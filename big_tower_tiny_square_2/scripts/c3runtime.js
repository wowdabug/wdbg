"use strict";(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,t(e.glMatrix={}))})(this,function(e){function t(e,t,s){var i=t[0],r=t[1],n=t[2];t=t[3];var a=s[0],o=s[1],h=s[2];return s=s[3],e[0]=i*a+n*o,e[1]=r*a+t*o,e[2]=i*h+n*s,e[3]=r*h+t*s,e}function s(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e}function i(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4];t=t[5];var h=s[0],l=s[1],c=s[2],u=s[3],_=s[4];return s=s[5],e[0]=i*h+n*l,e[1]=r*h+a*l,e[2]=i*c+n*u,e[3]=r*c+a*u,e[4]=i*_+n*s+o,e[5]=r*_+a*s+t,e}function r(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e}function n(){var e=new pe(9);return pe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function a(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7];t=t[8];var u=s[0],_=s[1],d=s[2],p=s[3],g=s[4],m=s[5],f=s[6],S=s[7];return s=s[8],e[0]=u*i+_*a+d*l,e[1]=u*r+_*o+d*c,e[2]=u*n+_*h+d*t,e[3]=p*i+g*a+m*l,e[4]=p*r+g*o+m*c,e[5]=p*n+g*h+m*t,e[6]=f*i+S*a+s*l,e[7]=f*r+S*o+s*c,e[8]=f*n+S*h+s*t,e}function o(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e[6]=t[6]-s[6],e[7]=t[7]-s[7],e[8]=t[8]-s[8],e}function h(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],_=t[9],d=t[10],p=t[11],g=t[12],m=t[13],f=t[14];t=t[15];var S=s[0],y=s[1],G=s[2],T=s[3];return e[0]=S*i+y*o+G*u+T*g,e[1]=S*r+y*h+G*_+T*m,e[2]=S*n+y*l+G*d+T*f,e[3]=S*a+y*c+G*p+T*t,S=s[4],y=s[5],G=s[6],T=s[7],e[4]=S*i+y*o+G*u+T*g,e[5]=S*r+y*h+G*_+T*m,e[6]=S*n+y*l+G*d+T*f,e[7]=S*a+y*c+G*p+T*t,S=s[8],y=s[9],G=s[10],T=s[11],e[8]=S*i+y*o+G*u+T*g,e[9]=S*r+y*h+G*_+T*m,e[10]=S*n+y*l+G*d+T*f,e[11]=S*a+y*c+G*p+T*t,S=s[12],y=s[13],G=s[14],T=s[15],e[12]=S*i+y*o+G*u+T*g,e[13]=S*r+y*h+G*_+T*m,e[14]=S*n+y*l+G*d+T*f,e[15]=S*a+y*c+G*p+T*t,e}function c(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,h=r+r,l=n+n;t=i*o;var c=i*h;i*=l;var u=r*h;return r*=l,n*=l,o*=a,h*=a,a*=l,e[0]=1-(u+n),e[1]=c+a,e[2]=i-h,e[3]=0,e[4]=c-a,e[5]=1-(t+n),e[6]=r+o,e[7]=0,e[8]=i+h,e[9]=r-o,e[10]=1-(t+u),e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e}function u(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function _(e,t){var s=t[4],i=t[5],r=t[6],n=t[8],a=t[9],o=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(s,i,r),e[2]=Math.hypot(n,a,o),e}function d(e,t){var s=new pe(3);_(s,t);var i=1/s[0],r=1/s[1],n=1/s[2],a=t[0]*i;s=t[1]*r;var o=t[2]*n,h=t[4]*i,l=t[5]*r,c=t[6]*n;return i*=t[8],r*=t[9],t=t[10]*n,n=a+l+t,0<n?(a=2*Math.sqrt(n+1),e[3]=.25*a,e[0]=(c-r)/a,e[1]=(i-o)/a,e[2]=(s-h)/a):a>l&&a>t?(a=2*Math.sqrt(1+a-l-t),e[3]=(c-r)/a,e[0]=.25*a,e[1]=(s+h)/a,e[2]=(i+o)/a):l>t?(a=2*Math.sqrt(1+l-a-t),e[3]=(i-o)/a,e[0]=(s+h)/a,e[1]=.25*a,e[2]=(c+r)/a):(a=2*Math.sqrt(1+t-a-l),e[3]=(s-h)/a,e[0]=(i+o)/a,e[1]=(c+r)/a,e[2]=.25*a),e}function p(e,t,s,i,r){return t=1/Math.tan(t/2),e[0]=t/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&1/0!==r?(s=1/(i-r),e[10]=(r+i)*s,e[14]=2*r*i*s):(e[10]=-1,e[14]=-2*i),e}function g(e,t,s,i,r,n,a){var o=1/(t-s),h=1/(i-r),l=1/(n-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+s)*o,e[13]=(r+i)*h,e[14]=(a+n)*l,e[15]=1,e}function m(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e[6]=t[6]-s[6],e[7]=t[7]-s[7],e[8]=t[8]-s[8],e[9]=t[9]-s[9],e[10]=t[10]-s[10],e[11]=t[11]-s[11],e[12]=t[12]-s[12],e[13]=t[13]-s[13],e[14]=t[14]-s[14],e[15]=t[15]-s[15],e}function f(){var e=new pe(3);return pe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function S(e){return Math.hypot(e[0],e[1],e[2])}function y(e,t,s){var i=new pe(3);return i[0]=e,i[1]=t,i[2]=s,i}function G(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e}function T(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e}function I(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e[2]=t[2]/s[2],e}function b(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function C(e,t){var s=t[0]-e[0],i=t[1]-e[1];return e=t[2]-e[2],s*s+i*i+e*e}function v(e){var t=e[0],s=e[1];return e=e[2],t*t+s*s+e*e}function P(e,t){var s=t[0],i=t[1],r=t[2];return s=s*s+i*i+r*r,0<s&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function x(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function R(e,t,s){var i=t[0],r=t[1];t=t[2];var n=s[0],a=s[1];return s=s[2],e[0]=r*s-t*a,e[1]=t*n-i*s,e[2]=i*a-r*n,e}function A(){var e=new pe(4);return pe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function w(e){var t=new pe(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function M(e,t,s,i){var r=new pe(4);return r[0]=e,r[1]=t,r[2]=s,r[3]=i,r}function D(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function E(e,t,s,i,r){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e}function B(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e}function O(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e}function F(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e[3]=t[3]*s[3],e}function k(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e[2]=t[2]/s[2],e[3]=t[3]/s[3],e}function L(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e}function N(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function W(e,t){var s=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return e=t[3]-e[3],s*s+i*i+r*r+e*e}function V(e){return Math.hypot(e[0],e[1],e[2],e[3])}function U(e){var t=e[0],s=e[1],i=e[2];return e=e[3],t*t+s*s+i*i+e*e}function j(e,t){var s=t[0],i=t[1],r=t[2];t=t[3];var n=s*s+i*i+r*r+t*t;return 0<n&&(n=1/Math.sqrt(n)),e[0]=s*n,e[1]=i*n,e[2]=r*n,e[3]=t*n,e}function H(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function X(e,t,s,i){var r=t[0],n=t[1],a=t[2];return t=t[3],e[0]=r+i*(s[0]-r),e[1]=n+i*(s[1]-n),e[2]=a+i*(s[2]-a),e[3]=t+i*(s[3]-t),e}function Y(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function q(){var e=new pe(4);return pe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function z(e,t,s){s*=.5;var i=Math.sin(s);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(s),e}function J(e,t,s){var i=t[0],r=t[1],n=t[2];t=t[3];var a=s[0],o=s[1],h=s[2];return s=s[3],e[0]=i*s+t*a+r*h-n*o,e[1]=r*s+t*o+n*a-i*h,e[2]=n*s+t*h+i*o-r*a,e[3]=t*s-i*a-r*o-n*h,e}function K(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2];t=t[3];var a=Math.sin(s);return s=Math.cos(s),e[0]=i*s+t*a,e[1]=r*s+n*a,e[2]=n*s-r*a,e[3]=t*s-i*a,e}function Q(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2];t=t[3];var a=Math.sin(s);return s=Math.cos(s),e[0]=i*s-n*a,e[1]=r*s+t*a,e[2]=n*s+i*a,e[3]=t*s-r*a,e}function Z(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2];t=t[3];var a=Math.sin(s);return s=Math.cos(s),e[0]=i*s+r*a,e[1]=r*s-i*a,e[2]=n*s+t*a,e[3]=t*s-n*a,e}function $(e,t){var s=t[0],i=t[1],r=t[2],n=Math.sqrt(s*s+i*i+r*r);t=Math.exp(t[3]);var a=0<n?t*Math.sin(n)/n:0;return e[0]=s*a,e[1]=i*a,e[2]=r*a,e[3]=t*Math.cos(n),e}function ee(e,t){var s=t[0],i=t[1],r=t[2];t=t[3];var n=Math.sqrt(s*s+i*i+r*r);return n=0<n?Math.atan2(n,t)/n:0,e[0]=s*n,e[1]=i*n,e[2]=r*n,e[3]=.5*Math.log(s*s+i*i+r*r+t*t),e}function te(e,t,s,i){var r=t[0],n=t[1],a=t[2];t=t[3];var o=s[0],h=s[1],l=s[2];s=s[3];var c=r*o+n*h+a*l+t*s;if(0>c&&(c=-c,o=-o,h=-h,l=-l,s=-s),1e-6<1-c){var u=Math.acos(c),_=Math.sin(u);c=Math.sin((1-i)*u)/_,i=Math.sin(i*u)/_}else c=1-i;return e[0]=c*r+i*o,e[1]=c*n+i*h,e[2]=c*a+i*l,e[3]=c*t+i*s,e}function se(e,t){var s=t[0]+t[4]+t[8];if(0<s)s=Math.sqrt(s+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var r=(i+1)%3,n=(i+2)%3;s=Math.sqrt(t[3*i+i]-t[3*r+r]-t[3*n+n]+1),e[i]=.5*s,s=.5/s,e[3]=(t[3*r+n]-t[3*n+r])*s,e[r]=(t[3*r+i]+t[3*i+r])*s,e[n]=(t[3*n+i]+t[3*i+n])*s}return e}function ie(e,t,s){var i=.5*s[0],r=.5*s[1];s=.5*s[2];var n=t[0],a=t[1],o=t[2];return t=t[3],e[0]=n,e[1]=a,e[2]=o,e[3]=t,e[4]=i*t+r*o-s*a,e[5]=r*t+s*n-i*o,e[6]=s*t+i*a-r*n,e[7]=-i*n-r*a-s*o,e}function re(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function ne(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=s[4],h=s[5],l=s[6],c=s[7],u=t[4],_=t[5],d=t[6];t=t[7];var p=s[0],g=s[1],m=s[2];return s=s[3],e[0]=i*s+a*p+r*m-n*g,e[1]=r*s+a*g+n*p-i*m,e[2]=n*s+a*m+i*g-r*p,e[3]=a*s-i*p-r*g-n*m,e[4]=i*c+a*o+r*l-n*h+u*s+t*p+_*m-d*g,e[5]=r*c+a*h+n*o-i*l+_*s+t*g+d*p-u*m,e[6]=n*c+a*l+i*h-r*o+d*s+t*m+u*g-_*p,e[7]=a*c-i*o-r*h-n*l+t*s-u*p-_*g-d*m,e}function ae(){var e=new pe(2);return pe!=Float32Array&&(e[0]=0,e[1]=0),e}function oe(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e}function he(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e}function le(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e}function ce(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function ue(e,t){var s=t[0]-e[0];return e=t[1]-e[1],s*s+e*e}function _e(e){return Math.hypot(e[0],e[1])}function de(e){var t=e[0];return e=e[1],t*t+e*e}var pe="undefined"!=typeof Float32Array?Float32Array:Array,ge=Math.random,me=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var fe,Se=Object.freeze({__proto__:null,EPSILON:1e-6,get ARRAY_TYPE(){return pe},RANDOM:ge,ANGLE_ORDER:"zyx",setMatrixArrayType:function(e){pe=e},toRadian:function(e){return e*me},equals:function(e,t){return Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))}}),ye=Object.freeze({__proto__:null,create:function(){var e=new pe(4);return pe!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new pe(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,s,i){var r=new pe(4);return r[0]=e,r[1]=t,r[2]=s,r[3]=i,r},set:function(e,t,s,i,r){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e},transpose:function(e,t){if(e===t){var s=t[1];e[1]=t[2],e[2]=s}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2];t=t[3];var n=s*t-r*i;return n?(n=1/n,e[0]=t*n,e[1]=-i*n,e[2]=-r*n,e[3]=s*n,e):null},adjoint:function(e,t){var s=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=s,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:t,rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2];t=t[3];var a=Math.sin(s);return s=Math.cos(s),e[0]=i*s+n*a,e[1]=r*s+t*a,e[2]=i*-a+n*s,e[3]=r*-a+t*s,e},scale:function(e,t,s){var i=t[1],r=t[2],n=t[3],a=s[0];return s=s[1],e[0]=t[0]*a,e[1]=i*a,e[2]=r*s,e[3]=n*s,e},fromRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=s,e[2]=-s,e[3]=t,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU:function(e,t,s,i){return e[2]=i[2]/i[0],s[0]=i[0],s[1]=i[1],s[3]=i[3]-e[2]*s[1],[e,t,s]},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e},subtract:s,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){var s=e[0],i=e[1],r=e[2];e=e[3];var n=t[0],a=t[1],o=t[2];return t=t[3],Math.abs(s-n)<=1e-6*Math.max(1,Math.abs(s),Math.abs(n))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e},mul:t,sub:s}),Ge=Object.freeze({__proto__:null,create:function(){var e=new pe(6);return pe!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new pe(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,s,i,r,n){var a=new pe(6);return a[0]=e,a[1]=t,a[2]=s,a[3]=i,a[4]=r,a[5]=n,a},set:function(e,t,s,i,r,n,a){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4];t=t[5];var o=s*n-i*r;return o?(o=1/o,e[0]=n*o,e[1]=-i*o,e[2]=-r*o,e[3]=s*o,e[4]=(r*t-n*a)*o,e[5]=(i*a-s*t)*o,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:i,rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4];t=t[5];var h=Math.sin(s);return s=Math.cos(s),e[0]=i*s+n*h,e[1]=r*s+a*h,e[2]=i*-h+n*s,e[3]=r*-h+a*s,e[4]=o,e[5]=t,e},scale:function(e,t,s){var i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=s[0];return s=s[1],e[0]=t[0]*h,e[1]=i*h,e[2]=r*s,e[3]=n*s,e[4]=a,e[5]=o,e},translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4];t=t[5];var h=s[0];return s=s[1],e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=i*h+n*s+o,e[5]=r*h+a*s+t,e},fromRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=s,e[2]=-s,e[3]=t,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e},subtract:r,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4];e=e[5];var o=t[0],h=t[1],l=t[2],c=t[3],u=t[4];return t=t[5],Math.abs(s-o)<=1e-6*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(i-h)<=1e-6*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-l)<=1e-6*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-c)<=1e-6*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-u)<=1e-6*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},mul:i,sub:r}),Te=Object.freeze({__proto__:null,create:n,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new pe(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,s,i,r,n,a,o,h){var l=new pe(9);return l[0]=e,l[1]=t,l[2]=s,l[3]=i,l[4]=r,l[5]=n,l[6]=a,l[7]=o,l[8]=h,l},set:function(e,t,s,i,r,n,a,o,h,l){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e[8]=l,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var s=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=s,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7];t=t[8];var c=t*a-o*l,u=-t*n+o*h,_=l*n-a*h,d=s*c+i*u+r*_;return d?(d=1/d,e[0]=c*d,e[1]=(-t*i+r*l)*d,e[2]=(o*i-r*a)*d,e[3]=u*d,e[4]=(t*s-r*h)*d,e[5]=(-o*s+r*n)*d,e[6]=_*d,e[7]=(-l*s+i*h)*d,e[8]=(a*s-i*n)*d,e):null},adjoint:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7];return t=t[8],e[0]=a*t-o*l,e[1]=r*l-i*t,e[2]=i*o-r*a,e[3]=o*h-n*t,e[4]=s*t-r*h,e[5]=r*n-s*o,e[6]=n*l-a*h,e[7]=i*h-s*l,e[8]=s*a-i*n,e},determinant:function(e){var t=e[3],s=e[4],i=e[5],r=e[6],n=e[7],a=e[8];return e[0]*(a*s-i*n)+e[1]*(-a*t+i*r)+e[2]*(n*t-s*r)},multiply:a,translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7];t=t[8];var u=s[0];return s=s[1],e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=o,e[5]=h,e[6]=u*i+s*a+l,e[7]=u*r+s*o+c,e[8]=u*n+s*h+t,e},rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7];t=t[8];var u=Math.sin(s);return s=Math.cos(s),e[0]=s*i+u*a,e[1]=s*r+u*o,e[2]=s*n+u*h,e[3]=s*a-u*i,e[4]=s*o-u*r,e[5]=s*h-u*n,e[6]=l,e[7]=c,e[8]=t,e},scale:function(e,t,s){var i=s[0];return s=s[1],e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=s,e[2]=0,e[3]=-s,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var s=t[0],i=t[1],r=t[2];t=t[3];var n=s+s,a=i+i,o=r+r;s*=n;var h=i*n;i*=a;var l=r*n,c=r*a;return r*=o,n*=t,a*=t,t*=o,e[0]=1-i-r,e[3]=h-t,e[6]=l+a,e[1]=h+t,e[4]=1-s-r,e[7]=c-n,e[2]=l-a,e[5]=c+n,e[8]=1-s-i,e},normalFromMat4:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],_=t[10],d=t[11],p=t[12],g=t[13],m=t[14];t=t[15];var f=s*o-i*a,S=s*h-r*a,y=s*l-n*a,G=i*h-r*o,T=i*l-n*o,I=r*l-n*h,b=c*g-u*p,C=c*m-_*p;c=c*t-d*p;var v=u*m-_*g;return u=u*t-d*g,_=_*t-d*m,d=f*_-S*u+y*v+G*c-T*C+I*b,d?(d=1/d,e[0]=(o*_-h*u+l*v)*d,e[1]=(h*c-a*_-l*C)*d,e[2]=(a*u-o*c+l*b)*d,e[3]=(r*u-i*_-n*v)*d,e[4]=(s*_-r*c+n*C)*d,e[5]=(i*c-s*u-n*b)*d,e[6]=(g*I-m*T+t*G)*d,e[7]=(m*y-p*I-t*S)*d,e[8]=(p*T-g*y+t*f)*d,e):null},projection:function(e,t,s){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/s,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e[8]=t[8]+s[8],e},subtract:o,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e[6]=t[6]+s[6]*i,e[7]=t[7]+s[7]*i,e[8]=t[8]+s[8]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],h=e[6],l=e[7];e=e[8];var c=t[0],u=t[1],_=t[2],d=t[3],p=t[4],g=t[5],m=t[6],f=t[7];return t=t[8],Math.abs(s-c)<=1e-6*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-u)<=1e-6*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-_)<=1e-6*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(n-d)<=1e-6*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=1e-6*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-g)<=1e-6*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(h-m)<=1e-6*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(l-f)<=1e-6*Math.max(1,Math.abs(l),Math.abs(f))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},mul:a,sub:o}),Ie=Object.freeze({__proto__:null,create:function(){var e=new pe(16);return pe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new pe(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,s,i,r,n,a,o,h,l,c,u,_,d,p,g){var m=new pe(16);return m[0]=e,m[1]=t,m[2]=s,m[3]=i,m[4]=r,m[5]=n,m[6]=a,m[7]=o,m[8]=h,m[9]=l,m[10]=c,m[11]=u,m[12]=_,m[13]=d,m[14]=p,m[15]=g,m},set:function(e,t,s,i,r,n,a,o,h,l,c,u,_,d,p,g,m){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e[8]=l,e[9]=c,e[10]=u,e[11]=_,e[12]=d,e[13]=p,e[14]=g,e[15]=m,e},identity:h,transpose:function(e,t){if(e===t){var s=t[1],i=t[2],r=t[3],n=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=s,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=r,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],_=t[10],d=t[11],p=t[12],g=t[13],m=t[14];t=t[15];var f=s*o-i*a,S=s*h-r*a,y=s*l-n*a,G=i*h-r*o,T=i*l-n*o,I=r*l-n*h,b=c*g-u*p,C=c*m-_*p,v=c*t-d*p,P=u*m-_*g,x=u*t-d*g,R=_*t-d*m,A=f*R-S*x+y*P+G*v-T*C+I*b;return A?(A=1/A,e[0]=(o*R-h*x+l*P)*A,e[1]=(r*x-i*R-n*P)*A,e[2]=(g*I-m*T+t*G)*A,e[3]=(_*T-u*I-d*G)*A,e[4]=(h*v-a*R-l*C)*A,e[5]=(s*R-r*v+n*C)*A,e[6]=(m*y-p*I-t*S)*A,e[7]=(c*I-_*y+d*S)*A,e[8]=(a*x-o*v+l*b)*A,e[9]=(i*v-s*x-n*b)*A,e[10]=(p*T-g*y+t*f)*A,e[11]=(u*y-c*T-d*f)*A,e[12]=(o*C-a*P-h*b)*A,e[13]=(s*P-i*C+r*b)*A,e[14]=(g*S-p*G-m*f)*A,e[15]=(c*G-u*S+_*f)*A,e):null},adjoint:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],_=t[10],d=t[11],p=t[12],g=t[13],m=t[14];t=t[15];var f=s*o-i*a,S=s*h-r*a,y=s*l-n*a,G=i*h-r*o,T=i*l-n*o,I=r*l-n*h,b=c*g-u*p,C=c*m-_*p,v=c*t-d*p,P=u*m-_*g,x=u*t-d*g,R=_*t-d*m;return e[0]=o*R-h*x+l*P,e[1]=r*x-i*R-n*P,e[2]=g*I-m*T+t*G,e[3]=_*T-u*I-d*G,e[4]=h*v-a*R-l*C,e[5]=s*R-r*v+n*C,e[6]=m*y-p*I-t*S,e[7]=c*I-_*y+d*S,e[8]=a*x-o*v+l*b,e[9]=i*v-s*x-n*b,e[10]=p*T-g*y+t*f,e[11]=u*y-c*T-d*f,e[12]=o*C-a*P-h*b,e[13]=s*P-i*C+r*b,e[14]=g*S-p*G-m*f,e[15]=c*G-u*S+_*f,e},determinant:function(e){var t=e[0],s=e[1],i=e[2],r=e[4],n=e[5],a=e[6],o=e[8],h=e[9],l=e[10],c=e[12],u=e[13],_=e[14],d=t*n-s*r,p=t*a-i*r,g=s*a-i*n,m=o*u-h*c,f=o*_-l*c,S=h*_-l*u;return e[7]*(t*S-s*f+i*m)-e[3]*(r*S-n*f+a*m)+e[15]*(o*g-h*p+l*d)-e[11]*(c*g-u*p+_*d)},multiply:l,translate:function(e,t,s){var i=s[0],r=s[1];if(s=s[2],t===e)e[12]=t[0]*i+t[4]*r+t[8]*s+t[12],e[13]=t[1]*i+t[5]*r+t[9]*s+t[13],e[14]=t[2]*i+t[6]*r+t[10]*s+t[14],e[15]=t[3]*i+t[7]*r+t[11]*s+t[15];else{var n=t[0],a=t[1],o=t[2],h=t[3],l=t[4],c=t[5],u=t[6],_=t[7],d=t[8],p=t[9],g=t[10],m=t[11];e[0]=n,e[1]=a,e[2]=o,e[3]=h,e[4]=l,e[5]=c,e[6]=u,e[7]=_,e[8]=d,e[9]=p,e[10]=g,e[11]=m,e[12]=n*i+l*r+d*s+t[12],e[13]=a*i+c*r+p*s+t[13],e[14]=o*i+u*r+g*s+t[14],e[15]=h*i+_*r+m*s+t[15]}return e},scale:function(e,t,s){var i=s[0],r=s[1];return s=s[2],e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,t,s,i){var r=i[0],n=i[1];i=i[2];var a=Math.hypot(r,n,i);if(1e-6>a)return null;a=1/a,r*=a,n*=a,i*=a;var o=Math.sin(s),h=Math.cos(s),l=1-h;s=t[0],a=t[1];var c=t[2],u=t[3],_=t[4],d=t[5],p=t[6],g=t[7],m=t[8],f=t[9],S=t[10],y=t[11],G=r*r*l+h,T=n*r*l+i*o,I=i*r*l-n*o,b=r*n*l-i*o,C=n*n*l+h,v=i*n*l+r*o,P=r*i*l+n*o;return r=n*i*l-r*o,n=i*i*l+h,e[0]=s*G+_*T+m*I,e[1]=a*G+d*T+f*I,e[2]=c*G+p*T+S*I,e[3]=u*G+g*T+y*I,e[4]=s*b+_*C+m*v,e[5]=a*b+d*C+f*v,e[6]=c*b+p*C+S*v,e[7]=u*b+g*C+y*v,e[8]=s*P+_*r+m*n,e[9]=a*P+d*r+f*n,e[10]=c*P+p*r+S*n,e[11]=u*P+g*r+y*n,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},rotateX:function(e,t,s){var i=Math.sin(s);s=Math.cos(s);var r=t[4],n=t[5],a=t[6],o=t[7],h=t[8],l=t[9],c=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=r*s+h*i,e[5]=n*s+l*i,e[6]=a*s+c*i,e[7]=o*s+u*i,e[8]=h*s-r*i,e[9]=l*s-n*i,e[10]=c*s-a*i,e[11]=u*s-o*i,e},rotateY:function(e,t,s){var i=Math.sin(s);s=Math.cos(s);var r=t[0],n=t[1],a=t[2],o=t[3],h=t[8],l=t[9],c=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*s-h*i,e[1]=n*s-l*i,e[2]=a*s-c*i,e[3]=o*s-u*i,e[8]=r*i+h*s,e[9]=n*i+l*s,e[10]=a*i+c*s,e[11]=o*i+u*s,e},rotateZ:function(e,t,s){var i=Math.sin(s);s=Math.cos(s);var r=t[0],n=t[1],a=t[2],o=t[3],h=t[4],l=t[5],c=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*s+h*i,e[1]=n*s+l*i,e[2]=a*s+c*i,e[3]=o*s+u*i,e[4]=h*s-r*i,e[5]=l*s-n*i,e[6]=c*s-a*i,e[7]=u*s-o*i,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,s){var i=s[0],r=s[1];s=s[2];var n=Math.hypot(i,r,s);if(1e-6>n)return null;n=1/n,i*=n,r*=n,s*=n,n=Math.sin(t),t=Math.cos(t);var a=1-t;return e[0]=i*i*a+t,e[1]=r*i*a+s*n,e[2]=s*i*a-r*n,e[3]=0,e[4]=i*r*a-s*n,e[5]=r*r*a+t,e[6]=s*r*a+i*n,e[7]=0,e[8]=i*s*a+r*n,e[9]=r*s*a-i*n,e[10]=s*s*a+t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromXRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=s,e[7]=0,e[8]=0,e[9]=-s,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=0,e[2]=-s,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=s,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var s=Math.sin(t);return t=Math.cos(t),e[0]=t,e[1]=s,e[2]=0,e[3]=0,e[4]=-s,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:c,fromQuat2:function(e,t){var s=new pe(3),i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],_=i*i+r*r+n*n+a*a;return 0<_?(s[0]=2*(o*a+u*i+h*n-l*r)/_,s[1]=2*(h*a+u*r+l*i-o*n)/_,s[2]=2*(l*a+u*n+o*r-h*i)/_):(s[0]=2*(o*a+u*i+h*n-l*r),s[1]=2*(h*a+u*r+l*i-o*n),s[2]=2*(l*a+u*n+o*r-h*i)),c(e,t,s),e},getTranslation:u,getScaling:_,getRotation:d,decompose:function(e,t,s,i){t[0]=i[12],t[1]=i[13],t[2]=i[14];var r=i[0],n=i[1],a=i[2],o=i[4],h=i[5],l=i[6],c=i[8];t=i[9],i=i[10],s[0]=Math.hypot(r,n,a),s[1]=Math.hypot(o,h,l),s[2]=Math.hypot(c,t,i);var u=1/s[0],_=1/s[1],d=1/s[2];return s=r*u,n*=_,a*=d,o*=u,h*=_,l*=d,c*=u,t*=_,i*=d,_=s+h+i,0<_?(i=2*Math.sqrt(_+1),e[3]=.25*i,e[0]=(l-t)/i,e[1]=(c-a)/i,e[2]=(n-o)/i):s>h&&s>i?(i=2*Math.sqrt(1+s-h-i),e[3]=(l-t)/i,e[0]=.25*i,e[1]=(n+o)/i,e[2]=(c+a)/i):h>i?(i=2*Math.sqrt(1+h-s-i),e[3]=(c-a)/i,e[0]=(n+o)/i,e[1]=.25*i,e[2]=(l+t)/i):(i=2*Math.sqrt(1+i-s-h),e[3]=(n-o)/i,e[0]=(c+a)/i,e[1]=(l+t)/i,e[2]=.25*i),e},fromRotationTranslationScale:function(e,t,s,i){var r=t[0],n=t[1],a=t[2],o=t[3],h=r+r,l=n+n,c=a+a;t=r*h;var u=r*l;r*=c;var _=n*l;n*=c,a*=c,h*=o,l*=o,o*=c,c=i[0];var d=i[1];return i=i[2],e[0]=(1-(_+a))*c,e[1]=(u+o)*c,e[2]=(r-l)*c,e[3]=0,e[4]=(u-o)*d,e[5]=(1-(t+a))*d,e[6]=(n+h)*d,e[7]=0,e[8]=(r+l)*i,e[9]=(n-h)*i,e[10]=(1-(t+_))*i,e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,s,i,r){var n=t[0],a=t[1],o=t[2],h=t[3],l=n+n,c=a+a,u=o+o;t=n*l;var _=n*c,d=n*u;n=a*c,a*=u;var p=o*u;o=h*l,c*=h;var g=h*u,m=i[0],f=i[1];u=i[2],i=r[0],h=r[1],r=r[2],l=(1-(n+p))*m;var S=(_+g)*m;return m*=d-c,_=(_-g)*f,p=(1-(t+p))*f,f*=a+o,d=(d+c)*u,a=(a-o)*u,t=(1-(t+n))*u,e[0]=l,e[1]=S,e[2]=m,e[3]=0,e[4]=_,e[5]=p,e[6]=f,e[7]=0,e[8]=d,e[9]=a,e[10]=t,e[11]=0,e[12]=s[0]+i-(l*i+_*h+d*r),e[13]=s[1]+h-(S*i+p*h+a*r),e[14]=s[2]+r-(m*i+f*h+t*r),e[15]=1,e},fromQuat:function(e,t){var s=t[0],i=t[1],r=t[2];t=t[3];var n=s+s,a=i+i,o=r+r;s*=n;var h=i*n;i*=a;var l=r*n,c=r*a;return r*=o,n*=t,a*=t,t*=o,e[0]=1-i-r,e[1]=h+t,e[2]=l-a,e[3]=0,e[4]=h-t,e[5]=1-s-r,e[6]=c+n,e[7]=0,e[8]=l+a,e[9]=c-n,e[10]=1-s-i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,s,i,r,n,a){var o=1/(s-t),h=1/(r-i),l=1/(n-a);return e[0]=2*n*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*h,e[6]=0,e[7]=0,e[8]=(s+t)*o,e[9]=(r+i)*h,e[10]=(a+n)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*n*2*l,e[15]=0,e},perspectiveNO:p,perspective:p,perspectiveZO:function(e,t,s,i,r){return t=1/Math.tan(t/2),e[0]=t/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&1/0!==r?(s=1/(i-r),e[10]=r*s,e[14]=r*i*s):(e[10]=-1,e[14]=-i),e},perspectiveFromFieldOfView:function(e,t,s,i){var r=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180);t=Math.tan(t.rightDegrees*Math.PI/180);var o=2/(a+t),h=2/(r+n);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-(a-t)*o*.5,e[9]=(r-n)*h*.5,e[10]=i/(s-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*s/(s-i),e[15]=0,e},orthoNO:g,ortho:g,orthoZO:function(e,t,s,i,r,n,a){var o=1/(t-s),h=1/(i-r);return a=1/(n-a),e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a,e[11]=0,e[12]=(t+s)*o,e[13]=(r+i)*h,e[14]=n*a,e[15]=1,e},lookAt:function(e,t,s,i){var r=t[0],n=t[1];t=t[2];var a=i[0],o=i[1],l=i[2],c=s[0];i=s[1];var u=s[2];if(1e-6>Math.abs(r-c)&&1e-6>Math.abs(n-i)&&1e-6>Math.abs(t-u))return h(e);s=r-c,i=n-i,c=t-u;var _=1/Math.hypot(s,i,c);s*=_,i*=_,c*=_,u=o*c-l*i,l=l*s-a*c,a=a*i-o*s,(_=Math.hypot(u,l,a))?(_=1/_,u*=_,l*=_,a*=_):a=l=u=0,o=i*a-c*l;var d=c*u-s*a,p=s*l-i*u;return(_=Math.hypot(o,d,p))?(_=1/_,o*=_,d*=_,p*=_):p=d=o=0,e[0]=u,e[1]=o,e[2]=s,e[3]=0,e[4]=l,e[5]=d,e[6]=i,e[7]=0,e[8]=a,e[9]=p,e[10]=c,e[11]=0,e[12]=-(u*r+l*n+a*t),e[13]=-(o*r+d*n+p*t),e[14]=-(s*r+i*n+c*t),e[15]=1,e},targetTo:function(e,t,s,i){var r=t[0],n=t[1];t=t[2];var a=i[0],o=i[1],h=i[2];i=r-s[0];var l=n-s[1];s=t-s[2];var c=i*i+l*l+s*s;0<c&&(c=1/Math.sqrt(c),i*=c,l*=c,s*=c);var u=o*s-h*l;return h=h*i-a*s,a=a*l-o*i,c=u*u+h*h+a*a,0<c&&(c=1/Math.sqrt(c),u*=c,h*=c,a*=c),e[0]=u,e[1]=h,e[2]=a,e[3]=0,e[4]=l*a-s*h,e[5]=s*u-i*a,e[6]=i*h-l*u,e[7]=0,e[8]=i,e[9]=l,e[10]=s,e[11]=0,e[12]=r,e[13]=n,e[14]=t,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e[8]=t[8]+s[8],e[9]=t[9]+s[9],e[10]=t[10]+s[10],e[11]=t[11]+s[11],e[12]=t[12]+s[12],e[13]=t[13]+s[13],e[14]=t[14]+s[14],e[15]=t[15]+s[15],e},subtract:m,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12]*s,e[13]=t[13]*s,e[14]=t[14]*s,e[15]=t[15]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e[6]=t[6]+s[6]*i,e[7]=t[7]+s[7]*i,e[8]=t[8]+s[8]*i,e[9]=t[9]+s[9]*i,e[10]=t[10]+s[10]*i,e[11]=t[11]+s[11]*i,e[12]=t[12]+s[12]*i,e[13]=t[13]+s[13]*i,e[14]=t[14]+s[14]*i,e[15]=t[15]+s[15]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,t){
var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=e[9],_=e[10],d=e[11],p=e[12],g=e[13],m=e[14];e=e[15];var f=t[0],S=t[1],y=t[2],G=t[3],T=t[4],I=t[5],b=t[6],C=t[7],v=t[8],P=t[9],x=t[10],R=t[11],A=t[12],w=t[13],M=t[14];return t=t[15],Math.abs(s-f)<=1e-6*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(i-S)<=1e-6*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-y)<=1e-6*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-G)<=1e-6*Math.max(1,Math.abs(n),Math.abs(G))&&Math.abs(a-T)<=1e-6*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(o-I)<=1e-6*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(h-b)<=1e-6*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(l-C)<=1e-6*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-v)<=1e-6*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-P)<=1e-6*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(_-x)<=1e-6*Math.max(1,Math.abs(_),Math.abs(x))&&Math.abs(d-R)<=1e-6*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-A)<=1e-6*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(g-w)<=1e-6*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(m-M)<=1e-6*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},mul:l,sub:m}),be=(fe=f(),function(e,t,s,i,r,n){for(t||(t=3),s||(s=0),i=i?Math.min(i*t+s,e.length):e.length;s<i;s+=t)fe[0]=e[s],fe[1]=e[s+1],fe[2]=e[s+2],r(fe,fe,n),e[s]=fe[0],e[s+1]=fe[1],e[s+2]=fe[2];return e});be=Object.freeze({__proto__:null,create:f,clone:function(e){var t=new pe(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:S,fromValues:y,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,s,i){return e[0]=t,e[1]=s,e[2]=i,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e},subtract:G,multiply:T,divide:I,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e},scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e},distance:b,squaredDistance:C,squaredLength:v,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:P,dot:x,cross:R,lerp:function(e,t,s,i){var r=t[0],n=t[1];return t=t[2],e[0]=r+i*(s[0]-r),e[1]=n+i*(s[1]-n),e[2]=t+i*(s[2]-t),e},slerp:function(e,t,s,i){var r=Math.acos(Math.min(Math.max(x(t,s),-1),1)),n=Math.sin(r),a=Math.sin((1-i)*r)/n;return i=Math.sin(i*r)/n,e[0]=a*t[0]+i*s[0],e[1]=a*t[1]+i*s[1],e[2]=a*t[2]+i*s[2],e},hermite:function(e,t,s,i,r,n){var a=n*n,o=a*(2*n-3)+1,h=a*(n-2)+n,l=a*(n-1);return n=a*(3-2*n),e[0]=t[0]*o+s[0]*h+i[0]*l+r[0]*n,e[1]=t[1]*o+s[1]*h+i[1]*l+r[1]*n,e[2]=t[2]*o+s[2]*h+i[2]*l+r[2]*n,e},bezier:function(e,t,s,i,r,n){var a=1-n,o=a*a,h=n*n,l=o*a;return o*=3*n,a*=3*h,n*=h,e[0]=t[0]*l+s[0]*o+i[0]*a+r[0]*n,e[1]=t[1]*l+s[1]*o+i[1]*a+r[1]*n,e[2]=t[2]*l+s[2]*o+i[2]*a+r[2]*n,e},random:function(e,t){t=t||1;var s=2*ge()*Math.PI,i=2*ge()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(s)*r,e[1]=Math.sin(s)*r,e[2]=i*t,e},transformMat4:function(e,t,s){var i=t[0],r=t[1];t=t[2];var n=s[3]*i+s[7]*r+s[11]*t+s[15];return n=n||1,e[0]=(s[0]*i+s[4]*r+s[8]*t+s[12])/n,e[1]=(s[1]*i+s[5]*r+s[9]*t+s[13])/n,e[2]=(s[2]*i+s[6]*r+s[10]*t+s[14])/n,e},transformMat3:function(e,t,s){var i=t[0],r=t[1];return t=t[2],e[0]=i*s[0]+r*s[3]+t*s[6],e[1]=i*s[1]+r*s[4]+t*s[7],e[2]=i*s[2]+r*s[5]+t*s[8],e},transformQuat:function(e,t,s){var i=s[0],r=s[1],n=s[2],a=t[0],o=t[1];t=t[2];var h=r*t-n*o,l=n*a-i*t,c=i*o-r*a;return s=2*s[3],e[0]=a+h*s+2*(r*c-n*l),e[1]=o+l*s+2*(n*h-i*c),e[2]=t+c*s+2*(i*l-r*h),e},rotateX:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[0],n[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),n[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},rotateY:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),n[1]=r[1],n[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},rotateZ:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),n[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),n[2]=r[2],e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},angle:function(e,t){var s=e[0],i=e[1],r=e[2],n=t[0],a=t[1],o=t[2];return e=(s=Math.sqrt((s*s+i*i+r*r)*(n*n+a*a+o*o)))&&x(e,t)/s,Math.acos(Math.min(Math.max(e,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var s=e[0],i=e[1];e=e[2];var r=t[0],n=t[1];return t=t[2],Math.abs(s-r)<=1e-6*Math.max(1,Math.abs(s),Math.abs(r))&&Math.abs(i-n)<=1e-6*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},sub:G,mul:T,div:I,dist:b,sqrDist:C,len:S,sqrLen:v,forEach:be});var Ce=function(){var e=A();return function(t,s,i,r,n,a){for(s||(s=4),i||(i=0),r=r?Math.min(r*s+i,t.length):t.length;i<r;i+=s)e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],e[3]=t[i+3],n(e,e,a),t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3];return t}}();Ce=Object.freeze({__proto__:null,create:A,clone:w,fromValues:M,copy:D,set:E,add:B,subtract:O,multiply:F,divide:k,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e[3]=Math.min(t[3],s[3]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e[3]=Math.max(t[3],s[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:L,scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e},distance:N,squaredDistance:W,length:V,squaredLength:U,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:j,dot:H,cross:function(e,t,s,i){var r=s[0]*i[1]-s[1]*i[0],n=s[0]*i[2]-s[2]*i[0],a=s[0]*i[3]-s[3]*i[0],o=s[1]*i[2]-s[2]*i[1],h=s[1]*i[3]-s[3]*i[1];s=s[2]*i[3]-s[3]*i[2],i=t[0];var l=t[1],c=t[2];return t=t[3],e[0]=l*s-c*h+t*o,e[1]=-i*s+c*a-t*n,e[2]=i*h-l*a+t*r,e[3]=-i*o+l*n-c*r,e},lerp:X,random:function(e,t){t=t||1;do{var s=2*ge()-1,i=2*ge()-1,r=s*s+i*i}while(1<=r);do{var n=2*ge()-1,a=2*ge()-1,o=n*n+a*a}while(1<=o);return r=Math.sqrt((1-r)/o),e[0]=t*s,e[1]=t*i,e[2]=t*n*r,e[3]=t*a*r,e},transformMat4:function(e,t,s){var i=t[0],r=t[1],n=t[2];return t=t[3],e[0]=s[0]*i+s[4]*r+s[8]*n+s[12]*t,e[1]=s[1]*i+s[5]*r+s[9]*n+s[13]*t,e[2]=s[2]*i+s[6]*r+s[10]*n+s[14]*t,e[3]=s[3]*i+s[7]*r+s[11]*n+s[15]*t,e},transformQuat:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=s[0],o=s[1],h=s[2];s=s[3];var l=s*i+o*n-h*r,c=s*r+h*i-a*n,u=s*n+a*r-o*i;return i=-a*i-o*r-h*n,e[0]=l*s+i*-a+c*-h-u*-o,e[1]=c*s+i*-o+u*-a-l*-h,e[2]=u*s+i*-h+l*-o-c*-a,e[3]=t[3],e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:Y,equals:function(e,t){var s=e[0],i=e[1],r=e[2];e=e[3];var n=t[0],a=t[1],o=t[2];return t=t[3],Math.abs(s-n)<=1e-6*Math.max(1,Math.abs(s),Math.abs(n))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},sub:O,mul:F,div:k,dist:N,sqrDist:W,len:V,sqrLen:U,forEach:Ce});var ve=function(){var e=f(),t=y(1,0,0),s=y(0,1,0);return function(i,r,n){var a=x(r,n);return-.999999>a?(R(e,t,r),1e-6>S(e)&&R(e,s,r),P(e,e),z(i,e,Math.PI),i):.999999<a?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(R(e,r,n),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+a,j(i,i))}}(),Pe=function(){var e=q(),t=q();return function(s,i,r,n,a,o){return te(e,i,a,o),te(t,r,n,o),te(s,e,t,2*o*(1-o)),s}}(),xe=function(){var e=n();return function(t,s,i,r){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-s[0],e[5]=-s[1],e[8]=-s[2],j(t,se(t,e))}}();ve=Object.freeze({__proto__:null,create:q,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:z,getAxisAngle:function(e,t){var s=2*Math.acos(t[3]),i=Math.sin(s/2);return 1e-6<i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),s},getAngle:function(e,t){return e=H(e,t),Math.acos(2*e*e-1)},multiply:J,rotateX:K,rotateY:Q,rotateZ:Z,calculateW:function(e,t){var s=t[0],i=t[1];return t=t[2],e[0]=s,e[1]=i,e[2]=t,e[3]=Math.sqrt(Math.abs(1-s*s-i*i-t*t)),e},exp:$,ln:ee,pow:function(e,t,s){return ee(e,t),L(e,e,s),$(e,e),e},slerp:te,random:function(e){var t=ge(),s=ge(),i=ge(),r=Math.sqrt(1-t);return t=Math.sqrt(t),e[0]=r*Math.sin(2*Math.PI*s),e[1]=r*Math.cos(2*Math.PI*s),e[2]=t*Math.sin(2*Math.PI*i),e[3]=t*Math.cos(2*Math.PI*i),e},invert:function(e,t){var s=t[0],i=t[1],r=t[2];t=t[3];var n=s*s+i*i+r*r+t*t;return n=n?1/n:0,e[0]=-s*n,e[1]=-i*n,e[2]=-r*n,e[3]=t*n,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:se,fromEuler:function(e,t,s,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"zyx",n=Math.PI/360;t*=n,i*=n,s*=n,n=Math.sin(t);var a=Math.cos(t),o=Math.sin(s),h=Math.cos(s),l=Math.sin(i),c=Math.cos(i);switch(r){case"xyz":e[0]=n*h*c+a*o*l,e[1]=a*o*c-n*h*l,e[2]=a*h*l+n*o*c,e[3]=a*h*c-n*o*l;break;case"xzy":e[0]=n*h*c-a*o*l,e[1]=a*o*c-n*h*l,e[2]=a*h*l+n*o*c,e[3]=a*h*c+n*o*l;break;case"yxz":e[0]=n*h*c+a*o*l,e[1]=a*o*c-n*h*l,e[2]=a*h*l-n*o*c,e[3]=a*h*c+n*o*l;break;case"yzx":e[0]=n*h*c+a*o*l,e[1]=a*o*c+n*h*l,e[2]=a*h*l-n*o*c,e[3]=a*h*c-n*o*l;break;case"zxy":e[0]=n*h*c-a*o*l,e[1]=a*o*c+n*h*l,e[2]=a*h*l+n*o*c,e[3]=a*h*c-n*o*l;break;case"zyx":e[0]=n*h*c-a*o*l,e[1]=a*o*c+n*h*l,e[2]=a*h*l-n*o*c,e[3]=a*h*c+n*o*l;break;default:throw Error("Unknown angle order "+r)}return e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:w,fromValues:M,copy:D,set:E,add:B,mul:J,scale:L,dot:H,lerp:X,length:V,len:V,squaredLength:U,sqrLen:U,normalize:j,exactEquals:Y,equals:function(e,t){return.999999<=Math.abs(H(e,t))},rotationTo:ve,sqlerp:Pe,setAxes:xe}),Pe=Object.freeze({__proto__:null,create:function(){var e=new pe(8);return pe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new pe(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,s,i,r,n,a,o){var h=new pe(8);return h[0]=e,h[1]=t,h[2]=s,h[3]=i,h[4]=r,h[5]=n,h[6]=a,h[7]=o,h},fromRotationTranslationValues:function(e,t,s,i,r,n,a){var o=new pe(8);return o[0]=e,o[1]=t,o[2]=s,o[3]=i,r*=.5,n*=.5,a*=.5,o[4]=r*i+n*s-a*t,o[5]=n*i+a*e-r*s,o[6]=a*i+r*t-n*e,o[7]=-r*e-n*t-a*s,o},fromRotationTranslation:ie,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var s=q();d(s,t);var i=new pe(3);return u(i,t),ie(e,s,i),e},copy:re,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,s,i,r,n,a,o,h){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e},getReal:D,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:D,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var s=t[4],i=t[5],r=t[6],n=t[7],a=-t[0],o=-t[1],h=-t[2];return t=t[3],e[0]=2*(s*t+n*a+i*h-r*o),e[1]=2*(i*t+n*o+r*a-s*h),e[2]=2*(r*t+n*h+s*o-i*a),e},translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=.5*s[0],h=.5*s[1];s=.5*s[2];var l=t[4],c=t[5],u=t[6];return t=t[7],e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=a*o+r*s-n*h+l,e[5]=a*h+n*o-i*s+c,e[6]=a*s+i*h-r*o+u,e[7]=-i*o-r*h-n*s+t,e},rotateX:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,_=h*a+c*r+l*i-o*n,d=l*a+c*n+o*r-h*i;return o=c*a-o*i-h*r-l*n,K(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+o*i+_*n-d*r,e[5]=_*a+o*r+d*i-u*n,e[6]=d*a+o*n+u*r-_*i,e[7]=o*a-u*i-_*r-d*n,e},rotateY:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,_=h*a+c*r+l*i-o*n,d=l*a+c*n+o*r-h*i;return o=c*a-o*i-h*r-l*n,Q(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+o*i+_*n-d*r,e[5]=_*a+o*r+d*i-u*n,e[6]=d*a+o*n+u*r-_*i,e[7]=o*a-u*i-_*r-d*n,e},rotateZ:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,_=h*a+c*r+l*i-o*n,d=l*a+c*n+o*r-h*i;return o=c*a-o*i-h*r-l*n,Z(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+o*i+_*n-d*r,e[5]=_*a+o*r+d*i-u*n,e[6]=d*a+o*n+u*r-_*i,e[7]=o*a-u*i-_*r-d*n,e},rotateByQuatAppend:function(e,t,s){var i=s[0],r=s[1],n=s[2];s=s[3];var a=t[0],o=t[1],h=t[2],l=t[3];return e[0]=a*s+l*i+o*n-h*r,e[1]=o*s+l*r+h*i-a*n,e[2]=h*s+l*n+a*r-o*i,e[3]=l*s-a*i-o*r-h*n,a=t[4],o=t[5],h=t[6],l=t[7],e[4]=a*s+l*i+o*n-h*r,e[5]=o*s+l*r+h*i-a*n,e[6]=h*s+l*n+a*r-o*i,e[7]=l*s-a*i-o*r-h*n,e},rotateByQuatPrepend:function(e,t,s){var i=t[0],r=t[1],n=t[2];t=t[3];var a=s[0],o=s[1],h=s[2],l=s[3];return e[0]=i*l+t*a+r*h-n*o,e[1]=r*l+t*o+n*a-i*h,e[2]=n*l+t*h+i*o-r*a,e[3]=t*l-i*a-r*o-n*h,a=s[4],o=s[5],h=s[6],l=s[7],e[4]=i*l+t*a+r*h-n*o,e[5]=r*l+t*o+n*a-i*h,e[6]=n*l+t*h+i*o-r*a,e[7]=t*l-i*a-r*o-n*h,e},rotateAroundAxis:function(e,t,s,i){if(1e-6>Math.abs(i))return re(e,t);var r=Math.hypot(s[0],s[1],s[2]);i*=.5;var n=Math.sin(i),a=n*s[0]/r,o=n*s[1]/r;s=n*s[2]/r,i=Math.cos(i),r=t[0],n=t[1];var h=t[2],l=t[3];return e[0]=r*i+l*a+n*s-h*o,e[1]=n*i+l*o+h*a-r*s,e[2]=h*i+l*s+r*o-n*a,e[3]=l*i-r*a-n*o-h*s,r=t[4],n=t[5],h=t[6],t=t[7],e[4]=r*i+t*a+n*s-h*o,e[5]=n*i+t*o+h*a-r*s,e[6]=h*i+t*s+r*o-n*a,e[7]=t*i-r*a-n*o-h*s,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e},multiply:ne,mul:ne,scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e},dot:H,lerp:function(e,t,s,i){var r=1-i;return 0>H(t,s)&&(i=-i),e[0]=t[0]*r+s[0]*i,e[1]=t[1]*r+s[1]*i,e[2]=t[2]*r+s[2]*i,e[3]=t[3]*r+s[3]*i,e[4]=t[4]*r+s[4]*i,e[5]=t[5]*r+s[5]*i,e[6]=t[6]*r+s[6]*i,e[7]=t[7]*r+s[7]*i,e},invert:function(e,t){var s=U(t);return e[0]=-t[0]/s,e[1]=-t[1]/s,e[2]=-t[2]/s,e[3]=t[3]/s,e[4]=-t[4]/s,e[5]=-t[5]/s,e[6]=-t[6]/s,e[7]=t[7]/s,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:V,len:V,squaredLength:U,sqrLen:U,normalize:function(e,t){var s=U(t);if(0<s){s=Math.sqrt(s);var i=t[0]/s,r=t[1]/s,n=t[2]/s,a=t[3]/s,o=t[4],h=t[5],l=t[6];t=t[7];var c=i*o+r*h+n*l+a*t;e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=(o-i*c)/s,e[5]=(h-r*c)/s,e[6]=(l-n*c)/s,e[7]=(t-a*c)/s}return e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,t){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],h=e[6];e=e[7];var l=t[0],c=t[1],u=t[2],_=t[3],d=t[4],p=t[5],g=t[6];return t=t[7],Math.abs(s-l)<=1e-6*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(i-c)<=1e-6*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-u)<=1e-6*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-_)<=1e-6*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-d)<=1e-6*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-p)<=1e-6*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(h-g)<=1e-6*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))}}),xe=function(){var e=ae();return function(t,s,i,r,n,a){for(s||(s=2),i||(i=0),r=r?Math.min(r*s+i,t.length):t.length;i<r;i+=s)e[0]=t[i],e[1]=t[i+1],n(e,e,a),t[i]=e[0],t[i+1]=e[1];return t}}(),xe=Object.freeze({__proto__:null,create:ae,clone:function(e){var t=new pe(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var s=new pe(2);return s[0]=e,s[1]=t,s},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,s){return e[0]=t,e[1]=s,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e},subtract:oe,multiply:he,divide:le,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e},scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e},distance:ce,squaredDistance:ue,length:_e,squaredLength:de,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var s=t[0],i=t[1];return s=s*s+i*i,0<s&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,s){return t=t[0]*s[1]-t[1]*s[0],e[0]=e[1]=0,e[2]=t,e},lerp:function(e,t,s,i){var r=t[0];return t=t[1],e[0]=r+i*(s[0]-r),e[1]=t+i*(s[1]-t),e},random:function(e,t){t=t||1;var s=2*ge()*Math.PI;return e[0]=Math.cos(s)*t,e[1]=Math.sin(s)*t,e},transformMat2:function(e,t,s){var i=t[0];return t=t[1],e[0]=s[0]*i+s[2]*t,e[1]=s[1]*i+s[3]*t,e},transformMat2d:function(e,t,s){var i=t[0];return t=t[1],e[0]=s[0]*i+s[2]*t+s[4],e[1]=s[1]*i+s[3]*t+s[5],e},transformMat3:function(e,t,s){var i=t[0];return t=t[1],e[0]=s[0]*i+s[3]*t+s[6],e[1]=s[1]*i+s[4]*t+s[7],e},transformMat4:function(e,t,s){var i=t[0];return t=t[1],e[0]=s[0]*i+s[4]*t+s[12],e[1]=s[1]*i+s[5]*t+s[13],e},rotate:function(e,t,s,i){var r=t[0]-s[0];t=t[1]-s[1];var n=Math.sin(i);return i=Math.cos(i),e[0]=r*i-t*n+s[0],e[1]=r*n+t*i+s[1],e},angle:function(e,t){var s=e[0];e=e[1];var i=t[0];t=t[1];var r=Math.sqrt((s*s+e*e)*(i*i+t*t));return Math.acos(Math.min(Math.max(r&&(s*i+e*t)/r,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,t){var s=e[0];e=e[1];var i=t[0];return t=t[1],Math.abs(s-i)<=1e-6*Math.max(1,Math.abs(s),Math.abs(i))&&Math.abs(e-t)<=1e-6*Math.max(1,Math.abs(e),Math.abs(t))},len:_e,sub:oe,mul:he,div:le,dist:ce,sqrDist:ue,sqrLen:de,forEach:xe}),e.glMatrix=Se,e.mat2=ye,e.mat2d=Ge,e.mat3=Te,e.mat4=Ie,e.quat=ve,e.quat2=Pe,e.vec2=xe,e.vec3=be,e.vec4=Ce,Object.defineProperty(e,"__esModule",{value:!0})});{function e(e,t,s){var i=[0,0],r=e[1][1]-e[0][1],n=e[0][0]-e[1][0];e=r*e[0][0]+n*e[0][1];var a=t[1][1]-t[0][1],o=t[0][0]-t[1][0];t=a*t[0][0]+o*t[0][1];var h=r*o-a*n;return E(h,0,s||0)||(i[0]=(o*e-n*t)/h,i[1]=(r*t-a*e)/h),i}function b(e,t,s,i){var r=t[0]-e[0];t=t[1]-e[1];var n=i[0]-s[0],a=i[1]-s[1];return 0!=n*t-a*r&&(i=(r*(s[1]-e[1])+t*(e[0]-s[0]))/(n*t-a*r),e=(n*(e[1]-s[1])+a*(s[0]-e[0]))/(a*r-n*t),0<=i&&1>=i&&0<=e&&1>=e)}function a(e,t,s){return(t[0]-e[0])*(s[1]-e[1])-(s[0]-e[0])*(t[1]-e[1])}function c(e,t,s){return 0<a(e,t,s)}function d(e,t,s){return 0<=a(e,t,s)}function f(e,t,s){return 0>a(e,t,s)}function h(e,t,s){return 0>=a(e,t,s)}var tmpPoint1$$module$str$c3runtime=[],tmpPoint2$$module$str$c3runtime=[];function g(e,t,s,i){if(i){var r=tmpPoint1$$module$str$c3runtime,n=tmpPoint2$$module$str$c3runtime;return r[0]=t[0]-e[0],r[1]=t[1]-e[1],n[0]=s[0]-t[0],n[1]=s[1]-t[1],Math.acos((r[0]*n[0]+r[1]*n[1])/(Math.sqrt(r[0]*r[0]+r[1]*r[1])*Math.sqrt(n[0]*n[0]+n[1]*n[1])))<i}return 0===a(e,t,s)}function k(e,t){var s=t[0]-e[0];return e=t[1]-e[1],s*s+e*e}function m(e,t){var s=e.length;return e[0>t?t%s+s:t%s]}function u(e){e.length=0}function v(e,t,s,i){for(;s<i;s++)e.push(t[s])}function n(e){for(var t=[],s=e.length,i=0;i!==s;i++)t.push(e.pop());for(i=0;i!==s;i++)e[i]=t[i]}function p(e,t){return f(m(e,t-1),m(e,t),m(e,t+1))}var tmpLine1$$module$str$c3runtime=[],tmpLine2$$module$str$c3runtime=[];function q(t,s,i){var r=tmpLine1$$module$str$c3runtime,n=tmpLine2$$module$str$c3runtime;if(d(m(t,s+1),m(t,s),m(t,i))&&h(m(t,s-1),m(t,s),m(t,i)))return!1;for(var a=k(m(t,s),m(t,i)),o=0;o!==t.length;++o)if((o+1)%t.length!==s&&o!==s&&d(m(t,s),m(t,i),m(t,o+1))&&h(m(t,s),m(t,i),m(t,o))){r[0]=m(t,s),r[1]=m(t,i),n[0]=m(t,o),n[1]=m(t,o+1);var l=e(r,n);if(k(m(t,s),l)<a)return!1}return!0}function t(e,t,s){for(var i=0;i!==e.length;++i)if(i!==t&&i!==s&&(i+1)%e.length!==t&&(i+1)%e.length!==s&&b(m(e,t),m(e,s),m(e,i),m(e,i+1)))return!1;return!0}function w(e,t,s,i){if(i=i||[],u(i),t<s)for(var r=t;r<=s;r++)i.push(e[r]);else{for(r=0;r<=s;r++)i.push(e[r]);for(r=t;r<e.length;r++)i.push(e[r])}return i}function y(e){for(var t,s,i=[],r=[],n=Number.MAX_VALUE,a=0;a<e.length;++a)if(p(e,a))for(var o=0;o<e.length;++o)if(q(e,a,o)){t=y(w(e,a,o,r)),s=y(w(e,o,a,r));for(var h=0;h<s.length;h++)t.push(s[h]);t.length<n&&(i=t,n=t.length,i.push([m(e,a),m(e,o)]))}return i}function B(e,t){if(0===t.length)return[e];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2===t[0].length&&t[0][0]instanceof Array){e=[e];for(var s=0;s<t.length;s++)for(var i=t[s],r=0;r<e.length;r++){var n=B(e[r],i);if(n){e.splice(r,1),e.push(n[0],n[1]);break}}return e}return i=t,s=e.indexOf(i[0]),r=e.indexOf(i[1]),-1!==s&&-1!==r&&[w(e,s,r),w(e,r,s)]}function D(e,t,s,i,r){var n=t[1]-e[1];t=e[0]-t[0],e=n*e[0]+t*e[1];var a=i[1]-s[1];i=s[0]-i[0],s=a*s[0]+i*s[1];var o=n*i-a*t;return E(o,0,r||0)?[0,0]:[(i*e-t*s)/o,(n*s-a*e)/o]}function A(e,s,i,r,n,a,o){a=a||100,o=o||0,n=n||25,s=void 0!==s?s:[],i=i||[],r=r||[];var l,u=[0,0],_=[0,0],g=[0,0],S=0,y=0,G=0,T=[],I=[];if(3>e.length)return s;if(o++,o>a)return console.warn("quickDecomp: max level ("+a+") reached."),s;for(var b=0;b<e.length;++b)if(p(e,b)){i.push(e[b]);for(var C=l=Number.MAX_VALUE,P=0;P<e.length;++P){if(c(m(e,b-1),m(e,b),m(e,P))&&h(m(e,b-1),m(e,b),m(e,P-1))&&(g=D(m(e,b-1),m(e,b),m(e,P),m(e,P-1)),f(m(e,b+1),m(e,b),g))){var x=k(e[b],g);x<l&&(l=x,_=g,y=P)}c(m(e,b+1),m(e,b),m(e,P+1))&&h(m(e,b+1),m(e,b),m(e,P))&&(g=D(m(e,b+1),m(e,b),m(e,P),m(e,P+1)),c(m(e,b-1),m(e,b),g)&&(x=k(e[b],g),x<C&&(C=x,u=g,S=P)))}if(y===(S+1)%e.length)g[0]=(_[0]+u[0])/2,g[1]=(_[1]+u[1])/2,r.push(g),b<S?(v(T,e,b,S+1),T.push(g),I.push(g),0!==y&&v(I,e,y,e.length),v(I,e,0,b+1)):(0!==b&&v(T,e,b,e.length),v(T,e,0,S+1),T.push(g),I.push(g),v(I,e,y,b+1));else{if(y>S&&(S+=e.length),u=Number.MAX_VALUE,S<y)return s;for(P=y;P<=S;++P)d(m(e,b-1),m(e,b),m(e,P))&&h(m(e,b+1),m(e,b),m(e,P))&&(x=k(m(e,b),m(e,P)),x<u&&t(e,b,P)&&(u=x,G=P%e.length));b<G?(v(T,e,b,G+1),0!==G&&v(I,e,G,e.length),v(I,e,0,b+1)):(0!==b&&v(T,e,b,e.length),v(T,e,0,G+1),v(I,e,G,b+1))}return T.length<I.length?(A(T,s,i,r,n,a,o),A(I,s,i,r,n,a,o)):(A(I,s,i,r,n,a,o),A(T,s,i,r,n,a,o)),s}return s.push(e),s}function E(e,t,s){return Math.abs(e-t)<=(s||0)}function J(e,t,s){return E(e[0],t[0],s)&&E(e[1],t[1],s)}self.polyDecomp={decomp:function(e){var t=y(e);return 0<t.length?B(e,t):[e]},quickDecomp:A,isSimple:function(e){var t;for(t=0;t<e.length-1;t++)for(var s=0;s<t-1;s++)if(b(e[t],e[t+1],e[s],e[s+1]))return!1;for(t=1;t<e.length-2;t++)if(b(e[0],e[e.length-1],e[t],e[t+1]))return!1;return!0},removeCollinearPoints:function(e,t){for(var s=0,i=e.length-1;3<e.length&&0<=i;--i)g(m(e,i-1),m(e,i),m(e,i+1),t)&&(e.splice(i%e.length,1),s++);return s},removeDuplicatePoints:function(e,t){for(var s=e.length-1;1<=s;--s)for(var i=e[s],r=s-1;0<=r;--r)J(i,e[r],t)&&e.splice(s,1)},makeCCW:function(e){for(var t=0,s=1;s<e.length;++s)(e[s][1]<e[t][1]||e[s][1]===e[t][1]&&e[s][0]>e[t][0])&&(t=s);return!c(m(e,t-1),m(e,t),m(e,t+1))&&(n(e),!0)}}}{let e=!1,t=!1,s="dev";const i=self.C3=class{constructor(){throw TypeError("static class can't be instantiated")}static SetReady(){e=!0}static IsReady(){return e}static SetAppStarted(){t=!0}static HasAppStarted(){return t}static SetBuildMode(e){s=e}static GetBuildMode(){return s}static IsReleaseBuild(){return"final"===s}};i.isDebug=!1,i.isDebugDefend=!1,i.hardwareConcurrency=navigator.hardwareConcurrency||2,self.C3X={}}{const e=self.C3;e.QueryParser=class{constructor(e){this._queryString=e,this._parameters=new Map,this._Parse()}_Parse(){var e=this._queryString;(e.startsWith("?")||e.startsWith("#"))&&(e=e.substr(1)),e=e.split("&");for(const t of e)this._ParseParameter(t)}_ParseParameter(e){if(e)if(e.includes("=")){var t=e.indexOf("="),s=decodeURIComponent(e.substring(0,t));e=decodeURIComponent(e.substring(t+1)),this._parameters.set(s,e)}else this._parameters.set(e,null)}LogAll(){for(const e of this._parameters)console.log("[QueryParser] Parameter '"+e[0]+"' = "+(null===e[1]?"null":"'"+e[1]+"'"))}Has(e){return this._parameters.has(e)}Get(e){return e=this._parameters.get(e),void 0===e?null:e}ClearHash(){history.replaceState("",document.title,location.pathname+location.search)}Reparse(e){this._queryString=e,this._parameters.clear(),this._Parse()}},e.QueryString=new e.QueryParser(location.search),e.LocationHashString=new e.QueryParser(location.hash),"dev"!==e.QueryString.Get("mode")&&e.SetBuildMode("final")}{const e=self.C3,t=navigator.userAgent;let s={linux:/linux|openbsd|freebsd|netbsd/i.test(t),chromeOS:/CrOS/.test(t),windowsTizen:/trident|iemobile|msie|tizen/i.test(t),genericMS:/trident|iemobile|msie|edge\//i.test(t),opera:/OPR\//.test(t),blackberry:/bb10/i.test(t),edge:/edge\//i.test(t),trident:/trident/i.test(t),webkit:/webkit/i.test(t),safari:/safari\//i.test(t),chrome:/chrome\//i.test(t),chromium:/chromium\//i.test(t),crosswalk:/crosswalk|xwalk/i.test(t),nwjs:/nwjs/i.test(t),amazonwebapp:/amazonwebappplatform/i.test(t),webview:/wv\)/.test(t),android:/android/i.test(t),nokia:/nokiabrowser\/[0-9.]+/i.test(t)};var JSCompiler_object_inline_windows_0=/windows\s+nt\s+\d+\.\d+/i.exec(t),JSCompiler_object_inline_OSX_1=/mac\s+os\s+x\s+[0-9_]+/i.exec(t),JSCompiler_object_inline_android_2=/android\s+[0-9.]+/i.exec(t),JSCompiler_object_inline_opera_3=/OPR\/[0-9.]+/.exec(t),JSCompiler_object_inline_tizen_4=/tizen\s+[0-9.]+/i.exec(t),JSCompiler_object_inline_iphone_5=/iphone\s+os\s+[0-9_]+/i.exec(t),JSCompiler_object_inline_ipad_6=/ipad[^)]*os\s+[0-9_]+/i.exec(t),JSCompiler_object_inline_winPhone_7=/windows\s+phone\s+[0-9.]+/i.exec(t),JSCompiler_object_inline_winPhoneOS_8=/windows\s+phone\s+os\s+[0-9.]+/i.exec(t),JSCompiler_object_inline_chrome_9=/chrome\/[0-9.]+/i.exec(t),JSCompiler_object_inline_chromium_10=/chromium\/[0-9.]+/i.exec(t),JSCompiler_object_inline_nwjs_11=/nwjs\/[0-9.]+/i.exec(t),JSCompiler_object_inline_firefox_12=/firefox\/[0-9.]+/i.exec(t),JSCompiler_object_inline_ie_13=/msie\s+[0-9.]+/i.exec(t),JSCompiler_object_inline_edge_14=/edge\/[0-9.]+/i.exec(t),JSCompiler_object_inline_edgeChromium_15=/edg\/[0-9.]+/i.exec(t),JSCompiler_object_inline_silk_16=/silk\/[0-9.]+/i.exec(t);let i="(unknown)",r="(unknown)",a="(unknown)",o="(unknown)",h="(unknown)",l="browser",c=!1,u=!1,_=new Map;function n(e,t,s){!0===t?(s(),_.set(e,!0)):t&&t.length&&(s(t[0]),_.set(e,!0))}n("isWindows",JSCompiler_object_inline_windows_0,e=>{if(i="Windows",e=e.split(" ")[2])switch(e){case"5.0":r="2000";break;case"5.1":case"5.2":r="XP";break;case"6.0":r="Vista";break;case"6.1":r="7";break;case"6.2":r="8";break;case"6.3":r="8.1";break;case"10.0":r="10"}}),n("isOSX",JSCompiler_object_inline_OSX_1,e=>{i="Mac OS X",(e=e.split(" ")[3])&&(r=e.replace("_","."))}),n("isLinux",s.linux,()=>{i="Linux"}),n("isChromeOS",s.chromeOS,()=>{i="Chrome OS"}),n("isAndroid",!s.windowsTizen&&JSCompiler_object_inline_android_2,e=>{i="Android",(e=e.split(" ")[1])&&(r=e)}),n("isTizen",JSCompiler_object_inline_tizen_4,e=>{i="Tizen",(e=e.split(" ")[1])&&(r=e)}),n("isIPhone",!s.windowsTizen&&JSCompiler_object_inline_iphone_5,e=>{i="iOS",(e=e.split(" ")[2])&&(r=e.replace("_","."))}),n("isIPad",!s.windowsTizen&&JSCompiler_object_inline_ipad_6,e=>{i="iOS",(e=e.split(" ")[3])&&(r=e.replace("_","."))}),n("isWindowsPhone",JSCompiler_object_inline_winPhone_7,e=>{i="Windows Phone",(e=e.split(" ")[2])&&(r=e)}),n("isWindowsPhoneOS",JSCompiler_object_inline_winPhoneOS_8,e=>{i="Windows Phone",(e=e.split(" ")[3])&&(r=e)}),n("isBlackberry",s.blackberry,()=>{i="Blackberry",r="10",a="stock",h="webkit"}),n("isChrome",!s.edge&&!s.opera&&JSCompiler_object_inline_chrome_9,e=>{a="Chrome",h="Chromium",(e=e.split("/")[1])&&(o=e)}),n("isOpera",JSCompiler_object_inline_opera_3,e=>{a="Opera",h="Chromium",(e=e.split("/")[1])&&(o=e)}),n("isChromium",JSCompiler_object_inline_chromium_10,e=>{h=a="Chromium",(e=e.split("/")[1])&&(o=e)}),n("isFirefox",JSCompiler_object_inline_firefox_12,e=>{a="Firefox",h="Gecko",(e=e.split("/")[1])&&(o=e)}),n("isInternetExplorer",JSCompiler_object_inline_ie_13,e=>{a="Internet Explorer",h="Trident",(e=e.split(" ")[1])&&(o=e)}),n("isTrident","Internet Explorer"!==a&&s.trident,()=>{h="Trident";var e=/rv:[0-9.]+/i.exec(t);e&&e.length&&(a="Internet Explorer",(e=e[0].split(":")[1])&&(o=e))}),n("isEdge",JSCompiler_object_inline_edge_14,e=>{h=a="Edge",(e=e.split("/")[1])&&(o=e)}),n("isEdgeChromium",JSCompiler_object_inline_edgeChromium_15,e=>{a="Edge",h="Chromium",(e=e.split("/")[1])&&(o=e)}),n("isSafari",s.safari&&!s.nokia&&!s.chrome&&!s.chromium&&!s.genericIE&&!s.blackberry,()=>{a="Safari",h="WebKit";var e=/version\/[0-9.]+/i.exec(t),s=/crios\/[0-9.]+/i.exec(t),i=/fxios\/[0-9.]+/i.exec(t);e&&e.length&&(e=e[0].split("/")[1])&&(o=e),s&&s.length&&(a="Chrome for iOS",(s=s[0].split("/")[1])&&(o=s)),i&&i.length&&(a="Firefox for iOS",(i=i[0].split("/")[1])&&(o=i))}),n("isSilk",JSCompiler_object_inline_silk_16,e=>{a="Silk",(e=e.split("/")[1])&&(o=e)}),n("isCrosswalk",s.crosswalk,()=>l="crosswalk"),n("isCordova",self.device&&(self.device.cordova||self.device.phonegap),()=>l="cordova"),n("isNWJS",JSCompiler_object_inline_nwjs_11,e=>{l="nwjs",a="NW.js",h="Chromium",(e=e.split("/")[1])&&(o=e)}),n("isAmazonWebApp",s.amazonwebapp,()=>l="webapp"),n("isHomeScreenWebApp","nwjs"!==l&&"undefined"!=typeof window&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator.standalone),()=>l="webapp"),n("isFalseSafari","Safari"===a&&("Android"===i||"Tizen"===i||"Blackberry"===i),()=>a="stock"),n("isAndroidWebview","Chrome"===a&&"browser"===l&&s.webview,()=>l="webview"),n("isFirefoxOS","Firefox"===a&&"(unknown)"===i,()=>i="Firefox OS"),n("isAndroidFallback","(unknown)"===i&&!s.windowsTizen&&s.android,()=>i="Android"),n("isTridentFallback","(unknown)"===i&&s.trident,()=>h="Trident"),n("isWebkitFallback","(unknown)"===i&&s.webkit,()=>h="WebKit"),n("isDesktop",(()=>"Windows"===i||"Mac OS X"===i||"Linux"===i||"Chrome OS"===i||"nwjs"===l)(),()=>c=!0),u="nwjs"===l;const d="Mac OS X"===i&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints;d&&(i="iOS",r=o,u=c=!1),e.Platform={OS:i,OSVersion:r,Browser:a,BrowserVersion:o,BrowserVersionNumber:parseFloat(o),BrowserEngine:h,Context:l,IsDesktop:c,IsMobile:!c,IsDesktopApp:u,IsChromeWebStore:!!(self.chrome&&self.chrome.runtime&&self.chrome.runtime.id),IsAppleOS:"Mac OS X"===i||"iOS"===i,IsIpadOS:d,IsLinux:"Linux"===i}}{const e=new Map,t="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAll,s="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAllKeys;function c(e){return new Promise((t,s)=>{e.onsuccess=(()=>t(e.result)),e.onerror=(()=>s(e.error))})}function d(e){return new Promise((t,s)=>{e.oncomplete=(()=>t()),e.onerror=(()=>s(e.error)),e.onabort=(()=>s(e.error))})}function f(e,t){return g(e,t)}function h(e,t){return g(e,t,!0)}async function g(t,s,i=!1,r=!0){const n=await k(t);try{const a=n.transaction(["keyvaluepairs"],i?"readwrite":"readonly");return s(a)
}catch(n){if(r&&"InvalidStateError"===n.name)return e.delete(t),g(t,s,i,!1);throw n}}function k(t){u(t);let s=e.get(t);return s instanceof Promise||(s=m(t),e.set(t,s),s.catch(s=>e.delete(t))),s}async function m(e){u(e);const t=indexedDB.open(e,2);return t.addEventListener("upgradeneeded",t=>{try{t.target.result.createObjectStore("keyvaluepairs")}catch(t){console.error(`Failed to create objectstore for database ${e}`,t)}}),c(t)}function u(e){if("string"!=typeof e)throw new TypeError("expected string")}function v(e,t){const s=e.objectStore("keyvaluepairs").openCursor();return new Promise(e=>{const i=[];s.onsuccess=(s=>{if(s=s.target.result){switch(t){case"entries":i.push([s.key,s.value]);break;case"keys":i.push(s.key);break;case"values":i.push(s.value)}s.continue()}else e(i)})})}class i{constructor(e){u(e),this.name=e}async ready(){await k(this.name)}set(e,t){return u(e),h(this.name,async s=>{var i=s.objectStore("keyvaluepairs").put(t,e);i=c(i),s=d(s),await Promise.all([s,i])})}get(e){return u(e),f(this.name,async t=>{var s=t.objectStore("keyvaluepairs").get(e);return s=c(s),t=d(t),[,t]=await Promise.all([t,s]),t})}delete(e){return u(e),h(this.name,async t=>{var s=t.objectStore("keyvaluepairs").delete(e);s=c(s),t=d(t),await Promise.all([t,s])})}clear(){return h(this.name,async e=>{var t=e.objectStore("keyvaluepairs").clear();t=c(t),e=d(e),await Promise.all([e,t])})}keys(){return f(this.name,async e=>{if(s){var t=e.objectStore("keyvaluepairs").getAllKeys();t=c(t)}else t=v(e,"keys");return e=d(e),[,e]=await Promise.all([e,t]),e})}values(){return f(this.name,async e=>{if(t){var s=e.objectStore("keyvaluepairs").getAll();s=c(s)}else s=v(e,"values");return e=d(e),[,e]=await Promise.all([e,s]),e})}entries(){return f(this.name,async e=>{var t=v(e,"entries");return e=d(e),[,t]=await Promise.all([e,t]),t})}}self.KVStorageContainer=i}{const e=self.KVStorageContainer,t=[/no available storage method found/i,/an attempt was made to break through the security policy of the user agent/i,/the user denied permission to access the database/i,/a mutation operation was attempted on a database that did not allow mutations/i,/idbfactory\.open\(\) called in an invalid security context/i],s=new WeakMap;let i=!1;function d(e){throw Error(`"${e}" is not implemented`)}function f(e){if("function"==typeof e)throw Error("localforage callback API is not implemented; please use the promise API instead")}function h(e){return"object"==typeof e?new Promise(t=>{const{port1:s,port2:i}=new MessageChannel;i.onmessage=(e=>t(e.data)),s.postMessage(e)}):Promise.resolve(e)}"undefined"==typeof indexedDB&&(i=!0,console.warn("Unable to use local storage because indexedDB is not defined"));class r{constructor(e){this._inst=e,s.set(this,new Map)}_MaybeSwitchToMemoryFallback(e){if(!i)for(const s of t)if(e&&s.test(e.message)){console.error("Unable to use local storage, reverting to in-memory store: ",e,e.message),i=!0;break}}async _getItemFallback(e){return e=s.get(this).get(e),e=await h(e),void 0===e?null:e}async _setItemFallback(e,t){t=await h(t),s.get(this).set(e,t)}_removeItemFallback(e){s.get(this).delete(e)}_clearFallback(){s.get(this).clear()}_keysFallback(){return Array.from(s.get(this).keys())}IsUsingFallback(){return i}async getItem(e,t){if(f(t),i)return await this._getItemFallback(e);let s;try{s=await this._inst.get(e)}catch(t){return this._MaybeSwitchToMemoryFallback(t),i?await this._getItemFallback(e):(console.error(`Error reading '${e}' from storage, returning null: `,t),null)}return void 0===s?null:s}async setItem(e,t,s){if(f(s),void 0===t&&(t=null),i)await this._setItemFallback(e,t);else try{await this._inst.set(e,t)}catch(s){if(this._MaybeSwitchToMemoryFallback(s),!i)throw s;await this._setItemFallback(e,t)}}async removeItem(e,t){if(f(t),i)this._removeItemFallback(e);else try{await this._inst.delete(e)}catch(t){this._MaybeSwitchToMemoryFallback(t),i?this._removeItemFallback(e):console.error(`Error removing '${e}' from storage: `,t)}}async clear(e){if(f(e),i)this._clearFallback();else try{await this._inst.clear()}catch(e){this._MaybeSwitchToMemoryFallback(e),i?this._clearFallback():console.error("Error clearing storage: ",e)}}async keys(e){if(f(e),i)return this._keysFallback();e=[];try{e=await this._inst.keys()}catch(e){if(this._MaybeSwitchToMemoryFallback(e),i)return this._keysFallback();console.error("Error getting storage keys: ",e)}return e}ready(e){return f(e),i?Promise.resolve(!0):this._inst.ready()}createInstance(t){if("object"!=typeof t)throw new TypeError("invalid options object");if(t=t.name,"string"!=typeof t)throw new TypeError("invalid store name");return t=new e(t),new r(t)}length(e){d("localforage.length()")}key(e,t){d("localforage.key()")}iterate(e,t){d("localforage.iterate()")}setDriver(e){d("localforage.setDriver()")}config(e){d("localforage.config()")}defineDriver(e){d("localforage.defineDriver()")}driver(){d("localforage.driver()")}supports(e){d("localforage.supports()")}dropInstance(){d("localforage.dropInstance()")}disableMemoryMode(){i=!1}}self.localforage=new r(new e("localforage"))}{const e=self.C3;if(e.Supports={},e.Supports.WebAnimations=(()=>{try{if("Safari"===e.Platform.Browser||"undefined"==typeof document)return!1;const t=document.createElement("div");return void 0!==t.animate&&void 0!==t.animate([{opacity:"0"},{opacity:"1"}],1e3).reverse}catch(e){return!1}})(),e.Supports.DialogElement="undefined"!=typeof HTMLDialogElement,e.Supports.RequestIdleCallback=!!self.requestIdleCallback,e.Supports.ImageBitmap=!!self.createImageBitmap&&"Safari"!==e.Platform.Browser,e.Supports.ImageBitmapOptions=!1,e.Supports.ImageBitmap)try{self.createImageBitmap(new ImageData(32,32),{resizeWidth:10,resizeHeight:10,premultiplyAlpha:"none"}).then(t=>{e.Supports.ImageBitmapOptions=10===t.width&&10===t.height}).catch(t=>{e.Supports.ImageBitmapOptions=!1})}catch(b){e.Supports.ImageBitmapOptions=!1}e.Supports.ClipboardReadText=!(!navigator.clipboard||!navigator.clipboard.readText||"Firefox"===e.Platform.Browser),e.Supports.PermissionsQuery=!(!navigator.permissions||!navigator.permissions.query),e.Supports.Proxies="undefined"!=typeof Proxy,e.Supports.DownloadAttribute=(()=>"undefined"!=typeof document&&void 0!==document.createElement("a").download)(),e.Supports.CanvasToBlob=(()=>"undefined"!=typeof HTMLCanvasElement&&HTMLCanvasElement.prototype.toBlob)(),e.Supports.Fetch="function"==typeof fetch,e.Supports.PersistentStorage=!!(self.isSecureContext&&"Opera"!==e.Platform.Browser&&navigator.storage&&navigator.storage.persist),e.Supports.StorageQuotaEstimate=!!(self.isSecureContext&&navigator.storage&&navigator.storage.estimate),e.Supports.Fullscreen=(()=>{if("undefined"==typeof document||"iOS"===e.Platform.OS)return!1;const t=document.documentElement;return!!(t.requestFullscreen||t.msRequestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen)})(),e.Supports.ImageDecoder=void 0!==self.ImageDecoder,e.Supports.NativeFileSystemAPI=!!self.showOpenFilePicker,e.Supports.NavigatorFontsQuery=!(!navigator.fonts||!navigator.fonts.query)}{const e=self.C3;if(!String.prototype.trimStart){const e=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;String.prototype.trimStart=function(){return this.replace(e,"")}}if(!String.prototype.trimEnd){const e=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;String.prototype.trimEnd=function(){return this.replace(e,"")}}if(String.prototype.replaceAll||(String.prototype.replaceAll=function(t,s){return this.replace(new RegExp(e.EscapeRegex(t),"g"),s)}),Array.prototype.values||(Array.prototype.values=function*(){for(const e of this)yield e}),!Array.prototype.flat){function b(e,t){return e.reduce((e,s)=>(0<t&&Array.isArray(s)?Array.prototype.push.apply(e,b(s,t-1)):e.push(s),e),[])}Array.prototype.flat=function(e=1){return b(this,e)}}Array.prototype.at||(Array.prototype.at=function(e){if(e=Math.trunc(e)||0,0>e&&(e+=this.length),!(0>e||e>=this.length))return this[e]}),String.prototype.at||(String.prototype.at=function(e){if(e=Math.trunc(e)||0,0>e&&(e+=this.length),!(0>e||e>=this.length))return this[e]}),RegExp.escape||(RegExp.escape=function(e){return String(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}),navigator.storage&&!navigator.storage.estimate&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota&&(navigator.storage.estimate=function(){return new Promise((e,t)=>navigator.webkitTemporaryStorage.queryUsageAndQuota((t,s)=>e({usage:t,quota:s}),t))}),void 0===self.isSecureContext&&(self.isSecureContext="https:"===location.protocol),void 0===self.globalThis&&(self.globalThis=self)}{const e=self.C3;function b(t){let s=e.GetCallStack();console.error("Assertion failure: "+t+"\n\nStack trace:\n"+s)}self.assert=function(e,t){e||b(t)}}{const e=self.C3,t=self.C3X;e.IsNumber=function(e){return"number"==typeof e},e.IsFiniteNumber=function(t){return e.IsNumber(t)&&isFinite(t)},e.RequireNumber=function(t){if(!e.IsNumber(t))throw new TypeError("expected number")},e.RequireOptionalNumber=function(t){e.IsNullOrUndefined(t)},e.RequireNumberInRange=function(t,s,i){if(!e.IsNumber(t)||isNaN(t)||s>t||i<t)throw new RangeError("number outside of range")},e.RequireAllNumber=function(...e){for(let t of e);},e.RequireFiniteNumber=function(t){if(!e.IsFiniteNumber(t))throw new TypeError("expected finite number")},e.RequireOptionalFiniteNumber=function(t){e.IsNullOrUndefined(t)},e.RequireAllFiniteNumber=function(...e){for(let t of e);},e.IsString=function(e){return"string"==typeof e},e.RequireString=function(t){if(!e.IsString(t))throw new TypeError("expected string")},e.RequireOptionalString=function(t){e.IsNullOrUndefined(t)},e.RequireAllString=function(...e){for(let t of e);},e.IsSimpleObject=function(e){return"object"==typeof e&&null!==e&&((e=Object.getPrototypeOf(e))?e.constructor===Object:null===e)},e.RequireSimpleObject=function(t){if(!e.IsSimpleObject(t))throw new TypeError("expected simple object")},e.RequireOptionalSimpleObject=function(t){if(!e.IsNullOrUndefined(t)&&!e.IsSimpleObject(t))throw new TypeError("expected simple object")},e.IsObject=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},e.RequireObject=function(t){if(!e.IsObject(t))throw new TypeError("expected object")},e.RequireOptionalObject=function(t){e.IsNullOrUndefined(t)},e.RequireAllObject=function(...e){for(let t of e);},e.IsFileLike=function(t){return e.IsInstanceOf(t,Blob)&&"string"==typeof t.name},e.RequireFileLike=function(t){if(!e.IsFileLike(t))throw new TypeError("expected file")},e.RequireOptionalFileLike=function(t){e.IsNullOrUndefined(t)},e.IsArray=function(e){return Array.isArray(e)},e.RequireArray=function(t){if(!e.IsArray(t))throw new TypeError("expected array")},e.RequireOptionalArray=function(t){e.IsNullOrUndefined(t)},e.RequireAllArray=function(...e){for(let t of e);},e.Is2DArray=function(t){return!!e.IsArray(t)&&(!t.length||!!e.IsArray(t[0]))},e.Require2DArray=function(t){if(!e.Is2DArray(t))throw new TypeError("expected 2d array");for(let s of t)if(!e.IsArray(s))throw new TypeError("expected 2d array")},e.RequireOptional2DArray=function(t){e.IsNullOrUndefined(t)},e.IsFunction=function(e){return"function"==typeof e},e.RequireFunction=function(t,s){if(!e.IsFunction(t))throw new TypeError("expected function");if(!e.IsNullOrUndefined(s)&&t!==s)throw new TypeError("expected same function reference")},e.RequireOptionalFunction=function(t){e.IsNullOrUndefined(t)},e.RequireAllFunction=function(...e){for(let t of e);},e.RequireAnyFunction=function(t,...s){if(!e.IsFunction(t))throw new TypeError("expected function");if(!s.length)throw Error("missing comparison functions");for(let i of s)if(!e.IsNullOrUndefined(i)&&t===i)return;throw new TypeError("expected same function reference")},e.RequireOptionalAllFunction=function(...t){if(!e.IsNullOrUndefined(t))for(let e of t);},e.IsInstanceOf=function(e,t){return e instanceof t},e.IsInstanceOfAny=function(t,...s){for(let i of s)if(e.IsInstanceOf(t,i))return!0;return!1},e.RequireInstanceOf=function(t,s){if(!e.IsInstanceOf(t,s))throw new TypeError("unexpected type")},e.RequireOptionalInstanceOf=function(t,s){e.IsNullOrUndefined(t)},e.RequireAllInstanceOf=function(e,...t){for(let e of t);},e.RequireAnyInstanceOf=function(t,...s){if(!e.IsInstanceOfAny(t,...s))throw new TypeError("unexpected type")},e.RequireAnyOptionalInstanceOf=function(t,...s){if(!e.IsNullOrUndefined(t)&&!e.IsInstanceOfAny(t,...s))throw new TypeError("unexpected type")},e.IsArrayOf=function(t,s){for(let i of t)if(!e.IsInstanceOf(i,s))return!1;return!0},e.IsArrayOfFiniteNumbers=function(t){for(let s of t)if(!e.IsFiniteNumber(s))return!1;return!0},e.RequireArrayOf=function(e,t){for(let t of e);},e.RequireOptionalArrayOf=function(t,s){if(!e.IsNullOrUndefined(t))for(let e of t);},e.RequireArrayOfAny=function(e,...t){for(let t of e);},e.RequireOptionalArrayOfAny=function(t,...s){if(!e.IsNullOrUndefined(t))for(let e of t);},e.IsDOMNode=function(t,s){return!(e.IsNullOrUndefined(t)||!e.IsString(t.nodeName))&&(!s||e.equalsNoCase(t.nodeName,s))},e.RequireDOMNode=function(t,s){if(e.IsNullOrUndefined(t)||!e.IsString(t.nodeName))throw new TypeError("expected DOM node");if(s&&!e.equalsNoCase(t.nodeName,s))throw new TypeError(`expected DOM '${s}' node`)},e.RequireOptionalDOMNode=function(t,s){e.IsNullOrUndefined(t)},e.IsHTMLElement=function(t,s){return!(e.IsNullOrUndefined(t)||!e.IsString(t.tagName))&&(!s||e.equalsNoCase(t.tagName,s))},e.RequireHTMLElement=function(t,s){if(e.IsNullOrUndefined(t)||!e.IsString(t.tagName))throw new TypeError("expected HTML element");if(s&&!e.equalsNoCase(t.tagName,s))throw new TypeError(`expected HTML '${s}' element`)},e.RequireOptionalHTMLElement=function(t,s){e.IsNullOrUndefined(t)},e.IsDrawable=function(t){return e.IsHTMLElement(t,"img")||e.IsHTMLElement(t,"canvas")||e.IsHTMLElement(t,"video")||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap},e.RequireDrawable=function(t){if(!e.IsDrawable(t))throw new TypeError("expected drawable")},e.RequireOptionalDrawable=function(t){e.IsNullOrUndefined(t)},e.IsDrawableOrImageData=function(t){return t instanceof ImageData||e.IsDrawable(t)},e.RequireDrawableOrImageData=function(t){if(!e.IsDrawableOrImageData(t))throw new TypeError("expected drawable or image data")},e.RequireOptionalDrawableOrImageData=function(t){if(!e.IsNullOrUndefined(t)&&!e.IsDrawableOrImageData(t))throw new TypeError("expected drawable or image data")},e.IsStringLike=function(t){return"string"==typeof t||t instanceof e.HtmlString||t instanceof e.BBString},e.RequireStringLike=function(t){if(!e.IsStringLike(t))throw new TypeError("expected string-like")},e.RequireOptionalStringLike=function(t){e.IsNullOrUndefined(t)},e.RequireAllStringLike=function(...e){for(let t of e);},e.RequireOverride=function(){throw Error("must be overridden")},e.NotYetImplemented=function(){throw Error("not yet implemented")},e.IsDefined=function(e,...t){if(void 0===e)return!1;for(let s of t){if(void 0===e[s])return!1;e=e[s]}return!0},e.IsNullOrUndefined=function(e){return null==e},e.AreArrayElementsOfSameType=function(e){let t=e[0].constructor;for(let s of e)if(s.constructor!==t)return!1;return t},e.AreArrayElementsOfType=function(e,t){for(let s of e)if(!(s instanceof t))return!1;return!0};const s=Object.getPrototypeOf(Uint8Array);e.IsTypedArray=function(t){return e.IsInstanceOf(t,s)},e.RequireTypedArray=function(e){},e.WeakRequireTypedArray=function(t){e.WeakRequireInstanceOf(t,s)},e.WeakRequireAnyInstanceOf=function(t,...s){if(!e.WeakIsAnyInstanceOf(t,...s))throw new TypeError("unexpected type")},e.WeakIsAnyInstanceOf=function(t,...s){for(const i of s)if(e.WeakIsInstanceOf(t,i))return!0;return!1},e.WeakRequireInstanceOf=function(t,s){if(!e.WeakIsInstanceOf(t,s))throw new TypeError("unexpected type")},e.WeakIsInstanceOf=function(e,t){for(;e=Object.getPrototypeOf(e);)if(e.constructor.name===t.name)return!0;return!1},t.RequireNumber=e.RequireNumber,t.RequireOptionalNumber=e.RequireOptionalNumber,t.RequireFiniteNumber=e.RequireFiniteNumber,t.RequireOptionalFiniteNumber=e.RequireOptionalFiniteNumber,t.RequireString=e.RequireString,t.RequireOptionalString=e.RequireOptionalString,t.RequireObject=e.RequireObject,t.RequireOptionalObject=e.RequireOptionalObject,t.RequireArray=e.RequireArray,t.RequireOptionalArray=e.RequireOptionalArray,t.RequireFunction=e.RequireFunction,t.RequireOptionalFunction=e.RequireOptionalFunction,t.RequireInstanceOf=e.RequireInstanceOf,t.RequireOptionalInstanceOf=e.RequireOptionalInstanceOf,t.IsNullOrUndefined=e.IsNullOrUndefined}{const e=self.C3,t=new Map;let s;function c(t,s){return t=e.getType(t),s=e.getType(s),"null"===t||"null"===s||"undefined"!==t&&"undefined"!==s&&t===s}e.RafLog=function(e,...s){t.has(e)||t.set(e,-1),-1===t.get(e)&&t.set(e,requestAnimationFrame(()=>{console.log(`%c${e}`,"font-weight: bold",...s),t.set(e,-1)}))},e.StartMeasure=function(e){performance.mark(e),s||(s=new Map),s.has(e)||s.set(e,{current:0,total:0,average:0,calls:1,toString:function(){return`current => ${this.current.toPrecision(3)} :: average => ${this.average.toPrecision(3)} :: calls => ${this.calls}`}})},e.EndMeasure=function(e){performance.measure("measure",e);const t=performance.getEntriesByName("measure")[0];e=s.get(e),e.current=t.duration,e.total+=e.current,e.average=e.total/e.calls,e.calls++,console.log(e.toString()),performance.clearMarks(),performance.clearMeasures()},e.GetCallStack=function(){return Error().stack},e.Debugger=function(){},e.cast=function(e,t){return e&&e instanceof t?e:null},e.getName=function(t){return void 0===t?"undefined":null===t?"null":"boolean"==typeof t?"<boolean>":e.IsNumber(t)?"<number>":e.IsString(t)?"<string>":e.IsArray(t)?"<array>":"symbol"==typeof t?"<"+t.toString()+">":e.IsFunction(t)?t.name&&"Function"!==t.name?t.name:"<anonymous function>":"object"==typeof t?t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"<anonymous object>":"<unknown>"},e.getType=function(e){return null===e?"null":Array.isArray(e)?"array":typeof e},e.range=function*(e,t){if(!isFinite(Math.abs(e-t)))throw Error("Invalid parameters");if(e>t)for(--e;e>=t;e--)yield e;else for(;e<t;e++)yield e};let i=new Map,r=new Map,n=new WeakMap,a=new WeakMap;e.DefendHandler={};const o=new Set(["then","splice"]);function m(t){console.warn("[Defence] "+t+" @",e.GetCallStack())}e.DefendHandler.get=function(t,s){return s in t||"symbol"==typeof s||o.has(s)||m(`Accessed missing property '${s}' from defended object '${e.getName(t)}', returning undefined`),a.has(t)&&"symbol"!=typeof s&&!o.has(s)&&m(`Accessed property '${s}' on a released object '${e.getName(t)}'\nObject was originally released at: ${a.get(t)})\nCall stack at access: `),t[s]},e.DefendHandler.set=function(t,s,r){return s in t||i.has(t)||m(`Set non-existent property '${s}' to '${r}' on defended object '${e.getName(t)}'`),c(t[s],r)||i.has(t)||m(`Set '${e.getType(t[s])}' property '${s}' to type '${e.getType(r)}' on defended object '${e.getName(t)}'`),a.has(t)&&m(`Set property '${s}' on a released object '${e.getName(t)}'\nObject was originally released at: ${a.get(t)})\nCall stack at access: `),t[s]=r,!0},e.DefendHandler.deleteProperty=function(t,s){throw new ReferenceError(`Cannot delete property '${s}' from defended object '${e.getName(t)}'`)},e.DefendHandler.defineProperty=function(t,s,i){throw new ReferenceError(`Cannot define property '${s}' on defended object '${e.getName(t)}'`)},e.DefendHandler.enumerate=function(t){throw new ReferenceError(`Cannot enumerate defended object '${e.getName(t)}'`)};let h=-1;function v(){if(h=-1,0<i.size||0<r.size){let t=[...new Set([...i.keys()].map(t=>e.getName(t)))].join();console.warn(`An object derived from DefendedBase was not protected with debugDefend(). This will disable some checks. See the coding guidelines! Possible affected class names: ${t}`),i.clear(),r.clear()}}e.DefendedBase=class{constructor(){if(e.isDebugDefend&&e.Supports.Proxies){var t=new.target;t=Object.create(t.prototype);var s=new Proxy(t,e.DefendHandler);return i.set(t,s),r.set(s,t),n.set(s,t),-1===h&&(h=requestAnimationFrame(v)),s}}},e.debugDefend=function(t){if(e.isDebugDefend&&e.Supports.Proxies&&t instanceof e.DefendedBase){if(!r.has(t))return t;let e=r.get(t);return r.delete(t),i.delete(e),t}return e.isDebug?Object.seal(t):t},e.New=function(t,...s){let n;try{n=new t(...s)}catch(e){throw r.clear(),i.clear(),e}return e.isDebugDefend&&q(t,n),e.debugDefend(n)},e.Release=function(t){(t=n.get(t))&&a.set(t,e.GetCallStack())},e.WasReleased=function(e){return!!(e=n.get(e))&&!!a.get(e)};let l=new Map;function p(e){let t=new Set;for(let s in e)t.add(s);return t}function q(t,s){s=p(s);let i=l.get(t);if(i){let r=[];for(let e of i.values())s.has(e)?s.delete(e):r.push(e);e.appendArray(r,[...s]),r.length&&console.warn(`[Defence] '${e.getName(t)}' constructor creates inconsistent properties: ${r.join(", ")}`)}else l.set(t,s)}e.PerfMark=class{constructor(e){this._name="",e&&this.start(e)}start(e){this._name=e,performance.mark(this._name+"-Start")}end(){performance.mark(this._name+"-End"),performance.measure(this._name,this._name+"-Start",this._name+"-End")}next(e){this.end(),this._name=e,performance.mark(this._name+"-Start")}}}{const e=self.C3,t=2*Math.PI,s=Math.PI/180,i=180/Math.PI;function d(e){return 0===e&&0>1/e}e.wrap=function(e,t,s){return e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),e<t?(e=s-(t-e)%(s-t),e===s?0:e):t+(e-t)%(s-t)},e.mapToRange=function(e,t,s,i,r){return(e-t)*(r-i)/(s-t)+i},e.normalize=function(e,t,s){return(e-t)/(s-t)},e.clamp=function(e,t,s){return e<t?t:e>s?s:e},e.clampAngle=function(e){return e%=t,0>e&&(e+=t),e},e.toRadians=function(e){return e*s},e.toDegrees=function(e){return e*i},e.distanceTo=function(e,t,s,i){return Math.hypot(s-e,i-t)},e.distanceSquared=function(e,t,s,i){return e=s-e,t=i-t,e*e+t*t},e.angleTo=function(e,t,s,i){return Math.atan2(i-t,s-e)},e.angleDiff=function(e,t){return e===t?0:(e=Math.sin(e)*Math.sin(t)+Math.cos(e)*Math.cos(t),1<=e?0:-1>=e?Math.PI:Math.acos(e))},e.angleRotate=function(t,s,i){let r=Math.sin(t),n=Math.cos(t),a=Math.sin(s),o=Math.cos(s);return Math.acos(r*a+n*o)>i?0<n*a-r*o?e.clampAngle(t+i):e.clampAngle(t-i):e.clampAngle(s)},e.angleClockwise=function(e,t){return 0>=Math.cos(e)*Math.sin(t)-Math.sin(e)*Math.cos(t)},e.angleLerp=function(s,i,r,n=0){let a=e.angleDiff(s,i);return n*=t,e.angleClockwise(i,s)?e.clampAngle(s+(a+n)*r):e.clampAngle(s-(a+n)*r)},e.angleLerpClockwise=function(s,i,r,n=0){const a=e.angleDiff(s,i);return n*=t,e.angleClockwise(i,s)?e.clampAngle(s+(a+n)*r):e.clampAngle((t-a+n)*r)},e.angleLerpAntiClockwise=function(s,i,r,n=0){const a=e.angleDiff(s,i);return n*=t,e.angleClockwise(i,s)?e.clampAngle((-t+a-n)*r):e.clampAngle(s-(a+n)*r)},e.lerp=function(e,t,s){return e+s*(t-e)},e.unlerp=function(e,t,s){return e===t?0:(s-e)/(t-e)},e.relerp=function(t,s,i,r,n){return e.lerp(r,n,e.unlerp(t,s,i))},e.qarp=function(t,s,i,r){return e.lerp(e.lerp(t,s,r),e.lerp(s,i,r),r)},e.cubic=function(t,s,i,r,n){return e.lerp(e.qarp(t,s,i,n),e.qarp(s,i,r,n),n)},e.cosp=function(e,t,s){return(e+t+(e-t)*Math.cos(s*Math.PI))/2},e.isPOT=function(e){return 0<e&&0==(e-1&e)},e.nextHighestPowerOfTwo=function(e){--e;for(let t=1;32>t;t<<=1)e|=e>>t;return e+1},e.roundToNearestFraction=function(e,t){return Math.round(e*t)/t},e.floorToNearestFraction=function(e,t){return Math.floor(e*t)/t},e.round6dp=function(e){return Math.round(1e6*e)/1e6},e.toFixed=function(e,t){for(e=e.toFixed(t),t=e.length-1;0<=t&&"0"===e.charAt(t);--t);return 0<=t&&"."===e.charAt(t)&&--t,0>t?e:e.substr(0,t+1)},e.PackRGB=function(t,s,i){return e.clamp(t,0,255)|e.clamp(s,0,255)<<8|e.clamp(i,0,255)<<16},e.PackRGBAEx=function(t,s,i,r){return t=e.clamp(Math.floor(1024*t),-8192,8191),s=e.clamp(Math.floor(1024*s),-8192,8191),i=e.clamp(Math.floor(1024*i),-8192,8191),r=e.clamp(Math.floor(1023*r),0,1023),0>t&&(t+=16384),0>s&&(s+=16384),0>i&&(i+=16384),-(274877906944*t+16777216*s+1024*i+r)},e.PackRGBEx=function(t,s,i){return e.PackRGBAEx(t,s,i,1)},e.GetRValue=function(e){return 0<=e?(255&e)/255:(e=Math.floor(-e/274877906944),8191<e&&(e-=16384),e/1024)},e.GetGValue=function(e){return 0<=e?((65280&e)>>8)/255:(e=Math.floor(-e%274877906944/16777216),8191<e&&(e-=16384),e/1024)},e.GetBValue=function(e){return 0<=e?((16711680&e)>>16)/255:(e=Math.floor(-e%16777216/1024),8191<e&&(e-=16384),e/1024)},e.GetAValue=function(e){return d(e)?0:0<=e?1:Math.floor(-e%1024)/1023},e.greatestCommonDivisor=function(e,t){for(e=Math.floor(e),t=Math.floor(t);0!==t;){let s=t;t=e%t,e=s}return e};const r=[[3,2],[4,3],[5,4],[5,3],[6,5],[14,9],[16,9],[16,10],[21,9]];e.getAspectRatio=function(t,s){if(t=Math.floor(t),s=Math.floor(s),t===s)return[1,1];for(var i of r){let e=t/i[0]*i[1];if(1>Math.abs(s-e))return i.slice(0);if(e=t/i[1]*i[0],1>Math.abs(s-e))return[i[1],i[0]]}return i=e.greatestCommonDivisor(t,s),[t/i,s/i]},e.segmentsIntersect=function(e,t,s,i,r,n,a,o){var h=Math.min(e,s),l=Math.max(r,a);return!(Math.max(e,s)<Math.min(r,a)||h>l)&&(h=Math.min(t,i),l=Math.max(n,o),!(Math.max(t,i)<Math.min(n,o)||h>l)&&(h=r-e+a-s,l=n-t+o-i,e=s-e,t=i-t,r=a-r,n=o-n,o=Math.abs(t*r-n*e),!(Math.abs(r*l-n*h)>o)&&Math.abs(e*l-t*h)<=o))},e.segmentsIntersectPreCalc=function(e,t,s,i,r,n,a,o,h,l,c,u){const _=Math.max(h,c);return!(n<Math.min(h,c)||r>_)&&(r=Math.max(l,u),!(o<Math.min(l,u)||a>r)&&(a=h-e+c-s,o=l-t+u-i,e=s-e,t=i-t,h=c-h,l=u-l,u=Math.abs(t*h-l*e),!(Math.abs(h*o-l*a)>u)&&Math.abs(e*o-t*a)<=u))},e.segmentIntersectsQuad=function(t,s,i,r,n){const a=Math.min(t,i),o=Math.max(t,i),h=Math.min(s,r),l=Math.max(s,r),c=n.getTlx(),u=n.getTly(),_=n.getTrx(),d=n.getTry(),p=n.getBrx(),g=n.getBry(),m=n.getBlx();return n=n.getBly(),e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,c,u,_,d)||e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,_,d,p,g)||e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,p,g,m,n)||e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,m,n,c,u)},e.segmentIntersectsAnyN=function(t,s,i,r,n){const a=Math.min(t,i),o=Math.max(t,i),h=Math.min(s,r),l=Math.max(s,r);let c=0;for(let u=n.length-4;c<=u;c+=2)if(e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,n[c],n[c+1],n[c+2],n[c+3]))return!0;return e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,n[c],n[c+1],n[0],n[1])},e.rayIntersect=function(e,t,s,i,r,n,a,o){s-=e,n=o-n;const h=s*n-(i-t)*(a-r);return 0===h?2:(i=((t-i)*(a-e)+s*(o-t))/h,0<i&&1.000001>i?(n*(a-e)+(r-a)*(o-t))/h:2)},e.rayIntersectExtended=function(t,s,i,r,n,a,o,h,l){const c=(o-n)*l;return l*=h-a,e.rayIntersect(t,s,i,r,n-c,a-l,o+c,h+l)},e.isPointInTriangleInclusive=function(e,t,s,i,r,n,a,o){return r-=s,n-=i,a-=s,o-=i,e-=s,s=t-i,t=r*r+n*n,i=r*a+n*o,r=r*e+n*s,n=a*a+o*o,a=a*e+o*s,o=1/(t*n-i*i),n=(n*r-i*a)*o,r=(t*a-i*r)*o,0<=n&&0<=r&&1>=n+r},e.triangleCartesianToBarycentric=function(e,t,s,i,r,n,a,o){r-=s,n-=i,a-=s,o-=i,e-=s;const h=t-i;return t=r*r+n*n,i=r*a+n*o,s=a*a+o*o,r=e*r+h*n,n=e*a+h*o,a=t*s-i*i,o=(s*r-i*n)/a,r=(t*n-i*r)/a,[1-o-r,o,r]},e.triangleBarycentricToCartesian=function(e,t,s,i,r,n,a,o,h){return[e*i+t*n+s*o,e*r+t*a+s*h]}}{const e=self.C3;let t=null,s="";if("undefined"!=typeof document){t=document;const e=document.querySelector("base");(s=e&&e.hasAttribute("href")?e.getAttribute("href"):"")&&(s.startsWith("/")&&(s=s.substr(1)),s.endsWith("/")||(s+="/"))}e.GetBaseHref=function(){return s},e.GetBaseURL=function(){if(!t)return"";const i=t.location;return e.GetPathFromURL(i.origin+i.pathname)+s},e.GetPathFromURL=function(e){if(!e.length||e.endsWith("/")||e.endsWith("\\"))return e;const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return-1===t?"":e.substr(0,t+1)},e.GetFilenameFromURL=function(e){if(!e.length)return e;if(e.endsWith("/")||e.endsWith("\\"))return"";const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return-1===t?e:e.substr(t+1)},e.GetFileExtension=function(e){let t=e.lastIndexOf(".");return 1>t?"":e.substr(t)},e.GetFileNamePart=function(e){let t=e.lastIndexOf(".");return 1>t?e:e.substr(0,t)},e.NormalizeFileSeparator=function(e){return e.replace(/\\/g,"/")},e.IsFileExtension=function(t,s){return t=t?e.GetFileExtension(t).slice(1):"",s===t},e.FileNameEquals=function(t,s){let i,r;return e.IsFileLike(t)&&(i=e.GetFileNamePart(t.name)),e.IsString(t)&&(i=e.GetFileNamePart(t)),e.IsFileLike(s)&&(r=e.GetFileNamePart(s.name)),e.IsString(s)&&(r=e.GetFileNamePart(s)),i===r},e.ParseFilePath=function(t){t=e.NormalizeFileSeparator(t);let s=/^\w:\//.exec(t);s?(s=s[0],t=t.slice(3),"/"!==t[0]&&(t="/"+t)):s="",t=t.replace(/\/{2,}/g,"/"),1<t.length&&"/"===t.slice(-1)&&(t=t.slice(0,-1));var i=t.lastIndexOf("/")+1;let r="",n=t,a="";return 0<i&&(r=t.slice(0,i),n=t.slice(i)),t=n,i=n.lastIndexOf("."),0<i&&(a=n.slice(i),t=n.slice(0,-a.length)),{dir:r,base:n,name:t,root:s,ext:a,full:s+r+n}},e.Wait=function(e,t){return new Promise((s,i)=>{self.setTimeout(s,e,t)})},e.swallowException=function(t){try{t()}catch(t){e.isDebug&&console.warn("Swallowed exception: ",t)}},e.noop=function(){},e.equalsNoCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize().toLowerCase()===t.normalize().toLowerCase())},e.equalsCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize()===t.normalize())},e.typedArraySet16=function(e,t,s){e[s++]=t[0],e[s++]=t[1],e[s++]=t[2],e[s++]=t[3],e[s++]=t[4],e[s++]=t[5],e[s++]=t[6],e[s++]=t[7],e[s++]=t[8],e[s++]=t[9],e[s++]=t[10],e[s++]=t[11],e[s++]=t[12],e[s++]=t[13],e[s++]=t[14],e[s]=t[15]},e.truncateArray=function(e,t){e.length=t},e.clearArray=function(t){t&&0!==t.length&&e.truncateArray(t,0)},e.clear2DArray=function(t){if(t){for(let s=0;s<t.length;s++)e.truncateArray(t[s],0);e.truncateArray(t,0)}},e.extendArray=function(e,t,s){t|=0;var i=e.length;if(!(t<=i))for(;i<t;++i)e.push(s)},e.resizeArray=function(t,s,i){s|=0;const r=t.length;s<r?e.truncateArray(t,s):s>r&&e.extendArray(t,s,i)},e.shallowAssignArray=function(t,s){e.clearArray(t),e.appendArray(t,s)},e.appendArray=function(e,t){if(1e4>t.length)e.push(...t);else for(let s=0,i=t.length;s<i;++s)e.push(t[s])},e.arrayRemove=function(t,s){if(s=Math.floor(s),!(0>s||s>=t.length)){for(var i=t.length-1;s<i;++s)t[s]=t[s+1];e.truncateArray(t,i)}},e.arrayFindRemove=function(e,t){t=e.indexOf(t),0<=t&&e.splice(t,1)},e.arraysEqual=function(e,t){let s=e.length;if(t.length!==s)return!1;for(let i=0;i<s;++i)if(e[i]!==t[i])return!1;return!0},e.arrayFilterOut=function(t,s){let i=[],r=0;for(let e=0,n=t.length;e<n;++e){let n=t[e];s(n)?i.push(n):(t[r]=n,++r)}return e.truncateArray(t,r),i},e.arrayRemoveAllInSet=function(t,s){const i=t.length;let r=0;for(let e=0,i=t.length;e<i;++e){let i=t[e];s.has(i)||(t[r++]=i)}return e.truncateArray(t,r),i-r},e.isArrayIndexInBounds=function(e,t){return e===Math.floor(e)&&(0<=e&&e<t.length)},e.validateArrayIndex=function(t,s){if(!e.isArrayIndexInBounds(t,s))throw new RangeError("array index out of bounds")},e.cloneArray=function(e){return e.slice()},e.deepCloneArray=function(t,s){let i=[];for(let r of t)if(e.IsObject(r)){if(t=s(r),!t)throw Error("missing clone");if(t.constructor!==r.constructor)throw Error("object is not a clone");i.push(t)}else e.IsArray(r)?i.push(e.deepCloneArray(r,s)):i.push(r);return i},e.clone2DArray=function(e){let t=[];for(let s of e)t.push(s.slice());return t},e.mergeSets=function(e,t){return new Set([...e,...t])},e.mergeSetsInPlace=function(e,t){for(const s of t)e.add(s);return e},e.first=function(e){for(let t of e)return t;return null},e.xor=function(e,t){return!e!=!t},e.compare=function(e,t,s){switch(t){case 0:return e===s;case 1:return e!==s;case 2:return e<s;case 3:return e<=s;case 4:return e>s;case 5:return e>=s;default:return!1}},e.hasAnyOwnProperty=function(e){for(let t in e)if(e.hasOwnProperty(t))return!0;return!1},e.PromiseAllWithProgress=function(e,t){return e.length?new Promise((s,i)=>{const r=[];let n=0,a=!1;for(let o=0,h=e.length;o<h;++o)r.push(void 0),e[o].then(i=>{a||(r[o]=i,++n,n===e.length?s(r):t(n,e.length))}).catch(e=>{a=!0,i(e)})
}):Promise.resolve([])};let i=[];e.AddLibraryMemoryCallback=function(e){i.push(e)},e.GetEstimatedLibraryMemoryUsage=function(){let e=0;for(let t of i){let s=t();e+=s}return Math.floor(e)};let r=1;const n=new Map,a=new MessageChannel;a.port2.onmessage=function(e){e=e.data;const t=n.get(e);n.delete(e),t&&t(performance.now())},e.RequestUnlimitedAnimationFrame=function(e){const t=r++;return n.set(t,e),a.port1.postMessage(t),t},e.CancelUnlimitedAnimationFrame=function(e){n.delete(e)},e.PostTask=e.RequestUnlimitedAnimationFrame,e.WaitForNextTask=function(){return new Promise(t=>e.PostTask(t))};const o=new Set;e.RequestPostAnimationFrame=function(t){const s=self.requestAnimationFrame(async i=>{await e.WaitForNextTask(),o.has(s)&&(o.delete(s),t(i))});return o.add(s),s},e.CancelPostAnimationFrame=function(e){o.has(e)&&(self.cancelAnimationFrame(e),o.delete(e))}}{const e=self.C3;e.IsAbsoluteURL=function(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)},e.IsRelativeURL=function(t){return!e.IsAbsoluteURL(t)},e.ThrowIfNotOk=function(e){if(!e.ok)throw Error(`fetch '${e.url}' response returned ${e.status} ${e.statusText}`)},e.FetchOk=function(t,s){return fetch(t,s).then(t=>(e.ThrowIfNotOk(t),t))},e.FetchText=function(t){return e.FetchOk(t).then(e=>e.text())},e.FetchJson=function(t){return e.FetchOk(t).then(e=>e.json())},e.FetchBlob=function(t){return e.FetchOk(t).then(e=>e.blob())},e.FetchArrayBuffer=function(t){return e.FetchOk(t).then(e=>e.arrayBuffer())},e.FetchImage=function(e){return new Promise((t,s)=>{const i=new Image;i.onload=(()=>t(i)),i.onerror=(e=>s(e)),i.src=e})},e.BlobToArrayBuffer=function(e){return"function"==typeof e.arrayBuffer?e.arrayBuffer():new Promise((t,s)=>{const i=new FileReader;i.onload=(()=>t(i.result)),i.onerror=(()=>s(i.error)),i.readAsArrayBuffer(e)})},e.BlobToString=function(e){return"function"==typeof e.text?e.text():new Promise((t,s)=>{const i=new FileReader;i.onload=(()=>t(i.result)),i.onerror=(()=>s(i.error)),i.readAsText(e)})},e.BlobToJson=function(t){return e.BlobToString(t).then(e=>JSON.parse(e))},e.BlobToImage=async function(t,s){t=URL.createObjectURL(t);try{const i=await e.FetchImage(t);return URL.revokeObjectURL(t),t="",s&&"function"==typeof i.decode&&await i.decode(),i}finally{t&&URL.revokeObjectURL(t)}},e.CreateCanvas=function(e,t){if("undefined"!=typeof document&&"function"==typeof document.createElement){const s=document.createElement("canvas");return s.width=e,s.height=t,s}return new OffscreenCanvas(e,t)},e.CanvasToBlob=function(t,s,i){return"number"!=typeof i&&(i=1),s=s||"image/png",i=e.clamp(i,0,1),t.toBlob?new Promise(e=>t.toBlob(e,s,i)):t.convertToBlob?t.convertToBlob({type:s,quality:i}):e.Asyncify(()=>e.CanvasToBlobSync(t,s,i))},e.CanvasToBlobSync=function(t,s,i){return"number"!=typeof i&&(i=1),s=s||"image/png",i=e.clamp(i,0,1),e.DataURIToBinaryBlobSync(t.toDataURL(s,i))},e.DataURIToBinaryBlobSync=function(t){return t=e.ParseDataURI(t),e.BinaryStringToBlob(t.data,t.mime_type)},e.ParseDataURI=function(e){if("data:"!==e.substr(0,5))throw new URIError("expected data: uri");var t=e.indexOf(",");if(0>t)throw new URIError("expected comma in data: uri");var s=e.substring(5,t);e=e.substring(t+1),t=s.split(";"),s=t[0]||"";let i=t[2];return e="base64"===t[1]||"base64"===i?atob(e):decodeURIComponent(e),{mime_type:s,data:e}},e.BinaryStringToBlob=function(e,t){var s=e.length;let i,r,n=s>>2,a=new Uint8Array(s),o=new Uint32Array(a.buffer,0,n);for(r=i=0;i<n;++i)o[i]=e.charCodeAt(r++)|e.charCodeAt(r++)<<8|e.charCodeAt(r++)<<16|e.charCodeAt(r++)<<24;for(s&=3;s--;)a[r]=e.charCodeAt(r),++r;return t?new Blob([a],{type:t}):new Blob([a])},e.DrawableToBlob=function(t,s,i){const r=e.CreateCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),e.CanvasToBlob(r,s,i)},e.ImageDataToBlobSync=function(t,s,i){const r=e.CreateCanvas(t.width,t.height);return r.getContext("2d").putImageData(t,0,0),e.CanvasToBlobSync(r,s,i)},e.ImageDataToBlob=function(t,s,i){if(e.Supports.ImageBitmapOptions)return createImageBitmap(t,{premultiplyAlpha:"none"}).then(t=>e.DrawableToBlob(t,s,i));if(e.Supports.ImageBitmap)return createImageBitmap(t).then(t=>e.DrawableToBlob(t,s,i));{const r=e.CreateCanvas(t.width,t.height);return r.getContext("2d").putImageData(t,0,0),e.CanvasToBlob(r,s,i)}},e.CopySet=function(e,t){e.clear();for(const s of t)e.add(s)},e.MapToObject=function(e){const t=Object.create(null);for(const[s,i]of e.entries())t[s]=i;return t},e.ObjectToMap=function(e,t){t.clear();for(const[s,i]of Object.entries(e))t.set(s,i)},e.ToSuperJSON=function e(t){if("object"==typeof t&&null!==t){if(t instanceof Set)return{_c3type_:"set",data:[...t].map(t=>e(t))};if(t instanceof Map)return{_c3type_:"map",data:[...t].map(t=>[t[0],e(t[1])])};{const s=Object.create(null);for(const[i,r]of Object.entries(t))s[i]=e(r);return s}}return t},e.FromSuperJSON=function e(t){if("object"==typeof t&null!==t){if("set"===t._c3type_)return new Set(t.data.map(t=>e(t)));if("map"===t._c3type_)return new Map(t.data.map(t=>[t[0],e(t[1])]));{const s=Object.create(null);for(const[i,r]of Object.entries(t))s[i]=e(r);return s}}return t},e.CSSToCamelCase=function(e){let t="",s=!1;for(const i of e)"-"===i?s=!0:s?(t+=i.toUpperCase(),s=!1):t+=i;return t},e.IsIterator=function(e){return"object"==typeof e&&"function"==typeof e.next},e.MakeFilledArray=function(e,t){const s=[];if("function"==typeof t)for(var i=0;i<e;++i)s.push(t());else for(i=0;i<e;++i)s.push(t);return s}}{const e=self.C3,t=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?/i,s=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?,([0-9.])/i;function c(e){return 0===e.length?"00":1===e.length?"0"+e:e}function d(e,t,s){return 0>s&&(s+=1),1<s&&--s,s<1/6?e+6*(t-e)*s:.5>s?t:s<2/3?e+(t-e)*(2/3-s)*6:e}e.Color=class{constructor(t,s,i,r){this._a=this._b=this._g=this._r=0,t instanceof e.Color?this.set(t):this.setRgba(t||0,s||0,i||0,r||0)}setRgb(e,t,s){return this._r=+e,this._g=+t,this._b=+s,this.clamp(),this}setRgba(e,t,s,i){return this._r=+e,this._g=+t,this._b=+s,this._a=+i,this.clamp(),this}set(e){return this._r=e._r,this._g=e._g,this._b=e._b,this._a=e._a,this}copy(e){return this.set(e)}add(e){this._r+=e._r,this._g+=e._g,this._b+=e._b,this._a+=e._a,this.clamp()}addRgb(e,t,s,i=0){this._r+=+e,this._g+=+t,this._b+=+s,this._a+=+i,this.clamp()}diff(e){this.setR(Math.max(this._r,e._r)-Math.min(this._r,e._r)),this.setG(Math.max(this._g,e._g)-Math.min(this._g,e._g)),this.setB(Math.max(this._b,e._b)-Math.min(this._b,e._b)),this.setA(Math.max(this._a,e._a)-Math.min(this._a,e._a)),this.clamp()}copyRgb(e){this._r=e._r,this._g=e._g,this._b=e._b}setR(t){this._r=e.clamp(+t,0,1)}getR(){return this._r}setG(t){this._g=e.clamp(+t,0,1)}getG(){return this._g}setB(t){this._b=e.clamp(+t,0,1)}getB(){return this._b}setA(t){this._a=e.clamp(+t,0,1)}getA(){return this._a}clone(){return e.New(e.Color,this._r,this._g,this._b,this._a)}toArray(){return[this._r,this._g,this._b,this._a]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t++]=this._b,e[t]=this._a}writeRGBToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t]=this._b}equals(e){return this._r===e._r&&this._g===e._g&&this._b===e._b&&this._a===e._a}equalsIgnoringAlpha(e){return this._r===e._r&&this._g===e._g&&this._b===e._b}equalsRgb(e,t,s){return this._r===e&&this._g===t&&this._b===s}equalsRgba(e,t,s,i){return this._r===e&&this._g===t&&this._b===s&&this._a===i}equalsF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)&&e[t+3]===Math.fround(this._a)}equalsRGBF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)}multiply(e){this._r*=e._r,this._g*=e._g,this._b*=e._b,this._a*=e._a}multiplyAlpha(e){this._r*=e,this._g*=e,this._b*=e,this._a*=e}premultiply(){return this._r*=this._a,this._g*=this._a,this._b*=this._a,this}unpremultiply(){return this._r/=this._a,this._g/=this._a,this._b/=this._a,this}clamp(){return this._r=e.clamp(this._r,0,1),this._g=e.clamp(this._g,0,1),this._b=e.clamp(this._b,0,1),this._a=e.clamp(this._a,0,1),this}setFromRgbValue(t){this._r=e.GetRValue(t),this._g=e.GetGValue(t),this._b=e.GetBValue(t),this._a=e.GetAValue(t)}getCssRgb(t,s,i){return t=e.IsFiniteNumber(t)?t:this.getR(),s=e.IsFiniteNumber(s)?s:this.getG(),i=e.IsFiniteNumber(i)?i:this.getB(),`rgb(${100*t}%, ${100*s}%, ${100*i}%)`}getCssRgba(t,s,i,r){return t=e.IsFiniteNumber(t)?t:this.getR(),s=e.IsFiniteNumber(s)?s:this.getG(),i=e.IsFiniteNumber(i)?i:this.getB(),r=e.IsFiniteNumber(r)?r:this.getA(),`rgba(${100*t}%, ${100*s}%, ${100*i}%, ${r})`}toHexString(){const e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),s=Math.round(255*this.getB());return"#"+c(e.toString(16))+c(t.toString(16))+c(s.toString(16))}parseHexString(e){if("string"!=typeof e)return!1;let t,s;if(e=e.trim(),"#"===e.charAt(0)&&(e=e.substr(1)),3===e.length)t=parseInt(e[0],16)/15,s=parseInt(e[1],16)/15,e=parseInt(e[2],16)/15;else{if(6!==e.length)return!1;t=parseInt(e.substr(0,2),16)/255,s=parseInt(e.substr(2,2),16)/255,e=parseInt(e.substr(4,2),16)/255}return isFinite(t)&&this.setR(t),isFinite(s)&&this.setG(s),isFinite(e)&&this.setB(e),this.setA(1),!0}toCommaSeparatedRgb(){const e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),s=Math.round(255*this.getB());return`${e}, ${t}, ${s}`}toRgbArray(){const e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),s=Math.round(255*this.getB());return[e,t,s]}parseCommaSeparatedRgb(e){if("string"!=typeof e)return!1;e=e.replace(/^rgb\(|\)|%/,"");var t=e.split(",");if(3>t.length)return!1;e=parseInt(t[0].trim(),10)/255;const s=parseInt(t[1].trim(),10)/255;return t=parseInt(t[2].trim(),10)/255,isFinite(e)&&this.setR(e),isFinite(s)&&this.setG(s),isFinite(t)&&this.setB(t),this.setA(1),!0}parseCommaSeparatedPercentageRgb(e){if("string"!=typeof e)return!1;e=e.replace(/^rgb\(|\)|%/,"");var t=e.split(",");if(3>t.length)return!1;e=parseInt(t[0].trim(),10)/100;const s=parseInt(t[1].trim(),10)/100;return t=parseInt(t[2].trim(),10)/100,isFinite(e)&&this.setR(e),isFinite(s)&&this.setG(s),isFinite(t)&&this.setB(t),this.setA(1),!0}parseCommaSeparatedRgba(e){if("string"!=typeof e)return!1;e=e.replace(/^rgba\(|\)|%/,"");var t=e.split(",");if(4>t.length)return!1;e=parseInt(t[0].trim(),10)/255;const s=parseInt(t[1].trim(),10)/255,i=parseInt(t[2].trim(),10)/255;return t=parseFloat(t[3].trim()),isFinite(e)&&this.setR(e),isFinite(s)&&this.setG(s),isFinite(i)&&this.setB(i),isFinite(t)&&this.setA(t),!0}parseCommaSeparatedPercentageRgba(e){if("string"!=typeof e)return!1;e=e.replace(/^rgba\(|\)|%/,"");var t=e.split(",");if(4>t.length)return!1;e=parseInt(t[0].trim(),10)/100;const s=parseInt(t[1].trim(),10)/100,i=parseInt(t[2].trim(),10)/100;return t=parseFloat(t[3].trim()),isFinite(e)&&this.setR(e),isFinite(s)&&this.setG(s),isFinite(i)&&this.setB(i),isFinite(t)&&this.setA(t),!0}parseString(e){if("string"!=typeof e)return!1;if(e=e.replace(/\s+/,""),e.includes(",")){if(e.startsWith("rgb("))return e.includes("%")?this.parseCommaSeparatedPercentageRgb(e):this.parseCommaSeparatedRgb(e);if(e.startsWith("rgba("))return e.includes("%")?this.parseCommaSeparatedPercentageRgba(e):this.parseCommaSeparatedRgba(e);if(e.startsWith("hsl(")||e.startsWith("hsla("))return this.parseHSLString(e);{const t=e.split(",");if(e.includes("%")){if(3===t.length)return this.parseCommaSeparatedPercentageRgb(e);if(4===t.length)return this.parseCommaSeparatedPercentageRgba(e)}else{if(3===t.length)return this.parseCommaSeparatedRgb(e);if(4===t.length)return this.parseCommaSeparatedRgba(e)}return!1}}return this.parseHexString(e)}toJSON(){return[this._r,this._g,this._b,this._a]}setFromHSLA(t,s,i,r){if(t%=360,s=e.clamp(s,0,100),i=e.clamp(i,0,100),r=e.clamp(r,0,1),t/=360,s/=100,i/=100,0===s)i=s=t=i;else{const e=.5>i?i*(1+s):i+s-i*s,r=2*i-e;i=d(r,e,t+1/3),s=d(r,e,t),t=d(r,e,t-1/3)}return this.setR(i),this.setG(s),this.setB(t),this.setA(r),this}parseHSLString(e){var i=e.replace(/ |hsl|hsla|\(|\)|;/gi,"");return e=t.exec(i),i=s.exec(i),e&&4===e.length?(this.setFromHSLA(+e[1],+e[2],+e[3],1),!0):!(!i||5!==i.length)&&(this.setFromHSLA(+e[1],+e[2],+e[3],+e[4]),!0)}toHSLAString(){var t=this._r;const s=this._g,i=this._b,r=this._a,n=e.Color.GetHue(t,s,i),a=e.Color.GetSaturation(t,s,i);return t=e.Color.GetLuminosity(t,s,i),`hsla(${n}, ${a}%, ${t}%, ${r})`}toHSLAArray(){const t=this._r,s=this._g,i=this._b;return[e.Color.GetHue(t,s,i),e.Color.GetSaturation(t,s,i),e.Color.GetLuminosity(t,s,i),this._a]}setFromJSON(e){!Array.isArray(e)||3>e.length||(this._r=e[0],this._g=e[1],this._b=e[2],this._a=4<=e.length?e[3]:1)}set r(e){this.setR(e)}get r(){return this.getR()}set g(e){this.setG(e)}get g(){return this.getG()}set b(e){this.setB(e)}get b(){return this.getB()}set a(e){this.setA(e)}get a(){return this.getA()}setAtIndex(e,t){switch(e){case 0:this.setR(t);break;case 1:this.setG(t);break;case 2:this.setB(t);break;case 3:this.setA(t);break;default:throw new RangeError("invalid color index")}}getAtIndex(e){switch(e){case 0:return this.getR();case 1:return this.getG();case 2:return this.getB();case 3:return this.getA();default:throw new RangeError("invalid color index")}}static Equals(t,s){let i;if(Array.isArray(t))i=new e.Color,i.setFromJSON(t);else{if(!(t instanceof e.Color))throw Error("unexpected type");i=t}if(Array.isArray(s))t=new e.Color,t.setFromJSON(s);else{if(!(s instanceof e.Color))throw Error("unexpected type");t=s}return i.equals(t)}static DiffChannel(t,s){return e.clamp(Math.max(t,s)-Math.min(t,s),0,1)}static Diff(t,s){const i=new e.Color;return i.setR(Math.max(t._r,s._r)-Math.min(t._r,s._r)),i.setG(Math.max(t._g,s._g)-Math.min(t._g,s._g)),i.setB(Math.max(t._b,s._b)-Math.min(t._b,s._b)),i.setA(Math.max(t._a,s._a)-Math.min(t._a,s._a)),i}static DiffNoAlpha(t,s){const i=new e.Color(0,0,0,1);return i.setR(Math.max(t._r,s._r)-Math.min(t._r,s._r)),i.setG(Math.max(t._g,s._g)-Math.min(t._g,s._g)),i.setB(Math.max(t._b,s._b)-Math.min(t._b,s._b)),i}static GetHue(e,t,s){const i=Math.max(e,t,s),r=Math.min(e,t,s);if(i===r)return 0;let n=0;switch(i){case e:n=(t-s)/(i-r)+(t<s?6:0);break;case t:n=(s-e)/(i-r)+2;break;case s:n=(e-t)/(i-r)+4}return Math.round(n/6*360)}static GetSaturation(e,t,s){const i=Math.max(e,t,s);return e=Math.min(e,t,s),i===e?0:(t=i-e,Math.round(100*(.5<(i+e)/2?t/(2-i-e):t/(i+e))))}static GetLuminosity(e,t,s){const i=Math.max(e,t,s);return i?Math.round((i+Math.min(e,t,s))/2*100):0}},e.Color.White=Object.freeze(e.New(e.Color,1,1,1,1)),e.Color.Black=Object.freeze(e.New(e.Color,0,0,0,1)),e.Color.TransparentBlack=Object.freeze(e.New(e.Color,0,0,0,0))}{const e=self.C3;e.Vector2=class{constructor(t,s){this._y=this._x=0,t instanceof e.Vector2?this.copy(t):this.set(t||0,s||0)}set(e,t){this._x=+e,this._y=+t}copy(e){this._x=e._x,this._y=e._y}equals(e){return this._x===e._x&&this._y===e._y}equalsValues(e,t){return this._x===e&&this._y===t}equalsF32Array(e,t){return e[t]===Math.fround(this._x)&&e[t+1]===Math.fround(this._y)}setX(e){this._x=+e}getX(){return this._x}setY(e){this._y=+e}getY(){return this._y}toArray(){return[this._x,this._y]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._x,e[t]=this._y}offset(e,t){this._x+=+e,this._y+=+t}scale(e,t){this._x*=e,this._y*=t}divide(e,t){this._x/=e,this._y/=t}round(){this._x=Math.round(this._x),this._y=Math.round(this._y)}floor(){this._x=Math.floor(this._x),this._y=Math.floor(this._y)}ceil(){this._x=Math.ceil(this._x),this._y=Math.ceil(this._y)}angle(){return e.angleTo(0,0,this._x,this._y)}lengthSquared(){return this._x*this._x+this._y*this._y}length(){return Math.sqrt(this.lengthSquared())}rotatePrecalc(e,t){const s=this._x*t-this._y*e;this._y=this._y*t+this._x*e,this._x=s}rotate(e){0!==e&&this.rotatePrecalc(Math.sin(e),Math.cos(e))}rotateAbout(e,t,s){0===e||t===this._x&&s===this._y||(this._x-=t,this._y-=s,this.rotatePrecalc(Math.sin(e),Math.cos(e)),this._x+=+t,this._y+=+s)}move(e,t){0!==t&&(this._x+=Math.cos(e)*t,this._y+=Math.sin(e)*t)}normalize(){const e=this.length();0!==e&&1!==e&&(this._x/=e,this._y/=e)}clamp(t,s){this._x=e.clamp(this._x,t,s),this._y=e.clamp(this._y,t,s)}}}{const e=self.C3;e.Rect=class{constructor(t,s,i,r){this._bottom=this._right=this._top=this._left=0,t instanceof e.Rect?this.copy(t):this.set(t||0,s||0,i||0,r||0)}set(e,t,s,i){this._left=+e,this._top=+t,this._right=+s,this._bottom=+i}setWH(e,t,s,i){e=+e,t=+t,this._left=e,this._top=t,this._right=e+ +s,this._bottom=t+ +i}copy(e){this._left=+e._left,this._top=+e._top,this._right=+e._right,this._bottom=+e._bottom}clone(){return new e.Rect(this._left,this._top,this._right,this._bottom)}static Merge(t,s){const i=new e.Rect;return i.setLeft(Math.min(t._left,s._left)),i.setTop(Math.min(t._top,s._top)),i.setRight(Math.max(t._right,s._right)),i.setBottom(Math.max(t._bottom,s._bottom)),i}static FromObject(t){return new e.Rect(t.left,t.top,t.right,t.bottom)}equals(e){return this._left===e._left&&this._top===e._top&&this._right===e._right&&this._bottom===e._bottom}equalsWH(e,t,s,i){return this._left===e&&this._top===t&&this.width()===s&&this.height()===i}equalsF32Array(e,t){return e[t]===Math.fround(this._left)&&e[t+1]===Math.fround(this._top)&&e[t+2]===Math.fround(this._right)&&e[t+3]===Math.fround(this._bottom)}setLeft(e){this._left=+e}getLeft(){return this._left}setTop(e){this._top=+e}getTop(){return this._top}setRight(e){this._right=+e}getRight(){return this._right}setBottom(e){this._bottom=+e}getBottom(){return this._bottom}toArray(){return[this._left,this._top,this._right,this._bottom]}toTypedArray(){return new Float64Array(this.toArray())}toDOMRect(){return new DOMRect(this._left,this._top,this.width(),this.height())}writeToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t]=this._bottom}writeAsQuadToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t++]=this._top,e[t++]=this._right,e[t++]=this._bottom,e[t++]=this._left,e[t]=this._bottom}writeAsQuadToTypedArray3D(e,t,s){e[t++]=this._left,e[t++]=this._top,e[t++]=s,e[t++]=this._right,e[t++]=this._top,e[t++]=s,e[t++]=this._right,e[t++]=this._bottom,e[t++]=s,e[t++]=this._left,e[t++]=this._bottom,e[t]=s}width(){return this._right-this._left}height(){return this._bottom-this._top}midX(){return(this._left+this._right)/2}midY(){return(this._top+this._bottom)/2}offset(e,t){e=+e,t=+t,this._left+=e,this._top+=t,this._right+=e,this._bottom+=t}offsetLeft(e){this._left+=+e}offsetTop(e){this._top+=+e}offsetRight(e){this._right+=+e}offsetBottom(e){this._bottom+=+e}toSquare(e){if("x"!==e)throw Error("invalid axis, only 'x' supported");this._bottom=this._top<this._bottom?this._left<this._right?this._top+this.width():this._top-this.width():this._left<this._right?this._top-this.width():this._top+this.width()}inflate(e,t){e=+e,t=+t,this._left-=e,this._top-=t,this._right+=e,this._bottom+=t}deflate(e,t){e=+e,t=+t,this._left+=e,this._top+=t,this._right-=e,this._bottom-=t}multiply(e,t){this._left*=e,this._top*=t,this._right*=e,this._bottom*=t}divide(e,t){this._left/=e,this._top/=t,this._right/=e,this._bottom/=t}mirrorAround(e){this._left=+e-this._left,this._right=+e-this._right}flipAround(e){this._top=+e-this._top,this._bottom=+e-this._bottom}swapLeftRight(){const e=this._left;this._left=this._right,this._right=e}swapTopBottom(){const e=this._top;this._top=this._bottom,this._bottom=e}shuntY(e){const t=this._top;this._top=+e-this._bottom,this._bottom=+e-t}round(){this._left=Math.round(this._left),this._top=Math.round(this._top),this._right=Math.round(this._right),this._bottom=Math.round(this._bottom)}roundInner(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}roundOuter(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}floor(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}ceil(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}clamp(e,t,s,i){this._left<e&&(this._left=+e),this._top<t&&(this._top=+t),this._right>s&&(this._right=+s),this._bottom>i&&(this._bottom=+i)}clampFlipped(e,t,s,i){this._left<e&&(this._left=+e),this._top>t&&(this._top=+t),this._right>s&&(this._right=+s),this._bottom<i&&(this._bottom=+i)}normalize(){this._left>this._right&&this.swapLeftRight(),this._top>this._bottom&&this.swapTopBottom()}intersectsRect(e){return!(e._right<this._left||e._bottom<this._top||e._left>this._right||e._top>this._bottom)}intersectsRectOffset(e,t,s){return!(e._right+t<this._left||e._bottom+s<this._top||e._left+t>this._right||e._top+s>this._bottom)}containsPoint(e,t){return e>=this._left&&e<=this._right&&t>=this._top&&t<=this._bottom}containsRect(e){return e._left>=this._left&&e._top>=this._top&&e._right<=this._right&&e._bottom<=this._bottom}expandToContain(e){e._left<this._left&&(this._left=+e._left),e._top<this._top&&(this._top=+e._top),e._right>this._right&&(this._right=+e._right),e._bottom>this._bottom&&(this._bottom=+e._bottom)}lerpInto(t){this._left=e.lerp(t._left,t._right,this._left),this._top=e.lerp(t._top,t._bottom,this._top),this._right=e.lerp(t._left,t._right,this._right),this._bottom=e.lerp(t._top,t._bottom,this._bottom)}}}{const e=self.C3;e.Quad=class{constructor(t,s,i,r,n,a,o,h){this._bly=this._blx=this._bry=this._brx=this._try=this._trx=this._tly=this._tlx=0,t instanceof e.Quad?this.copy(t):this.set(t||0,s||0,i||0,r||0,n||0,a||0,o||0,h||0)}set(e,t,s,i,r,n,a,o){this._tlx=+e,this._tly=+t,this._trx=+s,this._try=+i,this._brx=+r,this._bry=+n,this._blx=+a,this._bly=+o}setRect(e,t,s,i){this.set(e,t,s,t,s,i,e,i)}copy(e){this._tlx=e._tlx,this._tly=e._tly,this._trx=e._trx,this._try=e._try,this._brx=e._brx,this._bry=e._bry,this._blx=e._blx,this._bly=e._bly}equals(e){return this._tlx===e._tlx&&this._tly===e._tly&&this._trx===e._trx&&this._try===e._try&&this._brx===e._brx&&this._bry===e._bry&&this._blx===e._blx&&this._bly===e._bly}setTlx(e){this._tlx=+e}getTlx(){return this._tlx}setTly(e){this._tly=+e}getTly(){return this._tly}setTrx(e){this._trx=+e}getTrx(){return this._trx}setTry(e){this._try=+e}getTry(){return this._try}setBrx(e){this._brx=+e}getBrx(){return this._brx}setBry(e){this._bry=+e}getBry(){return this._bry}setBlx(e){this._blx=+e}getBlx(){return this._blx}setBly(e){this._bly=+e}getBly(){return this._bly}toDOMQuad(){return new DOMQuad(new DOMPoint(this._tlx,this._tly),new DOMPoint(this._trx,this._try),new DOMPoint(this._brx,this._bry),new DOMPoint(this._blx,this._bly))}toArray(){return[this._tlx,this._tly,this._trx,this._try,this._brx,this._bry,this._blx,this._bly]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=this._trx,e[t++]=this._try,e[t++]=this._brx,e[t++]=this._bry,e[t++]=this._blx,e[t]=this._bly}writeToTypedArray3D(e,t,s){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=s,e[t++]=this._trx,e[t++]=this._try,e[t++]=s,e[t++]=this._brx,e[t++]=this._bry,e[t++]=s,e[t++]=this._blx,e[t++]=this._bly,e[t]=s}offset(e,t){e=+e,t=+t,this._tlx+=e,this._tly+=t,this._trx+=e,this._try+=t,this._brx+=e,this._bry+=t,this._blx+=e,this._bly+=t}round(){this._tlx=Math.round(this._tlx),this._tly=Math.round(this._tly),this._trx=Math.round(this._trx),this._try=Math.round(this._try),this._brx=Math.round(this._brx),this._bry=Math.round(this._bry),this._blx=Math.round(this._blx),this._bly=Math.round(this._bly)}floor(){this._tlx=Math.floor(this._tlx),this._tly=Math.floor(this._tly),this._trx=Math.floor(this._trx),this._try=Math.floor(this._try),this._brx=Math.floor(this._brx),this._bry=Math.floor(this._bry),this._blx=Math.floor(this._blx),this._bly=Math.floor(this._bly)}ceil(){this._tlx=Math.ceil(this._tlx),this._tly=Math.ceil(this._tly),this._trx=Math.ceil(this._trx),this._try=Math.ceil(this._try),this._brx=Math.ceil(this._brx),this._bry=Math.ceil(this._bry),this._blx=Math.ceil(this._blx),this._bly=Math.ceil(this._bly)}setFromRect(e){this._tlx=e._left,this._tly=e._top,this._trx=e._right,this._try=e._top,this._brx=e._right,this._bry=e._bottom,this._blx=e._left,this._bly=e._bottom}setFromRotatedRect(e,t){0===t?this.setFromRect(e):this.setFromRotatedRectPrecalc(e,Math.sin(t),Math.cos(t))}setFromRotatedRectPrecalc(e,t,s){const i=e._left*t,r=e._top*t,n=e._right*t;t*=e._bottom;const a=e._left*s,o=e._top*s,h=e._right*s;e=e._bottom*s,this._tlx=a-r,this._tly=o+i,this._trx=h-r,this._try=o+n,this._brx=h-t,this._bry=e+n,this._blx=a-t,this._bly=e+i}getBoundingBox(e){e.set(Math.min(this._tlx,this._trx,this._brx,this._blx),Math.min(this._tly,this._try,this._bry,this._bly),Math.max(this._tlx,this._trx,this._brx,this._blx),Math.max(this._tly,this._try,this._bry,this._bly))}containsPoint(e,t){var s=this._trx-this._tlx,i=this._try-this._tly;const r=this._brx-this._tlx,n=this._bry-this._tly;e-=this._tlx,t-=this._tly;var a=s*s+i*i;let o=s*r+i*n;i=s*e+i*t;const h=r*r+n*n,l=r*e+n*t;let c=1/(a*h-o*o);return s=(h*i-o*l)*c,a=(a*l-o*i)*c,0<=s&&0<a&&1>s+a||(s=this._blx-this._tlx,i=this._bly-this._tly,a=s*s+i*i,o=s*r+i*n,i=s*e+i*t,c=1/(a*h-o*o),s=(h*i-o*l)*c,a=(a*l-o*i)*c,0<=s&&0<a&&1>s+a)}midX(){return(this._tlx+this._trx+this._brx+this._blx)/4}midY(){return(this._tly+this._try+this._bry+this._bly)/4}intersectsSegment(t,s,i,r){return!(!this.containsPoint(t,s)&&!this.containsPoint(i,r))||e.segmentIntersectsQuad(t,s,i,r,this)}intersectsQuad(t){var s=t.midX(),i=t.midY();if(this.containsPoint(s,i))return!0;if(s=this.midX(),i=this.midY(),t.containsPoint(s,i))return!0;s=this._tlx,i=this._tly;const r=this._trx,n=this._try,a=this._brx,o=this._bry,h=this._blx,l=this._bly;return e.segmentIntersectsQuad(s,i,r,n,t)||e.segmentIntersectsQuad(r,n,a,o,t)||e.segmentIntersectsQuad(a,o,h,l,t)||e.segmentIntersectsQuad(h,l,s,i,t)}rotatePointsAnticlockwise(){const e=this._tlx,t=this._tly;this._tlx=this._trx,this._tly=this._try,this._trx=this._brx,this._try=this._bry,this._brx=this._blx,this._bry=this._bly,this._blx=e,this._bly=t}mirror(){this._swap(0,2),this._swap(1,3),this._swap(6,4),this._swap(7,5)}flip(){this._swap(0,6),this._swap(1,7),this._swap(2,4),this._swap(3,5)}diag(){this._swap(2,6),this._swap(3,7)}_swap(e,t){const s=this._getAtIndex(e);this._setAtIndex(e,this._getAtIndex(t)),this._setAtIndex(t,s)}_getAtIndex(e){switch(e){case 0:return this._tlx;case 1:return this._tly;case 2:return this._trx;case 3:return this._try;case 4:return this._brx;case 5:return this._bry;case 6:return this._blx;case 7:return this._bly;default:throw new RangeError("invalid quad point index")}}_setAtIndex(e,t){switch(t=+t,e){case 0:this._tlx=t;break;case 1:this._tly=t;break;case 2:this._trx=t;break;case 3:this._try=t;break;case 4:this._brx=t;break;case 5:this._bry=t;break;case 6:this._blx=t;break;case 7:this._bly=t;break;default:throw new RangeError("invalid quad point index")}}}}{const e=self.C3,t=[0,0,1,0,1,1,0,1],s=e.New(e.Quad);e.CollisionPoly=class extends e.DefendedBase{constructor(s,i=!0){super(),s||(s=t),this._ptsArr=Float64Array.from(s),this._bbox=new e.Rect,this._isBboxChanged=!0,this._enabled=i}Release(){}pointsArr(){return this._ptsArr}pointCount(){return this._ptsArr.length/2}setPoints(e){this._ptsArr.length===e.length?this._ptsArr.set(e):this._ptsArr=Float64Array.from(e),this._isBboxChanged=!0}setDefaultPoints(){this.setPoints(t)}copy(e){this.setPoints(e._ptsArr)}setBboxChanged(){this._isBboxChanged=!0}_updateBbox(){if(this._isBboxChanged){var e=this._ptsArr,t=e[0],s=e[1],i=t,r=s;for(let n=0,a=e.length;n<a;n+=2){const a=e[n],o=e[n+1];a<t&&(t=a),a>i&&(i=a),o<s&&(s=o),o>r&&(r=o)}this._bbox.set(t,s,i,r),this._isBboxChanged=!1}}setFromRect(e,t,s){let i=this._ptsArr;8!==i.length&&(this._ptsArr=i=new Float64Array(8)),i[0]=e.getLeft()-t,i[1]=e.getTop()-s,i[2]=e.getRight()-t,i[3]=e.getTop()-s,i[4]=e.getRight()-t,i[5]=e.getBottom()-s,i[6]=e.getLeft()-t,i[7]=e.getBottom()-s,this._bbox.copy(e),0===t&&0===s||this._bbox.offset(-t,-s),this._isBboxChanged=!1}setFromQuad(e,t,i){s.copy(e),s.offset(t,i),this.setPoints(s.toArray()),this._isBboxChanged=!0}transform(e,t,s){let i=0,r=1;0!==s&&(i=Math.sin(s),r=Math.cos(s)),this.transformPrecalc(e,t,i,r)}transformPrecalc(e,t,s,i){const r=this._ptsArr;for(let n=0,a=r.length;n<a;n+=2){const a=n+1,o=r[n]*e,h=r[a]*t;r[n]=o*i-h*s,r[a]=h*i+o*s}this._isBboxChanged=!0}offset(e,t){const s=this._ptsArr;for(let i=0,r=s.length;i<r;i+=2)s[i]+=e,s[i+1]+=t}containsPoint(t,s){const i=this._ptsArr;if(t===i[0]&&s===i[1])return!0;this._updateBbox();var r=this._bbox;const n=r.getLeft()-110,a=r.getTop()-101,o=r.getRight()+131;let h,l,c,u,_,d,p,g;r=r.getBottom()+120,n<t?(h=n,c=t):(h=t,c=n),a<s?(l=a,u=s):(l=s,u=a),o<t?(_=o,p=t):(_=t,p=o),r<s?(d=r,g=s):(d=s,g=r);let m=0,f=0;for(let y=0,G=i.length;y<G;y+=2){var S=(y+2)%G;const T=i[y],I=i[y+1],b=i[S];S=i[S+1],e.segmentsIntersectPreCalc(n,a,t,s,h,c,l,u,T,I,b,S)&&++m,e.segmentsIntersectPreCalc(o,r,t,s,_,p,d,g,T,I,b,S)&&++f}return 1==m%2||1==f%2}intersectsPoly(t,s,i){const r=t._ptsArr,n=this._ptsArr;if(this.containsPoint(r[0]+s,r[1]+i)||t.containsPoint(n[0]-s,n[1]-i))return!0;for(let o=0,h=n.length;o<h;o+=2){var a=(o+2)%h;t=n[o];const l=n[o+1],c=n[a];let u,_,d,p;a=n[a+1],t<c?(u=t,d=c):(u=c,d=t),l<a?(_=l,p=a):(_=a,p=l);for(let n=0,o=r.length;n<o;n+=2){const h=(n+2)%o;if(e.segmentsIntersectPreCalc(t,l,c,a,u,d,_,p,r[n]+s,r[n+1]+i,r[h]+s,r[h+1]+i))return!0}}return!1}intersectsSegment(t,s,i,r,n,a){if(this.containsPoint(i-t,r-s)||this.containsPoint(n-t,a-s))return!0;let o,h,l,c;i<n?(o=i,l=n):(o=n,l=i),r<a?(h=r,c=a):(h=a,c=r);const u=this._ptsArr;for(let _=0,d=u.length;_<d;_+=2){const p=(_+2)%d;if(e.segmentsIntersectPreCalc(i,r,n,a,o,l,h,c,u[_]+t,u[_+1]+s,u[p]+t,u[p+1]+s))return!0}return!1}mirror(e){const t=this._ptsArr;for(let s=0,i=t.length;s<i;s+=2)t[s]=2*e-t[s];this._isBboxChanged=!0}flip(e){const t=this._ptsArr;for(let s=0,i=t.length;s<i;s+=2){const i=s+1;t[i]=2*e-t[i]}this._isBboxChanged=!0}diag(){const e=this._ptsArr;for(let t=0,s=e.length;t<s;t+=2){const s=t+1,i=e[t];e[t]=e[s],e[s]=i}this._isBboxChanged=!0}GetMidX(){const e=this._ptsArr;let t=0;for(let s=0,i=e.length;s<i;s+=2)t+=e[s];return t/this.pointCount()}GetMidY(){const e=this._ptsArr;let t=0;for(let s=0,i=e.length;s<i;s+=2)t+=e[s+1];return t/this.pointCount()}GetPointsArray(){return this._ptsArr}GetPointCount(){return this.pointCount()}IsEnabled(){return this._enabled}}}{const e=self.C3;e.PairMap=class extends e.DefendedBase{constructor(e){if(super(),this._firstMap=new Map,e)for(const[t,s,i]of e)this.Set(t,s,i)}Release(){this.Clear(),this._firstMap=null}Clear(){const e=this._firstMap;for(const t of e.values())t.clear();e.clear()}Set(e,t,s){const i=this._firstMap;let r=i.get(e);r||(r=new Map,i.set(e,r)),r.set(t,s)}Get(e,t){return(e=this._firstMap.get(e))?e.get(t):e}Has(e,t){return!!(e=this._firstMap.get(e))&&e.has(t)}Delete(e,t){const s=this._firstMap,i=s.get(e);return!!i&&((t=i.delete(t))&&0===i.size&&s.delete(e),t)}DeleteEither(e){const t=this._firstMap,s=t.get(e);s&&(s.clear(),t.delete(e));for(const[s,i]of t.entries())i.delete(e)&&0===i.size&&t.delete(s)}GetSize(){let e=0;for(const t of this._firstMap.values())e+=t.size;return e}*values(){for(const e of this._firstMap.values())yield*e.values()}*keyPairs(){for(const[e,t]of this._firstMap.entries())for(const s of t.keys())yield[e,s]}*entries(){for(const[e,t]of this._firstMap.entries())for(const[s,i]of t.entries())yield[e,s,i]}}}{const e=self.C3;e.ArraySet=class extends e.DefendedBase{constructor(){super(),this._set=new Set,this._arr=[],this._needToRebuildArray=!1}Release(){this.Clear()}Clear(){this._set.clear(),e.clearArray(this._arr),this._needToRebuildArray=!1}Add(e){this._set.has(e)||(this._set.add(e),this._needToRebuildArray||this._arr.push(e))}Has(e){return this._set.has(e)}Delete(e){this._set.delete(e)&&(this._needToRebuildArray=!0)}GetSize(){return this._set.size}IsEmpty(){return 0===this._set.size}GetArray(){return this._needToRebuildArray&&(this._RebuildArray(),this._needToRebuildArray=!1),this._arr}_RebuildArray(){
const t=this._arr;e.clearArray(t);for(const e of this._set)t.push(e)}}}{const e=new Map,t=new Map,s=new Map,i=new Map,r=new Map,n=new Map;n.set("linear","noease"),n.set("default","noease"),self.Ease=class c{constructor(){}static InheritEase(){return"default"}static DefaultEase(){return"noease"}static GetEditorEaseNames(e,...i){return this._CreateEaseMap(),s.has(e)||s.set(e,new Map),e=[...s.get(e).keys()],e.sort(),[...t.keys()].concat(e).filter(e=>!i.includes(e))}static GetRuntimeEaseNames(){this._CreateEaseMap();const e=[...i.keys()];return e.sort(),[...t.keys()].concat(e)}static IsNamePredefined(e){return this._CreateEaseMap(),[...t.keys()].includes(e)}static _GetEase(t){const s=n.get(t);return s?e.get(s):c.IsNamePredefined(t)?e.get(t):r.has(t)?r.get(t):void 0}static GetEditorEase(e,t){this._CreateEaseMap();const i=c._GetEase(e);return i||s.get(t).get(e)}static GetRuntimeEase(e){this._CreateEaseMap();const t=c._GetEase(e);return t||i.get(e)}static GetEaseFromIndex(e){return this._CreateEaseMap(),this.GetRuntimeEaseNames()[e]}static GetIndexForEase(e,t){return this._CreateEaseMap(),this.GetEditorEaseNames(t).indexOf(e)}static _CreateEaseMap(){0===e.size&&(this._AddPredifinedEase("default",()=>{}),this._AddPredifinedEase("noease",this.NoEase),this._AddPredifinedEase("easeinsine",this.EaseInSine),this._AddPredifinedEase("easeoutsine",this.EaseOutSine),this._AddPredifinedEase("easeinoutsine",this.EaseInOutSine),this._AddPredifinedEase("easeinelastic",this.EaseInElastic),this._AddPredifinedEase("easeoutelastic",this.EaseOutElastic),this._AddPredifinedEase("easeinoutelastic",this.EaseInOutElastic),this._AddPredifinedEase("easeinback",this.EaseInBack),this._AddPredifinedEase("easeoutback",this.EaseOutBack),this._AddPredifinedEase("easeinoutback",this.EaseInOutBack),this._AddPredifinedEase("easeinbounce",this.EaseInBounce),this._AddPredifinedEase("easeoutbounce",this.EaseOutBounce),this._AddPredifinedEase("easeinoutbounce",this.EaseInOutBounce),this._AddPredifinedEase("easeincubic",this.EaseInCubic),this._AddPredifinedEase("easeoutcubic",this.EaseOutCubic),this._AddPredifinedEase("easeinoutcubic",this.EaseInOutCubic),this._AddPredifinedEase("easeinquad",this.EaseInQuad),this._AddPredifinedEase("easeoutquad",this.EaseOutQuad),this._AddPredifinedEase("easeinoutquad",this.EaseInOutQuad),this._AddPredifinedEase("easeinquart",this.EaseInQuart),this._AddPredifinedEase("easeoutquart",this.EaseOutQuart),this._AddPredifinedEase("easeinoutquart",this.EaseInOutQuart),this._AddPredifinedEase("easeinquint",this.EaseInQuint),this._AddPredifinedEase("easeoutquint",this.EaseOutQuint),this._AddPredifinedEase("easeinoutquint",this.EaseInOutQuint),this._AddPredifinedEase("easeincirc",this.EaseInCirc),this._AddPredifinedEase("easeoutcirc",this.EaseOutCirc),this._AddPredifinedEase("easeinoutcirc",this.EaseInOutCirc),this._AddPredifinedEase("easeinexpo",this.EaseInExpo),this._AddPredifinedEase("easeoutexpo",this.EaseOutExpo),this._AddPredifinedEase("easeinoutexpo",this.EaseInOutExpo),this._AddPrivateCustomEase("cubicbezier",this.EaseCubicBezier),this._AddPrivateCustomEase("spline",this.EaseSpline))}static _AddPredifinedEase(e,t){c._AddEase(e,t,"predefined")}static _AddPrivateCustomEase(e,t){c._AddEase(e,t,"private")}static AddCustomEase(e,t,s){this._CreateEaseMap(),c._AddEase(e,t,"custom",s)}static RemoveCustomEase(e,t){this.IsNamePredefined(e)||[...r.keys()].includes(e)||(t=s.get(t))&&t.delete(e)}static _AddEase(n,a,o,h){switch(o){case"predefined":e.set(n,a),t.set(n,a);break;case"custom":h?(s.has(h)||s.set(h,new Map),s.get(h).set(n,a)):i.set(n,a);break;case"private":e.set(n,a),r.set(n,a);break;default:throw Error("unexpected ease mode")}}static NoEase(e,t,s,i){return s*e/i+t}static EaseInQuad(e,t,s,i){return s*(e/=i)*e+t}static EaseOutQuad(e,t,s,i){return-s*(e/=i)*(e-2)+t}static EaseInOutQuad(e,t,s,i){return 1>(e/=i/2)?s/2*e*e+t:-s/2*(--e*(e-2)-1)+t}static EaseInCubic(e,t,s,i){return s*(e/=i)*e*e+t}static EaseOutCubic(e,t,s,i){return s*((e=e/i-1)*e*e+1)+t}static EaseInOutCubic(e,t,s,i){return 1>(e/=i/2)?s/2*e*e*e+t:s/2*((e-=2)*e*e+2)+t}static EaseInQuart(e,t,s,i){return s*(e/=i)*e*e*e+t}static EaseOutQuart(e,t,s,i){return-s*((e=e/i-1)*e*e*e-1)+t}static EaseInOutQuart(e,t,s,i){return 1>(e/=i/2)?s/2*e*e*e*e+t:-s/2*((e-=2)*e*e*e-2)+t}static EaseInQuint(e,t,s,i){return s*(e/=i)*e*e*e*e+t}static EaseOutQuint(e,t,s,i){return s*((e=e/i-1)*e*e*e*e+1)+t}static EaseInOutQuint(e,t,s,i){return 1>(e/=i/2)?s/2*e*e*e*e*e+t:s/2*((e-=2)*e*e*e*e+2)+t}static EaseInSine(e,t,s,i){return-s*Math.cos(e/i*(Math.PI/2))+s+t}static EaseOutSine(e,t,s,i){return s*Math.sin(e/i*(Math.PI/2))+t}static EaseInOutSine(e,t,s,i){return-s/2*(Math.cos(Math.PI*e/i)-1)+t}static EaseInExpo(e,t,s,i){return 0===e?t:s*Math.pow(2,10*(e/i-1))+t}static EaseOutExpo(e,t,s,i){return e===i?t+s:s*(1-Math.pow(2,-10*e/i))+t}static EaseInOutExpo(e,t,s,i){return 0===e?t:e===i?t+s:1>(e/=i/2)?s/2*Math.pow(2,10*(e-1))+t:s/2*(2-Math.pow(2,-10*--e))+t}static EaseInCirc(e,t,s,i){return-s*(Math.sqrt(1-(e/=i)*e)-1)+t}static EaseOutCirc(e,t,s,i){return s*Math.sqrt(1-(e=e/i-1)*e)+t}static EaseInOutCirc(e,t,s,i){return 1>(e/=i/2)?-s/2*(Math.sqrt(1-e*e)-1)+t:s/2*(Math.sqrt(1-(e-=2)*e)+1)+t}static EaseInElastic(e,t,s,i){let r=0,n=s;return 0===e?t:1==(e/=i)?t+s:(r||(r=.3*i),n<Math.abs(s)?(n=s,s=r/4):s=r/(2*Math.PI)*Math.asin(s/n),-n*Math.pow(2,10*--e)*Math.sin(2*(e*i-s)*Math.PI/r)+t)}static EaseOutElastic(e,t,s,i){let r,n=0,a=s;return 0===e?t:1==(e/=i)?t+s:(n||(n=.3*i),a<Math.abs(s)?(a=s,r=n/4):r=n/(2*Math.PI)*Math.asin(s/a),a*Math.pow(2,-10*e)*Math.sin(2*(e*i-r)*Math.PI/n)+s+t)}static EaseInOutElastic(e,t,s,i){let r,n=0,a=s;return 0===e?t:2==(e/=i/2)?t+s:(n||(n=.3*i*1.5),a<Math.abs(s)?(a=s,r=n/4):r=n/(2*Math.PI)*Math.asin(s/a),1>e?-.5*a*Math.pow(2,10*--e)*Math.sin(2*(e*i-r)*Math.PI/n)+t:a*Math.pow(2,-10*--e)*Math.sin(2*(e*i-r)*Math.PI/n)*.5+s+t)}static EaseInBack(e,t,s,i,r){return void 0===r&&(r=1.70158),s*(e/=i)*e*((r+1)*e-r)+t}static EaseOutBack(e,t,s,i,r){return void 0===r&&(r=1.70158),s*((e=e/i-1)*e*((r+1)*e+r)+1)+t}static EaseInOutBack(e,t,s,i,r){return void 0===r&&(r=1.70158),1>(e/=i/2)?s/2*e*e*((1+(r*=1.525))*e-r)+t:s/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t}static EaseInBounce(e,t,s,i){return s-c.EaseOutBounce(i-e,0,s,i)+t}static EaseOutBounce(e,t,s,i){return(e/=i)<1/2.75?7.5625*s*e*e+t:e<2/2.75?s*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?s*(7.5625*(e-=2.25/2.75)*e+.9375)+t:s*(7.5625*(e-=2.625/2.75)*e+.984375)+t}static EaseInOutBounce(e,t,s,i){return e<i/2?.5*c.EaseInBounce(2*e,0,s,i)+t:.5*c.EaseOutBounce(2*e-i,0,s,i)+.5*s+t}static EaseCubicBezier(e,t,s,i,r){return t+3*e*(s-t)+3*e**2*(t+i-2*s)+e**3*(r-t+3*s-3*i)}static EaseSpline(e,t,s,i,r,n,c,_,d,p){return i===r&&n===c?e:(e=u(e,t,i,n,_,p),t=a(s,r,c,d),i=o(s,r,c,d),s=h(s,r,c,d),l(e,t,i,s))}static GetBezierSamples(e,t,s,i){const r=[],n=a(e,t,s,i),c=o(e,t,s,i);for(e=h(e,t,s,i),t=0;11>t;++t)s=l(.1*t,n,c,e),r.push(s);return r}};const a=(e,t,s,i)=>i-3*s+3*t-e,o=(e,t,s,i)=>3*s-6*t+3*e,h=(e,t,s,i)=>3*(t-e),l=(e,t,s,i)=>((t*e+s)*e+i)*e,c=(e,t,s,i)=>3*t*e*e+2*s*e+i,u=(e,t,s,i,r,n)=>{if(1==e)return 1;for(var u=0,_=1,d=n[_];10!=_&&d<=e;)_++,d=n[_],u+=.1;if(_--,d=n[_],n=u+(e-d)/(n[_+1]-d)*.1,_=a(t,s,i,r),d=o(t,s,i,r),t=h(t,s,i,r),s=c(n,_,d,t),0!==s)if(.02<=s)for(u=0;4>u;++u)s=l(n,_,d,t)-e,i=c(n,_,d,t),n-=s/i;else{let a;s=u,u+=.1,i=0;do{n=s+(u-s)/2,r=l(n,_,d,t)-e,0<r?u=n:s=n,r=1e-7<Math.abs(r),a=10>++i}while(r&&a)}return n}}{const e=self.C3;function b(t){e.IsString(t)}e.ProbabilityTable=class{constructor(){this._items=[],this._totalWeight=0}Release(){this.Clear(),this._items=null}Clear(){e.clear2DArray(this._items),this._totalWeight=0}GetTotalWeight(){return this._totalWeight}Sample(e=Math.random()*this.GetTotalWeight()){let t=0;for(const[s,i]of this._items)if(t+=s,e<t)return i;return 0}AddItem(e,t){b(t),this._totalWeight+=e,this._items.push([e,t])}RemoveItem(e,t){b(t);const s=0===e;for(let i=0;i<this._items.length;i++){const r=this._items[i],n=r[1]===t;if((s||r[0]===e)&&n){this._items.splice(i,1),this._totalWeight-=r[0];break}}}asJSON(){return JSON.stringify(this._items)}static fromJSON(t){const s=new e.ProbabilityTable;t=JSON.parse(t);for(const e of t)s.AddItem(e[0],e[1]);return s}}}self.C3.Event=class{constructor(e,t){this.type=e,this.cancelable=!!t,this.isAsync=this.propagationStopped=this.defaultPrevented=!1}preventDefault(){if(!this.cancelable)throw Error(`event '${this.type}' is not cancelable`);this.defaultPrevented=!0}stopPropagation(){if(!this.cancelable)throw Error(`event '${this.type}' cannot be stopped`);if(this.isAsync)throw Error(`cannot stop async event '${this.type}' propagation`);this.propagationStopped=!0}};{const e=self.C3;e.Event.Handler=class extends e.DefendedBase{constructor(e){super(),this._type=e,this._captureListeners=[],this._captureListenersSet=new Set,this._listeners=[],this._listenersSet=new Set,this._fireDepth=0,this._queueModifyListeners=[]}Release(){0<this._fireDepth||(e.clearArray(this._captureListeners),this._captureListenersSet.clear(),e.clearArray(this._listeners),this._listenersSet.clear(),e.clearArray(this._queueModifyListeners),e.Release(this))}_AddListener(e,t){this._IsFiring()?this._queueModifyListeners.push({op:"add",func:e,capture:t}):t?this._captureListenersSet.has(e)||(this._captureListeners.push(e),this._captureListenersSet.add(e)):this._listenersSet.has(e)||(this._listeners.push(e),this._listenersSet.add(e))}_RemoveListener(t,s){this._IsFiring()?this._queueModifyListeners.push({op:"remove",func:t,capture:s}):s?this._captureListenersSet.has(t)&&(this._captureListenersSet.delete(t),e.arrayFindRemove(this._captureListeners,t)):this._listenersSet.has(t)&&(this._listenersSet.delete(t),e.arrayFindRemove(this._listeners,t))}_IsEmpty(){return!this._captureListeners.length&&!this._listeners.length}_IsFiring(){return 0<this._fireDepth}_ProcessQueuedListeners(){const t=new Set,s=new Set;for(const e of this._queueModifyListeners)if("add"===e.op)this._AddListener(e.func,e.capture),e.capture?s.delete(e.func):t.delete(e.func);else{if("remove"!==e.op)throw Error("invalid op");e.capture?(this._captureListenersSet.delete(e.func),s.add(e.func)):(this._listenersSet.delete(e.func),t.add(e.func))}e.arrayRemoveAllInSet(this._listeners,t),e.arrayRemoveAllInSet(this._captureListeners,s),e.clearArray(this._queueModifyListeners)}_FireCancellable(e){this._IncreaseFireDepth();let t=!1;for(let s=0,i=this._captureListeners.length;s<i;++s)if(this._captureListeners[s](e),e.propagationStopped){t=!0;break}if(!t)for(let t=0,s=this._listeners.length;t<s&&(this._listeners[t](e),!e.propagationStopped);++t);return this._DecreaseFireDepth(),!e.defaultPrevented}_FireNonCancellable(e){this._IncreaseFireDepth();for(let t=0,s=this._captureListeners.length;t<s;++t)this._captureListeners[t](e);for(let t=0,s=this._listeners.length;t<s;++t)this._listeners[t](e);return this._DecreaseFireDepth(),!0}_IncreaseFireDepth(){this._fireDepth++}_DecreaseFireDepth(){this._fireDepth--,0===this._fireDepth&&0<this._queueModifyListeners.length&&this._ProcessQueuedListeners()}SetDelayRemoveEventsEnabled(e){e?this._IncreaseFireDepth():this._DecreaseFireDepth()}_FireAsync(t){let s=[];for(let i=0,r=this._captureListeners.length;i<r;++i){let r=this._captureListeners[i];s.push(e.Asyncify(()=>r(t)))}for(let i=0,r=this._listeners.length;i<r;++i){let r=this._listeners[i];s.push(e.Asyncify(()=>r(t)))}return Promise.all(s).then(()=>!t.defaultPrevented)}_FireAndWait_AsyncOptional(e){const t=[];this._IncreaseFireDepth();for(let i=0,r=this._captureListeners.length;i<r;++i){var s=this._captureListeners[i](e);s instanceof Promise&&t.push(s)}for(let i=0,r=this._listeners.length;i<r;++i)s=this._listeners[i](e),s instanceof Promise&&t.push(s);return this._DecreaseFireDepth(),t.length?Promise.all(t).then(()=>!e.defaultPrevented):!e.defaultPrevented}async _FireAndWaitAsync(e){return await this._FireAndWait_AsyncOptional(e)}async _FireAndWaitAsyncSequential(e){this._IncreaseFireDepth();for(let s=0,i=this._captureListeners.length;s<i;++s){var t=this._captureListeners[s](e);t instanceof Promise&&await t}for(let s=0,i=this._listeners.length;s<i;++s)t=this._listeners[s](e),t instanceof Promise&&await t;return this._DecreaseFireDepth(),!e.defaultPrevented}*_FireAsGenerator(t){this._IncreaseFireDepth();for(let i=0,r=this._captureListeners.length;i<r;++i){var s=this._captureListeners[i](t);e.IsIterator(s)&&(yield*s)}for(let i=0,r=this._listeners.length;i<r;++i)s=this._listeners[i](t),e.IsIterator(s)&&(yield*s);this._DecreaseFireDepth()}}}{const e=self.C3;e.Event.Dispatcher=class extends e.DefendedBase{constructor(){super(),this._eventHandlers=new Map,this._dispatcherWasReleased=!1}Release(){if(this._dispatcherWasReleased)throw Error("already released");this.ClearEvents(),this._dispatcherWasReleased=!0,e.Release(this)}WasReleased(){return this._dispatcherWasReleased}ClearEvents(){for(let e of this._eventHandlers.values())e.Release();this._eventHandlers.clear()}_GetHandlerByType(t,s){let i=this._eventHandlers.get(t);return i||(s?(i=e.New(e.Event.Handler,t),this._eventHandlers.set(t,i),i):null)}HasAnyHandlerFor(e){return this._eventHandlers.has(e)}addEventListener(e,t,s){this._GetHandlerByType(e,!0)._AddListener(t,!!s)}removeEventListener(e,t,s){let i=this._GetHandlerByType(e,!1);i&&(i._RemoveListener(t,!!s),i._IsEmpty()&&this._eventHandlers.delete(e))}dispatchEvent(e){const t=this._GetHandlerByType(e.type,!1);return!t||(e.cancelable?t._FireCancellable(e):t._FireNonCancellable(e))}dispatchEventAsync(e){const t=this._GetHandlerByType(e.type,!1);return t?(e.isAsync=!0,t._FireAsync(e)):Promise.resolve(!0)}async dispatchEventAndClearAsync(e){const t=this._GetHandlerByType(e.type,!1);return!t||(this._eventHandlers.delete(e.type),e.isAsync=!0,e=await t._FireAsync(e),t.Release(),e)}async dispatchEventAndWaitAsync(e){const t=this._GetHandlerByType(e.type,!1);return!t||await t._FireAndWaitAsync(e)}dispatchEventAndWait_AsyncOptional(e){const t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWait_AsyncOptional(e)}async dispatchEventAndWaitAsyncSequential(e){const t=this._GetHandlerByType(e.type,!1);return!t||await t._FireAndWaitAsyncSequential(e)}dispatchGeneratorEvent(e){const t=this._GetHandlerByType(e.type,!1);if(!t)return null;if(e.cancelable)throw Error("not supported");return t._FireAsGenerator(e)}SetDelayRemoveEventsEnabled(e){for(const t of this._eventHandlers.values())t.SetDelayRemoveEventsEnabled(e)}}}{const e=self.C3,t="undefined"!=typeof requestIdleCallback;let s=[],i=-1,r=0;function f(e){i=t&&0===r?requestIdleCallback(h,{timeout:35}):setTimeout(h,0<r?1:e)}function h(e){if(i=-1,s.length){var n=performance.now(),a=0;do{g(s.shift());var o=performance.now();++a;var h=(o-n)/a*1.1}while(s.length&&(t&&0===r&&void 0!==e?h<e.timeRemaining():12>o-n+h));-1===i&&s.length&&f(Math.max(16-(o-n),4))}}function g(e){let t;try{t=e.func()}catch(t){return void e.reject(t)}e.resolve(t)}let n=e.QueryString.Has("disable-asyncify");n&&console.warn("[Asyncify] Asyncify has been disabled due to disable-asyncify in the query string. Some work will now be done synchronously."),e.Asyncify=function(t){let r=null;return e.isDebug&&(r=e.GetCallStack()),new Promise((e,a)=>{s.push({func:t,resolve:e,reject:a,stack:r}),n?g(s.pop()):-1===i&&f(16)})},e.Asyncify.SetHighThroughputMode=function(e){if(e)++r;else if(--r,0>r)throw Error("already turned off high throughput mode")}}{const e=self.C3;let t=-1;function a(){t=-1}e.FastGetDateNow=function(){return-1===t&&(t=Date.now(),self.setTimeout(a,16)),t};let s=-1,i=-1,r=new Set;function h(){i=s=-1;let e=Date.now();for(let t of r)if(t._CheckTimeout(e)){let e=t._GetDeadline();(-1===i||e<i)&&(i=e)}else r.delete(t);-1!==i&&(s=self.setTimeout(h,Math.max(i-e+100,1e3)))}e.IdleTimeout=class{constructor(e,t){this._callback=e,this._timeout=1e3*t,this._deadline=0,this._isActive=!1}Reset(){let t=e.FastGetDateNow();this._deadline=t+this._timeout,this._isActive||(r.add(this),this._isActive=!0),-1===s?(i=this._deadline,s=self.setTimeout(h,this._timeout+100)):this._deadline<i&&i>t+1e3&&(self.clearTimeout(s),i=this._deadline,s=self.setTimeout(h,this._timeout+100))}_CheckTimeout(e){return!(e>=this._deadline)||(this._callback()?(this._deadline=e+this._timeout,!0):this._isActive=!1)}_GetDeadline(){return this._deadline}Cancel(){this._isActive&&(r.delete(this),this._isActive=!1,0===r.size&&-1!==s&&(self.clearTimeout(s),i=s=-1))}Release(){this.Cancel(),this._callback=null}}}{const e=self.C3;e.Disposable=class t{constructor(e){this._disposed=!1,this._disposeAction=e}Dispose(){this._disposed||(this._disposed=!0,this._disposeAction&&(this._disposeAction(),this._disposeAction=null))}IsDisposed(){return this._disposed}Release(){this.Dispose()}static Release(e){return new t(()=>e.Release())}static From(t,s,i,r,n){if(null==r)r=!1;else if("boolean"!=typeof r&&"object"!=typeof r)throw new TypeError("invalid event listener options");if(n&&(i=i.bind(n)),s.includes(" ")){s=s.split(" "),n=new e.CompositeDisposable;for(let a of s)t.addEventListener(a,i,r),n.Add(e.New(e.Disposable,()=>t.removeEventListener(a,i,r)));return n}return t.addEventListener(s,i,r),e.New(e.Disposable,()=>t.removeEventListener(s,i,r))}},e.StubDisposable=class extends e.Disposable{SetAction(e){this._disposeAction=e}},e.CompositeDisposable=class extends e.Disposable{constructor(...e){super(),this._disposables=new Set;for(let t of e)this.Add(t)}Add(...e){if(this._disposed)throw Error("already disposed");for(let t of e)this._disposables.add(t)}Remove(e){if(this._disposed)throw Error("already disposed");this._disposables.delete(e)}RemoveAll(){if(this._disposed)throw Error("already disposed");if(this._disposables){for(let e of this._disposables)e.Dispose();this._disposables.clear()}}IsDisposed(){return this._disposed}Dispose(){if(this._disposed)throw Error("already disposed");this._disposed=!0;for(let e of this._disposables)e.Dispose();this._disposables.clear(),this._disposables=null}Release(){this.Dispose()}}}{const e=self.C3;e.KahanSum=class extends e.DefendedBase{constructor(){super(),this._sum=this._t=this._y=this._c=0}Add(e){this._y=+e-this._c,this._t=this._sum+this._y,this._c=this._t-this._sum-this._y,this._sum=this._t}Subtract(e){this._sum-=+e}Get(){return this._sum}Reset(){this._sum=this._t=this._y=this._c=0}Set(e){this._t=this._y=this._c=0,this._sum=+e}Release(){}}}{const e=self.C3,t={RBnode:function(e){this.tree=e,this.left=this.right=this.tree.sentinel,this.parent=null,this.color=!1,this.key=null},RedBlackSet:function(e){this.size=0,this.sentinel=new t.RBnode(this),this.sentinel.color=!1,this.root=this.sentinel,this.root.parent=this.sentinel,this.compare=e||this.default_compare}};t.RedBlackSet.prototype.default_compare=function(e,t){return e<t?-1:t<e?1:0},t.RedBlackSet.prototype.clone=function(){var e=new t.RedBlackSet(this.compare);return e.insertAll(this),e},t.RedBlackSet.prototype.clear=function(){this.size=0,this.sentinel=new t.RBnode(this),this.sentinel.color=!1,this.root=this.sentinel,this.root.parent=this.sentinel},t.RedBlackSet.prototype.leftRotate=function(e){var t=e.right;e.right=t.left,t.left!=this.sentinel&&(t.left.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t},t.RedBlackSet.prototype.rightRotate=function(e){var t=e.left;e.left=t.right,t.right!=this.sentinel&&(t.right.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t},t.RedBlackSet.prototype.insert=function(e){if(this.contains(e))this.get_(e).key=e;else{var s=new t.RBnode(this);s.key=e,e=this.sentinel;for(var i=this.root;i!=this.sentinel;)e=i,i=0>this.compare(s.key,i.key)?i.left:i.right;s.parent=e,e==this.sentinel?this.root=s:0>this.compare(s.key,e.key)?e.left=s:e.right=s,s.left=this.sentinel,s.right=this.sentinel,s.color=!0,this.insertFixup(s),this.size++}},t.RedBlackSet.prototype.insertFixup=function(e){for(;e!=this.sentinel&&e!=this.root&&1==e.parent.color;)if(e.parent==e.parent.parent.left){var t=e.parent.parent.right;1==t.color?(e.parent.color=!1,t.color=!1,e.parent.parent.color=!0,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.leftRotate(e)),e.parent.color=!1,e.parent.parent.color=!0,e.parent.parent!=this.sentinel&&this.rightRotate(e.parent.parent))}else t=e.parent.parent.left,1==t.color?(e.parent.color=!1,t.color=!1,e.parent.parent.color=!0,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rightRotate(e)),e.parent.color=!1,e.parent.parent.color=!0,e.parent.parent!=this.sentinel&&this.leftRotate(e.parent.parent));this.root.color=!1},t.RedBlackSet.prototype.delete_=function(e){var t=e.left==this.sentinel||e.right==this.sentinel?e:this.successor_(e),s=t.left!=this.sentinel?t.left:t.right;s.parent=t.parent,t.parent==this.sentinel?this.root=s:t==t.parent.left?t.parent.left=s:t.parent.right=s,t!=e&&(e.key=t.key),0==t.color&&this.deleteFixup(s),this.size--},t.RedBlackSet.prototype.deleteFixup=function(e){for(;e!=this.root&&0==e.color;)if(e==e.parent.left){var t=e.parent.right;1==t.color&&(t.color=!1,e.parent.color=!0,this.leftRotate(e.parent),t=e.parent.right),0==t.left.color&&0==t.right.color?(t.color=!0,e=e.parent):(0==t.right.color&&(t.left.color=!1,t.color=!0,this.rightRotate(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=!1,t.right.color=!1,this.leftRotate(e.parent),e=this.root)}else t=e.parent.left,1==t.color&&(t.color=!1,e.parent.color=!0,this.rightRotate(e.parent),t=e.parent.left),0==t.right.color&&0==t.left.color?(t.color=!0,e=e.parent):(0==t.left.color&&(t.right.color=!1,t.color=!0,this.leftRotate(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=!1,t.left.color=!1,this.rightRotate(e.parent),e=this.root);e.color=!1},t.RedBlackSet.prototype.remove=function(e){if(e=this.get_(e),e!=this.sentinel){var t=e.key;return this.delete_(e),t}return null},t.RedBlackSet.prototype.removeSwapped=function(e,t){this.remove(t)},t.RedBlackSet.prototype.min=function(e){for(;e.left!=this.sentinel;)e=e.left;return e},t.RedBlackSet.prototype.max=function(e){for(;e.right!=this.sentinel;)e=e.right;return e},t.RedBlackSet.prototype.successor_=function(e){if(e.right!=this.sentinel)return this.min(e.right);for(var t=e.parent;t!=this.sentinel&&e==t.right;)e=t,t=t.parent;return t},t.RedBlackSet.prototype.predeccessor_=function(e){if(e.left!=this.sentinel)return this.max(e.left);for(var t=e.parent;t!=this.sentinel&&e==t.left;)e=t,t=t.parent;return t},t.RedBlackSet.prototype.successor=function(e){if(0<this.size){if(e=this.get_(e),e==this.sentinel)return null;if(e.right!=this.sentinel)return this.min(e.right).key;for(var t=e.parent;t!=this.sentinel&&e==t.right;)e=t,t=t.parent;return t!=this.sentinel?t.key:null}return null},t.RedBlackSet.prototype.predecessor=function(e){if(0<this.size){if(e=this.get_(e),e==this.sentinel)return null;if(e.left!=this.sentinel)return this.max(e.left).key;for(var t=e.parent;t!=this.sentinel&&e==t.left;)e=t,t=t.parent;return t!=this.sentinel?t.key:null}return null},t.RedBlackSet.prototype.getMin=function(){return this.min(this.root).key},t.RedBlackSet.prototype.getMax=function(){return this.max(this.root).key},t.RedBlackSet.prototype.get_=function(e){for(var t=this.root;t!=this.sentinel&&0!=this.compare(t.key,e);)t=0>this.compare(e,t.key)?t.left:t.right;return t},t.RedBlackSet.prototype.contains=function(e){return null!=this.get_(e).key},t.RedBlackSet.prototype.getValues=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},t.RedBlackSet.prototype.insertAll=function(e){if("array"==t.typeOf(e))for(var s=0;s<e.length;s++)this.insert(e[s]);else if("function"==t.typeOf(e.forEach))e.forEach(this.insert,this);else if("function"==t.typeOf(e.getValues))for(e=e.getValues(),s=0;s<e.length;s++)this.insert(e[s]);else if("object"==t.typeOf(e))for(s in e)this.insert(e[s])},t.RedBlackSet.prototype.removeAll=function(e){if("array"==t.typeOf(e))for(var s=0;s<e.length;s++)this.remove(e[s]);else if("function"==t.typeOf(e.forEach))e.forEach(this.removeSwapped,this);else if("function"==t.typeOf(e.getValues))for(e=e.getValues(),s=0;s<e.length;s++)this.remove(e[s]);else if("object"==t.typeOf(e))for(s in e)this.remove(e[s])},t.RedBlackSet.prototype.containsAll=function(e){if("array"==t.typeOf(e)){for(var s=0;s<e.length;s++)if(!this.contains(e[s]))return!1;return!0}if("function"==t.typeOf(e.forEach))return e.every(this.contains,this);if("function"==t.typeOf(e.getValues)){for(e=e.getValues(),s=0;s<e.length;s++)if(!this.contains(e[s]))return!1;return!0}if("object"==t.typeOf(e)){for(s in e)if(!this.contains(e[s]))return!1;return!0}},t.RedBlackSet.prototype.range=function(e,t){var s=[];return this.traverseFromTo(function(e){s.push(e)},e,t),s},t.RedBlackSet.prototype.traverse=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel&&!e.call(t,s.key,this);)s=this.successor_(s)},t.RedBlackSet.prototype.traverseFrom=function(e,t,s){if(!this.isEmpty())for(t=this.get_(t);t!=this.sentinel&&!e.call(s,t.key,this);)t=this.successor_(t)},t.RedBlackSet.prototype.traverseTo=function(e,t,s){if(!this.isEmpty()){var i=this.min(this.root);for(t=this.get_(t);i!=t&&!e.call(s,i.key,this);)i=this.successor_(i)}},t.RedBlackSet.prototype.traverseFromTo=function(e,t,s,i){if(!this.isEmpty())for(t=this.get_(t),s=this.get_(s);t!=s&&!e.call(i,t.key,this);)t=this.successor_(t)},t.RedBlackSet.prototype.traverseBackwards=function(e,t){if(!this.isEmpty())for(var s=this.max(this.root);s!=this.sentinel&&!e.call(t,s.key,this);)s=this.predeccessor_(s)},t.RedBlackSet.prototype.forEach=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))e.call(t,s.key,s.key,this)},t.RedBlackSet.prototype.some=function(e,t){if(this.isEmpty())return!1;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))if(e.call(t,s.key,s.key,this))return!0;return!1},t.RedBlackSet.prototype.every=function(e,t){if(this.isEmpty())return!1;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))if(!e.call(t,s.key,s.key,this))return!1;return!0},t.RedBlackSet.prototype.map=function(e,t){var s=[];if(this.isEmpty())return s;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))s.push(e.call(t,i.key,i.key,this));return s},t.RedBlackSet.prototype.filter=function(e,t){var s=[];if(this.isEmpty())return s;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))e.call(t,i.key,i.key,this)&&s.push(i.key);return s},t.RedBlackSet.prototype.getCount=function(){return this.size},t.RedBlackSet.prototype.isEmpty=function(){return 0==this.size},t.RedBlackSet.prototype.isSubsetOf=function(e){var s=t.getCount(e);if(this.getCount()>s)return!1;if(s=0,this.isEmpty())return!0;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))t.contains.call(e,e,i.key)&&s++;return s==this.getCount()},t.RedBlackSet.prototype.intersection=function(e){var s=new t.RedBlackSet(this.compare);if(this.isEmpty())return s;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))e.contains.call(e,i.key,i.key,this)&&s.insert(i.key);return s},e.RedBlackSet=class extends e.DefendedBase{constructor(e){super(),this._rbSet=new t.RedBlackSet(e),this._enableQueue=!1,this._queueInsert=new Set,this._queueRemove=new Set}Add(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.delete(e):this._queueInsert.add(e):this._rbSet.insert(e)}Remove(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.add(e):this._queueInsert.delete(e):this._rbSet.remove(e)}Has(e){return this._enableQueue?!!this._queueInsert.has(e)||!this._queueRemove.has(e)&&this._rbSet.contains(e):this._rbSet.contains(e)}Clear(){this._rbSet.clear(),this._queueInsert.clear(),this._queueRemove.clear()}toArray(){if(this._enableQueue)throw Error("cannot be used in queueing mode");return this._rbSet.getValues()}GetSize(){return this._rbSet.getCount()+this._queueInsert.size-this._queueRemove.size}IsEmpty(){return 0===this.GetSize()}Front(){if(this.IsEmpty())throw Error("empty set");if(this._enableQueue)throw Error("cannot be used in queueing mode");const e=this._rbSet;return e.min(e.root).key}Shift(){if(this.IsEmpty())throw Error("empty set");if(this._enableQueue)throw Error("cannot be used in queueing mode");const e=this.Front();return this.Remove(e),e}SetQueueingEnabled(e){if(e=!!e,this._enableQueue!==e&&(this._enableQueue=e,!e)){for(const e of this._queueRemove)this._rbSet.remove(e);this._queueRemove.clear();for(const e of this._queueInsert)this._rbSet.insert(e);this._queueInsert.clear()}}ForEach(e){this._rbSet.forEach(e)}*values(){if(!this.IsEmpty()){var e=this._rbSet;for(let t=e.min(e.root);t!=e.sentinel;t=e.successor_(t))yield t.key}}[Symbol.iterator](){return this.values()}}}{const e=self.C3;e.PromiseThrottle=class{constructor(t=e.hardwareConcurrency){this._maxParallel=t,this._queue=[],this._activeCount=0}Add(e){return new Promise((t,s)=>{this._queue.push({func:e,resolve:t,reject:s}),this._MaybeStartNext()})}_FindInQueue(e){for(let t=0,s=this._queue.length;t<s;++t)if(this._queue[t].func===e)return t;return-1}RemoveAndResolve(e,t){if(e=this._FindInQueue(e),-1===e)throw Error("cannot find promise to resolve");this._queue[e].resolve(t),this._queue.splice(e,1)}RemoveAndReject(e,t){if(e=this._FindInQueue(e),-1===e)throw Error("cannot find promise to reject");this._queue[e].reject(t),this._queue.splice(e,1)}async _MaybeStartNext(){if(this._queue.length&&!(this._activeCount>=this._maxParallel)){this._activeCount++;var e=this._queue.shift();try{const t=await e.func();e.resolve(t)}catch(t){e.reject(t)}this._activeCount--,this._MaybeStartNext()}}static async Batch(e,t){const s=[];let i=!1;const r=async e=>{for(;(e=t.pop())&&!i;)try{s.push(await e())}catch(e){throw i=!0,e}},n=[];for(;e--;)n.push(r());return await Promise.all(n),s}}}{const e=self.C3;e.RateLimiter=class{constructor(e,t,s){this._callback=e,this._interval=t,this._intervalOnBattery=s||2*t,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=(()=>this._OnTimer()),this._canRunImmediate=this._ignoreReset=!1,this._callbackArguments=null}SetCanRunImmediate(e){this._canRunImmediate=!!e}_GetInterval(){return void 0!==e.Battery&&e.Battery.IsOnBatteryPower()?this._intervalOnBattery:this._interval}Call(...t){if(-1===this._timerId){this._callbackArguments=t,t=e.FastGetDateNow();var s=t-this._lastCallTime,i=this._GetInterval();s>=i&&this._canRunImmediate?(this._lastCallTime=t,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(i-s,4))}}_RunCallback(){this._ignoreReset=!0;const e=this._callbackArguments;this._callbackArguments=null,e?this._callback(...e):this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._callbackArguments=null,this._lastCallTime=e.FastGetDateNow())}_OnTimer(){this._timerId=-1,this._lastCallTime=e.FastGetDateNow(),this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._timerCallFunc=this._callbackArguments=this._callback=null}}}{const e=self.C3;e.SVGRasterManager=class{constructor(){this._images=new Map,this._allowNpotSurfaces=!1,this._redrawCallback=this._releaseResultCallback=this._rasterAtSizeCallback=this._getBaseSizeCallback=null}SetNpotSurfaceAllowed(e){this._allowNpotSurfaces=!!e}IsNpotSurfaceAllowed(){return this._allowNpotSurfaces}SetGetBaseSizeCallback(e){this._getBaseSizeCallback=e}GetBaseSize(e){if(!this._getBaseSizeCallback)throw Error("no get base size callback set");return this._getBaseSizeCallback(e)}SetRasterAtSizeCallback(e){this._rasterAtSizeCallback=e}RasterAtSize(e,t,s,i,r,n){if(!this._rasterAtSizeCallback)throw Error("no raster at size callback set");return this._rasterAtSizeCallback(e,t,s,i,r,n)}SetReleaseResultCallback(e){this._releaseResultCallback=e}ReleaseResult(e){if(!this._releaseResultCallback)throw Error("no release result callback set");this._releaseResultCallback(e)}SetRedrawCallback(e){this._redrawCallback=e}Redraw(){if(!this._redrawCallback)throw Error("no redraw callback set");this._redrawCallback()}AddImage(t){
let s=this._images.get(t);return s||(s=e.New(e.SVGRasterImage,this,t),this._images.set(t,s)),s.IncReference(),s}_RemoveImage(e){this._images.delete(e.GetDataSource())}OnTexturesChanged(){for(const e of this._images.values())e.ReleaseRasterizedResult(),e.ForceRasterAgain()}}}{const e=self.C3;e.SVGRasterImage=class{constructor(e,t){this._manager=e,this._dataSource=t,this._baseHeight=this._baseWidth=this._refCount=0,this._getBaseSizePromise=this._manager.GetBaseSize(t).then(e=>{this._baseWidth=e[0],this._baseHeight=e[1],this._manager.Redraw()}).catch(e=>{console.error("[SVG] Error loading SVG: ",e),this._hadError=!0,this._manager.Redraw()}),this._rasterImageHeight=this._rasterImageWidth=this._rasterSurfaceHeight=this._rasterSurfaceWidth=0,this._isRasterizing=!1,this._rasterizedResult=null,this._hadError=this._forceRaster=!1}Release(){if(0>=this._refCount)throw Error("already released");this._refCount--,0===this._refCount&&this._Release()}ReleaseRasterizedResult(){this._rasterizedResult&&(this._manager.ReleaseResult(this._rasterizedResult),this._rasterizedResult=null)}_Release(){this.ReleaseRasterizedResult(),this._manager._RemoveImage(this),this._manager=null}GetDataSource(){return this._dataSource}IncReference(){this._refCount++}HasReferences(){return 0<this._refCount}GetRasterizedResult(){return this._rasterizedResult}ForceRasterAgain(){this._forceRaster=!0}async StartRasterForSize(t,s,i){if(0!==s&&0!==i&&!this._hadError&&!this._isRasterizing){var r=e.nextHighestPowerOfTwo(Math.ceil(s)),n=e.nextHighestPowerOfTwo(Math.ceil(i)),a=Math.max(r,n);2048<a&&(a=2048/a,s*=a,i*=a,r=Math.min(Math.ceil(r*a),2048),n=Math.min(Math.ceil(n*a),2048)),s<r&&i<n&&(i=s/i,r/n>i?(s=n*i,i=n):(s=r,i=r/i)),this._manager.IsNpotSurfaceAllowed()&&(r=Math.ceil(s),n=Math.ceil(i)),r<=this._rasterSurfaceWidth&&n<=this._rasterSurfaceHeight&&!this._forceRaster||(this._isRasterizing=!0,this._rasterSurfaceWidth=r,this._rasterSurfaceHeight=n,t=await this._manager.RasterAtSize(this._dataSource,t,this._rasterSurfaceWidth,this._rasterSurfaceHeight,s,i),this._manager&&(this.ReleaseRasterizedResult(),this._rasterizedResult=t,this._rasterImageWidth=s,this._rasterImageHeight=i,this._forceRaster=this._isRasterizing=!1,this._manager.Redraw()))}}WhenBaseSizeReady(){return this._getBaseSizePromise}GetBaseWidth(){return this._baseWidth}GetBaseHeight(){return this._baseHeight}GetRasterWidth(){return this._rasterImageWidth}GetRasterHeight(){return this._rasterImageHeight}HadError(){return this._hadError}}}{const e=self.C3;e.UTF8_BOM="\ufeff";const t=new Set([..."0123456789"]);e.IsNumericChar=function(e){return t.has(e)};const s=new Set([..." \t\n\r\u2028\u2029"]);e.IsWhitespaceChar=function(e){return s.has(e)},e.FilterWhitespace=function(t){return[...t].filter(t=>!e.IsWhitespaceChar(t)).join("")},e.IsStringAllWhitespace=function(t){for(const s of t)if(!e.IsWhitespaceChar(s))return!1;return!0},e.IsUnprintableChar=function(e){return 1===e.length&&32>e.charCodeAt(0)},e.FilterUnprintableChars=function(t){return[...t].filter(t=>!e.IsUnprintableChar(t)).join("")};const i=new Set([..."0123456789.+-e"]);e.IsStringNumber=function(e){if(e=e.trim(),!e.length)return!1;let s=e.charAt(0);if("-"!==s&&!t.has(s))return!1;for(let t of e)if(!i.has(t))return!1;return!0},e.RemoveTrailingDigits=function(t){let s=t.length;for(;0<s;){let i=t.charAt(s-1);if(!e.IsNumericChar(i))break;--s}return t.substr(0,s)},e.IncrementNumberAtEndOf=function(t){let s=e.RemoveTrailingDigits(t);return t=(t=t.substr(s.length))?(parseInt(t,10)+1).toString():"2",s+t};const r=new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#39;"]]);function f(e){return r.get(e)}const n=/[&<>"']/g;e.EscapeHTML=function(e){return e.replace(n,f)},e.EscapeJS=function(t){return t=e.ReplaceAll(t,"\\","\\\\"),t=e.ReplaceAll(t,'"','\\"'),t=e.ReplaceAll(t,"\t","\\t"),t=e.ReplaceAll(t,"\r",""),e.ReplaceAll(t,"\n","\\n")},e.EscapeXML=function(t){return t=e.ReplaceAll(t,"&","&amp;"),t=e.ReplaceAll(t,"<","&lt;"),t=e.ReplaceAll(t,">","&gt;"),e.ReplaceAll(t,'"',"&quot;")};const a=/[-[\]{}()*+?.,\\^$|#\s]/g;e.EscapeRegex=function(e){return e.replace(a,"\\$&")},e.FindAll=function(e,t,s=!1){if(!t)return[];s||(e=e.toLowerCase(),t=t.toLowerCase()),s=t.length;var i=0;let r=[];for(;-1<(i=e.indexOf(t,i));)r.push(i),i+=s;return r},e.ReplaceAll=function(e,t,s){return e.replaceAll(t,()=>s)},e.ReplaceAllCaseInsensitive=function(t,s,i){return t.replace(new RegExp(e.EscapeRegex(s),"gi"),()=>i)},e.SetElementContent=function(t,s){"string"==typeof s?t.textContent=s:s.isPlainText()?t.textContent=s.toString():(t.innerHTML=s.toHTML(),s instanceof e.BBString&&s.attachLinkHandlers(t))},e.StringLikeEquals=function(t,s){return t instanceof e.HtmlString||t instanceof e.BBString?t.equals(s):s instanceof e.HtmlString||s instanceof e.BBString?s.equals(t):t===s},e.StringSubstitute=function(e,...t){let s=e;for(let i=0,r=t.length;i<r;++i){const r=`{${i}}`;if(!e.includes(r))throw Error(`missing placeholder '${r}' in string substitution`);s=s.replace(r,t[i].toString())}return s},e.StringSubstituteAllowMissing=function(e,...t){let s=e,i=-1,r=-1;for(let n=0,a=t.length;n<a;++n){const a=`{${n}}`;e.includes(a)?(r=n,s=s.replace(a,t[n].toString())):-1===i&&(i=n)}if(0<=i&&0<=r&&i<r)throw Error(`missing placeholder '${i}' in string substitution`);return s},e.StringSubstituteMap=function(e,t){for(let[s,i]of Object.entries(t))e=e.replaceAll(s,i.toString());return e},e.SortAZCaseInsensitive=function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e>t?1:e<t?-1:0},e.FormatDataSize=function(e,t){t="common."+(t?"dataRates":"dataSizes")+".";const s=self.langSub;return 1024>e?s(t+"bytes",e):1048576>e?(e/=1024,e=10>e?Math.round(10*e)/10:Math.round(e),s(t+"kilobytes",e)):1073741824>e?(e/=1048576,e=10>e?Math.round(10*e)/10:Math.round(e),s(t+"megabytes",e)):1099511627776>e?(e/=1073741824,e=10>e?Math.round(10*e)/10:Math.round(e),s(t+"gigabytes",e)):(e/=1099511627776,e=10>e?Math.round(10*e)/10:Math.round(e),s(t+"terabytes",e))};const o={approximate:!1,days:!0,hours:!0,minutes:!0,seconds:!0};e.FormatTime=function(t,s){s=Object.assign({},o,s),e.Lang.PushContext("common.time");const i=[],r=self.lang,n=self.langPluralSub;if(s.days){var a=Math.floor(t/86400);0<a&&(t-=86400*a,i.push(n(".days",null,a)))}return s.hours&&(a=Math.floor(t/3600),0<a||i.length)&&(t-=3600*a,i.push(n(".hours",null,a))),s.minutes&&(a=Math.floor(t/60),0<a||i.length||!s.seconds)&&(t-=60*a,i.push(n(".minutes",null,a))),s.seconds&&i.push(n(".seconds",null,Math.floor(t%60))),t=(s.approximate?r(".approx-prefix"):"")+i.join(r(".separator")),e.Lang.PopContext(),t},e.ZeroPad=function(e,t){let s=0>e?"-":"";e=Math.abs(e),e=e.toString(),t-=e.length;for(let e=0;e<t;++e)s+="0";return s+e},e.StringToTitleCase=function(e){return e.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())},e.CompareVersionStrings=function(t,s){t=t.split(".").map(e=>e.trim()),s=s.split(".").map(e=>e.trim()),e.resizeArray(t,4,"0"),e.resizeArray(s,4,"0"),t=t.map(e=>parseInt(e,10)),s=s.map(e=>parseInt(e,10));for(let e=0;4>e;++e){const i=t[e]-s[e];if(0!==i)return 0>i?-1:1}return 0},e.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.floor(16*Math.random());return("x"===e?t:3&t|8).toString(16)})},e.StringHammingDistance=function(e,t){if(e.length!==t.length)throw Error("strings must be same length");let s=0;for(let i=0,r=e.length;i<r;++i)e.charAt(i)!==t.charAt(i)&&++s;return s},e.StringLevenshteinDistance=function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;let s,i,r,n;if(e.length>t.length){var a=e;e=t,t=a}for(n=Array(e.length+1),a=0;a<=e.length;a++)n[a]=a;for(a=1;a<=t.length;a++){for(i=a,s=1;s<=e.length;s++)r=t[a-1]===e[s-1]?n[s-1]:Math.min(n[s-1]+1,Math.min(i+1,n[s]+1)),n[s-1]=i,i=r;n[e.length]=i}return n[e.length]}}{const e=self.C3,t=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["sub","sub"],["sup","sup"],["small","small"],["mark","mark"],["a1","a"],["a2","a"],["a3","a"],["a4","a"],["a5","a"],["a6","a"],["a7","a"],["a8","a"],["a9","a"],["bad",["span","bbCodeBad"]],["good",["span","bbCodeGood"]],["info",["span","bbCodeInfo"]],["h1",["span","bbCodeH1"]],["h2",["span","bbCodeH2"]],["h3",["span","bbCodeH3"]],["h4",["span","bbCodeH4"]],["item",["span","bbCodeItem"]]]),s=/\[(\/?)([a-zA-Z0-9]+)\]/g,i=/\[(\/?)([^\[\n]*?)\]/g;let r=null,n=0;function h(e,s,i){var a=t.get(i);if(!a)return"class"===i?s?"</span>":`<span class="bbclass${n++}">`:e;if("string"==typeof a){if("a"!==a||s)return"<"+s+a+">";if(s=parseInt(i.substring(1),10)-1,0>s||s>=r.length)throw Error("invalid bbcode link substitution");if(a=r[s],"string"==typeof a)return`<a href="${r[s]}">`;if("function"==typeof a)return`<a class="bblink${s}">`;throw new TypeError("invalid bbcode link action")}return Array.isArray(a)?(e=a[0],a=a[1],s?"</"+e+">":`<${e} class="${a}">`):void 0}const a=/\n/g;e.BBString=class{constructor(t,s){if(this._bbstr=s&&s.noEscape?t:e.EscapeHTML(t),this._htmlstr="",this._convertLineBreaks=!1,this._linkActions=[],s&&(this._convertLineBreaks=!!s.convertLineBreaks,s.links)){if(9<s.links.length)throw Error("too many links");this._linkActions=s.links}this._hasAnyBBtags=this._bbstr.includes("["),this._needsLineBreakConversion=this._convertLineBreaks&&this._bbstr.includes("\n"),this._isPlain=!this._hasAnyBBtags&&!this._needsLineBreakConversion&&!this._bbstr.includes("&"),this._hasParsedFragments=!1,this._fragments=[]}toString(){return this._bbstr}valueOf(){return this._bbstr}isPlainText(){return this._isPlain}toPlainText(){return this._hasAnyBBtags?this._bbstr.replace(s,""):this._bbstr}toHTML(){if(this._isPlain)return this._bbstr;if(!this._htmlstr&&this._bbstr){let e=this._bbstr;this._hasAnyBBtags&&(n=0,r=this._linkActions,e=e.replace(s,h),r=null),this._needsLineBreakConversion&&(e=e.replace(a,"<br>")),this._htmlstr=e}return this._htmlstr}attachLinkHandlers(e){if(this._linkActions.length)for(let t=0,s=this._linkActions.length;t<s;++t){const s=this._linkActions[t];if("function"!=typeof s)continue;const i=e.querySelector(".bblink"+t);if(!i)throw Error("unable to attach BBString link handler");i.onclick=s}}equals(t){return t instanceof e.HtmlString?this.toHTML()===t.toHTML():t instanceof e.BBString?this._bbstr===t._bbstr:this._bbstr===t}toFragmentList(){if(this._hasParsedFragments)return this._fragments;const e=this._bbstr,t=[];let s=i.lastIndex=0;for(var r;null!==(r=i.exec(e));){var n=r.index;if(0<n&&"\\"===e.charAt(n-1))continue;var a=r[0],o=r[1];r=r[2];const i=e.substring(s,n);if(s=n+a.length,i&&this._fragments.push({text:i,styles:t.slice(0)}),r)if(o){for(r=r.toLowerCase(),n=t.length-1;0<=n;--n)if(t[n].tag===r){t.splice(n,1);break}}else n=r,a=null,o=r.indexOf("="),-1!==o?(n=r.substring(0,o).toLowerCase(),a=r.substring(o+1)):n=n.toLowerCase(),t.push({tag:n,param:a})}s<e.length&&this._fragments.push({text:e.substring(s),styles:t.slice(0)});for(const e of this._fragments)e.text=this._ProcessBBCodeEscapeSequences(e.text);return this._hasParsedFragments=!0,this._fragments}_ProcessBBCodeEscapeSequences(t){return t=e.ReplaceAll(t,"\\[","["),e.ReplaceAll(t,"\\\\","\\")}static StripTags(t){return e.New(e.BBString,t,{noEscape:!0}).toPlainText()}static StripAnyTags(e){return e.replace(i,"")}}}{const e=self.C3;e.WordWrap=class{constructor(){this._lines=[]}GetLines(){return this._lines}GetLineCount(){return this._lines.length}_MeasureLine(e,t){let s=0,i=0,r=0,n=0,a=0;for(const o of e)-1===o.width&&(e=t(o.text,o.styles),o.width=e.width,o.height=e.height,o.fontBoundingBoxAscent=e.fontBoundingBoxAscent||0,o.fontBoundingBoxDescent=e.fontBoundingBoxDescent||0,o.topToAlphabeticDistance=e.topToAlphabeticDistance||0),s+=o.width,i=Math.max(i,o.height),r=Math.max(r,o.fontBoundingBoxAscent),n=Math.max(n,o.fontBoundingBoxDescent),a=Math.max(a,o.topToAlphabeticDistance);return{width:s,height:i,fontBoundingBoxAscent:r,fontBoundingBoxDescent:n,topToAlphabeticDistance:a}}_AddLine(e,t,s,i,r,n){this._lines.push({fragments:e,width:t,height:s,fontBoundingBoxAscent:i,fontBoundingBoxDescent:r,topToAlphabeticDistance:n})}WordWrap(t,s,i,r,n){if("string"==typeof t&&(t=[{text:t,styles:[]}]),e.clearArray(this._lines),!(!t.length||1===t.length&&!t[0].text.length||2>i)){if(1===t.length){var a=t[0];const e=a.text;if(a=a.styles,100>=e.length&&!e.includes("\n")){let{width:t,height:r,fontBoundingBoxAscent:o,fontBoundingBoxDescent:h,topToAlphabeticDistance:l}=s(e,a);if(t+=n,o=o||0,h=h||0,l=l||0,t<=i)return void this._AddLine([{text:e,styles:a,width:t,height:r,fontBoundingBoxAscent:o,fontBoundingBoxDescent:h,topToAlphabeticDistance:l}],t,r,o,h,l)}}if("word"===r)r=this._TokeniseWords(t);else{r=[];for(const s of t)e.appendArray(r,[...s.text].map(e=>[{text:e,styles:s.styles}]))}this._WrapText(r,s,i,n)}}_TokeniseWords(t){const s=[];let i=[],r=!1;for(const a of t){var n=a.text;t=a.styles;for(const a of n)"\n"===a?(0<i.length&&s.push(i),s.push([{text:"\n",styles:t}]),i=[]):0===i.length?(i.push({text:a,styles:t}),r=e.IsWhitespaceChar(a)):(n=e.IsWhitespaceChar(a),n===r?(n=i.at(-1),n.styles===t?n.text+=a:i.push({text:a,styles:t})):(s.push(i),i=[],i.push({text:a,styles:t}),r=n))}return 0<i.length&&s.push(i),s}_CopyLine(e){return e.map(e=>({text:e.text,styles:e.styles,width:e.width,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent,topToAlphabeticDistance:e.topToAlphabeticDistance}))}_AddWordToLine(e,t){var s=e.length?e.at(-1):null;let i=0;for(s&&t[0].styles===s.styles&&(s.text+=t[0].text,s.width=-1,s.height=-1,s.fontBoundingBoxAscent=-1,s.fontBoundingBoxDescent=-1,s.topToAlphabeticDistance=-1,i=1),s=t.length;i<s;++i){const s=t[i];e.push({text:s.text,styles:s.styles,width:-1,height:-1,fontBoundingBoxAscent:-1,fontBoundingBoxDescent:-1,topToAlphabeticDistance:-1})}}_WrapText(t,s,i,r){let n=[],a=0,o=0,h=0,l=0;var c=0;for(const r of t){if(1===r.length&&"\n"===r[0].text){0===o&&(c=s(" ",r[0].styles),o=c.height,h=c.fontBoundingBoxAscent||0,l=c.fontBoundingBoxDescent||0,c=c.topToAlphabeticDistance||0),this._AddLine(n,a,o,h,l,c),n=[],c=l=h=o=a=0;continue}t=this._CopyLine(n),this._AddWordToLine(t,r);const u=this._MeasureLine(t,s),_=u.width;_>=i?(0<n.length&&this._AddLine(n,a,o,h,l,c),n=[],e.IsStringAllWhitespace(r[0].text)?c=l=h=o=a=0:(this._AddWordToLine(n,r),c=this._MeasureLine(n,s),a=c.width,o=c.height,h=c.fontBoundingBoxAscent,l=c.fontBoundingBoxDescent,c=c.topToAlphabeticDistance)):(n=t,a=_,o=u.height,h=u.fontBoundingBoxAscent,l=u.fontBoundingBoxDescent,c=u.topToAlphabeticDistance)}0<n.length&&this._AddLine(n,a,o,h,l,c),this._TrimLinesTrailingWhitespace(s,r)}_TrimLinesTrailingWhitespace(e,t){for(const i of this._lines){const r=i.fragments;if(!r.length)continue;let n=r.at(-1);var s=n.text;const a=s.trimEnd();if(a){if(a.length<s.length){s=e(a,n.styles).width;const t=n.width-s;n.width=s,n.text=a,i.width-=t}}else i.width-=n.width,r.pop();0!==t&&0<r.length&&(n=r.at(-1),n.width+=t,i.width+=t)}}Clear(){e.clearArray(this._lines)}GetMaxLineWidth(){return this._lines.reduce((e,t)=>Math.max(e,t.width),0)}GetTotalLineHeight(){return this._lines.reduce((e,t)=>e+t.height,0)}}}{const e=self.C3,t=self.glMatrix,s=t.vec3,i=t.vec4,r=t.mat4,n=s.create(),a=s.create(),o=s.create(),h=i.create(),l=r.create(),c=s.create(),u=s.create(),_=s.create(),d=s.create(),p=s.create(),g=s.create(),m=s.create(),f=s.create(),S=i.fromValues(0,0,1,1);function D(e,t,i,r){s.subtract(n,i,t),s.subtract(a,e,t),s.cross(o,n,a),s.normalize(o,o),r.set(o[0],o[1],o[2],s.dot(e,o))}function A(e,t,s,i,r,n,a){const o=a.x,h=a.y,l=a.z,c=a.w,u=a.xF,_=a.yF;a=a.zF;const d=1-u,p=1-_,g=1-a;return o*e*u+o*i*d+h*t*_+h*r*p+l*s*a+l*n*g>=c||o*i*u+o*e*d+h*r*_+h*t*p+l*n*a+l*s*g>c}function E(e,t,s,i){return i.x*e+i.y*t+i.z*s>=i.w}e.Gfx={Project(e,t,s,i,r,n,a){const o=i[0]*e+i[4]*t+i[8]*s+i[12],h=i[1]*e+i[5]*t+i[9]*s+i[13],l=i[2]*e+i[6]*t+i[10]*s+i[14];return i=i[3]*e+i[7]*t+i[11]*s+i[15],e=r[0]*o+r[4]*h+r[8]*l+r[12]*i,t=r[1]*o+r[5]*h+r[9]*l+r[13]*i,s=r[2]*o+r[6]*h+r[10]*l+r[14]*i,r=r[3]*o+r[7]*h+r[11]*l+r[15]*i,0!==r&&(r=1/r,a[0]=(e*r*.5+.5)*n[2]+n[0],a[1]=(t*r*.5+.5)*n[3]+n[1],a[2]=.5*(1+s*r),!0)},Unproject:(e,t,s,n,a,o,c)=>(r.multiply(l,a,n),null!==r.invert(l,l)&&(h[0]=(e-o[0])/o[2]*2-1,h[1]=(t-o[1])/o[3]*2-1,h[2]=2*s-1,h[3]=1,i.transformMat4(h,h,l),0!==h[3]&&(h[3]=1/h[3],c[0]=h[0]*h[3],c[1]=h[1]*h[3],c[2]=h[2]*h[3],!0))),UnprojectScreenToWorldZ(t,i,r,h,l,c,u){if(!e.Gfx.Unproject(t,i,0,h,l,c,n)||!e.Gfx.Unproject(t,i,1,h,l,c,a))return!1;if(s.subtract(a,a,n),s.set(o,0,0,1),t=-r,i=s.dot(o,a),r=0,0===i){if(0!==s.dot(o,n)+t)return!1}else if(r=-(s.dot(n,o)+t)/i,0>r)return!1;return s.scaleAndAdd(u,n,a,r),!0}};class y{constructor(){this.zF=this.yF=this.xF=this.w=this.z=this.y=this.x=NaN}set(e,t,s,i){this.x=e,this.y=t,this.z=s,this.w=i,this.xF=0<e?1:0,this.yF=0<t?1:0,this.zF=0<s?1:0}}e.Gfx.ViewFrustum=class{constructor(){this._leftP=new y,this._topP=new y,this._rightP=new y,this._bottomP=new y,this._nearP=new y,this._farP=new y}CalculatePlanes(t,s){e.Gfx.Unproject(0,1,0,t,s,S,c),e.Gfx.Unproject(1,1,0,t,s,S,u),e.Gfx.Unproject(0,0,0,t,s,S,_),e.Gfx.Unproject(1,0,0,t,s,S,d),e.Gfx.Unproject(0,1,1,t,s,S,p),e.Gfx.Unproject(1,1,1,t,s,S,g),e.Gfx.Unproject(0,0,1,t,s,S,m),e.Gfx.Unproject(1,0,1,t,s,S,f),D(_,c,p,this._leftP),D(c,u,g,this._topP),D(u,d,f,this._rightP),D(d,_,m,this._bottomP),D(m,p,g,this._farP),D(d,u,c,this._nearP)}ContainsAABB(e,t,s,i,r,n){return A(e,t,s,i,r,n,this._leftP)&&A(e,t,s,i,r,n,this._topP)&&A(e,t,s,i,r,n,this._rightP)&&A(e,t,s,i,r,n,this._bottomP)&&A(e,t,s,i,r,n,this._nearP)&&A(e,t,s,i,r,n,this._farP)}IsBehindNearPlane(e,t,s){return!E(e,t,s,this._nearP)}}}{const e=self.C3,t=self.glMatrix,s=t.vec3,i=t.vec4,r=t.mat4,n=r.create(),a=s.fromValues(0,0,0),o=s.fromValues(0,0,0),h=s.fromValues(0,0,0),l=s.fromValues(0,1,0);i.fromValues(0,0,0,0);const c=new e.Quad,u=new e.Rect,_=new e.Quad(0,0,1,0,1,1,0,1);e.Gfx.RendererBase=class{constructor(){this._height=this._width=0,this._fovY=e.toRadians(45),this._tan_fovY_2=Math.tan(this._fovY/2),this._matP=r.create(),this._matMV=r.create(),this._allShaderPrograms=[],this._shaderProgramsByName=new Map,this._spSmoothLineFill=this._spSmoothEllipseOutline=this._spSmoothEllipseFill=this._spHardEllipseOutline=this._spHardEllipseFill=this._spLinearGradientFill=this._spColorFill=this._spTilemapFill=this._spPoints=this._spTextureFill=null,this._stateGroups=new Map,this._currentStateGroup=null,this._blendModeTable=[],this._namedBlendModeMap=new Map,this._currentZ=this._baseZ=0,this._lineWidth=1,this._lineWidthStack=[this._lineWidth],this._lineCap=1,this._lineCapStack=[this._lineCap],this._lineOffset=.5,this._lineOffsetStack=[this._lineOffset],this._frameNumber=0,this._enableMipmaps=!0,this._hasMajorPerformanceCaveat=!1}FillIndexBufferData(e){let t=0,s=e.length,i=0;for(;t<s;)e[t++]=i,e[t++]=i+1,e[t++]=i+2,e[t++]=i,e[t++]=i+2,e[t++]=i+3,i+=4}_ClearState(){this._currentZ=this._baseZ=0,this._spSmoothLineFill=this._spSmoothEllipseOutline=this._spSmoothEllipseFill=this._spHardEllipseOutline=this._spHardEllipseFill=this._spLinearGradientFill=this._spColorFill=this._spTilemapFill=this._spPoints=this._spTextureFill=null,this._ClearAllShaderPrograms()}InitState(){this._ClearState(),this._currentStateGroup=null}OnDeviceOrContextLost(){for(const e of this._allShaderPrograms)e.Release();this._ClearState()}GetWidth(){return this._width}GetHeight(){return this._height}GetDefaultCameraZ(){return 100}GetNearZ(){return 1}GetFarZ(){return 1e4}GetFovY(){return this._fovY}_GetTanFovYDiv2(){return this._tan_fovY_2}CalculatePerspectiveMatrix(e,t,s=.5,i=.5){const n=this.GetNearZ(),a=this.GetFarZ();var o=this.GetFovY();if(.5===s&&.5===i)this.IsWebGPU()?r.perspectiveZO(e,o,t,n,a):r.perspective(e,o,t,n,a);else{s=1-s,o=2*s-2,s*=2;const h=2*i-2;i*=2;const l=this._GetTanFovYDiv2()*n;t*=l,r.frustum(e,o*t,s*t,h*l,i*l,n,a)}}CalculateOrthographicMatrix(e,t,s,i=1){var n=self.devicePixelRatio;const a=2*this.GetDefaultCameraZ()*n*this._GetTanFovYDiv2()/s;t=t*a/(2*n*i),s=s*a/(2*n*i),i=-t,n=-s,this.IsWebGPU()?r.orthoZO(e,i,t,n,s,this.GetNearZ(),this.GetFarZ()):r.ortho(e,i,t,n,s,this.GetNearZ(),this.GetFarZ())}CalculateLookAtModelView(e,t,i,n,c=this.GetHeight()){c=2*this.GetDefaultCameraZ()*self.devicePixelRatio*this._GetTanFovYDiv2()/c,s.set(h,c,-c,1),s.multiply(a,t,h),s.multiply(o,i,h),r.lookAt(e,a,o,n||l),r.scale(e,e,h)}CalculateLookAtModelView2(e,t,i,r,h,c,u){return s.set(a,e,t,i),s.set(o,r,h,c),this.CalculateLookAtModelView(n,a,o,l,u),n}_AddShaderProgram(e){this._allShaderPrograms.push(e),this._shaderProgramsByName.set(e.GetName(),e)}_RemoveShaderProgram(e){const t=this._allShaderPrograms.indexOf(e);-1!==t&&this._allShaderPrograms.splice(t,1),this._shaderProgramsByName.delete(e.GetName())}_ClearAllShaderPrograms(){e.clearArray(this._allShaderPrograms),this._shaderProgramsByName.clear()}GetShaderProgramByName(e){return this._shaderProgramsByName.get(e)||null}GetTextureFillShaderProgram(){return this._spTextureFill}SetTextureFillMode(){this.SetProgram(this._spTextureFill)}GetPointsRenderingProgram(){return this._spPoints}SetPointsRenderingProgram(){this.SetProgram(this._spPoints)}SetTilemapFillMode(){this.SetProgram(this._spTilemapFill)}SetColorFillMode(){this.SetProgram(this._spColorFill)}SetLinearGradientFillMode(){this.SetProgram(this._spLinearGradientFill)}SetHardEllipseFillMode(){this.SetProgram(this._spHardEllipseFill)}SetHardEllipseOutlineMode(){this.SetProgram(this._spHardEllipseOutline)}SetSmoothEllipseFillMode(){this.SetProgram(this._spSmoothEllipseFill)}SetSmoothEllipseOutlineMode(){this.SetProgram(this._spSmoothEllipseOutline)}SetSmoothLineFillMode(){this.SetProgram(this._spSmoothLineFill)}_SetCurrentStateGroup(e){this._currentStateGroup=e}GetCurrentStateGroup(){return this._currentStateGroup}AcquireStateGroup(t,s,i,r){const n=e.Gfx.StateGroup.MakeKey(t,s,i,r);let a=this._stateGroups.get(n);return a||(a=e.New(e.Gfx.StateGroup,this,t,s,i,r),this._stateGroups.set(n,a)),a.AddRef(),a}ReleaseStateGroup(e){e.DecRef(),0===e._GetRefCount()&&(this._currentStateGroup===e&&(this._currentStateGroup=null),this._stateGroups.delete(e.GetKey()),e.Release())}_InitBlendModeData(t){e.clearArray(this._blendModeTable),this._namedBlendModeMap.clear();let s=0;for(const e of t){t=e[0];const i=e[1],r=e[2];this._blendModeTable.push([i,r]),this._namedBlendModeMap.set(t,{number:s,srcBlend:i,destBlend:r}),s++}}_GetBlendByIndex(e){return this._blendModeTable[e]}GetSrcBlendByIndex(e){return this._GetBlendByIndex(e)[0]}GetDestBlendByIndex(e){return this._GetBlendByIndex(e)[1]}GetNamedBlend(e){if(e=this._namedBlendModeMap.get(e),void 0===e)throw Error("invalid blend name");return e}NamedBlendToNumber(e){if(e=this._namedBlendModeMap.get(e),void 0===e)throw Error("invalid blend name");return e.number}SetBaseZ(e){this._baseZ=e}GetBaseZ(){return this._baseZ}SetCurrentZ(e){this._currentZ=e,this._currentStateGroup=null}GetCurrentZ(){return this._currentZ}Line(t,s,i,r){var n=e.angleTo(t,s,i,r),a=.5*this._lineWidth;const o=Math.sin(n)*a;n=Math.cos(n)*a,a=this._lineCap,2===a?this.LinePreCalc_LineCap2(t,s,0,i,r,0,o,n):1===a?this.LinePreCalc_LineCap1(t,s,0,i,r,0,o,n):this.LinePreCalc_LineCap0(t,s,0,i,r,0,o,n)}Line3D(t,s,i,r,n,a){var o=e.angleTo(t,s,r,n),h=.5*this._lineWidth;const l=Math.sin(o)*h;o=Math.cos(o)*h,h=this._lineCap,2===h?this.LinePreCalc_LineCap2(t,s,i,r,n,a,l,o):1===h?this.LinePreCalc_LineCap1(t,s,i,r,n,a,l,o):this.LinePreCalc_LineCap0(t,s,i,r,n,a,l,o)}LinePreCalc_LineCap2(e,t,s,i,r,n,a,o){var h=this._lineOffset;e=e+h-o,t=t+h-a,i=i+h+o,r=r+h+a,h=2*o;const l=2*a;this.Quad3D2(e+a,t-o,s,i+a,r-o,n,i-a-h,r+o-l,n,e-a+h,t+o+l,s,_)}LinePreCalc_LineCap1(e,t,s,i,r,n,a,o){const h=this._lineOffset;e=e+h-o,t=t+h-a,i=i+h+o,r=r+h+a,this.Quad3D2(e+a,t-o,s,i+a,r-o,n,i-a,r+o,n,e-a,t+o,s,_)}LinePreCalc_LineCap0(e,t,s,i,r,n,a,o){const h=this._lineOffset;e+=h,t+=h,i+=h,r+=h,this.Quad3D2(e+a,t-o,s,i+a,r-o,n,i-a,r+o,n,e-a,t+o,s,_)}TexturedLine(t,s,i,r,n,a){var o=e.angleTo(t,s,i,r),h=.5*this._lineWidth;const l=Math.sin(o)*h;o=Math.cos(o)*h,h=this._lineCap,2===h?this.TexturedLinePreCalc_LineCap2(t,s,i,r,l,o,n,a):1===h?this.TexturedLinePreCalc_LineCap1(t,s,i,r,l,o,n,a):this.TexturedLinePreCalc_LineCap0(t,s,i,r,l,o,n,a)}TexturedLinePreCalc_LineCap2(e,t,s,i,r,n,a,o){var h=this._lineOffset;e=e+h-n,t=t+h-r,s=s+h+n,i=i+h+r,h=2*n;const l=2*r;c.set(e+r,t-n,s+r,i-n,s-r-h,i+n-l,e-r+h,t+n+l),u.set(a,0,o,0),this.Quad3(c,u)}TexturedLinePreCalc_LineCap1(e,t,s,i,r,n,a,o){const h=this._lineOffset;e=e+h-n,t=t+h-r,s=s+h+n,i=i+h+r,c.set(e+r,t-n,s+r,i-n,s-r,i+n,e-r,t+n),u.set(a,0,o,0),this.Quad3(c,u)}TexturedLinePreCalc_LineCap0(e,t,s,i,r,n,a,o){const h=this._lineOffset;e+=h,t+=h,s+=h,i+=h,c.set(e+r,t-n,s+r,i-n,s-r,i+n,e-r,t+n),u.set(a,0,o,0),this.Quad3(c,u)}LineRect(e,t,s,i){const r=.5*this._lineWidth,n=this._lineCap;2===n?this._LineRectPreCalc_LineCap2(e,t,s,i,r):1===n?this._LineRectPreCalc_LineCap1(e,t,s,i,r):this._LineRectPreCalc_LineCap0(e,t,s,i,r)}_LineRectPreCalc_LineCap2(e,t,s,i,r){this.LinePreCalc_LineCap2(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap2(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap2(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap2(e,i,0,e,t,0,-r,0)}_LineRectPreCalc_LineCap1(e,t,s,i,r){this.LinePreCalc_LineCap1(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap1(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap1(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap1(e,i,0,e,t,0,-r,0)}_LineRectPreCalc_LineCap0(e,t,s,i,r){this.LinePreCalc_LineCap0(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap0(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap0(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap0(e,i,0,e,t,0,-r,0)}LineRect2(e){this.LineRect(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}LineQuad(t){var s=e.angleTo(t.getTlx(),t.getTly(),t.getTrx(),t.getTry()),i=.5*this._lineWidth;const r=Math.sin(s)*i;s=Math.cos(s)*i,i=this._lineCap,2===i?this._LineQuadPreCalc_LineCap2(t,r,s):1===i?this._LineQuadPreCalc_LineCap1(t,r,s):this._LineQuadPreCalc_LineCap0(t,r,s)}_LineQuadPreCalc_LineCap2(e,t,s){this.LinePreCalc_LineCap2(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap2(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap2(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap2(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}_LineQuadPreCalc_LineCap1(e,t,s){this.LinePreCalc_LineCap1(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap1(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap1(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap1(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}_LineQuadPreCalc_LineCap0(e,t,s){this.LinePreCalc_LineCap0(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap0(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap0(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap0(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}SetLineWidth(e){this._lineWidth=e,this._lineWidthStack[this._lineWidthStack.length-1]=e}GetLineWidth(){return this._lineWidth}PushLineWidth(e){if(100<=this._lineWidthStack.length)throw Error("pushed too many line widths - check push/pop pairs");this._lineWidthStack.push(e),this._lineWidth=e}PopLineWidth(){if(1>=this._lineWidthStack.length)throw Error("cannot pop last line width - check push/pop pairs");this._lineWidthStack.pop(),this._lineWidth=this._lineWidthStack.at(-1)}SetLineCapButt(){this._lineCap=0,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapSquare(){this._lineCap=1,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapZag(){this._lineCap=2,this._lineCapStack[this._lineCapStack.length-1]=0}PushLineCap(e){if("butt"===e)this.PushLineCapButt();else if("square"===e)this.PushLineCapSquare();else{if("zag"!==e)throw Error("invalid line cap");this.PushLineCapZag()}}PushLineCapButt(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(0),this._lineCap=0}PushLineCapSquare(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(1),this._lineCap=1}PushLineCapZag(){if(100<=this._lineCapStack.length)throw Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(2),this._lineCap=2}PopLineCap(){if(1>=this._lineCapStack.length)throw Error("cannot pop last line cap - check push/pop pairs");this._lineCapStack.pop(),this._lineCap=this._lineCapStack.at(-1)}SetLineOffset(e){this._lineOffset=e,this._lineOffsetStack[this._lineOffsetStack.length-1]=e}GetLineOffset(){return this._lineOffset}PushLineOffset(e){if(100<=this._lineOffsetStack.length)throw Error("pushed too many line offsets - check push/pop pairs");this._lineOffsetStack.push(e),this._lineOffset=e}PopLineOffset(){if(1>=this._lineOffsetStack.length)throw Error("cannot pop last line offset - check push/pop pairs");this._lineOffsetStack.pop(),this._lineOffset=this._lineOffsetStack.at(-1)}ConvexPoly(e){var t=e.length/2;if(3>t)throw Error("need at least 3 points");t-=2;const s=t-1,i=e[0],r=e[1];for(let n=0;n<t;n+=2){const t=2*n,a=e[t+2],o=e[t+3],h=e[t+4],l=e[t+5];n===s?this.Quad2(i,r,a,o,h,l,h,l):this.Quad2(i,r,a,o,h,l,e[t+6],e[t+7])}}GetNumVertexComponents(){return 3}Finish(){this.EndBatch(!0),this._frameNumber++}GetFrameNumber(){return this._frameNumber}IncrementFrameNumber(){this._frameNumber++}SetMipmapsEnabled(e){this._enableMipmaps=!!e}AreMipmapsEnabled(){return this._enableMipmaps}SetHasMajorPerformanceCaveat(e){this._hasMajorPerformanceCaveat=!!e}HasMajorPerformanceCaveat(){return this._hasMajorPerformanceCaveat}IsWebGL(){return!1}IsWebGPU(){return!1}}}self.C3.Gfx.ShaderProgramBase=class{constructor(e,t,s){this._name=t,this._renderer=e,this._extendBoxHorizontal=s.extendBoxHorizontal||0,this._extendBoxVertical=s.extendBoxVertical||0,this._crossSampling=!!s.crossSampling,this._mustPreDraw=!!s.mustPreDraw,this._preservesOpaqueness=!!s.preservesOpaqueness,this._animated=!!s.animated,this._blendsBackground=!!s.blendsBackground,this._usesDepth=!!s.usesDepth,this._usesAnySrcRectOrPixelSize=!1,this._needsPostDrawOrExtendBox=this._crossSampling||this._blendsBackground||0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}Release(){this._renderer=null}GetRenderer(){return this._renderer}GetName(){return this._name}ExtendsBox(){return 0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}GetBoxExtendHorizontal(){return this._extendBoxHorizontal}GetBoxExtendVertical(){return this._extendBoxVertical}UsesCrossSampling(){return this._crossSampling}MustPreDraw(){return this._mustPreDraw}PreservesOpaqueness(){return this._preservesOpaqueness}IsAnimated(){return this._animated}BlendsBackground(){return this._blendsBackground}UsesDepth(){return this._usesDepth}UsesAnySrcRectOrPixelSize(){return this._usesAnySrcRectOrPixelSize}NeedsPostDrawOrExtendsBox(){return this._needsPostDrawOrExtendBox}};{const e=self.C3;e.Gfx.StateGroup=class{constructor(t,s,i,r,n){this._renderer=t,this._refCount=0,this._shaderProgram=null,this._shaderProgramName="",this._blendMode=i,this._color=e.New(e.Color),this._color.set(r),this._zElevation=n,"string"==typeof s?this._shaderProgramName=s:(this._shaderProgram=s,this._shaderProgramName=this._shaderProgram.GetName())}Release(){if(0<this._refCount)throw Error("releasing state group still in use");this._shaderProgram=this._renderer=null,this._shaderProgramName=""}Apply(){const e=this._renderer;e.SetProgram(this._shaderProgram),e.SetBlendMode(this._blendMode),e.SetColor(this._color),e.SetCurrentZ(this._zElevation),e._SetCurrentStateGroup(this)}GetKey(){return e.Gfx.StateGroup.MakeKey(this._shaderProgramName,this._blendMode,this._color,this._zElevation)}AddRef(){++this._refCount}DecRef(){--this._refCount}_GetRefCount(){return this._refCount}OnContextLost(){this._shaderProgram=null}OnContextRestored(e){if(this._shaderProgram=e.GetShaderProgramByName(this._shaderProgramName),!this._shaderProgram)throw Error("failed to restore shader program")}static MakeKey(e,t,s,i){
return("string"==typeof e?e:e.GetName())+","+t+","+s.getR()+","+s.getG()+","+s.getB()+","+s.getA()+","+i}}}{const e=self.C3,t=e.New(e.Quad);function a(e,t,s){const i=s.getTlx(),r=s.getTly(),n=s.getTrx()-i,a=s.getTry()-r,o=s.getBlx()-i;return s=s.getBly()-r,[i+n*e+o*t,r+a*e+s*t]}e.Gfx.MeshPoint=class{constructor(e,t,s){this._mesh=e,this._col=t,this._row=s,this._v=this._u=this._zElevation=this._y=this._x=0}_Init(e,t,s,i){this._x=e,this._y=t,this._u=s,this._v=i}GetX(){return this._x}SetX(e){this._x!==e&&(this._x=e,this._mesh._SetPointsChanged())}GetY(){return this._y}SetY(e){this._y!==e&&(this._y=e,this._mesh._SetPointsChanged())}GetZElevation(){return this._zElevation}SetZElevation(e){this._zElevation!==e&&(this._zElevation=Math.max(e,0),this._mesh._SetPointsChanged())}GetU(){return this._u}SetU(e){this._u=e}GetV(){return this._v}SetV(e){this._v=e}_Interpolate_TexRect(t,s,i){[this._x,this._y]=a(t._x,t._y,s),this._zElevation=t._zElevation,this._u=e.lerp(i.getLeft(),i.getRight(),t._u),this._v=e.lerp(i.getTop(),i.getBottom(),t._v)}_Interpolate_TexQuad(e,t,s){[this._x,this._y]=a(e._x,e._y,t),this._zElevation=e._zElevation,[this._u,this._v]=a(e._u,e._v,s)}SaveToJson(){return{x:this.GetX(),y:this.GetY(),z:this.GetZElevation(),u:this.GetU(),v:this.GetV()}}LoadFromJson(e){this.SetX(e.x),this.SetY(e.y),e.hasOwnProperty("z")&&this.SetZElevation(e.z),this.SetU(e.u),this.SetV(e.v)}GetMesh(){return this._mesh}GetColumn(){return this._col}GetRow(){return this._row}},e.Gfx.Mesh=class{constructor(t,s,i){if(2>t||2>s)throw Error("invalid mesh size");this._hsize=t,this._vsize=s,this._owner=i||null,this._pts=[],this._minY=this._minX=0,this._maxY=this._maxX=1,this._maxZ=0,this._pointsChanged=!1,i=t-1;const r=s-1;for(let n=0;n<s;++n){const s=[];for(let a=0;a<t;++a){const t=e.New(e.Gfx.MeshPoint,this,a,n),o=a/i,h=n/r;t._Init(o,h,o,h),s.push(t)}this._pts.push(s)}}Release(){e.clearArray(this._pts)}GetHSize(){return this._hsize}GetVSize(){return this._vsize}GetOwner(){return this._owner}_GetPoints(){return this._pts}_SetPointsChanged(){this._pointsChanged=!0}_MaybeComputeBounds(){if(this._pointsChanged){var e=1/0,t=1/0,s=-1/0,i=-1/0,r=0;for(const n of this._pts)for(const a of n){const n=a.GetX(),o=a.GetY();e=Math.min(e,n),t=Math.min(t,o),s=Math.max(s,n),i=Math.max(i,o),r=Math.max(r,a.GetZElevation())}this._minX=e,this._minY=t,this._maxX=s,this._maxY=i,this._maxZ=r,this._pointsChanged=!1}}GetMinX(){return this._MaybeComputeBounds(),this._minX}GetMinY(){return this._MaybeComputeBounds(),this._minY}GetMaxX(){return this._MaybeComputeBounds(),this._maxX}GetMaxY(){return this._MaybeComputeBounds(),this._maxY}GetMaxZ(){return this._MaybeComputeBounds(),this._maxZ}HasAnyZElevation(){return 0<this.GetMaxZ()}GetMeshPointAt(e,t){return e=Math.floor(e),t=Math.floor(t),0>e||e>=this._hsize||0>t||t>=this._vsize?null:this._pts[t][e]}CalculateTransformedMesh(t,s,i){const r=i instanceof e.Rect;if(t.GetHSize()!==this.GetHSize()||t.GetVSize()!==this.GetVSize())throw Error("source mesh wrong size");t=t._pts;const n=this._pts;for(let e=0,a=n.length;e<a;++e){const a=t[e],o=n[e];for(let e=0,t=o.length;e<t;++e){const t=a[e],n=o[e];r?n._Interpolate_TexRect(t,s,i):n._Interpolate_TexQuad(t,s,i)}}}Draw(e){const s=this._pts;let i=s[0];for(let r=1,n=s.length;r<n;++r){const n=s[r];let a=i[0],o=n[0];for(let s=1,r=n.length;s<r;++s){const r=i[s],h=n[s];t.set(a.GetU(),a.GetV(),r.GetU(),r.GetV(),h.GetU(),h.GetV(),o.GetU(),o.GetV()),e.Quad3D2(a.GetX(),a.GetY(),a.GetZElevation(),r.GetX(),r.GetY(),r.GetZElevation(),h.GetX(),h.GetY(),h.GetZElevation(),o.GetX(),o.GetY(),o.GetZElevation(),t),a=r,o=h}i=n}}Outline(e,t){t||(t=((e,t,s)=>[e,t,s]));const s=this._pts;let i=s[0];for(let r=1,n=s.length;r<n;++r){const a=s[r];let o=i[0],h=a[0];for(let s=1,l=a.length;s<l;++s){const c=i[s],u=a[s],[_,d,p]=t(o.GetX(),o.GetY(),o.GetZElevation()),[g,m,f]=t(c.GetX(),c.GetY(),c.GetZElevation()),[S,y,G]=t(u.GetX(),u.GetY(),u.GetZElevation()),[T,I,b]=t(h.GetX(),h.GetY(),h.GetZElevation());e.Line3D(_,d,p,g,m,f),e.Line3D(_,d,p,S,y,G),e.Line3D(_,d,p,T,I,b),s===l-1&&e.Line3D(g,m,f,S,y,G),r===n-1&&e.Line3D(T,I,b,S,y,G),o=c,h=u}i=a}}InsertPolyMeshVertices(t){t=t.pointsArr();const s=[],i=this.GetHSize()-1,r=this.GetVSize()-1,n=1/i,a=1/r,o=i-1,h=r-1;let l=t[0],c=t[1],u=e.clamp(Math.floor(l*i),0,o),_=e.clamp(Math.floor(c*r),0,h),d=0,p=0,g=0;var m=-1;const f=()=>{l=e.clamp(e.lerp(l,d,g),0,1),c=e.clamp(e.lerp(c,p,g),0,1),s.push(l,c)};for(let S=0,y=t.length;S<y;S+=2)for(l=t[S],c=t[S+1],s.push(l,c),u=e.clamp(Math.floor(l*i),0,o),_=e.clamp(Math.floor(c*r),0,h),m=(S+2)%y,d=t[m],p=t[m+1],m=-1;;){if(1e6<s.length)throw Error("Too many mesh poly points");const t=u*n,i=_*a,r=(u+1)*n,S=(_+1)*a;if(e.isPointInTriangleInclusive(l,c,t,i,r,i,r,S),0!==m&&(g=e.rayIntersectExtended(l,c,d,p,t,i,r,S,-.001),0<=g&&.99999999>=g))f(),m=0;else if(0<_&&2!==m&&(g=e.rayIntersectExtended(l,c,d,p,t,i,r,i,.001),0<=g&&.99999999>=g))f(),_--,m=4;else if(u<o&&3!==m&&(g=e.rayIntersectExtended(l,c,d,p,r,i,r,S,.001),0<=g&&.99999999>=g))f(),u++,m=1;else if(0<u&&1!==m&&(g=e.rayIntersectExtended(l,c,d,p,t,i,t,S,.001),0<=g&&.99999999>=g))f(),u--,m=3;else{if(!(_<h&&4!==m&&(g=e.rayIntersectExtended(l,c,d,p,t,S,r,S,.001),0<=g&&.99999999>=g)))break;f(),_++,m=2}}return e.New(e.CollisionPoly,s)}TransformCollisionPoly(e,t){e=this._TransformPolyPoints(e),this._SimplifyPoly(e),t.setPoints(e)}_TransformPolyPoints(e){const t=[];e=e.pointsArr();for(let s=0,i=e.length;s<i;s+=2){const[i,r]=this.TransformPoint(e[s],e[s+1]);t.push(i,r)}return t}TransformPoint(t,s){var i=this.GetHSize()-1,r=this.GetVSize()-1,n=1/i,a=1/r;i=e.clamp(Math.floor(t*i),0,i-1);const o=e.clamp(Math.floor(s*r),0,r-1);r=i*n;const h=o*a,l=(i+1)*n,c=(o+1)*a,u=this.GetMeshPointAt(i,o),_=this.GetMeshPointAt(i+1,o+1),d=e.isPointInTriangleInclusive(t,s,r,h,l,h,l,c);n=d?r+n:r,a=d?h:h+a,i=this.GetMeshPointAt(i+(d?1:0),o+(d?0:1));const[p,g,m]=e.triangleCartesianToBarycentric(t,s,r,h,n,a,l,c);return e.triangleBarycentricToCartesian(p,g,m,u.GetX(),u.GetY(),i.GetX(),i.GetY(),_.GetX(),_.GetY())}_SimplifyPoly(t){const s=[];let i=t[0],r=t[1],n=i-t.at(-2),a=r-t.at(-1);for(let e=0,h=t.length;e<h;e+=2){var o=(e+2)%h;const l=t[o];o=t[o+1];const c=l-i,u=o-r,_=1e-7>Math.abs(u)&&1e-7>Math.abs(a)&&Math.sign(c)===Math.sign(n);(!(1e-7>Math.abs(c)&&1e-7>Math.abs(n)&&Math.sign(u)===Math.sign(a)||_)&&1e-7<Math.abs(c/n-u/a)||0==c&&0===u)&&s.push(i,r),i=l,r=o,n=c,a=u}6<=s.length&&s.length<t.length&&e.shallowAssignArray(t,s)}SaveToJson(){return{cols:this.GetHSize(),rows:this.GetVSize(),points:this._pts.map(e=>e.map(e=>e.SaveToJson()))}}LoadFromJson(e){const t=this.GetHSize(),s=this.GetVSize();if(e.cols!==t||e.rows!==s)throw Error("mesh data wrong size");e=e.points;for(let i=0;i<s;++i){const s=e[i];for(let e=0;e<t;++e)this.GetMeshPointAt(e,i).LoadFromJson(s[e])}}}}{const e=self.C3,t=new Set(["rgba8","rgb8","rgba4","rgb5_a1","rgb565"]),s=new Set(["nearest","bilinear","trilinear"]),i=new Set(["default","low","high"]),r=new Set(["clamp-to-edge","repeat","mirror-repeat"]);function f(e,t){let s,i;switch(e){case"rgba8":e=t.RGBA8,i=s=t.RGBA,t=t.UNSIGNED_BYTE;break;case"rgb8":e=t.RGB8,i=s=t.RGB,t=t.UNSIGNED_BYTE;break;case"rgba4":e=t.RGBA4,i=s=t.RGBA,t=t.UNSIGNED_SHORT_4_4_4_4;break;case"rgb5_a1":e=t.RGB5_A1,i=s=t.RGBA,t=t.UNSIGNED_SHORT_5_5_5_1;break;case"rgb565":e=t.RGB565,i=s=t.RGB,t=t.UNSIGNED_SHORT_5_6_5;break;default:throw Error("invalid pixel format")}return{sizedinternalformat:e,internalformat:s,format:i,type:t}}const n={wrapX:"clamp-to-edge",wrapY:"clamp-to-edge",sampling:"trilinear",anisotropy:0,pixelFormat:"rgba8",mipMap:!0,mipMapQuality:"default",premultiplyAlpha:!0,isSvg:!1,width:-1,height:-1},a={premultiplyAlpha:!0,flipY:!1},o=new Set;e.Gfx.WebGLRendererTexture=class{constructor(e){this._renderer=e,this._texture=null,this._height=this._width=0,this._isStatic=!0,this._wrapY=this._wrapX="clamp-to-edge",this._sampling="trilinear",this._anisotropy=0,this._pixelFormat="rgba8",this._isMipMapped=!1,this._mipMapQuality="default",this._refCount=0}_CreateStatic(a,h){if(!("undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&a instanceof OffscreenCanvas||a instanceof ImageData||a instanceof ArrayBuffer)&&null!==a)throw Error("invalid texture source");if(h=Object.assign({},n,h),this._texture)throw Error("already created texture");if(this._wrapX=h.wrapX,this._wrapY=h.wrapY,this._sampling=h.sampling,this._anisotropy=h.anisotropy,this._pixelFormat=h.pixelFormat,this._isMipMapped=!!h.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=h.mipMapQuality,!r.has(this._wrapX)||!r.has(this._wrapY))throw Error("invalid wrap mode");if(!s.has(this._sampling))throw Error("invalid sampling");if(!t.has(this._pixelFormat))throw Error("invalid pixel format");if(!i.has(this._mipMapQuality))throw Error("invalid mipmap quality");if(this._isStatic=!0,a instanceof ArrayBuffer||null===a||h.isSvg){if(this._width=h.width,this._height=h.height,a instanceof ArrayBuffer&&a.byteLength!==this._width*this._height*4)throw Error("ArrayBuffer wrong size")}else this._width=a.width,this._height=a.height;if(0>=this._width||0>=this._height)throw Error("invalid texture data size");if(h.isSvg){var l=e.CreateCanvas(this._width,this._height);l.getContext("2d").drawImage(a,0,0,this._width,this._height),a=l}var c=e.isPOT(this._width)&&e.isPOT(this._height);if(l=this._renderer.GetMaxTextureSize(),this._width>l||this._height>l)throw Error("texture data exceeds maximum texture size");l=this._renderer.GetContext();var u=this._renderer.GetWebGLVersionNumber();if(this._texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this._texture),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h.premultiplyAlpha),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1),h=f(this._pixelFormat,l),this._renderer.SupportsNPOTTextures()||c||!this._IsTiled())2<=u?(l.texStorage2D(l.TEXTURE_2D,this._isMipMapped?Math.floor(Math.log2(Math.max(this._width,this._height))+1):1,h.sizedinternalformat,this._width,this._height),a instanceof ArrayBuffer?l.texSubImage2D(l.TEXTURE_2D,0,0,0,this._width,this._height,h.format,h.type,new Uint8Array(a)):null!==a&&l.texSubImage2D(l.TEXTURE_2D,0,0,0,h.format,h.type,a)):a instanceof ArrayBuffer?l.texImage2D(l.TEXTURE_2D,0,h.internalformat,this._width,this._height,0,h.format,h.type,new Uint8Array(a)):null===a?l.texImage2D(l.TEXTURE_2D,0,h.internalformat,this._width,this._height,0,h.format,h.type,null):l.texImage2D(l.TEXTURE_2D,0,h.internalformat,h.format,h.type,a);else{if(null===a)throw Error("cannot pass null data when creating a NPOT tiled texture without NPOT support");a instanceof ArrayBuffer&&(a=new ImageData(new Uint8ClampedArray(a),this._width,this._height)),a instanceof ImageData&&(c=e.CreateCanvas(this._width,this._height),c.getContext("2d").putImageData(a,0,0),a=c),c=e.CreateCanvas(e.nextHighestPowerOfTwo(this._width),e.nextHighestPowerOfTwo(this._height)),u=c.getContext("2d"),u.imageSmoothingEnabled="nearest"!==this._sampling,u.drawImage(a,0,0,this._width,this._height,0,0,c.width,c.height),l.texImage2D(l.TEXTURE_2D,0,h.internalformat,h.format,h.type,c)}null!==a&&this._SetTextureParameters(l),l.bindTexture(l.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,o.add(this)}_CreateDynamic(a,h,l){if(l=Object.assign({},n,l),this._texture)throw Error("already created texture");if(this._wrapX=l.wrapX,this._wrapY=l.wrapY,this._sampling=l.sampling,this._pixelFormat=l.pixelFormat,this._isMipMapped=!!l.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=l.mipMapQuality,!r.has(this._wrapX)||!r.has(this._wrapY))throw Error("invalid wrap mode");if(!s.has(this._sampling))throw Error("invalid sampling");if(!t.has(this._pixelFormat))throw Error("invalid pixel format");if(!i.has(this._mipMapQuality))throw Error("invalid mipmap quality");if(this._isStatic=!1,this._width=Math.floor(a),this._height=Math.floor(h),a=e.isPOT(this._width)&&e.isPOT(this._height),h=this._renderer.GetMaxTextureSize(),0>=this._width||0>=this._height)throw Error("invalid texture size");if(this._width>h||this._height>h)throw Error("texture exceeds maximum texture size");if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!a)throw Error("non-power-of-two tiled textures not supported");a=this._renderer.GetContext(),h=this._renderer.GetWebGLVersionNumber(),this._texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this._texture),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.premultiplyAlpha),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),l=f(this._pixelFormat,a),a.texImage2D(a.TEXTURE_2D,0,2<=h?l.sizedinternalformat:l.internalformat,this._width,this._height,0,l.format,l.type,null),this._SetTextureParameters(a),a.bindTexture(a.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,o.add(this)}_GetMipMapHint(e){if("default"===this._mipMapQuality)return this._isStatic?e.NICEST:e.FASTEST;if("low"===this._mipMapQuality)return e.FASTEST;if("high"===this._mipMapQuality)return e.NICEST;throw Error("invalid mipmap quality")}_IsTiled(){return"clamp-to-edge"!==this._wrapX||"clamp-to-edge"!==this._wrapY}_GetTextureWrapMode(e,t){if("clamp-to-edge"===t)return e.CLAMP_TO_EDGE;if("repeat"===t)return e.REPEAT;if("mirror-repeat"===t)return e.MIRRORED_REPEAT;throw Error("invalid wrap mode")}_SetTextureParameters(t){var s=e.isPOT(this._width)&&e.isPOT(this._height);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._GetTextureWrapMode(t,this._wrapX)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._GetTextureWrapMode(t,this._wrapY)),"nearest"===this._sampling?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),this._isMipMapped=!1):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),(s||this._renderer.SupportsNPOTTextures())&&this._isMipMapped?(t.hint(t.GENERATE_MIPMAP_HINT,this._GetMipMapHint(t)),t.generateMipmap(t.TEXTURE_2D),s="trilinear"===this._sampling&&!this._renderer.HasMajorPerformanceCaveat(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,s?t.LINEAR_MIPMAP_LINEAR:t.LINEAR_MIPMAP_NEAREST)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),this._isMipMapped=!1)),(s=this._renderer._GetAnisotropicExtension())&&0<this._anisotropy&&"nearest"!==this._sampling&&t.texParameterf(t.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this._anisotropy,this._renderer._GetMaxAnisotropy()))}_Update(t,s){if(!("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||t instanceof ImageData))throw Error("invalid texture source");if(!this._texture||0>=this._refCount)throw Error("texture not created");if(this._isStatic)throw Error("cannot update static texture");s=Object.assign({},a,s);const i=t.width||t.videoWidth,r=t.height||t.videoHeight;var n=this._renderer.GetWebGLVersionNumber();const o=this._renderer.GetContext();o.bindTexture(o.TEXTURE_2D,this._texture),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!!s.flipY),s=f(this._pixelFormat,o),n=2<=n?s.sizedinternalformat:s.internalformat;try{if(this._width===i&&this._height===r){const i=e.isPOT(this._width)&&e.isPOT(this._height);o.texSubImage2D(o.TEXTURE_2D,0,0,0,s.format,s.type,t),(i||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(o.hint(o.GENERATE_MIPMAP_HINT,this._GetMipMapHint(o)),o.generateMipmap(o.TEXTURE_2D))}else{this._width=i,this._height=r;const a=e.isPOT(this._width)&&e.isPOT(this._height);if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!a)throw Error("non-power-of-two tiled textures not supported");o.texImage2D(o.TEXTURE_2D,0,n,s.format,s.type,t),(a||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(o.hint(o.GENERATE_MIPMAP_HINT,this._GetMipMapHint(o)),o.generateMipmap(o.TEXTURE_2D))}}catch(e){console.error("Error updating WebGL texture: ",e)}o.bindTexture(o.TEXTURE_2D,null),this._renderer._ResetLastTexture()}_Delete(){if(0<this._refCount)throw Error("texture still has references");if(!this._texture)throw Error("already deleted texture");o.delete(this),this._renderer.GetContext().deleteTexture(this._texture),this._texture=null}IsValid(){return!!this._texture}_GetTexture(){return this._texture}GetRenderer(){return this._renderer}AddReference(){this._refCount++}SubtractReference(){if(0>=this._refCount)throw Error("no more references");this._refCount--}GetReferenceCount(){return this._refCount}GetWidth(){return this._width}GetHeight(){return this._height}IsStatic(){return this._isStatic}GetEstimatedMemoryUsage(){let e=this._width*this._height;switch(this._pixelFormat){case"rgba8":e*=4;break;case"rgb8":e*=3;break;case"rgba4":case"rgb5_a1":case"rgb565":e*=2}return this._isMipMapped&&(e+=Math.floor(e/3)),e}static OnContextLost(){o.clear()}static allTextures(){return o.values()}}}{const e=self.C3,t=self.glMatrix.mat4,s=new Set(["nearest","bilinear","trilinear"]),i={sampling:"trilinear",alpha:!0,depth:!1,isSampled:!0,isDefaultSize:!0,multisampling:0},r=new Set;e.Gfx.WebGLRenderTarget=class{constructor(e){this._renderer=e,this._renderBuffer=this._texture=this._frameBufferNoDepth=this._frameBuffer=null,this._height=this._width=0,this._isDefaultSize=!0,this._sampling="trilinear",this._alpha=!0,this._depth=!1,this._isSampled=!0,this._multisampling=0,this._projectionMatrix=t.create()}_Create(e,t,n){n=Object.assign({},i,n);const a=this._renderer.GetWebGLVersionNumber();if(this._texture||this._renderBuffer)throw Error("already created render target");if(this._sampling=n.sampling,this._alpha=!!n.alpha,this._depth=!!n.depth,this._isSampled=!!n.isSampled,this._isDefaultSize=!!n.isDefaultSize,this._multisampling=n.multisampling,!s.has(this._sampling))throw Error("invalid sampling");if(0<this._multisampling&&(2>a||this._isSampled))throw Error("invalid use of multisampling");if(2>a&&(this._isSampled=!0),this._width=e,this._height=t,0>=this._width||0>=this._height)throw Error("invalid render target size");this._CalculateProjection(),e=this._renderer.GetContext(),this._frameBuffer=e.createFramebuffer(),this._depth&&(this._frameBufferNoDepth=e.createFramebuffer()),this._isSampled?(this._texture=this._renderer.CreateDynamicTexture(this._width,this._height,{sampling:this._sampling,pixelFormat:this._alpha?"rgba8":"rgb8",mipMap:!1}),t=this._texture._GetTexture(),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))):(this._renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this._renderBuffer),t=this._alpha?e.RGBA8:e.RGB8,0<this._multisampling&&((n=e.getInternalformatParameter(e.RENDERBUFFER,t,e.SAMPLES))&&n[0]?(n=n[0],this._multisampling>n&&(this._multisampling=n)):this._multisampling=0),0===this._multisampling?e.renderbufferStorage(e.RENDERBUFFER,t,this._width,this._height):e.renderbufferStorageMultisample(e.RENDERBUFFER,this._multisampling,t,this._width,this._height),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,this._renderBuffer),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,this._renderBuffer)),e.bindRenderbuffer(e.RENDERBUFFER,null)),t=this._renderer._GetDepthBuffer(),this._depth&&t&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),this._renderer._CanSampleDepth()?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,t,0):e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)),e.bindFramebuffer(e.FRAMEBUFFER,null),r.add(this)}_Resize(e,t){this._width===e&&this._height===t||(this._width=e,this._height=t,this._CalculateProjection(),e=this._renderer.GetContext(),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),this._texture?this._texture._Update(new ImageData(this._width,this._height)):(e.bindRenderbuffer(e.RENDERBUFFER,this._renderBuffer),e.renderbufferStorage(e.RENDERBUFFER,this._alpha?e.RGBA8:e.RGB8,this._width,this._height),e.bindRenderbuffer(e.RENDERBUFFER,null)),t=this._renderer._GetDepthBuffer(),this._depth&&t&&(this._renderer._CanSampleDepth()?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,t,0):e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)),e.bindFramebuffer(e.FRAMEBUFFER,null))}_Delete(){if(!this._texture&&!this._renderBuffer)throw Error("already deleted render target");r.delete(this);var e=this._renderer.GetContext();this._texture?(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)),this._renderer.DeleteTexture(this._texture),this._texture=null):this._renderBuffer&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null)),e.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),e.bindFramebuffer(e.FRAMEBUFFER,null),2<=this._renderer.GetWebGLVersionNumber()&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)),e.deleteFramebuffer(this._frameBuffer),this._depth&&e.deleteFramebuffer(this._frameBufferNoDepth),e=this._renderer.GetBatchState(),e.currentFramebuffer=null,this._frameBuffer=e.currentFramebufferNoDepth=null}_CalculateProjection(){this._renderer.CalculatePerspectiveMatrix(this._projectionMatrix,this._width/this._height)}_GetFramebuffer(){return this._frameBuffer}_GetFramebufferNoDepth(){return this._frameBufferNoDepth}GetRenderer(){return this._renderer}GetTexture(){return this._texture}GetProjectionMatrix(){return this._projectionMatrix}IsLinearSampling(){return"nearest"!==this._sampling}HasAlpha(){return this._alpha}IsSampled(){return this._isSampled}HasDepthBuffer(){return this._depth}GetWidth(){return this._width}GetHeight(){return this._height}IsDefaultSize(){return this._isDefaultSize}GetMultisampling(){return this._multisampling}GetOptions(){const e={sampling:this._sampling,alpha:this._alpha,isSampled:this._isSampled};return this._isDefaultSize||(e.width=this._width,e.height=this._height),e}IsCompatibleWithOptions(e){return e=Object.assign({},i,e),!("nearest"!==e.sampling!==this.IsLinearSampling()||!!e.alpha!==this.HasAlpha()||!!e.depth!==this.HasDepthBuffer()||2<=this._renderer.GetWebGLVersionNumber()&&!!e.isSampled!==this.IsSampled())&&("number"==typeof e.width||"number"==typeof e.height?!this.IsDefaultSize()&&this.GetWidth()===e.width&&this.GetHeight()===e.height:this.IsDefaultSize())}_GetWebGLTexture(){return this._texture?this._texture._GetTexture():null}GetEstimatedMemoryUsage(){return this._texture?this._texture.GetEstimatedMemoryUsage():this._width*this._height*(this._alpha?4:3)}static async DebugReadPixelsToBlob(t,s){return t=await t.ReadBackRenderTargetToImageData(s,!0),await e.ImageDataToBlob(t)}static OnContextLost(){r.clear()}static allRenderTargets(){return r.values()}static ResizeAll(e,t){for(const s of r)s.IsDefaultSize()&&s._Resize(e,t)}}}{const e=self.C3,t=new Set("aPos aTex aPoints matP matMV samplerFront samplerBack samplerDepth destStart destEnd srcStart srcEnd srcOriginStart srcOriginEnd pixelSize seconds devicePixelRatio layerScale layerAngle layoutStart layoutEnd color color2_ pointTexStart pointTexEnd zElevation tileSize tileSpacing outlineThickness".split(" "));e.Gfx.WebGLShaderProgram=class extends e.Gfx.ShaderProgramBase{static async Compile(t,s,i,r){const n=t.GetContext(),a=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(a,s),n.compileShader(a),s=n.createShader(n.VERTEX_SHADER),n.shaderSource(s,i),n.compileShader(s);const o=n.createProgram();n.attachShader(o,a),n.attachShader(o,s),n.bindAttribLocation(o,0,"aPos"),n.bindAttribLocation(o,1,"aTex"),n.bindAttribLocation(o,2,"aPoints"),n.linkProgram(o);const h=t._GetParallelShaderCompileExtension();if(h?await t._WaitForObjectReady(()=>n.getProgramParameter(o,h.COMPLETION_STATUS_KHR)):await e.Wait(5),!n.getShaderParameter(a,n.COMPILE_STATUS))throw r=n.getShaderInfoLog(a),n.deleteShader(a),n.deleteShader(s),n.deleteProgram(o),Error("Error compiling fragment shader: "+r);if(!n.getShaderParameter(s,n.COMPILE_STATUS))throw r=n.getShaderInfoLog(s),n.deleteShader(a),n.deleteShader(s),n.deleteProgram(o),Error("Error compiling vertex shader: "+r);if(!n.getProgramParameter(o,n.LINK_STATUS))throw r=n.getProgramInfoLog(o),n.deleteShader(a),n.deleteShader(s),n.deleteProgram(o),Error("Error linking shader program: "+r);return(t=e.FilterUnprintableChars(n.getProgramInfoLog(o)||"").trim())&&!e.IsStringAllWhitespace(t)&&console.info(`[WebGL] Shader program '${r}' compilation log: `,t),n.deleteShader(a),n.deleteShader(s),o}static async Create(t,s,i,r){return i=await e.Gfx.WebGLShaderProgram.Compile(t,s.src,i,r),new e.Gfx.WebGLShaderProgram(t,i,s,r)}constructor(t,s,i,r){super(t,r,i);const n=t.GetContext();var a=t.GetBatchState();t.EndBatch(),n.useProgram(s),this._gl=n,this._shaderProgram=s,this._isDeviceTransform="<default-device-transform>"===r,r=n.getAttribLocation(s,"aPos");const o=n.getAttribLocation(s,"aTex");this._locAPoints=n.getAttribLocation(s,"aPoints"),-1!==r&&(n.bindBuffer(n.ARRAY_BUFFER,t._vertexBuffer),n.vertexAttribPointer(r,t.GetNumVertexComponents(),n.FLOAT,!1,0,0),n.enableVertexAttribArray(r)),-1!==o&&(n.bindBuffer(n.ARRAY_BUFFER,t._texcoordBuffer),n.vertexAttribPointer(o,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(o)),-1!==this._locAPoints&&(n.bindBuffer(n.ARRAY_BUFFER,t._pointBuffer),n.vertexAttribPointer(this._locAPoints,4,n.FLOAT,!1,0,0),n.enableVertexAttribArray(this._locAPoints)),n.bindBuffer(n.ARRAY_BUFFER,null),this._uMatP=new e.Gfx.WebGLShaderUniform(this,"matP","mat4"),this._uMatMV=new e.Gfx.WebGLShaderUniform(this,"matMV","mat4"),this._uColor=new e.Gfx.WebGLShaderUniform(this,"color","vec4"),this._uSamplerFront=new e.Gfx.WebGLShaderUniform(this,"samplerFront","sampler"),this._uPointTexStart=new e.Gfx.WebGLShaderUniform(this,"pointTexStart","vec2"),this._uPointTexEnd=new e.Gfx.WebGLShaderUniform(this,"pointTexEnd","vec2"),this._uZElevation=new e.Gfx.WebGLShaderUniform(this,"zElevation","float"),this._uTileSize=new e.Gfx.WebGLShaderUniform(this,"tileSize","vec2"),this._uTileSpacing=new e.Gfx.WebGLShaderUniform(this,"tileSpacing","vec2"),this._uColor2=new e.Gfx.WebGLShaderUniform(this,"color2_","vec4"),this._uOutlineThickness=new e.Gfx.WebGLShaderUniform(this,"outlineThickness","float"),this._uSamplerBack=new e.Gfx.WebGLShaderUniform(this,"samplerBack","sampler"),this._uSamplerDepth=new e.Gfx.WebGLShaderUniform(this,"samplerDepth","sampler"),this._uDestStart=new e.Gfx.WebGLShaderUniform(this,"destStart","vec2"),this._uDestEnd=new e.Gfx.WebGLShaderUniform(this,"destEnd","vec2"),this._uSrcStart=new e.Gfx.WebGLShaderUniform(this,"srcStart","vec2"),this._uSrcEnd=new e.Gfx.WebGLShaderUniform(this,"srcEnd","vec2"),this._uSrcOriginStart=new e.Gfx.WebGLShaderUniform(this,"srcOriginStart","vec2"),this._uSrcOriginEnd=new e.Gfx.WebGLShaderUniform(this,"srcOriginEnd","vec2"),this._uPixelSize=new e.Gfx.WebGLShaderUniform(this,"pixelSize","vec2"),this._uSeconds=new e.Gfx.WebGLShaderUniform(this,"seconds","float"),this._uDevicePixelRatio=new e.Gfx.WebGLShaderUniform(this,"devicePixelRatio","float"),this._uLayerScale=new e.Gfx.WebGLShaderUniform(this,"layerScale","float"),this._uLayerAngle=new e.Gfx.WebGLShaderUniform(this,"layerAngle","float"),this._uLayoutStart=new e.Gfx.WebGLShaderUniform(this,"layoutStart","vec2"),this._uLayoutEnd=new e.Gfx.WebGLShaderUniform(this,"layoutEnd","vec2"),this._hasAnyOptionalUniforms=!!(this._uPixelSize.IsUsed()||this._uSeconds.IsUsed()||this._uSamplerBack.IsUsed()||this._uDestStart.IsUsed()||this._uDestEnd.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed()||this._uDevicePixelRatio.IsUsed()||this._uLayerScale.IsUsed()||this._uLayerAngle.IsUsed()||this._uLayoutStart.IsUsed()||this._uLayoutEnd.IsUsed()),t=i.parameters||[],this._uCustomParameters=[],this._usesAnySrcRectOrPixelSize=this._uPixelSize.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed(),this._hasCurrentMatMV=this._hasCurrentMatP=!1,this._uColor.Init4f(1,1,1,1),this._uColor2.Init4f(1,1,1,1),this._uSamplerFront.Init1i(0),this._uSamplerBack.Init1i(1),this._uSamplerDepth.Init1i(2),this._uPointTexStart.Init2f(0,0),this._uPointTexEnd.Init2f(1,1),this._uZElevation.Init1f(0),this._uTileSize.Init2f(0,0),this._uTileSpacing.Init2f(0,0),this._uDestStart.Init2f(0,0),this._uDestEnd.Init2f(1,1),this._uSrcStart.Init2f(0,0),this._uSrcEnd.Init2f(0,0),this._uSrcOriginStart.Init2f(0,0),this._uSrcOriginEnd.Init2f(0,0),this._uPixelSize.Init2f(0,0),this._uDevicePixelRatio.Init1f(1),this._uLayerScale.Init1f(1),this._uLayerAngle.Init1f(0),this._uSeconds.Init1f(0),this._uLayoutStart.Init2f(0,0),this._uLayoutEnd.Init2f(0,0),this._uOutlineThickness.Init1f(1);for(const i of t)t=i[2],s=new e.Gfx.WebGLShaderUniform(this,i[0],t),"color"===t?s.Init3f(0,0,0):s.Init1f(0),this._uCustomParameters.push(s);this._isDeviceTransform?this._UpdateDeviceTransformUniforms(a.currentMatP):(this.UpdateMatP(a.currentMatP,!0),this.UpdateMatMV(a.currentMV,!0)),a=a.currentShader,n.useProgram(a?a._shaderProgram:null)}Release(){this._gl.deleteProgram(this._shaderProgram),this._shaderProgram=null,this._renderer._RemoveShaderProgram(this),this._gl=null,super.Release()}GetWebGLContext(){return this._gl}GetShaderProgram(){return this._shaderProgram}GetParameterCount(){return this._uCustomParameters.length}GetParameterType(e){return this._uCustomParameters[e].GetType()}AreCustomParametersAlreadySetInBatch(e){for(let t=0,s=e.length;t<s;++t)if(!this._uCustomParameters[t].IsSetToCustomInBatch(e[t]))return!1;return!0}SetCustomParametersInBatch(e){for(let t=0,s=e.length;t<s;++t)this._uCustomParameters[t].SetBatchValueCustom(e[t])}AreOptionalUniformsAlreadySetInBatch(e,t,s,i,r,n,a,o,h,l){return!(this._uSamplerBack.IsUsed()||this._uPixelSize.IsUsed()&&!this._uPixelSize.IsSetTo2InBatch(r,n)||this._uDestStart.IsUsed()&&!this._uDestStart.IsSetTo2InBatch(e.getLeft(),e.getTop())||this._uDestEnd.IsUsed()&&!this._uDestEnd.IsSetTo2InBatch(e.getRight(),e.getBottom())||this._uDevicePixelRatio.IsUsed()&&!this._uDevicePixelRatio.IsSetTo1InBatch(a)||this._uLayerScale.IsUsed()&&!this._uLayerScale.IsSetTo1InBatch(o)||this._uLayerAngle.IsUsed()&&!this._uLayerAngle.IsSetTo1InBatch(h)||this._uSrcStart.IsUsed()&&!this._uSrcStart.IsSetTo2InBatch(t.getLeft(),t.getTop())||this._uSrcEnd.IsUsed()&&!this._uSrcEnd.IsSetTo2InBatch(t.getRight(),t.getBottom())||this._uSrcOriginStart.IsUsed()&&!this._uSrcOriginStart.IsSetTo2InBatch(s.getLeft(),s.getTop())||this._uSrcOriginEnd.IsUsed()&&!this._uSrcOriginEnd.IsSetTo2InBatch(s.getRight(),s.getBottom())||this._uLayoutStart.IsUsed()&&!this._uLayoutStart.IsSetTo2InBatch(i.getLeft(),i.getTop())||this._uLayoutEnd.IsUsed()&&!this._uLayoutEnd.IsSetTo2InBatch(i.getTop(),i.getBottom())||this._uSeconds.IsUsed()&&!this._uSeconds.IsSetTo1InBatch(l))}SetOptionalUniformsInBatch(e,t,s,i,r,n,a,o,h,l){this._uSamplerBack.IsUsed()||(this._uPixelSize.IsUsed()&&this._uPixelSize.SetBatch2(r,n),this._uDestStart.IsUsed()&&this._uDestStart.SetBatch2(e.getLeft(),e.getTop()),
this._uDestEnd.IsUsed()&&this._uDestEnd.SetBatch2(e.getRight(),e.getBottom()),this._uDevicePixelRatio.IsUsed()&&this._uDevicePixelRatio.SetBatch1(a),this._uLayerScale.IsUsed()&&this._uLayerScale.SetBatch1(o),this._uLayerAngle.IsUsed()&&this._uLayerAngle.SetBatch1(h),this._uSrcStart.IsUsed()&&this._uSrcStart.SetBatch2(t.getLeft(),t.getTop()),this._uSrcEnd.IsUsed()&&this._uSrcEnd.SetBatch2(t.getRight(),t.getBottom()),this._uSrcOriginStart.IsUsed()&&this._uSrcOriginStart.SetBatch2(s.getLeft(),s.getTop()),this._uSrcOriginEnd.IsUsed()&&this._uSrcOriginEnd.SetBatch2(s.getRight(),s.getBottom()),this._uLayoutStart.IsUsed()&&this._uLayoutStart.SetBatch2(i.getLeft(),i.getTop()),this._uLayoutEnd.IsUsed()&&this._uLayoutEnd.SetBatch2(i.getTop(),i.getBottom()),this._uSeconds.IsUsed()&&this._uSeconds.SetBatch1(l))}UpdateMatP(e,t){this._hasCurrentMatP&&!t||this._isDeviceTransform||(this._uMatP.IsUsed()&&this._uMatP.UpdateMatrix4fv(e),this._hasCurrentMatP=!0)}SetMatPStale(){this._hasCurrentMatP=!1}UpdateMatMV(e,t){this._hasCurrentMatMV&&!t||this._isDeviceTransform||(this._uMatMV.IsUsed()&&this._uMatMV.UpdateMatrix4fv(e),this._hasCurrentMatMV=!0)}SetMatMVStale(){this._hasCurrentMatMV=!1}_UpdateDeviceTransformUniforms(e){if(!this._isDeviceTransform)throw Error("not device transform shader");this._uMatP.UpdateMatrix4fv(e),e=this._renderer;const t=e.GetWidth()/2,s=e.GetHeight()/2;e=e.CalculateLookAtModelView2(t,s,e.GetDefaultCameraZ()*self.devicePixelRatio,t,s,0),this._uMatMV.UpdateMatrix4fv(e)}UpdateColor(e){this._uColor.IsUsed()&&this._uColor.Update4f(e[0],e[1],e[2],e[3])}static GetReservedUniformNames(){return t}static GetDefaultVertexShaderSource(e){return e=e?"highmedp":"mediump",["#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nattribute highp vec3 aPos;",`attribute ${e} vec2 aTex;`,`varying ${e} vec2 vTex;`,"uniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos, 1.0);\n\tvTex = aTex;\n}"].join("\n")}static GetTextureFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex) * color;\n}"}static GetTilemapFragmentShaderSource(){return"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nvarying highmedp vec2 vTex;\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform highmedp vec2 srcStart;\nuniform highmedp vec2 pixelSize;\nuniform highmedp vec2 tileSize;\nuniform highmedp vec2 tileSpacing;\nvoid main(void) {\n\thighmedp vec2 tile = floor(vTex);\n\thighmedp vec2 tex = fract(vTex);\n\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);\n\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;\n\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;\n\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;\n}"}static GetPointVertexShaderSource(t){return e.Gfx.WebGLShaderProgram.GetPointVertexShaderSource_WebGL1()}static GetPointFragmentShaderSource(t){return e.Gfx.WebGLShaderProgram.GetPointFragmentShaderSource_WebGL1()}static GetPointVertexShaderSource_WebGL1(){return"attribute vec4 aPoints;\nvarying float pointOpacity;\nuniform float zElevation;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);\n\tgl_PointSize = aPoints.z;\n\tpointOpacity = aPoints.w;\n}"}static GetPointFragmentShaderSource_WebGL1(){return"uniform lowp sampler2D samplerFront;\nvarying lowp float pointOpacity;\nuniform mediump vec2 pointTexStart;\nuniform mediump vec2 pointTexEnd;\nuniform lowp vec4 color;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, mix(pointTexStart, pointTexEnd, gl_PointCoord)) * color * pointOpacity;\n}"}static GetColorFillFragmentShaderSource(){return"uniform lowp vec4 color;\nvoid main(void) {\n\tgl_FragColor = color;\n}"}static GetLinearGradientFillFragmentShaderSource(){return"precision lowp float;\nvarying mediump vec2 vTex;\nuniform vec4 color;\nuniform vec4 color2_;\nvec3 fromLinear(vec3 linearRGB)\n{\n\tbvec3 cutoff = lessThan(linearRGB, vec3(0.0031308));\n\tvec3 higher = vec3(1.055) * pow(abs(linearRGB), vec3(1.0/2.4)) - vec3(0.055);\n\tvec3 lower = linearRGB * vec3(12.92);\n\treturn mix(higher, lower, vec3(cutoff));\n}\nvec3 toLinear(vec3 sRGB)\n{\n\tbvec3 cutoff = lessThan(sRGB, vec3(0.04045));\n\tvec3 higher = pow(abs((sRGB + vec3(0.055))/vec3(1.055)), vec3(2.4));\n\tvec3 lower = sRGB/vec3(12.92);\n\treturn mix(higher, lower, vec3(cutoff));\n}\nvoid main(void) {\n\tvec3 linearGrad = mix(toLinear(color.rgb), toLinear(color2_.rgb), vTex.x);\n\tfloat a = mix(color.a, color2_.a, vTex.x);\n\tgl_FragColor = vec4(fromLinear(linearGrad) * a, a);\n}"}static GetSmoothLineFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nvoid main(void) {\n\tlowp float f = 1.0 - abs(vTex.y - 0.5) * 2.0;\n\tgl_FragColor = color * f;\n}"}static GetHardEllipseFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float f = step(diffSq.x + diffSq.y, 0.25);\n\tgl_FragColor = color * f;\n}"}static GetHardEllipseOutlineFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nuniform mediump float outlineThickness;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float distSq = diffSq.x + diffSq.y;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump float innerF = step(distSq, 0.25);\n\tmediump vec2 innerEdge = halfNorm - pixelSize * norm * outlineThickness;\n\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;\n\tmediump float outerF = step(innerEdgeSq.x + innerEdgeSq.y, distSq);\n\tgl_FragColor = color * innerF * outerF;\n}"}static GetSmoothEllipseFillFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump vec2 halfNormSq = halfNorm * halfNorm;\n\tmediump vec2 innerEdge = halfNorm - pixelSize * norm;\n\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;\n\tmediump float f = smoothstep(halfNormSq.x + halfNormSq.y, innerEdgeSq.x + innerEdgeSq.y, diffSq.x + diffSq.y);\n\tgl_FragColor = color * f;\n}"}static GetSmoothEllipseOutlineFragmentShaderSource(){return"varying mediump vec2 vTex;\nuniform lowp vec4 color;\nuniform mediump vec2 pixelSize;\nuniform mediump float outlineThickness;\nvoid main(void) {\n\tmediump vec2 diff = vTex - vec2(0.5, 0.5);\n\tmediump vec2 diffSq = diff * diff;\n\tmediump float distSq = diffSq.x + diffSq.y;\n\tmediump vec2 norm = normalize(diff);\n\tmediump vec2 halfNorm = norm * 0.5;\n\tmediump vec2 halfNormSq = halfNorm * halfNorm;\n\tmediump vec2 pxNorm = pixelSize * norm;\n\tmediump vec2 innerEdge1 = halfNorm - pxNorm;\n\tmediump vec2 innerEdge1Sq = innerEdge1 * innerEdge1;\n\tmediump float innerF = smoothstep(halfNormSq.x + halfNormSq.y, innerEdge1Sq.x + innerEdge1Sq.y, distSq);\n\tmediump vec2 innerEdge2 = halfNorm - pxNorm * outlineThickness;\n\tmediump vec2 innerEdge2Sq = innerEdge2 * innerEdge2;\n\tmediump vec2 innerEdge3 = halfNorm - pxNorm * (outlineThickness + 1.0);\n\tmediump vec2 innerEdge3Sq = innerEdge3 * innerEdge3;\n\tmediump float outerF = smoothstep(innerEdge3Sq.x + innerEdge3Sq.y, innerEdge2Sq.x + innerEdge2Sq.y, distSq);\n\tgl_FragColor = color * innerF * outerF;\n}"}}}{const e=self.C3,t=self.glMatrix.mat4,s=new Map([["float",1],["percent",1],["sampler",1],["vec2",2],["vec3",3],["color",3],["vec4",4],["mat4",16]]);e.Gfx.WebGLShaderUniform=class{constructor(e,t,i){if(!s.has(i))throw Error("invalid uniform type");this._owner=e,this._gl=this._owner.GetWebGLContext(),this._name=t,this._type=i,this._isColorType="color"===this._type,this._location=this._gl.getUniformLocation(this._owner.GetShaderProgram(),t),this._isUsed=!!this._location,e=s.get(i),this._lastValue=new Float32Array(e),this._lastBatchValue=new Float32Array(e)}Release(){this._location=this._gl=this._owner=null}IsUsed(){return this._isUsed}GetType(){return this._type}IsColorType(){return this._isColorType}Init1f(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1f(this._location,e))}Init1i(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1i(this._location,e))}Init2f(e,t){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastBatchValue.set(this._lastValue),this._gl.uniform2f(this._location,e,t))}Init3f(e,t,s){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=s,this._lastBatchValue.set(this._lastValue),this._gl.uniform3f(this._location,e,t,s))}Init4f(e,t,s,i){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=s,this._lastValue[3]=i,this._lastBatchValue.set(this._lastValue),this._gl.uniform4f(this._location,e,t,s,i))}Update1f(e){e=Math.fround(e);const t=this._lastValue;t[0]!==e&&(t[0]=e,this._gl.uniform1f(this._location,e))}Update1i(e){const t=this._lastValue;t[0]!==e&&(t[0]=e,this._gl.uniform1i(this._location,e))}Update2f(e,t){e=Math.fround(e),t=Math.fround(t);const s=this._lastValue;s[0]===e&&s[1]===t||(s[0]=e,s[1]=t,this._gl.uniform2f(this._location,e,t))}Update3f(e,t,s){e=Math.fround(e),t=Math.fround(t),s=Math.fround(s);const i=this._lastValue;i[0]===e&&i[1]===t&&i[2]===s||(i[0]=e,i[1]=t,i[2]=s,this._gl.uniform3f(this._location,e,t,s))}Update4f(e,t,s,i){e=Math.fround(e),t=Math.fround(t),s=Math.fround(s),i=Math.fround(i);const r=this._lastValue;r[0]===e&&r[1]===t&&r[2]===s&&r[3]===i||(r[0]=e,r[1]=t,r[2]=s,r[3]=i,this._gl.uniform4f(this._location,e,t,s,i))}UpdateMatrix4fv(s){const i=this._lastValue;t.exactEquals(i,s)||(e.typedArraySet16(i,s,0),this._gl.uniformMatrix4fv(this._location,!1,s))}IsSetToCustomInBatch(e){const t=this._lastBatchValue;return this.IsColorType()?t[0]===Math.fround(e.getR())&&t[1]===Math.fround(e.getG())&&t[2]===Math.fround(e.getB()):t[0]===Math.fround(e)}SetBatchValueCustom(e){const t=this._lastBatchValue;this.IsColorType()?(t[0]=e.getR(),t[1]=e.getG(),t[2]=e.getB()):t[0]=e}IsSetTo1InBatch(e){return this._lastBatchValue[0]===Math.fround(e)}IsSetTo2InBatch(e,t){const s=this._lastBatchValue;return s[0]===Math.fround(e)&&s[1]===Math.fround(t)}SetBatch1(e){this._lastBatchValue[0]=e}SetBatch2(e,t){const s=this._lastBatchValue;s[0]=e,s[1]=t}}}{const e=self.C3,t=self.glMatrix,s=t.vec4,i=t.mat4;e.Gfx.BatchState=class{constructor(t){this.renderer=t,this.currentMV=i.create(),this.currentMatP=i.create(),this.currentFramebufferNoDepth=this.currentFramebuffer=null,this.isDepthSamplingEnabled=!1,this.currentColor=s.fromValues(1,1,1,1),this.currentShader=null,this.pointTexCoords=new e.Rect,this.clearColor=e.New(e.Color,0,0,0,0)}},e.Gfx.WebGLBatchJob=class{constructor(e){const t=new ArrayBuffer(96);this._type=0,this._batchState=e,this._gl=e.renderer.GetContext(),this._indexCount=this._startIndex=0,this._texParam=null,this._mat4param=new Float32Array(t,0,16),this._colorParam=new Float32Array(t,64,4),this._srcOriginRect=new Float32Array(t,80,4),this._shaderParams=[]}InitQuad(e,t){this._type=1,this._startIndex=e,this._indexCount=t}DoQuad(){const e=this._gl;e.drawElements(e.TRIANGLES,this._indexCount,e.UNSIGNED_SHORT,this._startIndex)}InitSetTexture(e){this._type=2,this._texParam=e}DoSetTexture(){const e=this._gl,t=this._texParam;e.bindTexture(e.TEXTURE_2D,t?t._GetTexture():null)}InitSetColor(e){this._type=3,e.writeToTypedArray(this._colorParam,0)}DoSetColor(){const e=this._colorParam,t=this._batchState;s.copy(t.currentColor,e),t.currentShader.UpdateColor(e)}InitSetGradientColor(e){this._type=20,e.writeToTypedArray(this._colorParam,0)}DoSetGradientColor(){const e=this._colorParam,t=this._batchState.currentShader;t._uColor2.IsUsed()&&t._uColor2.Update4f(e[0],e[1],e[2],e[3])}InitSetBlend(e,t){this._type=4,this._startIndex=e,this._indexCount=t}DoSetBlend(){this._gl.blendFunc(this._startIndex,this._indexCount)}InitSetViewport(e,t,s,i){this._type=5;const r=this._colorParam;r[0]=e,r[1]=t,r[2]=s,r[3]=i}DoSetViewport(){const e=this._colorParam;this._gl.viewport(e[0],e[1],e[2],e[3])}InitSetProjection(e){this._type=6,i.copy(this._mat4param,e)}DoSetProjection(){const e=this._batchState,t=e.renderer._allShaderPrograms,s=e.currentShader,r=this._mat4param;for(let e=0,i=t.length;e<i;++e){const i=t[e];i===s?i.UpdateMatP(r,!0):i.SetMatPStale()}i.copy(e.currentMatP,r)}InitSetModelView(e){this._type=7,i.copy(this._mat4param,e)}DoSetModelView(){const e=this._batchState,t=e.renderer._allShaderPrograms,s=e.currentShader,r=this._mat4param;for(let e=0,i=t.length;e<i;++e){const i=t[e];i===s?i.UpdateMatMV(r,!0):i.SetMatMVStale()}i.copy(e.currentMV,r)}InitSetRenderTarget(e){this._type=8,this._texParam=e}DoSetRenderTarget(){const e=this._gl,t=this._texParam,s=this._batchState;t?(s.currentFramebuffer=t._GetFramebuffer(),s.currentFramebufferNoDepth=t._GetFramebufferNoDepth(),s.isDepthSamplingEnabled&&s.currentFramebufferNoDepth?e.bindFramebuffer(e.FRAMEBUFFER,s.currentFramebufferNoDepth):e.bindFramebuffer(e.FRAMEBUFFER,s.currentFramebuffer)):(s.currentFramebuffer=null,s.currentFramebufferNoDepth=null,e.bindFramebuffer(e.FRAMEBUFFER,null))}InitClearSurface(e){this._type=9,e.writeToTypedArray(this._mat4param,0)}InitClearSurface2(e,t,s,i){this._type=9;const r=this._mat4param;r[0]=e,r[1]=t,r[2]=s,r[3]=i}DoClearSurface(){const e=this._gl;var t=this._mat4param;const s=this._batchState.clearColor,i=t[0],r=t[1],n=t[2];t=t[3],s.equalsRgba(i,r,n,t)||(e.clearColor(i,r,n,t),s.setRgba(i,r,n,t)),e.clear(e.COLOR_BUFFER_BIT)}InitSetPointTexCoords(e){this._type=14,e.writeToTypedArray(this._mat4param,0)}DoSetPointTextureCoords(){const e=this._mat4param;this._batchState.pointTexCoords.set(e[0],e[1],e[2],e[3])}InitPoints(e,t){this._type=10,this._startIndex=e,this._indexCount=1,this._mat4param[0]=t}DoPoints(){const e=this._gl,t=this._batchState,s=t.renderer._spPoints;e.useProgram(s._shaderProgram),s.UpdateMatP(t.currentMatP,!1),s.UpdateMatMV(t.currentMV,!1);var i=t.pointTexCoords;s._uPointTexStart.IsUsed()&&s._uPointTexStart.Update2f(i.getLeft(),i.getTop()),s._uPointTexEnd.IsUsed()&&s._uPointTexEnd.Update2f(i.getRight(),i.getBottom()),i=this._mat4param[0],s._uZElevation.IsUsed()&&s._uZElevation.Update1f(i),s._uColor.IsUsed()&&(i=t.currentColor,s._uColor.Update4f(i[0],i[1],i[2],i[3])),e.drawArrays(e.POINTS,this._startIndex/4,this._indexCount),e.useProgram(t.currentShader._shaderProgram)}InitSetProgram(e){this._type=11,this._texParam=e}DoSetProgram(){var e=this._gl;const t=this._batchState,s=this._texParam;t.currentShader=s,e.useProgram(s._shaderProgram),s.UpdateMatP(t.currentMatP,!1),s.UpdateMatMV(t.currentMV,!1),s._uColor.IsUsed()&&(e=t.currentColor,s._uColor.Update4f(e[0],e[1],e[2],e[3]))}InitSetProgramParameters(){this._type=12}DoSetProgramParameters(){const e=this._batchState.currentShader;e._hasAnyOptionalUniforms&&this._DoSetOptionalUniformProgramParameters(e),e._uCustomParameters.length&&this._DoUpdateCustomProgramParameters(e)}_DoSetOptionalUniformProgramParameters(e){const t=this._gl,s=this._mat4param,i=this._colorParam,r=this._srcOriginRect;if(e._uSamplerBack.IsUsed()){const e=this._batchState.renderer,s=this._texParam;e._lastTexture1!==s&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s?s._GetTexture():null),e._lastTexture1=s,t.activeTexture(t.TEXTURE0))}e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(s[0],s[1]),e._uDestStart.IsUsed()&&e._uDestStart.Update2f(s[2],s[3]),e._uDestEnd.IsUsed()&&e._uDestEnd.Update2f(s[4],s[5]),e._uDevicePixelRatio.IsUsed()&&e._uDevicePixelRatio.Update1f(this._indexCount),e._uLayerScale.IsUsed()&&e._uLayerScale.Update1f(s[6]),e._uLayerAngle.IsUsed()&&e._uLayerAngle.Update1f(s[7]),e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(s[12],s[13]),e._uSrcEnd.IsUsed()&&e._uSrcEnd.Update2f(s[14],s[15]),e._uSrcOriginStart.IsUsed()&&e._uSrcOriginStart.Update2f(r[0],r[1]),e._uSrcOriginEnd.IsUsed()&&e._uSrcOriginEnd.Update2f(r[2],r[3]),e._uLayoutStart.IsUsed()&&e._uLayoutStart.Update2f(i[0],i[1]),e._uLayoutEnd.IsUsed()&&e._uLayoutEnd.Update2f(i[2],i[3]),e._uSeconds.IsUsed()&&e._uSeconds.Update1f(this._startIndex)}_DoUpdateCustomProgramParameters(e){e=e._uCustomParameters;const t=this._shaderParams;for(let s=0,i=e.length;s<i;++s){const i=e[s],r=t[s];i.IsColorType()?i.Update3f(r.getR(),r.getG(),r.getB()):i.Update1f(r)}}InitInvalidateFramebuffer(e){this._type=13,this._texParam=e}DoInvalidateFramebuffer(){const e=this._gl,t=this._texParam,s=this._batchState.currentFramebuffer;t!==s&&e.bindFramebuffer(e.FRAMEBUFFER,t),e.invalidateFramebuffer(e.FRAMEBUFFER,[e.COLOR_ATTACHMENT0]),t!==s&&e.bindFramebuffer(e.FRAMEBUFFER,s)}InitBlitFramebuffer(t,s,i){this._type=16;const r=this._mat4param,n=this._batchState.renderer;r[0]=t.GetWidth(),r[1]=t.GetHeight(),r[2]=s?s.GetWidth():n.GetWidth(),r[3]=s?s.GetHeight():n.GetHeight(),r[4]=t.IsLinearSampling()?1:0,r[5]="stretch"===i,i=this._shaderParams,e.clearArray(i),i.push(t._GetFramebuffer()),i.push(s?s._GetFramebuffer():null)}DoBlitFramebuffer(){var e=this._mat4param,t=this._shaderParams;const s=this._gl;var i=e[0],r=e[1],n=e[2];const a=e[3],o=0!==e[4];e=0!==e[5];const h=t[1];s.bindFramebuffer(s.READ_FRAMEBUFFER,t[0]),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,h),e?s.blitFramebuffer(0,0,i,r,0,0,n,a,s.COLOR_BUFFER_BIT,o?s.LINEAR:s.NEAREST):(t=Math.min(i,n),i=Math.min(r,a),n=Math.max(r-a,0),r=Math.max(a-r,0),s.blitFramebuffer(0,n,t,i+n,0,r,t,i+r,s.COLOR_BUFFER_BIT,s.NEAREST))}InitStartQuery(e){this._type=17,this._texParam=e}DoStartQuery(){this._texParam.BeginTimeElapsed(),this._texParam=null}InitEndQuery(e){this._type=18,this._texParam=e}DoEndQuery(){this._texParam.EndTimeElapsed(),this._texParam=null}InitSetEllipseParams(e,t,s){this._type=19;const i=this._mat4param;i[0]=e,i[1]=t,i[2]=s}DoSetEllipseParams(){const e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[2])}InitSetTilemapInfo(e,t,s,i,r,n,a){this._type=15;const o=this._mat4param;e.writeToTypedArray(o,0),o[4]=1/t,o[5]=1/s,o[6]=i/t,o[7]=r/s,o[8]=n/t,o[9]=a/s}DoSetTilemapInfo(){const e=this._batchState.currentShader,t=this._mat4param;e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(t[0],t[1]),e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[4],t[5]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[6],t[7]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[8],t[9])}InitClearDepth(e){this._type=21,this._startIndex=e?1:0}DoClearDepth(){const e=this._gl,t=0!==this._startIndex;t||e.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT),t||e.depthMask(!1)}InitSetDepthEnabled(e){this._type=22,this._startIndex=e?1:0}DoSetDepthEnabled(){const e=this._gl;0===this._startIndex?(e.disable(e.DEPTH_TEST),e.depthMask(!1)):(e.enable(e.DEPTH_TEST),e.depthMask(!0))}InitSetDepthSamplingEnabled(e){this._type=23,this._startIndex=e?1:0}DoSetDepthSamplingEnabled(){const e=this._gl,t=this._batchState,s=t.renderer,i=0!==this._startIndex;t.isDepthSamplingEnabled=i,e.activeTexture(e.TEXTURE2),i?(t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebufferNoDepth),e.bindTexture(e.TEXTURE_2D,s._GetDepthBuffer())):(e.bindTexture(e.TEXTURE_2D,null),t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebuffer)),e.activeTexture(e.TEXTURE0)}InitCoplanarStartStencilPass(){this._type=24}DoCoplanarStartStencilPass(){const e=this._gl;e.clear(e.STENCIL_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.colorMask(!1,!1,!1,!1)}InitCoplanarStartColorPass(){this._type=25}DoCoplanarStartColorPass(){const e=this._gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,1,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}InitCoplanarRestore(){this._type=26}DoCoplanarRestore(){const e=this._gl;e.disable(e.STENCIL_TEST)}Run(){switch(this._type){case 1:this.DoQuad();break;case 2:this.DoSetTexture();break;case 3:this.DoSetColor();break;case 4:this.DoSetBlend();break;case 5:this.DoSetViewport();break;case 6:this.DoSetProjection();break;case 7:this.DoSetModelView();break;case 8:this.DoSetRenderTarget();break;case 9:this.DoClearSurface();break;case 10:this.DoPoints();break;case 11:this.DoSetProgram();break;case 12:this.DoSetProgramParameters();break;case 13:this.DoInvalidateFramebuffer();break;case 14:this.DoSetPointTextureCoords();break;case 15:this.DoSetTilemapInfo();break;case 16:this.DoBlitFramebuffer();break;case 17:this.DoStartQuery();break;case 18:this.DoEndQuery();break;case 19:this.DoSetEllipseParams();break;case 20:this.DoSetGradientColor();break;case 21:this.DoClearDepth();break;case 22:this.DoSetDepthEnabled();break;case 23:this.DoSetDepthSamplingEnabled();break;case 24:this.DoCoplanarStartStencilPass();break;case 25:this.DoCoplanarStartColorPass();break;case 26:this.DoCoplanarRestore()}}}}{const e=self.C3,t={timeout:60},s=new e.Color(0,0,0,1),i=new Set(["left","center","right"]),r=new Set(["top","center","bottom"]),n=new Set(["word","character"]),a=new Set;function g(t,s,i,r,n,a){s?"Gecko"===e.Platform.BrowserEngine?t.strokeText(i,r,n,a):t.strokeText(i,r,n):"Gecko"===e.Platform.BrowserEngine?t.fillText(i,r,n,a):t.fillText(i,r,n)}function k(e,t,s,i,r,n){t?e.strokeRect(s,i,r,n):e.fillRect(s,i,r,n)}function m(e){return 4/3*e}e.FontManager&&e.FontManager.addEventListener("fontload",t=>{t=t.font.GetName();for(const s of a)(s.IsBBCodeEnabled()||e.equalsNoCase(s.GetFontName(),t))&&s._SetTextChanged()});let o=!1,h=!1;e.Gfx.RendererText=class{constructor(s,i){i=Object.assign({},t,i),this._renderer=s,this._fontName="Arial",this._fontSize=16,this._fontSizeScale=1,this._lineHeight=0,this._isItalic=this._isBold=!1,this._colorStr="black",this._isBBcodeEnabled=!1,this.onloadfont=null,this._alreadyLoadedFonts=new Set,this._horizontalAlign="left",this._verticalAlign="top",this._text="",this._bbString=null,this._wrappedText=e.New(e.WordWrap),this._wrapMode="word",this._isUpdating=this._textChanged=!1,this._isAsync=!0,this._drawMaxCharCount=-1,this._height=this._width=this._cssHeight=this._cssWidth=this._drawCharCount=0,this._zoom=1,this._changed=!1,this._measureContextTop=this._measureContext=this._textContext=this._textCanvas=null,this._lastCanvasHeight=this._lastCanvasWidth=-1,this._lastTextCanvasFillStyle=this._lastMeasureCanvasFont=this._lastTextCanvasFont="",this._lastTextCanvasLineWidth=this._lastTextCanvasOpacity=1,this._measureTextCallback=((e,t)=>this._MeasureText(e,t)),this._texture=null,this._textureHeight=this._textureWidth=0,this._rcTex=new e.Rect,this._scaleFactor=1,this._needToRecreateTexture=!1,this._textureTimeout=new e.IdleTimeout(()=>{this.ReleaseTexture(),this._SetTextCanvasSize(8,8)},i.timeout),this.ontextureupdate=null,this._wasReleased=!1,a.add(this)}Release(){this.onloadfont=null,this._alreadyLoadedFonts.clear(),this._measureTextCallback=this._measureContextTop=this._measureContext=this._textContext=this._textCanvas=this._bbString=null,this._textureTimeout.Release(),this.ontextureupdate=null,this.ReleaseTexture(),this._wrappedText.Clear(),this._renderer=this._wrappedText=null,this._wasReleased=!0,a.delete(this)}_SetChanged(){this._changed=!0}_SetTextChanged(){this._SetChanged(),this._wrappedText.Clear(),this._textChanged=!0}SetIsAsync(e){this._isAsync=!!e}IsAsync(){return this._isAsync}SetBBCodeEnabled(e){e=!!e,this._isBBcodeEnabled!==e&&(e=(this._isBBcodeEnabled=e)?"alphabetic":"top",this._textContext&&(this._textContext.textBaseline=e),this._measureContext&&(this._measureContext.textBaseline=e),this._SetTextChanged())}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetFontName(e){e||(e="serif"),this._fontName!==e&&(this._fontName=e,this._SetTextChanged())}GetFontName(){return this._fontName}SetFontSize(e){.1>e&&(e=.1),this._fontSize!==e&&(this._fontSize=e,this._SetTextChanged())}SetFontSizeScale(e){this._fontSizeScale!==e&&(this._fontSizeScale=e,this._SetTextChanged())}SetLineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._SetChanged())}SetBold(e){e=!!e,this._isBold!==e&&(this._isBold=e,this._SetTextChanged())}SetItalic(e){e=!!e,this._isItalic!==e&&(this._isItalic=e,this._SetTextChanged())}SetDrawMaxCharacterCount(e){e=Math.floor(e),this._drawMaxCharCount!==e&&(this._drawMaxCharCount=e,this._SetChanged())}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetStyleTag(e,t){for(let s=e.length-1;0<=s;--s){const i=e[s];if(i.tag===t)return i}return null}_HasStyleTag(e,t){return!!this._GetStyleTag(e,t)}_GetFontString(e,t){let s=[];(this._isBold||this._HasStyleTag(t,"b"))&&s.push("bold"),(this._isItalic||this._HasStyleTag(t,"i"))&&s.push("italic");var i=this._GetStyleTag(t,"size");return i=(i?parseFloat(i.param):this._fontSize)*this._fontSizeScale,e?s.push(i+"pt"):s.push(i*this._scaleFactor*this._zoom*self.devicePixelRatio+"pt"),e=this._fontName,(t=this._GetStyleTag(t,"font"))&&t.param&&(e=t.param,this.onloadfont&&!this._alreadyLoadedFonts.has(e)&&(this.onloadfont(e),this._alreadyLoadedFonts.add(e))),e&&s.push('"'+e+'"'),s.join(" ")}SetColor(t){t instanceof e.Color&&(t=t.getCssRgb()),this._colorStr!==t&&(this._colorStr=t,this._SetChanged())}SetColorRgb(e,t,i){s.setRgb(e,t,i),this.SetColor(s)}SetHorizontalAlignment(e){if(!i.has(e))throw Error("invalid horizontal alignment");this._horizontalAlign!==e&&(this._horizontalAlign=e,this._SetChanged())}SetVerticalAlignment(e){if(!r.has(e))throw Error("invalid vertical alignment");this._verticalAlign!==e&&(this._verticalAlign=e,this._SetChanged())}SetWordWrapMode(e){if(!n.has(e))throw Error("invalid word wrap mode");this._wrapMode!==e&&(this._wrapMode=e,this._SetTextChanged())}SetText(e){this._text!==e&&(this._text=e,this._SetTextChanged())}SetSize(e,t,s){if(void 0===s&&(s=1),!(0>=e||0>=e||this._cssWidth===e&&this._cssHeight===t&&this._zoom===s)){1===this._zoom!=(1===s)&&(this._needToRecreateTexture=!0);var i=this._cssWidth,r=this._zoom;this._cssWidth=e,this._cssHeight=t,this._zoom=s,e=self.devicePixelRatio,this._width=this._cssWidth*this._zoom*e,this._height=this._cssHeight*this._zoom*e,e=Math.max(this._width,this._height),t=Math.min(this._renderer.GetMaxTextureSize(),2048),s=1,e>t&&(s=t/e,this._width=Math.min(this._width*s,t),this._height=Math.min(this._height*s,t)),this._scaleFactor=s,0<this._textureWidth&&0<this._textureHeight&&this._zoom===r&&this._rcTex.set(0,0,this._width/this._textureWidth,this._height/this._textureHeight),this._cssWidth!==i?this._SetTextChanged():this._SetChanged()}}GetWidth(){return this._width}GetHeight(){return this._height}GetTextWidth(){return this._MaybeWrapText(),this._wrappedText.GetMaxLineWidth()}GetTextHeight(){return this._MaybeWrapText(),this._wrappedText.GetTotalLineHeight()+this._wrappedText.GetLineCount()*(this._lineHeight+4)-this._lineHeight}GetTexture(){return this._textureTimeout.Reset(),this._MaybeUpdate(),this._texture}_MaybeUpdate(){this._texture&&!this._changed&&!this._textChanged||this._isUpdating||0>=this._width||0>=this._height||(this._changed=!1,this._isUpdating=!0,this._isAsync?e.Asyncify(()=>this._DoUpdate()):this._DoUpdate())}_DoUpdate(){this._wasReleased||(this._SetTextCanvasSize(Math.ceil(this._width),Math.ceil(this._height)),this._MaybeWrapText(),this._DrawTextToCanvas(),this._UpdateTexture(),this._textureTimeout.Reset(),this._isUpdating=!1)}_SetTextCanvasSize(t,s){this._textCanvas||(this._textCanvas=e.CreateCanvas(16,16));let i=!1;this._lastCanvasWidth===t&&this._lastCanvasHeight===s||(this._lastCanvasWidth=t,this._lastCanvasHeight=s,this._textCanvas.width=t,this._textCanvas.height=s,i=!0),this._textContext||(this._textContext=this._textCanvas.getContext("2d"),i=!0),i?(this._textContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._textContext.font=this._lastTextCanvasFont,this._textContext.fillStyle=this._lastTextCanvasFillStyle,this._textContext.strokeStyle=this._lastTextCanvasFillStyle,this._textContext.globalAlpha=this._lastTextCanvasOpacity,this._textContext.lineWidth=this._lastTextCanvasLineWidth):this._textContext.clearRect(0,0,t,s)}_MaybeCreateMeasureContext(){this._measureContext||(this._measureContext=e.CreateCanvas(16,16).getContext("2d"),this._measureContextTop=e.CreateCanvas(16,16).getContext("2d"),this._measureContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._measureContextTop.textBaseline="top")}_SetMeasureFontString(e){this._lastMeasureCanvasFont!==e&&(this._lastMeasureCanvasFont=e,this._measureContext.font=e,this._measureContextTop.font=e)}_SupportsFontBoundingBoxMeasurements(){if(!o){o=!0,this._MaybeCreateMeasureContext();const e=this._measureContext.measureText("test");h="number"==typeof e.fontBoundingBoxAscent&&"number"==typeof e.fontBoundingBoxDescent}return h}_MaybeWrapText(){this._textChanged&&(this._MaybeCreateMeasureContext(),!this._isBBcodeEnabled||this._bbString&&this._bbString.toString()===this._text||(this._bbString=new e.BBString(this._text,{noEscape:!0})),this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,this._measureTextCallback,this._cssWidth,this._wrapMode,0),this._textChanged=!1)}_MeasureText(e,t){this._SetMeasureFontString(this._GetFontString(!0,t)),t=this._GetStyleTag(t,"size"),t=(t?parseFloat(t.param):this._fontSize)*this._fontSizeScale;const s=this._measureContext.measureText(e);let i=0;return this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements()&&(e=this._measureContextTop.measureText(e),i=s.fontBoundingBoxAscent-e.fontBoundingBoxAscent),{width:s.width,height:m(t),fontBoundingBoxAscent:s.fontBoundingBoxAscent||0,fontBoundingBoxDescent:s.fontBoundingBoxDescent||0,topToAlphabeticDistance:i}}_SetDrawFontString(e){this._lastTextCanvasFont!==e&&(this._lastTextCanvasFont=e,this._textContext.font=e)}_SetDrawCanvasColor(e){this._lastTextCanvasFillStyle!==e&&(this._lastTextCanvasFillStyle=e,this._textContext.fillStyle=e,this._textContext.strokeStyle=e)}_SetDrawCanvasOpacity(e){this._lastTextCanvasOpacity!==e&&(this._lastTextCanvasOpacity=e,this._textContext.globalAlpha=e)}_SetDrawCanvasLineWith(e){this._lastTextCanvasLineWidth!==e&&(this._lastTextCanvasLineWidth=e,this._textContext.lineWidth=e)}_DrawTextToCanvas(){this._drawCharCount=0;const e=this._scaleFactor*this._zoom*self.devicePixelRatio,t=(4+this._lineHeight)*e;var s=0;const i=this._wrappedText.GetLines();if(0!==i.length){var r=this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements(),n=i[0].height*e;"center"===this._verticalAlign?(s=i.reduce((s,i)=>s+i.height*e+t,0)-t,s=Math.max(this._height/2-s/2,0),r&&(n=i[0].topToAlphabeticDistance*e)):"bottom"===this._verticalAlign&&(s=i.reduce((s,i)=>s+i.height*e+t,0)-this._lineHeight*e,r=r?i.at(-1).fontBoundingBoxDescent*e:0,s=this._height-s-r-2);for(let a=0,o=i.length;a<o;++a){r=i[a];const o=r.height*e,h=s;if(this._isBBcodeEnabled){if(s+=0===a?n:o,0<a&&s>this._height-4*e)break}else if(0<a&&s>=this._height-o)break;0<=h&&this._DrawTextLine(r,s,e),this._isBBcodeEnabled||(s+=o),s+=t}}}_DrawTextLine(e,t,s){let i=0;"center"===this._horizontalAlign?i=(this._width-e.width*s)/2:"right"===this._horizontalAlign&&(i=this._width-e.width*s);for(const r of e.fragments)this._DrawTextFragment(r,i,t,s,e.height),i+=r.width*s}_DrawTextFragment(t,s,i,r,n){const a=this._textContext,o=n/16;n=t.width*r;const h=t.height*r,l=t.height/16;var c=(4+this._lineHeight)*r,u=t.styles;if(t=t.text,-1!==this._drawMaxCharCount){if(this._drawCharCount>=this._drawMaxCharCount)return;this._drawCharCount+t.length>this._drawMaxCharCount&&(t=t.substr(0,this._drawMaxCharCount-this._drawCharCount),n=this._MeasureText(t,u).width*r),this._drawCharCount+=t.length}var _=this._GetStyleTag(u,"background")
;const d=this._HasStyleTag(u,"u"),p=this._HasStyleTag(u,"s");if((!e.IsStringAllWhitespace(t)||_||d||p)&&!this._HasStyleTag(u,"hide")){var m=this._GetStyleTag(u,"offsetx");s+=m?parseFloat(m.param)*r:0,m=this._GetStyleTag(u,"offsety"),i+=m?parseFloat(m.param)*r:0,_&&(this._SetDrawCanvasColor(_.param),a.fillRect(s,i-h,n,h+c)),c=this._GetStyleTag(u,"color"),this._SetDrawCanvasColor(c?c.param:this._colorStr),_=this._GetStyleTag(u,"opacity"),this._SetDrawCanvasOpacity(_?parseFloat(_.param)/100:1),_=(_=this._GetStyleTag(u,"linethickness"))?parseFloat(_.param):1,(m=this._HasStyleTag(u,"stroke"))&&this._SetDrawCanvasLineWith(.5*l*_*this._scaleFactor*this._zoom*self.devicePixelRatio),this._SetDrawFontString(this._GetFontString(!1,u)),g(a,m,t,s,i,n),!m&&(this._SetDrawCanvasLineWith(.5*l*_*this._scaleFactor*this._zoom*self.devicePixelRatio),u=this._GetStyleTag(u,"outline"))&&(this._SetDrawCanvasColor(u.param),g(a,!0,t,s,i,n)),this._SetDrawCanvasColor(c?c.param:this._colorStr),d&&k(a,m,s,i+r*o,n,r*o*_),p&&(r*=l,a.fillRect(s,i-h/4+r/2-r*_/2,n,r*_))}}_UpdateTexture(){!this._renderer.IsContextLost()&&(this._textureWidth=Math.ceil(this._width),this._textureHeight=Math.ceil(this._height),this._rcTex.set(0,0,this._width/this._textureWidth,this._height/this._textureHeight),this._needToRecreateTexture&&(this.ReleaseTexture(),this._needToRecreateTexture=!1),this._texture||(this._texture=this._renderer.CreateDynamicTexture(this._textureWidth,this._textureHeight,{mipMap:1===this._zoom,mipMapQuality:"high"})),this._renderer.UpdateTexture(this._textCanvas,this._texture),this.ontextureupdate)&&this.ontextureupdate()}GetTexRect(){return this._rcTex}ReleaseTexture(){this._texture&&(this._renderer.IsContextLost()||this._renderer.DeleteTexture(this._texture),this._texture=null)}static OnContextLost(){for(const e of a)e.ReleaseTexture()}static GetAll(){return a.values()}}}{const e=self.C3;class t{constructor(e){this._gl=e.GetContext(),this._version=e.GetWebGLVersionNumber(),this._timerExt=e._GetDisjointTimerQueryExtension(),this._query=null,this._hasResult=this._isActive=!1,this._result=0,this._query=1===this._version?this._timerExt.createQueryEXT():this._gl.createQuery()}Release(){this._DeleteQueryObject(),this._timerExt=this._gl=null,this._hasResult=!1}_DeleteQueryObject(){this._query&&(1===this._version?this._timerExt.deleteQueryEXT(this._query):this._gl.deleteQuery(this._query),this._query=null)}BeginTimeElapsed(){if(this._isActive)throw Error("query already active");1===this._version?this._timerExt.beginQueryEXT(this._timerExt.TIME_ELAPSED_EXT,this._query):this._gl.beginQuery(this._timerExt.TIME_ELAPSED_EXT,this._query),this._isActive=!0}EndTimeElapsed(){if(!this._isActive)throw Error("query not active");1===this._version?this._timerExt.endQueryEXT(this._timerExt.TIME_ELAPSED_EXT):this._gl.endQuery(this._timerExt.TIME_ELAPSED_EXT),this._isActive=!1}CheckForResult(){if(this._query&&!this._hasResult&&!this._isActive){var e=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_AVAILABLE_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE),t=this._gl.getParameter(this._timerExt.GPU_DISJOINT_EXT);e&&!t&&(this._result=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT),this._result/=1e9,this._hasResult=!0),(e||t)&&this._DeleteQueryObject()}}HasResult(){return this._hasResult}GetResult(){if(!this._hasResult)throw Error("no result available");return this._result}}e.Gfx.WebGLTimeElapsedQuery=class{constructor(e){this._renderer=e,this._frameNumber=e.GetFrameNumber(),this._isActive=!1,this._parentQuery=null,this._isNested=!1,this._realQuery=null,this._queries=[]}Release(){for(const e of this._queries)e instanceof t&&e.Release();e.clearArray(this._queries),this._renderer=this._realQuery=this._parentQuery=null}BeginTimeElapsed(){if(this._isActive)throw Error("query already active");const e=this._renderer._GetTimeQueryStack();0<e.length?(this._isNested=!0,this._parentQuery=e.at(-1),this._parentQuery._EndReal(),this._parentQuery._queries.push(this)):(this._isNested=!1,this._parentQuery=null),this._isActive=!0,e.push(this),this._StartReal()}EndTimeElapsed(){if(!this._isActive)throw Error("query not active");if(this._renderer._GetTimeQueryStack().pop()!==this)throw Error("can only end most nested query");this._isActive=!1,this._EndReal(),this._parentQuery&&(this._parentQuery._StartReal(),this._parentQuery=null)}_StartReal(){this._realQuery=e.New(t,this._renderer),this._queries.push(this._realQuery),this._realQuery.BeginTimeElapsed()}_EndReal(){this._realQuery.EndTimeElapsed(),this._realQuery=null}CheckForResult(){for(const e of this._queries)e.CheckForResult()}IsNested(){return this._isNested}HasResult(){return this._queries.every(e=>e.HasResult())}GetResult(){return this._queries.reduce((e,t)=>e+t.GetResult(),0)}GetFrameNumber(){return this._frameNumber}}}{const e=self.C3;e.Gfx.WebGLQueryResultBuffer=class{constructor(e,t=1e3){this._renderer=e,this._maxQueries=t,this._buffer=[],this._renderer._AddQueryResultBuffer(this)}Release(){this.Clear(),this._renderer._RemoveQueryResultBuffer(this),this._renderer=null}Clear(){for(const e of this._buffer)e.Release();e.clearArray(this._buffer)}AddTimeElapsedQuery(){const t=new e.Gfx.WebGLTimeElapsedQuery(this._renderer);return this._buffer.push(t),this._buffer.length>this._maxQueries&&this._buffer.shift().Release(),t}CheckForResults(e){for(const t of this._buffer){if(t.GetFrameNumber()>=e)break;if(t.IsNested())break;t.CheckForResult()}}GetFrameRangeResultSum(e,t){if(t<=e)return NaN;let s=0;for(const i of this._buffer){if(i.GetFrameNumber()>=t)break;if(!(i.GetFrameNumber()<e)){if(!i.HasResult())return NaN;s+=i.GetResult()}}return s}DeleteAllBeforeFrameNumber(e){for(let t=0,s=this._buffer.length;t<s;++t){const s=this._buffer[t];if(!(s.GetFrameNumber()<e)){0<t&&this._buffer.splice(0,t);break}s.Release()}}}}{const e=self.C3,t=self.glMatrix,s=t.vec4,i=t.mat4,r={powerPreference:"default",enableGpuProfiling:!0,alpha:!1,lowLatency:!1,depth:!1,canSampleDepth:!1,maxWebGLVersion:2,failIfMajorPerformanceCaveat:!1},n=new Set(["default","low-power","high-performance"]),a=new e.Quad(0,0,1,0,1,1,0,1),o=i.create(),h=i.create(),l=new e.Quad,c=new e.Rect;let u=null;e.isDebug&&(self.debug_lose_context=function(){u?u.loseContext():console.warn("WEBGL_lose_context not supported")},self.debug_restore_context=function(){u?u.restoreContext():console.warn("WEBGL_lose_context not supported")});const _=new Set;let d=-1;function q(){d=-1;for(const e of _)e.checkFunc()&&(e.resolve(),_.delete(e));0<_.size&&(d=self.requestAnimationFrame(q))}e.Gfx.WebGLRenderer=class extends e.Gfx.RendererBase{constructor(t,a){if(super(),a=Object.assign({},r,a),!n.has(a.powerPreference))throw Error("invalid power preference");const o={alpha:!!a.alpha,depth:!1,antialias:!1,powerPreference:a.powerPreference,failIfMajorPerformanceCaveat:!!a.failIfMajorPerformanceCaveat};a.lowLatency&&(o.desynchronized=!0,o.preserveDrawingBuffer=!0);let h=null,l=0;if(2<=a.maxWebGLVersion&&(h=t.getContext("webgl2",o),l=2),h||(h=t.getContext("webgl",o),l=1),!h)throw Error("failed to initialise WebGL context");this._gl=h,this._attribs=h.getContextAttributes(),a.lowLatency&&!this._attribs.desynchronized&&console.info("[WebGLRenderer] Low-latency mode specified but is not supported here"),this._versionString=h.getParameter(h.VERSION),this._version=l,this._viewport=s.create(),this._didChangeTransform=!1,this._bbProjectionMatrix=i.create(),this._usesDepthBuffer=!!a.depth,this._canSampleDepth=!(!a.depth||!a.canSampleDepth),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._depthBuffer=null,this._isAutoSizeDepthBuffer=!0,this._depthBufferHeight=this._depthBufferWidth=0,this._pointBuffer=this._indexBuffer=this._texcoordBuffer=this._vertexBuffer=null,this._vertexData=new Float32Array(8e3*this.GetNumVertexComponents()),this._indexData=new Uint16Array(12e3),this._texcoordData=new Float32Array(16e3),this._pointData=new Float32Array(32e3),this._lastVertexPtr=this._pointPtr=this._texPtr=this._vertexPtr=0,this._spDeviceTransformTextureFill=this._lastProgram=null,this._batch=[],this._topOfBatch=this._batchPtr=0,this._currentRenderTarget=null,this._lastPointZ=0,this._batchState=e.New(e.Gfx.BatchState,this),this._lastColor=e.New(e.Color,1,1,1,1),this._lastTexture1=this._lastTexture0=null,this._lastDestBlend=this._lastSrcBlend=0,this._lastPointTexCoords=new e.Rect,this._maxTextureSize=-1,this._highpPrecision=this._maxPointSize=this._minPointSize=0,this._unmaskedRenderer=this._unmaskedVendor="(unavailable)",this._extensions=[],this._isInitialisingAfterContextRestored=!1,this._depthTextureExt=this._anisotropicExt=this._parallelShaderCompileExt=null,this._maxAnisotropy=0,this._isGpuProfilingEnabled=!!a.enableGpuProfiling,this._timerExt=null,this._allQueryResultBuffers=new Set,this._timeQueryStack=[],this.FillIndexBufferData(this._indexData)}IsWebGL(){return!0}async InitState(){super.InitState();var t=this._gl,i=this.GetNumVertexComponents();this._lastColor.setRgba(1,1,1,1),this._lastTexture1=this._lastTexture0=null,this._pointPtr=this._vertexPtr=0,this._lastVertexPtr=8e3*i-4*i,e.clearArray(this._batch),this._topOfBatch=this._batchPtr=0,this._currentRenderTarget=this._lastProgram=null,this._lastPointTexCoords.set(0,0,1,1),this._lastPointZ=0,i=this._batchState,i.currentShader=null,i.currentFramebuffer=null,i.currentFramebufferNoDepth=null,s.set(i.currentColor,1,1,1,1),i.clearColor.setRgba(0,0,0,0),i.pointTexCoords.set(0,0,1,1),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this._lastSrcBlend=t.ONE,this._lastDestBlend=t.ONE_MINUS_SRC_ALPHA,this._InitBlendModes(t),t.disable(t.CULL_FACE),t.disable(t.STENCIL_TEST),t.disable(t.DITHER),this._usesDepthBuffer?(t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LEQUAL)):(t.disable(t.DEPTH_TEST),t.depthMask(!1)),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._pointBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._pointBuffer),t.bufferData(t.ARRAY_BUFFER,this._pointData.byteLength,t.DYNAMIC_DRAW),this._vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this._vertexData.byteLength,t.DYNAMIC_DRAW),this._texcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._texcoordBuffer),t.bufferData(t.ARRAY_BUFFER,this._texcoordData.byteLength,t.DYNAMIC_DRAW),this._indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indexData,t.STATIC_DRAW),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),i=t.getParameter(t.ALIASED_POINT_SIZE_RANGE),this._minPointSize=i[0],this._maxPointSize=i[1],i=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT);const r=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);if(this._highpPrecision=i&&r?Math.min(i.precision,r.precision):0,2048<this._maxPointSize&&(this._maxPointSize=2048),this._extensions=t.getSupportedExtensions(),(i=t.getExtension("WEBGL_debug_renderer_info"))&&(this._unmaskedVendor=t.getParameter(i.UNMASKED_VENDOR_WEBGL),this._unmaskedRenderer=t.getParameter(i.UNMASKED_RENDERER_WEBGL)),this._parallelShaderCompileExt=t.getExtension("KHR_parallel_shader_compile"),e.isDebug&&(u=t.getExtension("WEBGL_lose_context")),this._isGpuProfilingEnabled&&(1===this.GetWebGLVersionNumber()?("Chromium"!==e.Platform.BrowserEngine||81<=e.Platform.BrowserVersionNumber||"undefined"!=typeof document)&&(this._timerExt=t.getExtension("EXT_disjoint_timer_query")):this._timerExt=t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query")),this._maxAnisotropy=(this._anisotropicExt=t.getExtension("EXT_texture_filter_anisotropic"))?t.getParameter(this._anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,2>this.GetWebGLVersionNumber()&&this._usesDepthBuffer&&this._canSampleDepth&&(this._depthTextureExt=t.getExtension("WEBGL_depth_texture"),!this._depthTextureExt))throw Error("no depth texture support");t=e.Gfx.WebGLShaderProgram,i=t.GetDefaultVertexShaderSource(!1),t=[[t.GetTextureFillFragmentShaderSource(),i,"<default>"],[t.GetTextureFillFragmentShaderSource(),i,"<default-device-transform>"],[t.GetPointFragmentShaderSource(this._version),t.GetPointVertexShaderSource(this._version),"<point>"],[t.GetColorFillFragmentShaderSource(),i,"<fill>"],[t.GetLinearGradientFillFragmentShaderSource(),i,"<lineargradient>"],[t.GetHardEllipseFillFragmentShaderSource(),i,"<hardellipse>"],[t.GetHardEllipseOutlineFragmentShaderSource(),i,"<hardellipseoutline>"],[t.GetSmoothEllipseFillFragmentShaderSource(),i,"<smoothellipse>"],[t.GetSmoothEllipseOutlineFragmentShaderSource(),i,"<smoothellipseoutline>"],[t.GetSmoothLineFillFragmentShaderSource(),i,"<smoothline>"],[t.GetTilemapFragmentShaderSource(),t.GetDefaultVertexShaderSource(!0),"<tilemap>"]],t=await Promise.all(t.map(e=>this.CreateShaderProgram({src:e[0]},e[1],e[2]))),this._spTextureFill=t[0],this._spDeviceTransformTextureFill=t[1],this._spPoints=t[2],this._spColorFill=t[3],this._spLinearGradientFill=t[4],this._spHardEllipseFill=t[5],this._spHardEllipseOutline=t[6],this._spSmoothEllipseFill=t[7],this._spSmoothEllipseOutline=t[8],this._spSmoothLineFill=t[9],this._spTilemapFill=t[10],this.SetTextureFillMode()}async CreateShaderProgram(t,s,i){return t=await e.Gfx.WebGLShaderProgram.Create(this,t,s,i),this._AddShaderProgram(t),t}ResetLastProgram(){this._lastProgram=null}SetSize(e,t,s){if(this._width!==e||this._height!==t||s){this.EndBatch(),s=this._gl;var i=this._batchState;this._width=e,this._height=t,this._SetViewport(0,0,e,t),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,e/t),this.SetProjectionMatrix(this._bbProjectionMatrix),this._spDeviceTransformTextureFill&&(s.useProgram(this._spDeviceTransformTextureFill.GetShaderProgram()),this._spDeviceTransformTextureFill._UpdateDeviceTransformUniforms(this._matP),this._lastProgram=this._spDeviceTransformTextureFill,this._batchState.currentShader=this._spDeviceTransformTextureFill),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0),this._lastTexture1=this._lastTexture0=null,this._usesDepthBuffer&&this._isAutoSizeDepthBuffer&&this._SetDepthBufferSize(this._width,this._height),this._currentRenderTarget&&this._currentRenderTarget._Resize(this._width,this._height),s.bindFramebuffer(s.FRAMEBUFFER,null),this._currentRenderTarget=null,i.currentFramebuffer=null,i.currentFramebufferNoDepth=null}}_SetDepthBufferSize(e,t){const s=this._gl;this._depthBuffer&&this._depthBufferWidth===e&&this._depthBufferHeight===t||(this._canSampleDepth?(this._depthBuffer&&s.deleteTexture(this._depthBuffer),this._depthBuffer=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this._depthBuffer),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),2<=this.GetWebGLVersionNumber()?s.texImage2D(s.TEXTURE_2D,0,s.DEPTH24_STENCIL8,e,t,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):this._depthTextureExt&&s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_STENCIL,e,t,0,s.DEPTH_STENCIL,this._depthTextureExt.UNSIGNED_INT_24_8_WEBGL,null),s.bindTexture(s.TEXTURE_2D,null)):(this._depthBuffer&&s.deleteRenderbuffer(this._depthBuffer),this._depthBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this._depthBuffer),s.renderbufferStorage(s.RENDERBUFFER,2<=this._version?s.DEPTH24_STENCIL8:s.DEPTH_STENCIL,e,t),s.bindRenderbuffer(s.RENDERBUFFER,null)),this._depthBufferWidth=e,this._depthBufferHeight=t)}SetFixedSizeDepthBuffer(e,t){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!1,this._SetDepthBufferSize(e,t))}SetAutoSizeDepthBuffer(){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!0,this._SetDepthBufferSize(this._width,this._height))}_SetViewport(e,t,i,r){const n=this._viewport;n[0]===e&&n[1]===t&&n[2]===i&&n[3]===r||(this.PushBatch().InitSetViewport(e,t,i,r),s.set(n,e,t,i,r),this._topOfBatch=0)}SetProjectionMatrix(e){i.exactEquals(this._matP,e)||(this.PushBatch().InitSetProjection(e),i.copy(this._matP,e),this._topOfBatch=0,this._didChangeTransform=!0)}SetDefaultRenderTargetProjectionState(){let e,t;var s=this._currentRenderTarget;null===s?(e=this._bbProjectionMatrix,t=this.GetWidth(),s=this.GetHeight()):(e=s.GetProjectionMatrix(),t=s.GetWidth(),s=s.GetHeight()),this.SetProjectionMatrix(e),this._SetViewport(0,0,t,s)}SetModelViewMatrix(e){i.exactEquals(this._matMV,e)||(this.PushBatch().InitSetModelView(e),i.copy(this._matMV,e),this._topOfBatch=0,this._didChangeTransform=!0)}ResetDidChangeTransformFlag(){this._didChangeTransform=!1}DidChangeTransform(){return this._didChangeTransform}GetBatchState(){return this._batchState}PushBatch(){const t=this._batch;return this._batchPtr===t.length&&t.push(new e.Gfx.WebGLBatchJob(this._batchState)),t[this._batchPtr++]}EndBatch(){0===this._batchPtr||this.IsContextLost()||(this._WriteBuffers(),this._ExecuteBatch(),this._topOfBatch=this._pointPtr=this._texPtr=this._vertexPtr=this._batchPtr=0)}_WriteBuffers(){const e=this._gl;0<this._pointPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this._pointBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._pointData.subarray(0,this._pointPtr))),0<this._vertexPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._vertexData.subarray(0,this._vertexPtr)),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._texcoordData.subarray(0,this._texPtr)))}_ExecuteBatch(){const e=this._batch;for(let t=0,s=this._batchPtr;t<s;++t)e[t].Run()}GetOpacity(){return this._lastColor.getA()}SetColorRgba(e,t,s,i){const r=this._lastColor;r.equalsRgba(e,t,s,i)||(r.setRgba(e,t,s,i),this.PushBatch().InitSetColor(r),this._topOfBatch=0,this._currentStateGroup=null)}SetOpacity(e){const t=this._lastColor;t.getA()!==e&&(t.setA(e),this.PushBatch().InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null)}SetColor(e){const t=this._lastColor;t.equals(e)||(t.set(e),this.PushBatch().InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null)}ResetColor(){this.SetColorRgba(1,1,1,1)}GetColor(){return this._lastColor}SetTexture(e){e!==this._lastTexture0&&(this.PushBatch().InitSetTexture(e),this._lastTexture0=e,this._topOfBatch=0)}_ResetLastTexture(){this._lastTexture0=null}SetBlendMode(e){e=this._GetBlendByIndex(e),this._SetBlend(e[0],e[1])}SetNamedBlendMode(e){e=this.GetNamedBlend(e),this._SetBlend(e.srcBlend,e.destBlend)}_SetBlend(e,t){e===this._lastSrcBlend&&t===this._lastDestBlend||(this.PushBatch().InitSetBlend(e,t),this._lastSrcBlend=e,this._lastDestBlend=t,this._topOfBatch=0,this._currentStateGroup=null)}IsPremultipliedAlphaBlend(){return this._lastSrcBlend===this._gl.ONE&&this._lastDestBlend===this._gl.ONE_MINUS_SRC_ALPHA}SetAlphaBlend(){this._SetBlend(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)}SetNoPremultiplyAlphaBlend(){this._SetBlend(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA)}SetCopyBlend(){this._SetBlend(this._gl.ONE,this._gl.ZERO)}Rect(e){this.Rect2(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}Rect2(e,t,s,i){this.Quad2(e,t,s,t,s,i,e,i)}_ExtendQuadBatch(){let e=this._vertexPtr;e>=this._lastVertexPtr&&(this.EndBatch(),e=0),1===this._topOfBatch?this._batch[this._batchPtr-1]._indexCount+=6:(this.PushBatch().InitQuad(e,6),this._topOfBatch=1)}_WriteQuadToVertexBuffer(e){e.writeToTypedArray3D(this._vertexData,this._vertexPtr,this._baseZ+this._currentZ),this._vertexPtr+=12}Quad(e){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),a.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad2(e,t,s,i,r,n,o,h){this._ExtendQuadBatch();const l=this._vertexData;let c=this._vertexPtr;const u=this._baseZ+this._currentZ;l[c++]=e,l[c++]=t,l[c++]=u,l[c++]=s,l[c++]=i,l[c++]=u,l[c++]=r,l[c++]=n,l[c++]=u,l[c++]=o,l[c++]=h,l[c++]=u,this._vertexPtr=c,a.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad4(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D(e,t,s,i,r,n,a,o,h,l,c,u,_){this._ExtendQuadBatch();const d=this._vertexData;let p=this._vertexPtr;const g=this._baseZ+this._currentZ;d[p++]=e,d[p++]=t,d[p++]=g+s,d[p++]=i,d[p++]=r,d[p++]=g+n,d[p++]=a,d[p++]=o,d[p++]=g+h,d[p++]=l,d[p++]=c,d[p++]=g+u,this._vertexPtr=p,_.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D2(e,t,s,i,r,n,a,o,h,l,c,u,_){this._ExtendQuadBatch();const d=this._vertexData;let p=this._vertexPtr;const g=this._baseZ+this._currentZ;d[p++]=e,d[p++]=t,d[p++]=g+s,d[p++]=i,d[p++]=r,d[p++]=g+n,d[p++]=a,d[p++]=o,d[p++]=g+h,d[p++]=l,d[p++]=c,d[p++]=g+u,this._vertexPtr=p,_.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}FullscreenQuad(e,t){i.copy(o,this._matP),i.copy(h,this._matMV),this.SetDefaultRenderTargetProjectionState();const[s,r]=this.GetRenderTargetSize(this._currentRenderTarget);var n=this.CalculateLookAtModelView2(0,0,this.GetDefaultCameraZ()*self.devicePixelRatio,0,0,0,r);if(this.SetModelViewMatrix(n),"crop"===e&&this._currentRenderTarget&&t){e=this._width/2,n=this._height/2;const s=t.GetWidth();t=t.GetHeight();var a=this._currentRenderTarget.GetWidth(),u=this._currentRenderTarget.GetHeight();a=Math.min(a,s);const i=Math.min(u,t),r=Math.max(t-u,0);u=Math.max(u-t,0),c.set(-e,n-u,-e+a,n-i-u),l.setFromRect(c),c.set(0,r,a,i+r),c.divide(s,t),this.Quad3(l,c)}else e=s/2,n=r/2,this.Rect2(-e,n,e,-n);this.SetProjectionMatrix(o),this.SetModelViewMatrix(h)}StartRenderingPoints(e){this._lastPointTexCoords.equals(e)||(this._lastPointTexCoords.copy(e),this.PushBatch().InitSetPointTexCoords(e),this._topOfBatch=0)}FinishRenderingPoints(){}Point(e,t,s,i){7996<=this._pointPtr&&this.EndBatch();let r=this._pointPtr;var n=this._baseZ+this._currentZ;2===this._topOfBatch&&this._lastPointZ===n?this._batch[this._batchPtr-1]._indexCount++:(this.PushBatch().InitPoints(r,n),this._topOfBatch=2,this._lastPointZ=n),n=this._pointData,n[r++]=e,n[r++]=t,n[r++]=s,n[r++]=i,this._pointPtr=r}SetProgram(e){this._lastProgram!==e&&(this.PushBatch().InitSetProgram(e),this._lastProgram=e,this._topOfBatch=0,this._currentStateGroup=null)}SetDeviceTransformTextureFillMode(){this.SetProgram(this._spDeviceTransformTextureFill)}SetGradientColor(e){this.PushBatch().InitSetGradientColor(e),this._topOfBatch=0}SetEllipseParams(e,t,s=1){this.PushBatch().InitSetEllipseParams(e,t,s),this._topOfBatch=0}SetTilemapInfo(e,t,s,i,r,n,a){if(this._lastProgram!==this._spTilemapFill)throw Error("must set tilemap fill mode first");this.PushBatch().InitSetTilemapInfo(e,t,s,i,r,n,a),this._topOfBatch=0}SetProgramParameters(t,s,i,r,n,a,o,h,l,c,u,_){const d=this._lastProgram;var p=d._hasAnyOptionalUniforms;const g=!!_.length;if(p&&!d.AreOptionalUniformsAlreadySetInBatch(s,i,r,n,a,o,h,l,c,u)||g&&!d.AreCustomParametersAlreadySetInBatch(_)){var m=this.PushBatch();m.InitSetProgramParameters(),p&&(d.SetOptionalUniformsInBatch(s,i,r,n,a,o,h,l,c,u),p=m._mat4param,p[0]=a,p[1]=o,s.writeToTypedArray(p,2),p[6]=l,p[7]=c,i.writeToTypedArray(p,12),s=m._colorParam,n.writeToTypedArray(s,0),n=s[1],s[1]=s[3],s[3]=n,r.writeToTypedArray(m._srcOriginRect,0),m._startIndex=u,m._indexCount=h,d._uSamplerBack.IsUsed()?m._texParam=t?t.GetTexture():null:m._texParam=null),g&&(d.SetCustomParametersInBatch(_),e.shallowAssignArray(m._shaderParams,_)),this._topOfBatch=0}}ClearRgba(e,t,s,i){this.PushBatch().InitClearSurface2(e,t,s,i),this._topOfBatch=0}Clear(e){this.PushBatch().InitClearSurface(e),this._topOfBatch=0}Start(){}Finish(){super.Finish(),this._gl.flush()}ClearDepth(){this._usesDepthBuffer&&this._currentRenderTarget&&this._currentRenderTarget.HasDepthBuffer()&&(this.PushBatch().InitClearDepth(this._isDepthEnabled),this._topOfBatch=0)}SetDepthEnabled(e){e=!!e,this._isDepthEnabled!==e&&this._usesDepthBuffer&&(this._isDepthEnabled=e,this.PushBatch().InitSetDepthEnabled(e),this._topOfBatch=0)}IsDepthEnabled(){return this._isDepthEnabled}_GetDepthBuffer(){return this._depthBuffer}_CanSampleDepth(){return this._canSampleDepth}SetDepthSamplingEnabled(e){if(e=!!e,this._canSampleDepth&&this._isDepthSamplingEnabled!==e){if(e&&this.IsDepthEnabled())throw Error("depth still enabled");this._isDepthSamplingEnabled=e,this.PushBatch().InitSetDepthSamplingEnabled(e),this._topOfBatch=0}}CheckForQueryResults(){for(const e of this._allQueryResultBuffers)e.CheckForResults(this._frameNumber)}IsContextLost(){return!this._gl||this._gl.isContextLost()||this._isInitialisingAfterContextRestored}OnContextLost(){super.OnDeviceOrContextLost(),e.Gfx.WebGLRendererTexture.OnContextLost(),e.Gfx.WebGLRenderTarget.OnContextLost(),e.Gfx.RendererText.OnContextLost();for(const e of this._allQueryResultBuffers)e.Clear();this._extensions=[],this._depthTextureExt=this._anisotropicExt=this._parallelShaderCompileExt=this._timerExt=null,this._maxAnisotropy=0,this._unmaskedRenderer=this._unmaskedVendor="(unavailable)",this._depthBuffer=this._spDeviceTransformTextureFill=this._lastProgram=null;for(const e of this._stateGroups.values())e.OnContextLost()}async OnContextRestored(){this._isInitialisingAfterContextRestored=!0,await this.InitState(),this._isInitialisingAfterContextRestored=!1;for(const e of this._stateGroups.values())e.OnContextRestored(this);this.SetSize(this._width,this._height,!0)}CreateStaticTexture(t,s){if(this.IsContextLost())throw Error("context lost");this.EndBatch();const i=e.New(e.Gfx.WebGLRendererTexture,this);return i._CreateStatic(t,s),i}CreateStaticTextureAsync(t,s){if(this.IsContextLost())return Promise.reject("context lost");s=Object.assign({},s);const i=s.wrapX&&"clamp-to-edge"!==s.wrapX||s.wrapY&&"clamp-to-edge"!==s.wrapY;return!e.Supports.ImageBitmapOptions||!this.SupportsNPOTTextures()&&i?e.Supports.ImageBitmap?createImageBitmap(t).then(t=>e.Asyncify(()=>this.CreateStaticTexture(t,s))):t instanceof Blob?e.BlobToImage(t,!0).then(e=>this.CreateStaticTextureAsync(e,s)):"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement&&"function"==typeof t.decode?t.decode().then(()=>e.Asyncify(()=>this.CreateStaticTexture(t,s))):e.Asyncify(()=>this.CreateStaticTexture(t,s)):(s.premultiplyAlpha=!1,createImageBitmap(t,{premultiplyAlpha:"premultiply"}).then(t=>e.Asyncify(()=>this.CreateStaticTexture(t,s))))}CreateDynamicTexture(t,s,i){this.EndBatch();const r=e.New(e.Gfx.WebGLRendererTexture,this);return r._CreateDynamic(t,s,i),r}UpdateTexture(e,t,s){this.EndBatch(),t._Update(e,s)}DeleteTexture(e){e&&(e.SubtractReference(),0<e.GetReferenceCount()||(this.EndBatch(),e===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),e===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()))}CreateRenderTarget(t){let s=this._width,i=this._height,r=!0;if(t&&("number"==typeof t.width&&(s=t.width,r=!1),"number"==typeof t.height&&(i=t.height,r=!1)),0>=s||0>=i)throw Error("invalid size");this.EndBatch();const n=e.New(e.Gfx.WebGLRenderTarget,this);return n._Create(s,i,Object.assign({isDefaultSize:r},t)),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,n}SetRenderTarget(e,t=!0){e!==this._currentRenderTarget&&(e&&e.IsDefaultSize()&&e._Resize(this._width,this._height),this.PushBatch().InitSetRenderTarget(e),this._currentRenderTarget=e,this._topOfBatch=0,t&&this.SetDefaultRenderTargetProjectionState())}GetRenderTarget(){return this._currentRenderTarget}GetRenderTargetSize(e){return e?[e.GetWidth(),e.GetHeight()]:[this._width,this._height]}CopyRenderTarget(e,t="stretch"){2>this._version||this._currentRenderTarget&&0<this._currentRenderTarget.GetMultisampling()?(this.SetCopyBlend(),this.ResetColor(),this.DrawRenderTarget(e,t)):(this.PushBatch().InitBlitFramebuffer(e,this._currentRenderTarget,t),this._topOfBatch=0)}DrawRenderTarget(e,t="stretch"){if(e=e.GetTexture(),!e)throw Error("not a texture-backed render target");this.SetTexture(e),this.FullscreenQuad(t,e)}InvalidateRenderTarget(e){2>this._version||(this.PushBatch().InitInvalidateFramebuffer(e._GetFramebuffer()),this._topOfBatch=0)}DeleteRenderTarget(e){this.SetRenderTarget(null),this.EndBatch();const t=e.GetTexture();t===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),t===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()}async ReadBackRenderTargetToImageData(t,s,i){this.EndBatch();const r=this._currentRenderTarget;if(t)var n=t.GetWidth(),a=t.GetHeight(),o=t._GetFramebuffer();else n=this.GetWidth(),a=this.GetHeight(),o=null;let h=t=0;var l=n,c=a;i&&(t=e.clamp(Math.floor(i.getLeft()),0,n-1),h=e.clamp(Math.floor(i.getTop()),0,a-1),l=i.width(),l=0===l?n-t:e.clamp(Math.floor(l),0,n-t),c=i.height(),c=0===c?a-h:e.clamp(Math.floor(c),0,a-h),h=a-(h+c));const u=this._gl;if(u.bindFramebuffer(u.FRAMEBUFFER,o),a=(()=>{u.bindFramebuffer(u.FRAMEBUFFER,null),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,this.SetRenderTarget(r)}),!s&&2<=this.GetWebGLVersionNumber()){u.bindFramebuffer(u.READ_FRAMEBUFFER,o),o=u.createBuffer(),i=l*c*4,n=u.PIXEL_PACK_BUFFER,u.bindBuffer(n,o),u.bufferData(n,i,u.STREAM_READ),u.readPixels(t,h,l,c,u.RGBA,u.UNSIGNED_BYTE,0),u.bindFramebuffer(u.READ_FRAMEBUFFER,null),u.bindBuffer(n,null),a();const e=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);await this._WaitForObjectReady(()=>u.getSyncParameter(e,u.SYNC_STATUS)===u.SIGNALED),u.deleteSync(e),s=new ImageData(l,c),u.bindBuffer(n,o),u.getBufferSubData(n,0,new Uint8Array(s.data.buffer),0,i),u.bindBuffer(n,null),u.deleteBuffer(o)}else s=new ImageData(l,c),u.readPixels(t,h,l,c,u.RGBA,u.UNSIGNED_BYTE,new Uint8Array(s.data.buffer)),a();return s}CoplanarStartStencilPass(){this.SetDepthEnabled(!0),this.PushBatch().InitCoplanarStartStencilPass(),this._topOfBatch=0}CoplanarStartColorPass(){this.SetDepthEnabled(!1),this.PushBatch().InitCoplanarStartColorPass(),this._topOfBatch=0}CoplanarRestoreStandardRendering(){this.SetDepthEnabled(!0),this.PushBatch().InitCoplanarRestore(),this._topOfBatch=0}StartQuery(e){this.SupportsGPUProfiling()&&(this.PushBatch().InitStartQuery(e),this._topOfBatch=0)}EndQuery(e){this.SupportsGPUProfiling()&&(this.PushBatch().InitEndQuery(e),this._topOfBatch=0)}_WaitForObjectReady(e){const t=new Promise(t=>_.add({resolve:t,checkFunc:e}));return-1===d&&(d=self.requestAnimationFrame(q)),t}IsDesynchronized(){return!!this._attribs.desynchronized}GetEstimatedBackBufferMemoryUsage(){return this._width*this._height*(this._attribs.alpha?4:3)}GetEstimatedRenderBufferMemoryUsage(){let t=0;for(const s of e.Gfx.WebGLRenderTarget.allRenderTargets())s.GetTexture()||(t+=s.GetEstimatedMemoryUsage());return t}GetEstimatedTextureMemoryUsage(){let t=0;for(const s of e.Gfx.WebGLRendererTexture.allTextures())t+=s.GetEstimatedMemoryUsage();return t}GetEstimatedTotalMemoryUsage(){return this.GetEstimatedBackBufferMemoryUsage()+this.GetEstimatedRenderBufferMemoryUsage()+this.GetEstimatedTextureMemoryUsage()}GetWebGLVersionString(){return this._versionString}GetWebGLVersionNumber(){return this._version}GetDisplayName(){return"webgl"+this.GetWebGLVersionNumber()}SupportsNPOTTextures(){return 2<=this.GetWebGLVersionNumber()}GetMaxTextureSize(){return this._maxTextureSize}GetMinPointSize(){return this._minPointSize}GetMaxPointSize(){return this._maxPointSize}SupportsHighP(){
return 0!==this._highpPrecision}GetHighPPrecision(){return this._highpPrecision}GetUnmaskedVendor(){return this._unmaskedVendor}GetUnmaskedRenderer(){return this._unmaskedRenderer}GetExtensions(){return this._extensions}SupportsGPUProfiling(){return!!this._timerExt}_GetDisjointTimerQueryExtension(){return this._timerExt}_GetParallelShaderCompileExtension(){return this._parallelShaderCompileExt}_GetAnisotropicExtension(){return this._anisotropicExt}_GetMaxAnisotropy(){return this._maxAnisotropy}_AddQueryResultBuffer(e){this._allQueryResultBuffers.add(e)}_RemoveQueryResultBuffer(e){this._allQueryResultBuffers.delete(e)}_GetTimeQueryStack(){return this._timeQueryStack}GetContext(){return this._gl}_InitBlendModes(e){this._InitBlendModeData([["normal",e.ONE,e.ONE_MINUS_SRC_ALPHA],["additive",e.ONE,e.ONE],["xor",e.ONE,e.ONE_MINUS_SRC_ALPHA],["copy",e.ONE,e.ZERO],["destination-over",e.ONE_MINUS_DST_ALPHA,e.ONE],["source-in",e.DST_ALPHA,e.ZERO],["destination-in",e.ZERO,e.SRC_ALPHA],["source-out",e.ONE_MINUS_DST_ALPHA,e.ZERO],["destination-out",e.ZERO,e.ONE_MINUS_SRC_ALPHA],["source-atop",e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],["destination-atop",e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA]])}CreateRendererText(){return e.New(e.Gfx.RendererText,this)}CreateWebGLText(){return this.CreateRendererText()}}}{const e={getDrawSize:null,getRenderTarget:null,releaseRenderTarget:null,getTime:null,redraw:null};self.C3.Gfx.EffectChainManager=class{constructor(t){t=Object.assign({},e,t),this._cbGetDrawSize=t.getDrawSize,this._cbGetRenderTarget=t.getRenderTarget,this._cbReleaseRenderTarget=t.releaseRenderTarget,this._cbGetTime=t.getTime,this._cbRedraw=t.redraw}GetDrawSize(e){return this._cbGetDrawSize?this._cbGetDrawSize(e):[e.GetWidth(),e.GetHeight()]}GetRenderTarget(e){return this._cbGetRenderTarget(e)}ReleaseRenderTarget(e,t){this._cbReleaseRenderTarget(e,t)}GetTime(){return this._cbGetTime()}Redraw(e){this._cbRedraw(e)}}}{const e=self.C3,t=self.glMatrix.mat4,s=e.New(e.Rect),i=e.New(e.Rect),r=e.New(e.Rect),n=e.New(e.Rect),a=t.create(),o=t.create(),h={drawContent:null,getSourceTextureInfo:null,getShaderParameters:null,invalidateRenderTargets:!1},l={indexMap:null,forcePreDraw:!1,forcePostDraw:!1,is3D:!1,isSourceTextureRotated:!1,isRotatedOrNegativeSizeInstance:!1,useFullSurface:!1},c={contentObject:null,contextObject:null,blendMode:0,devicePixelRatio:1,layerScale:1,layerAngle:0,layoutRect:null,drawSurfaceRect:null,drawContentHook:null,compositOffX:0,compositOffY:0,updateOwnProjection:!1};e.Gfx.EffectChain=class{constructor(s,i){i=Object.assign({},h,i),this._manager=s,this._cbDrawContent=i.drawContent,this._cbGetSourceTextureInfo=i.getSourceTextureInfo,this._cbGetShaderParameters=i.getShaderParameters,this._cbDrawContentHook=null,this._shaderProgramList=[],this._shaderProgramIndices=[],this._steps=[],this._blendMode=0,this._isSourceTextureRotated=this._useFullSurface=this._canUseFastPath=this._depthEnabledAtStart=this._didChangeTransform=this._isAnyShaderDepthSampling=this._isAnyShaderAnimated=!1,this._numTempSurfacesRequired=0,this._renderTargets=[null,null,null],this._invalidateRenderTargets=!!i.invalidateRenderTargets,this._drawHeight=this._drawWidth=this._boxExtendVertical=this._boxExtendHorizontal=0,this._contextObject=this._contentObject=null,this._layoutRect=e.New(e.Rect),this._drawSurfaceRect=e.New(e.Rect),this._rcTexOriginal=e.New(e.Rect),this._rcTexBounce=e.New(e.Rect),this._rcTexDest=e.New(e.Rect),this._layerScale=this._devicePixelRatio=1,this._time=this._layerAngle=0,this._destRenderTarget=null,this._compositOffY=this._compositOffX=0,this._updateOwnProjection=!1,this._projectionMatrix=t.create(),this._modelViewMatrix=t.create()}Release(){e.clearArray(this._steps),e.clearArray(this._shaderProgramList),e.clearArray(this._shaderProgramIndices),this._cbGetShaderParameters=this._cbGetSourceTextureInfo=this._cbDrawContent=this._contextObject=this._contentObject=null}BuildSteps(t,s){if(s=Object.assign({},l,s),e.clearArray(this._steps),this._boxExtendVertical=this._boxExtendHorizontal=0,this._isAnyShaderDepthSampling=this._isAnyShaderAnimated=!1,this._numTempSurfacesRequired=0,this._isSourceTextureRotated=!!s.isSourceTextureRotated,this._useFullSurface=!!s.useFullSurface,e.shallowAssignArray(this._shaderProgramList,t),0!==t.length){if(s.indexMap){if(s.indexMap.length!==t.length)throw Error("incorrect indexMap length");e.shallowAssignArray(this._shaderProgramIndices,s.indexMap)}else{e.clearArray(this._shaderProgramIndices);for(let e=0,s=t.length;e<s;++e)this._shaderProgramIndices.push(e)}for(var i of t)this._boxExtendHorizontal+=i.GetBoxExtendHorizontal(),this._boxExtendVertical+=i.GetBoxExtendVertical(),i.IsAnimated()&&(this._isAnyShaderAnimated=!0),i.UsesDepth()&&(this._isAnyShaderDepthSampling=!0);if(1!==t.length||t[0].BlendsBackground()||t[0].UsesCrossSampling()||!s.useFullSurface&&t[0].ExtendsBox()||s.forcePreDraw||t[0].MustPreDraw()||s.forcePostDraw||s.is3D||!this._useFullSurface&&t[0].UsesDepth()){this._canUseFastPath=!1,i=this._ShouldPreDraw(t[0],s),s=this._ShouldPostDraw(t.at(-1),s);var r=0;i&&(this._numTempSurfacesRequired=1,this._steps.push(e.New(e.Gfx.EffectChain.Step.PreDraw,this,-1,1)),r=1);for(let n=0,a=t.length;n<a;++n)0!==n||i?(t=1===r?2:1,n!==a-1||s||(t=0),this._numTempSurfacesRequired=Math.max(this._numTempSurfacesRequired,t),this._steps.push(e.New(e.Gfx.EffectChain.Step.Bounce,this,r,t,n)),r=t):(this._numTempSurfacesRequired=1,this._steps.push(e.New(e.Gfx.EffectChain.Step.FirstBounce,this,-1,1,n)),r=1);s&&this._steps.push(e.New(e.Gfx.EffectChain.Step.PostDraw,this,r,0))}else this._canUseFastPath=!0}}_ShouldPreDraw(e,t){return t.forcePreDraw||t.is3D||!this._useFullSurface&&e.UsesDepth()||e.MustPreDraw()||e.BlendsBackground()&&(t.isRotatedOrNegativeSizeInstance||e.GetRenderer().IsWebGL()&&t.isSourceTextureRotated)||0!==this._boxExtendHorizontal||0!==this._boxExtendVertical}_ShouldPostDraw(e,t){return t.forcePostDraw||e.BlendsBackground()||e.UsesCrossSampling()}Render(e,t,s){if(s=Object.assign({},c,s),e.IsWebGPU()&&null===t&&(t=e.GetBackbufferRenderTarget()),this._destRenderTarget=t,this._contentObject=s.contentObject,this._contextObject=s.contextObject,this._blendMode=s.blendMode,this._devicePixelRatio=s.devicePixelRatio,this._layerScale=s.layerScale,this._layerAngle=s.layerAngle,this._time=this._manager.GetTime(),this._didChangeTransform=!1,e.ResetDidChangeTransformFlag(),this._isAnyShaderAnimated&&this._Redraw(),this._canUseFastPath)this._Render_FastPath(e,s);else{var[i,r]=this._manager.GetDrawSize(e);this._SetDrawSize(e,i,r),this._CalculateRectangles(s),e.ResetColor(),e.SetBaseZ(0),e.SetCurrentZ(0),this._cbDrawContentHook=s.drawContentHook,this._compositOffX=s.compositOffX||0,this._compositOffY=s.compositOffY||0,this._updateOwnProjection=!!s.updateOwnProjection,this._OnBeforeStartEffectChain(e),this._renderTargets[0]=t,this._renderTargets[1]=1<=this._numTempSurfacesRequired?this._GetRenderTarget():null,this._renderTargets[2]=2===this._numTempSurfacesRequired?this._GetRenderTarget():null;for(const i of this._steps)t=this._GetRenderTargetForId(i.GetSrcTargetId()),s=this._GetRenderTargetForId(i.GetDestTargetId()),e.IsWebGPU()?i.Run_WebGPU(e,t,s):i.Run_WebGL(e,t,s);this._renderTargets[1]&&this._ReleaseRenderTarget(this._renderTargets[1]),this._renderTargets[2]&&this._ReleaseRenderTarget(this._renderTargets[2]),this._renderTargets.fill(null),this._OnAfterEndEffectChain(e),this._cbDrawContentHook=this._contextObject=this._contentObject=this._destRenderTarget=null}}_SetDrawSize(e,t,s){if(0>=t||0>=s)throw Error("invalid draw size");this._drawWidth===t&&this._drawHeight===s||this._CalculateDeviceTransformMatrices(e,t,s,0,0,this._projectionMatrix,this._modelViewMatrix),this._drawWidth=t,this._drawHeight=s}_CalculateDeviceTransformMatrices(e,s,i,r,n,a,o){r=s/2+r,n=i/2+n,e.CalculatePerspectiveMatrix(a,s/i),e=e.CalculateLookAtModelView2(r,n,e.GetDefaultCameraZ()*self.devicePixelRatio,r,n,0,i),t.copy(o,e)}_CalculateRectangles(e){this._layoutRect.copy(e.layoutRect),e.drawSurfaceRect?this._drawSurfaceRect.copy(e.drawSurfaceRect):this._drawSurfaceRect.set(0,0,this._drawWidth,this._drawHeight),this._rcTexOriginal.copy(this._drawSurfaceRect),this._rcTexOriginal.divide(this._drawWidth,this._drawHeight),e=e.layerScale*e.devicePixelRatio,this._drawSurfaceRect.inflate(this._boxExtendHorizontal*e,this._boxExtendVertical*e),this._rcTexDest.copy(this._drawSurfaceRect),this._rcTexDest.divide(this._drawWidth,this._drawHeight),this._drawSurfaceRect.clamp(0,0,this._drawWidth,this._drawHeight),this._rcTexBounce.copy(this._drawSurfaceRect),this._rcTexBounce.divide(this._drawWidth,this._drawHeight)}_OnBeforeStartEffectChain(e){this._depthEnabledAtStart=e.IsDepthEnabled(),this._useFullSurface&&(e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0)),e.IsWebGPU()&&!this._useFullSurface&&(s.copy(this._drawSurfaceRect),s.roundOuter(),e.SetScissorRect(s.getLeft(),s.getTop(),s.width(),s.height()))}_OnAfterEffectChainDrawContent(e){e.ResetColor(),this._useFullSurface||(e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0)),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!0)}_OnAfterEndEffectChain(e){e.SetDepthSamplingEnabled(!1),e.SetDepthEnabled(this._depthEnabledAtStart),e.IsWebGPU()&&!this._useFullSurface&&e.RemoveScissorRect(),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!1),this._didChangeTransform=e.DidChangeTransform()}_ClampRcTexDest(){this._rcTexDest.clamp(0,0,1,1)}_GetRenderTargetForId(e){return 0>e?null:this._renderTargets[e]}_GetRenderTarget(){return this._manager.GetRenderTarget(this)}_GetDestRenderTarget(){return this._destRenderTarget}_ReleaseRenderTarget(e){this._manager.ReleaseRenderTarget(e,this)}_GetShaderProgramAt(e){return this._shaderProgramList[e]}_DrawContent(e){this._cbDrawContentHook?this._cbDrawContentHook(this,e,()=>this._cbDrawContent(e,this)):this._cbDrawContent(e,this),this._canUseFastPath||this._OnAfterEffectChainDrawContent(e)}_IsRenderTargetSameSizeAndOffset(e){if(this._useFullSurface)return!0;if(0!==this._compositOffX||0!==this._compositOffY)return!1;const[t,s]=e.GetRenderTargetSize(e.GetRenderTarget());return t===this._drawWidth&&s===this._drawHeight}_SetDeviceTransform(e,t){let s=this._projectionMatrix,i=this._modelViewMatrix;if(t&&!this._IsRenderTargetSameSizeAndOffset(e)){s=a,i=o;const[t,r]=e.GetRenderTargetSize(e.GetRenderTarget());this._CalculateDeviceTransformMatrices(e,t,r,this._compositOffX,this._compositOffY,s,i),e.IsWebGPU()&&!this._useFullSurface&&e.RemoveScissorRect()}e.SetProjectionMatrix(s),e.SetModelViewMatrix(i)}_Redraw(){this._manager.Redraw(this)}_GetShaderParameters(e){return this._cbGetShaderParameters(this._shaderProgramIndices[e])}_SetProgramParameters(e,t){let s=this._rcTexDest,a=this._rcTexBounce,o=this._rcTexOriginal;e.IsWebGL()&&(i.copy(s),i.flipAround(1),s=i,r.copy(a),r.flipAround(1),a=r,n.copy(o),n.flipAround(1),o=n),this._DoSetProgramParameters(e,t,a,o,s,1/this._drawWidth,1/this._drawHeight)}_SetFirstBounceProgramParameters(e,t){let a=this._rcTexBounce,o=this._rcTexOriginal,h=1/this._drawWidth,l=1/this._drawHeight;if(this._cbGetSourceTextureInfo){let{srcTexRect:e,srcWidth:t,srcHeight:i}=this._cbGetSourceTextureInfo(this._contentObject);e||(s.set(0,0,0,0),e=s),t||(t=this._drawWidth),i||(i=this._drawHeight),o=a=e,h=1/t,l=1/i}else e.IsWebGL()&&(r.copy(a),r.flipAround(1),a=r,n.copy(o),n.flipAround(1),o=n);let c=this._rcTexDest;e.IsWebGL()&&(c=i,c.copy(this._rcTexDest),c.flipAround(1)),this._DoSetProgramParameters(e,t,a,o,c,h,l),e.IsWebGPU()&&this._shaderProgramList[0].BlendsBackground()&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated)}_DoSetProgramParameters(e,t,s,i,r,n,a){t=this._GetShaderParameters(t),e.SetProgramParameters(this._destRenderTarget,r,s,i,this._layoutRect,n,a,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time,t)}_Render_FastPath(e,t){var s=this._shaderProgramList[0];const i=e.IsDepthEnabled(),r=s.UsesDepth();let n;if(r&&(e.SetDepthEnabled(!1),e.SetDepthSamplingEnabled(!0),this._rcTexDest.set(0,0,1,1),this._rcTexOriginal.set(0,0,1,1)),e.SetProgram(s),e.SetBlendMode(this._blendMode),e.SetRenderTarget(this._destRenderTarget),this._rcTexOriginal.set(0,0,1,1),s.UsesAnySrcRectOrPixelSize()&&this._cbGetSourceTextureInfo){const{srcTexRect:e,srcWidth:t,srcHeight:i}=this._cbGetSourceTextureInfo(this._contentObject);e&&this._rcTexOriginal.copy(e),s=Number.isFinite(t)?1/t:0,n=Number.isFinite(i)?1/i:0}else{const[t,i]=this._manager.GetDrawSize(e);s=1/t,n=1/i}t.layoutRect?this._layoutRect.copy(t.layoutRect):this._layoutRect.set(0,0,0,0),t=this._GetShaderParameters(0),e.SetProgramParameters(null,this._rcTexDest,this._rcTexOriginal,this._rcTexOriginal,this._layoutRect,s,n,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time,t),e.SetBaseZ(0),this._DrawContent(e),r&&(e.SetDepthSamplingEnabled(!1),e.SetDepthEnabled(i))}IsFastPath(){return this._canUseFastPath}UseFullSurface(){return this._useFullSurface}GetContentObject(){return this._contentObject}GetContextObject(){return this._contextObject}_GetBlendMode(){return this._blendMode}_UpdateOwnProjection(){return this._updateOwnProjection}DidChangeTransform(){return this._didChangeTransform}_GetDrawSurfaceRect(){return this._drawSurfaceRect}_GetRcTexBounce(){return this._rcTexBounce}_ShouldInvalidateRenderTargets(){return this._invalidateRenderTargets}async DebugLogRenderTargetContents(e,t,s){}}}self.C3.Gfx.EffectChain.Step=class{constructor(e,t,s,i=-1){this._effectChain=e,this._srcTargetId=t,this._destTargetId=s,this._index=i}GetEffectChain(){return this._effectChain}GetSrcTargetId(){return this._srcTargetId}GetDestTargetId(){return this._destTargetId}GetIndex(){return this._index}GetShaderProgram(){return this.GetEffectChain()._GetShaderProgramAt(this.GetIndex())}Run_WebGL(e,t,s){}Run_WebGPU(e,t,s){}};{const e=self.C3;e.Gfx.EffectChain.Step.PreDraw=class extends e.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,t,s){t=this.GetEffectChain(),e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(s,t._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),t._DrawContent(e),t._ClampRcTexDest()}Run_WebGPU(e,t,s){t=this.GetEffectChain(),e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(s,!1),e.ClearRgba(0,0,0,0),t._DrawContent(e),t._ClampRcTexDest()}}}{const e=self.C3,t=e.New(e.Rect),s=e.New(e.Quad);e.Gfx.EffectChain.Step.PostDraw=class extends e.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,i,r){const n=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(r),n._SetDeviceTransform(e,!0),e.SetBlendMode(n._GetBlendMode()),e.SetTexture(i.GetTexture()),s.setFromRect(n._GetDrawSurfaceRect()),t.copy(n._GetRcTexBounce()),t.flipAround(1),e.Quad3(s,t),n._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(i)}Run_WebGPU(e,t,i){const r=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(i,!1),r._IsRenderTargetSameSizeAndOffset(e)?s.setFromRect(r._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),r._SetDeviceTransform(e,!0),s.setFromRect(r._GetDrawSurfaceRect())),e.SetBackTexture(null),e.SetBlendMode(r._GetBlendMode()),e.SetTexture(t.GetTexture()),r.UseFullSurface()?e.FullscreenQuad():e.Quad3(s,r._GetRcTexBounce())}}}{const e=self.C3;e.Gfx.EffectChain.Step.FirstBounce=class extends e.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,t,s){t=this.GetEffectChain(),e.SetRenderTarget(s,t._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),t._SetFirstBounceProgramParameters(e,this.GetIndex()),t._DrawContent(e),t._ClampRcTexDest()}Run_WebGPU(e,t,s){t=this.GetEffectChain(),e.SetRenderTarget(s,!1),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),t._SetFirstBounceProgramParameters(e,this.GetIndex()),t._DrawContent(e),t._ClampRcTexDest()}}}{const e=self.C3,t=e.New(e.Rect),s=e.New(e.Quad);e.Gfx.EffectChain.Step.Bounce=class extends e.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,i,r){const n=this.GetEffectChain();e.SetRenderTarget(r),(r=0===this.GetDestTargetId())?e.SetBlendMode(n._GetBlendMode()):(e.ClearRgba(0,0,0,0),e.SetCopyBlend()),e.SetProgram(this.GetShaderProgram()),n._SetProgramParameters(e,this.GetIndex()),e.SetTexture(i.GetTexture()),n._SetDeviceTransform(e,r),s.setFromRect(n._GetDrawSurfaceRect()),t.copy(n._GetRcTexBounce()),t.flipAround(1),e.Quad3(s,t),n._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(i)}Run_WebGPU(e,t,i){const r=this.GetEffectChain();e.SetRenderTarget(i,!1),0===this.GetDestTargetId()?(e.SetBlendMode(r._GetBlendMode()),e.SetBackTexture(null),r._IsRenderTargetSameSizeAndOffset(e)?s.setFromRect(r._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),r._SetDeviceTransform(e,!0),s.setFromRect(r._GetDrawSurfaceRect()))):(e.ClearRgba(0,0,0,0),e.SetCopyBlend(),s.setFromRect(r._GetRcTexBounce())),e.SetProgram(this.GetShaderProgram()),r._SetProgramParameters(e,this.GetIndex()),e.SetTexture(t.GetTexture()),r.UseFullSurface()?e.FullscreenQuad():e.Quad3(s,r._GetRcTexBounce())}}}{const e=self.C3,t=self.C3X;let s=null;const i=new Set;function d(e,t){const s=e[0]-t[0];return 0!==s?s:e[1]-t[1]}const r=[],n=[];let a=!1;self.IRuntime=class{constructor(e,t){s=e,Object.defineProperties(this,{assets:{value:s.GetAssetManager().GetIAssetManager(),writable:!1},objects:{value:t,writable:!1},globalVars:{value:{},writable:!1},projectName:{value:s.GetProjectName(),writable:!1},projectVersion:{value:s.GetProjectVersion(),writable:!1},storage:{value:new self.IStorage(s),writable:!1},isInWorker:{value:s.IsInWorker(),writable:!1}}),s.UserScriptDispatcher().addEventListener("keydown",e=>{i.has(e.key)?e.stopPropagation():i.add(e.key)}),s.UserScriptDispatcher().addEventListener("keyup",e=>i.delete(e.key)),s.Dispatcher().addEventListener("window-blur",()=>i.clear()),s.IsInWorker()&&(self.alert=(e=>(a||(a=!0,console.warn("[Construct 3] alert() was called from a Web Worker, because the project 'Use worker' setting is enabled. This method is not normally available in a Web Worker. Construct has implemented the alert for you, but note that other features may be missing in worker mode. You may wish to disable 'Use worker', or use a more convenient function like console.log(). For more information please refer to the scripting section of the manual.")),this.alert(e))))}_InitGlobalVars(e){Object.defineProperties(this.globalVars,e)}addEventListener(e,t){s.UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){s.UserScriptDispatcher().removeEventListener(e,t)}callFunction(e,...i){t.RequireString(e);const r=s.GetEventSheetManager(),n=r.GetFunctionBlockByName(e);if(!n)throw Error(`cannot find function name '${e}'`);if(!n.IsEnabled())return n.GetDefaultReturnValue();if(i.length<n.GetFunctionParameterCount())throw Error(`not enough function parameters passed for '${e}' (${i.length} passed, ${n.GetFunctionParameterCount()} expected)`);const a=n.GetEventBlock();e=null;var o=r.GetCurrentEvent();return o&&(o=o.GetSolModifiersIncludingParents(),0<o.length&&(e=o,r.PushCleanSol(o))),i=a.RunAsExpressionFunctionCall(a.GetSolModifiersIncludingParents(),n.GetReturnType(),n.GetDefaultReturnValue(),...i),e&&r.PopSol(e),i}setReturnValue(e){const t=s.GetEventStack().GetCurrentExpFuncStackFrame();if(!t)throw Error("not in a function which returns a value");switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:"number"!=typeof e&&"string"!=typeof e||t.SetFunctionReturnValue(e)}}get dt(){return s.GetDt()}get gameTime(){return s.GetGameTime()}get wallTime(){return s.GetWallTime()}random(){return s.Random()}get layout(){return s.GetMainRunningLayout().GetILayout()}getLayout(e){const t=s.GetLayoutManager();if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(e=t.GetLayout(e),!e)throw Error("invalid layout");return e.GetILayout()}getAllLayouts(){return s.GetLayoutManager().GetAllLayouts().map(e=>e.GetILayout())}goToLayout(e){const t=s.GetLayoutManager();if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(e=t.GetLayout(e),!e)throw Error("invalid layout");t.IsPendingChangeMainLayout()||t.ChangeMainLayout(e)}get keyboard(){const e=s._GetCommonScriptInterfaces().keyboard;if(!e)throw Error("runtime.keyboard used but Keyboard object missing - add it to your project first");return e}get mouse(){const e=s._GetCommonScriptInterfaces().mouse;if(!e)throw Error("runtime.mouse used but Mouse object missing - add it to your project first");return e}get touch(){const e=s._GetCommonScriptInterfaces().touch;if(!e)throw Error("runtime.touch used but Touch object missing - add it to your project first");return e}invokeDownload(e,i){t.RequireString(e),t.RequireString(i),s.InvokeDownload(e,i)}getInstanceByUid(e){return t.RequireFiniteNumber(e),(e=s.GetInstanceByUID(e))?e.GetInterfaceClass():null}sortZOrder(i,a){t.RequireFunction(a);const o=s.GetCurrentLayout();for(var h of i){i=s._UnwrapIWorldInstance(h);var l=i.GetWorldInfo();r.push([l.GetLayer().GetIndex(),l.GetZIndex()]),n.push(i)}if(0!==r.length){r.sort(d),n.sort((e,t)=>a(e.GetInterfaceClass(),t.GetInterfaceClass())),h=!1;for(let e=0,t=r.length;e<t;++e){i=n[e],l=o.GetLayerByIndex(r[e][0]);const t=r[e][1],s=l._GetInstances();s[t]!==i&&(s[t]=i,i.GetWorldInfo()._SetLayer(l),l.SetZIndicesChanged(),h=!0)}h&&s.UpdateRender(),e.clearArray(r),e.clearArray(n)}}alert(e){return s.PostComponentMessageToDOMAsync("runtime","alert",{message:e+(s.IsInWorker()?" [via Web Worker]":"")})}}}{const e=self.C3;let t=null;self.IAssetManager=class{constructor(e){t=e,Object.defineProperties(this,{isWebMOpusSupported:{value:t.IsAudioFormatSupported("audio/webm; codecs=opus"),writable:!1}})}fetchText(e){return t.FetchText(e)}fetchJson(e){return t.FetchJson(e)}fetchBlob(e){return t.FetchBlob(e)}fetchArrayBuffer(e){return t.FetchArrayBuffer(e)}getProjectFileUrl(e){return t.GetProjectFileUrl(e)}getMediaFileUrl(s){return e.IsRelativeURL(s)&&(s=s.toLowerCase()),t.GetMediaFileUrl(s,t.GetMediaSubfolder())}get mediaFolder(){return t.GetMediaSubfolder()}async decodeWebMOpus(e,s){if(this.isWebMOpusSupported)throw Error("decodeWebMOpus(): not supported because WebM Opus is supported by the platform");return s=await t.GetRuntime()._WasmDecodeWebMOpus(s),s=new Float32Array(s),e=e.createBuffer(1,s.length,48e3),e.getChannelData(0).set(s),e}loadScripts(...e){return t.LoadScripts(...e)}compileWebAssembly(e){return t.CompileWebAssembly(e)}loadStyleSheet(e){return t.LoadStyleSheet(e)}}}{const e=self.C3X;self.IStorage=class{constructor(e){this._storage=e._GetProjectStorage()}getItem(t){return e.RequireString(t),this._storage.getItem(t)}setItem(t,s){return e.RequireString(t),this._storage.setItem(t,s)}removeItem(t){return e.RequireString(t),this._storage.removeItem(t)}clear(){return this._storage.clear()}keys(){return this._storage.keys()}}}{const e=self.C3X,t=new WeakMap;self.IObjectClass=class{constructor(e){t.set(this,e),Object.defineProperties(this,{name:{value:e.GetName(),writable:!1}}),e.GetRuntime()._MapScriptInterface(this,e)}addEventListener(s,i){e.RequireString(s),e.RequireFunction(i),t.get(this).UserScriptDispatcher().addEventListener(s,i)}removeEventListener(s,i){e.RequireString(s),e.RequireFunction(i),t.get(this).UserScriptDispatcher().removeEventListener(s,i)}getAllInstances(){return t.get(this).GetInstances().map(e=>e.GetInterfaceClass())}getFirstInstance(){const e=t.get(this).GetInstances();return 0<e.length?e[0].GetInterfaceClass():null}getPickedInstances(){return t.get(this).GetCurrentSol().GetInstances().map(e=>e.GetInterfaceClass())}getFirstPickedInstance(){const e=t.get(this).GetCurrentSol().GetInstances();return 0<e.length?e[0].GetInterfaceClass():null}*instances(){for(const e of t.get(this).GetInstances())yield e.GetInterfaceClass()}*pickedInstances(){for(const e of t.get(this).GetCurrentSol().GetInstances())yield e.GetInterfaceClass()}setInstanceClass(s){if(e.RequireFunction(s),0<t.get(this).GetInstanceCount())throw Error("setInstanceClass() called too late, because instances have already been created - call in runOnStartup");t.get(this)._SetUserScriptInstanceClass(s)}createInstance(s,i,r,n){if(e.RequireNumber(i),e.RequireNumber(r),"number"!=typeof s&&"string"!=typeof s)throw new TypeError("invalid layer parameter");const a=t.get(this),o=a.GetRuntime();if(s=o.GetMainRunningLayout().GetLayer(s),!s)throw Error("invalid layer");return i=o.CreateInstance(a,s,i,r,n),n&&s.SortAndAddInstancesByZIndex(i),n=o.GetEventSheetManager(),n.BlockFlushingInstances(!0),i._TriggerOnCreatedOnSelfAndRelated(),n.BlockFlushingInstances(!1),i.GetInterfaceClass()}}}{const e=self.C3X,t=new WeakMap;self.ILayout=class{constructor(e){t.set(this,e);const s=[],i=e.GetEffectList(),r=i.GetAllEffectTypes().length;for(let e=0;e<r;++e)s.push(new self.IEffectInstance(i,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},index:{value:e.GetIndex(),writable:!1},effects:{value:s,writable:!1}})}addEventListener(s,i){e.RequireString(s),e.RequireFunction(i),t.get(this).UserScriptDispatcher().addEventListener(s,i)}removeEventListener(s,i){e.RequireString(s),e.RequireFunction(i),t.get(this).UserScriptDispatcher().removeEventListener(s,i)}get width(){return t.get(this).GetWidth()}set width(e){t.get(this).SetWidth(e)}get height(){return t.get(this).GetHeight()}set height(e){t.get(this).SetHeight(e)}set scale(s){e.RequireFiniteNumber(s),t.get(this).SetScale(s)}get scale(){return t.get(this).GetScale()}set angle(s){e.RequireFiniteNumber(s),t.get(this).SetAngle(s)}get angle(){return t.get(this).GetAngle()}set scrollX(s){e.RequireNumber(s),t.get(this).SetScrollX(s)}get scrollX(){return t.get(this).GetScrollX()}set scrollY(s){e.RequireNumber(s),t.get(this).SetScrollY(s)}get scrollY(){return t.get(this).GetScrollY()}scrollTo(s,i){e.RequireNumber(s),e.RequireNumber(i);const r=t.get(this);r.SetScrollX(s),r.SetScrollY(i)}getLayer(e){const s=t.get(this);if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");return e=s.GetLayer(e),e?e.GetILayer():null}getAllLayers(){return t.get(this).GetLayers().map(e=>e.GetILayer())}setVanishingPoint(s,i){e.RequireFiniteNumber(s),e.RequireFiniteNumber(i),t.get(this).SetVanishingPointXY(s,i)}getVanishingPoint(){return t.get(this)._GetVanishingPoint()}set projection(s){e.RequireString(s);const i=t.get(this);if("perspective"===s)i.SetPerspectiveProjection();else{if("orthographic"!==s)throw Error("invalid projection");i.SetOrthographicProjection()}}get projection(){return t.get(this).IsOrthographicProjection()?"orthographic":"perspective"}}}{const e=self.C3,t=self.C3X,s=new WeakMap,i=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),r=new Map([...i.entries()].map(e=>[e[1],e[0]])),n=e.New(e.Color);self.ILayer=class{constructor(e){s.set(this,e);const t=[],i=e.GetEffectList(),r=i.GetAllEffectTypes().length;for(let e=0;e<r;++e)t.push(new self.IEffectInstance(i,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},index:{value:e.GetIndex(),writable:!1},layout:{value:e.GetLayout().GetILayout(),writable:!1},effects:{value:t,writable:!1}})}static _Unwrap(e){return s.get(e)}get isVisible(){return s.get(this).IsVisible()}set isVisible(e){s.get(this).SetVisible(e)}get opacity(){return s.get(this).GetOpacity()}set opacity(t){t=e.clamp(+t,0,1),isNaN(t)||s.get(this).SetOpacity(t)}set scale(e){t.RequireFiniteNumber(e),s.get(this).SetOwnScale(e)}get scale(){return s.get(this).GetOwnScale()}set scaleRate(e){t.RequireFiniteNumber(e),s.get(this).SetScaleRate(e)}get scaleRate(){return s.get(this).GetScaleRate()}set angle(e){t.RequireFiniteNumber(e),s.get(this).SetAngle(e)}get angle(){return s.get(this).GetOwnAngle()}set parallaxX(e){t.RequireFiniteNumber(e),s.get(this).SetParallaxX(e)}get parallaxX(){return s.get(this).GetParallaxX()}set parallaxY(e){t.RequireFiniteNumber(e),s.get(this).SetParallaxY(e)}get parallaxY(){return s.get(this).GetParallaxY()}set zElevation(e){t.RequireFiniteNumber(e),s.get(this).SetZElevation(e)}get zElevation(){return s.get(this).GetZElevation()}set isTransparent(e){s.get(this).SetTransparent(e)}get isTransparent(){return s.get(this).IsTransparent()}set isForceOwnTexture(e){s.get(this).SetForceOwnTexture(e)}get isForceOwnTexture(){return s.get(this).IsForceOwnTexture()}set blendMode(e){if(t.RequireString(e),e=i.get(e),"number"!=typeof e)throw Error("invalid blend mode");s.get(this).SetBlendMode(e)}get blendMode(){return r.get(s.get(this).GetBlendMode())}set backgroundColor(e){if(t.RequireArray(e),3>e.length)throw Error("expected 3 elements");n.setRgb(e[0],e[1],e[2]),e=s.get(this);const i=e.GetBackgroundColor();i.equalsIgnoringAlpha(n)||(i.copyRgb(n),e.GetRuntime().UpdateRender())}get backgroundColor(){const e=s.get(this).GetBackgroundColor();return[e.getR(),e.getG(),e.getB()]}set scrollX(e){t.RequireNumber(e);const i=s.get(this);i.SetOwnScrollPositionEnabled(!0),i.SetScrollX(e)}get scrollX(){return s.get(this).GetScrollX()}set scrollY(e){t.RequireNumber(e);const i=s.get(this);i.SetOwnScrollPositionEnabled(!0),i.SetScrollY(e)}get scrollY(){return s.get(this).GetScrollY()}scrollTo(e,i){t.RequireNumber(e),t.RequireNumber(i);const r=s.get(this);r.SetOwnScrollPositionEnabled(!0),r.SetScrollX(e),r.SetScrollY(i)}restoreScrollPosition(){s.get(this).SetOwnScrollPositionEnabled(!1)}getViewport(){return s.get(this).GetViewport().toDOMRect()}cssPxToLayer(e,i,r=0){t.RequireNumber(e),t.RequireNumber(i),t.RequireNumber(r);const n=s.get(this),a=n.GetRuntime();return n.CanvasCssToLayer(e-a.GetCanvasClientX(),i-a.GetCanvasClientY(),r)}layerToCssPx(e,i,r=0){t.RequireNumber(e),t.RequireNumber(i),t.RequireNumber(r);const n=s.get(this),a=n.GetRuntime(),[o,h]=n.LayerToCanvasCss(e,i,r);return[o+a.GetCanvasClientX(),h+a.GetCanvasClientY()]}}}{const e=self.C3,t=self.C3X,s=new WeakMap,i=new WeakMap;function d(t){let s=i.get(t);return s||(s=e.New(e.Event.Dispatcher),i.set(t,s),s)}let r=null;self.IInstance=class{constructor(){s.set(this,r);const e={runtime:{value:r.GetRuntime().GetIRuntime(),writable:!1},objectType:{value:r.GetObjectClass().GetIObjectClass(),writable:!1},uid:{value:r.GetUID(),writable:!1}};r._GetInstVarsScriptDescriptor(e),r._GetBehaviorsScriptDescriptor(e),Object.defineProperties(this,e),r.GetRuntime()._MapScriptInterface(this,r)}static _Init(e){r=e}static _GetInitInst(){return r}_Release(){const e=i.get(this);e&&(e.Release(),i.delete(this)),s.delete(this)}addEventListener(e,s,i){t.RequireString(e),t.RequireFunction(s),d(this).addEventListener(e,s,i)}removeEventListener(e,s,i){t.RequireString(e),t.RequireFunction(s),d(this).removeEventListener(e,s,i)}dispatchEvent(e){d(this).dispatchEvent(e)}destroy(){const e=s.get(this);e.GetRuntime().DestroyInstance(e)}}}{const e=self.C3,t=self.C3X,s=self.IInstance,i=self.ILayer,r=new WeakMap,n=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),a=new Map([...n.entries()].map(e=>[e[1],e[0]])),o=e.New(e.Color);self.IWorldInstance=class h extends s{constructor(){super();var e=s._GetInitInst();r.set(this,e);const t=[];var i=e.GetWorldInfo();if(e=i.GetInstanceEffectList()){i=i.GetObjectClass().GetEffectList().GetAllEffectTypes().length;for(let s=0;s<i;++s)t.push(new self.IEffectInstance(e,s))}Object.defineProperties(this,{effects:{value:t,writable:!1}})}get layout(){return r.get(this).GetWorldInfo().GetLayout().GetILayout()}get layer(){return r.get(this).GetWorldInfo().GetLayer().GetILayer()}get x(){return r.get(this).GetWorldInfo().GetX()}set x(e){e=+e;const t=r.get(this).GetWorldInfo();isNaN(e)||t.GetX()===e||(t.SetX(e),t.SetBboxChanged())}get y(){return r.get(this).GetWorldInfo().GetY()}set y(e){e=+e
;const t=r.get(this).GetWorldInfo();isNaN(e)||t.GetY()===e||(t.SetY(e),t.SetBboxChanged())}get zElevation(){return r.get(this).GetWorldInfo().GetZElevation()}set zElevation(e){e=+e;const t=r.get(this),s=t.GetWorldInfo();isNaN(e)||s.GetZElevation()===e||(s.SetZElevation(e),t.GetRuntime().UpdateRender())}get totalZElevation(){return r.get(this).GetWorldInfo().GetTotalZElevation()}get width(){return r.get(this).GetWorldInfo().GetWidth()}set width(e){e=+e;const t=r.get(this).GetWorldInfo();isNaN(e)||t.GetWidth()===e||(t.SetWidth(e),t.SetBboxChanged())}get height(){return r.get(this).GetWorldInfo().GetHeight()}set height(e){e=+e;const t=r.get(this).GetWorldInfo();isNaN(e)||t.GetHeight()===e||(t.SetHeight(e),t.SetBboxChanged())}get angle(){return r.get(this).GetWorldInfo().GetAngle()}set angle(t){t=e.clampAngle(+t);const s=r.get(this).GetWorldInfo();isNaN(t)||s.GetAngle()===t||(s.SetAngle(t),s.SetBboxChanged())}get angleDegrees(){return e.toDegrees(this.angle)}set angleDegrees(t){this.angle=e.toRadians(t)}getBoundingBox(){return r.get(this).GetWorldInfo().GetBoundingBox().toDOMRect()}getBoundingQuad(){return r.get(this).GetWorldInfo().GetBoundingQuad().toDOMQuad()}get isVisible(){return r.get(this).GetWorldInfo().IsVisible()}set isVisible(e){e=!!e;const t=r.get(this),s=t.GetWorldInfo();s.IsVisible()!==e&&(s.SetVisible(e),t.GetRuntime().UpdateRender())}get opacity(){return r.get(this).GetWorldInfo().GetOpacity()}set opacity(t){t=e.clamp(+t,0,1);const s=r.get(this),i=s.GetWorldInfo();isNaN(t)||i.GetOpacity()===t||(i.SetOpacity(t),s.GetRuntime().UpdateRender())}set colorRgb(e){if(t.RequireArray(e),3>e.length)throw Error("expected 3 elements");o.setRgb(e[0],e[1],e[2]),e=r.get(this);const s=e.GetWorldInfo();s.GetUnpremultipliedColor().equalsIgnoringAlpha(o)||(s.SetUnpremultipliedColor(o),e.GetRuntime().UpdateRender())}get colorRgb(){const e=r.get(this).GetWorldInfo().GetUnpremultipliedColor();return[e.getR(),e.getG(),e.getB()]}set blendMode(e){if(t.RequireString(e),e=n.get(e),"number"!=typeof e)throw Error("invalid blend mode");const s=r.get(this);s.GetWorldInfo().SetBlendMode(e),s.GetRuntime().UpdateRender()}get blendMode(){return a.get(r.get(this).GetWorldInfo().GetBlendMode())}moveToTop(){r.get(this).GetWorldInfo().ZOrderMoveToTop()}moveToBottom(){r.get(this).GetWorldInfo().ZOrderMoveToBottom()}moveToLayer(e){if(t.RequireInstanceOf(e,i),e=i._Unwrap(e),!e)throw Error("invalid layer");r.get(this).GetWorldInfo().ZOrderMoveToLayer(e)}moveAdjacentToInstance(e,s){t.RequireInstanceOf(e,h),r.get(this).GetWorldInfo().ZOrderMoveAdjacentToInstance(r.get(e),s)}get zIndex(){return r.get(this).GetWorldInfo().GetZIndex()}containsPoint(e,s){return t.RequireNumber(e),t.RequireNumber(s),r.get(this).GetWorldInfo().ContainsPoint(+e,+s)}testOverlap(e){t.RequireInstanceOf(e,h);const s=r.get(this);return e=r.get(e),s.GetRuntime().GetCollisionEngine().TestOverlap(s,e)}testOverlapSolid(){var e=r.get(this);return(e=e.GetRuntime().GetCollisionEngine().TestOverlapSolid(e))?e.GetInterfaceClass():null}getParent(){const e=r.get(this).GetParent();return e?e.GetInterfaceClass():null}getTopParent(){const e=r.get(this).GetTopParent();return e?e.GetInterfaceClass():null}*parents(){for(const e of r.get(this).parents())yield e.GetInterfaceClass()}getChildCount(){return r.get(this).GetChildCount()}getChildAt(e){return(e=r.get(this).GetChildAt(e))?e.GetInterfaceClass():null}*children(){for(const e of r.get(this).children())yield e.GetInterfaceClass()}*allChildren(){for(const e of r.get(this).allChildren())yield e.GetInterfaceClass()}addChild(e,s){t.RequireInstanceOf(e,h),t.RequireOptionalObject(s),s||(s={});const i=r.get(this);e=r.get(e),i.AddChild(e,s)}removeChild(e){t.RequireInstanceOf(e,h);const s=r.get(this);e=r.get(e),s.RemoveChild(e)}removeFromParent(){const e=r.get(this);e.HasParent()&&e.GetParent().RemoveChild(e)}createMesh(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),r.get(this).GetWorldInfo().CreateMesh(e,s)}releaseMesh(){const e=r.get(this).GetWorldInfo();e.ReleaseMesh(),e.SetBboxChanged()}setMeshPoint(e,s,i){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireObject(i);const n=r.get(this).GetWorldInfo();n.SetMeshPoint(e,s,i)&&n.SetBboxChanged()}getMeshSize(){var e=r.get(this).GetWorldInfo();return e.HasMesh()?(e=e.GetSourceMesh(),[e.GetHSize(),e.GetVSize()]):[0,0]}}}{const e=self.C3X,t=new WeakMap;self.IDOMInstance=class extends self.IWorldInstance{constructor(){super(),t.set(this,self.IInstance._GetInitInst())}getElement(){return t.get(this).GetSdkInstance()._GetElementInDOMMode()}focus(){t.get(this).GetSdkInstance().FocusElement()}blur(){t.get(this).GetSdkInstance().BlurElement()}setCssStyle(s,i){e.RequireString(s),t.get(this).GetSdkInstance().SetElementCSSStyle(s,i)}}}{const e=self.C3,t=self.C3X,s=new WeakMap,i=new WeakMap;function d(t){let s=i.get(t);return s||(s=e.New(e.Event.Dispatcher),i.set(t,s),s)}let r=null;self.IBehaviorInstance=class{constructor(){s.set(this,r);const e={runtime:{value:r.GetRuntime().GetIRuntime(),writable:!1},behavior:{value:r.GetBehavior().GetIBehavior(),writable:!1}};Object.defineProperties(this,e)}static _Init(e){r=e}static _GetInitInst(){return r}get instance(){return s.get(this).GetObjectInstance().GetInterfaceClass()}_Release(){const e=i.get(this);e&&(e.Release(),i.delete(this)),s.delete(this)}addEventListener(e,s,i){t.RequireString(e),t.RequireFunction(s),d(this).addEventListener(e,s,i)}removeEventListener(e,s,i){t.RequireString(e),t.RequireFunction(s),d(this).removeEventListener(e,s,i)}dispatchEvent(e){d(this).dispatchEvent(e)}}}{const e=new WeakMap;self.IBehavior=class{constructor(t){e.set(this,t),t={runtime:{value:t.GetRuntime().GetIRuntime(),writable:!1}},Object.defineProperties(this,t)}getAllInstances(){return e.get(this).GetInstances().map(e=>e.GetInterfaceClass())}}}{const e=self.C3,t=self.C3X,s=new WeakMap;self.IEffectInstance=class{constructor(e,t){s.set(this,e),Object.defineProperties(this,{index:{value:t,writable:!1}})}get name(){return s.get(this).GetAllEffectTypes()[this.index].GetName()}get isActive(){return s.get(this).IsEffectIndexActive(this.index)}set isActive(e){e=!!e;const t=s.get(this);t.IsEffectIndexActive(this.index)!==e&&(t.SetEffectIndexActive(this.index,e),t.UpdateActiveEffects(),t.GetRuntime().UpdateRender())}setParameter(i,r){t.RequireFiniteNumber(i),i=Math.floor(+i);const n=s.get(this);var a=n.GetEffectParametersForIndex(this.index);if(0>i||i>=a.length)throw new RangeError("invalid effect parameter index");const o=a[i];if(o instanceof e.Color){if(!Array.isArray(r)||3>r.length)throw new TypeError("expected array with 3 elements");if(i=r[0],a=r[1],r=r[2],o.equalsRgb(i,a,r))return;o.setRgb(i,a,r)}else{if("number"!=typeof r)throw new TypeError("expected number");if(o===r)return;a[i]=r}n.IsEffectIndexActive(this.index)&&n.GetRuntime().UpdateRender()}getParameter(i){t.RequireFiniteNumber(i),i=Math.floor(+i);const r=s.get(this).GetEffectParametersForIndex(this.index);if(0>i||i>=r.length)throw new RangeError("invalid effect parameter index");return i=r[i],i instanceof e.Color?[i.getR(),i.getG(),i.getB()]:i}}}{const e=self.C3,t=new Set(["local","remote"]),s=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"],["svg","image/svg+xml"],["html","text/html"]]);function c(e){return e?(e=e.split("."),2>e.length?"":(e=e.at(-1).toLowerCase(),s.get(e)||"")):""}function d(e){return new Promise((t,s)=>{const i=document.createElement("script");i.onload=t,i.onerror=s,i.async=!1,i.type="module",i.src=e,document.head.appendChild(i)})}e.AssetManager=class extends e.DefendedBase{constructor(t,s){super();var i=s.exportType;if(this._runtime=t,this._localUrlBlobs=new Map,this._localBlobUrlCache=new Map,this._localBlobSWUrls=new Map,this._isCordova="cordova"===i,this._isiOSCordova=!!s.isiOSCordova,this._isFileProtocol=!!s.isFileProtocol,this._swClientId=s.swClientId,this._supportedAudioFormats=s.supportedAudioFormats||{},this._audioFiles=new Map,this._preloadSounds=!1,this._iconsSubfolder=this._fontsSubfolder=this._mediaSubfolder="",this._defaultLoadPolicy="html5"===i||"scirra-arcade"===i||"instant-games"===i?"remote":"local",this._allAssets=[],this._assetsByUrl=new Map,this._webFonts=[],this._loadPromises=[],this._hasFinishedInitialLoad=!1,this._lastLoadProgress=this._assetSizeLoaded=this._totalAssetSizeToLoad=0,this._hasHadErrorLoading=!1,this._loadingRateLimiter=e.New(e.RateLimiter,()=>this._FireLoadingProgressEvent(),50),this._promiseThrottle=new e.PromiseThrottle(Math.max(e.hardwareConcurrency,8)),t=s.previewImageBlobs){(i=s.previewProjectFileBlobs)&&Object.assign(t,i),(i=s.projectData)&&(t["data.json"]=i);for(const[e,s]of Object.entries(t))this._localUrlBlobs.set(e.toLowerCase(),s)}if(s=s.previewProjectFileSWUrls)for(const[e,t]of Object.entries(s))this._localBlobSWUrls.set(e,t);this._iAssetManager=new self.IAssetManager(this)}Release(){this._localUrlBlobs.clear();for(const e of this._localBlobUrlCache.values())e.startsWith("blob:")&&URL.revokeObjectURL(e);this._localBlobUrlCache.clear();for(const e of this._allAssets)e.Release();e.clearArray(this._allAssets),this._assetsByUrl.clear(),e.clearArray(this._loadPromises),this._runtime=null}GetRuntime(){return this._runtime}_SetMediaSubfolder(e){this._mediaSubfolder=e}GetMediaSubfolder(){return this._mediaSubfolder}_SetFontsSubfolder(e){this._fontsSubfolder=e}GetFontsSubfolder(){return this._fontsSubfolder}_SetIconsSubfolder(e){this._iconsSubfolder=e}GetIconsSubfolder(){return this._iconsSubfolder}IsFileProtocol(){return this._isFileProtocol}_HasLocalUrlBlob(e){return this._localUrlBlobs.has(e.toLowerCase())}_GetLocalUrlBlob(e){return this._localUrlBlobs.get(e.toLowerCase())||null}GetLocalUrlAsBlobUrl(e){if(!this._HasLocalUrlBlob(e))return e;e=e.toLowerCase();var t=this._localBlobUrlCache.get(e);return t||(t=this._GetLocalUrlBlob(e),t=URL.createObjectURL(t),this._localBlobUrlCache.set(e,t)),t}FetchBlob(t,s){s=s||this._defaultLoadPolicy;const i=this._GetLocalUrlBlob(t);if(i)return Promise.resolve(i);if(e.IsRelativeURL(t)){const i=t.toLowerCase();return this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlob(i):"local"===s?this._promiseThrottle.Add(()=>e.FetchBlob(i)):e.FetchBlob(i)}return e.FetchBlob(t)}FetchArrayBuffer(t){const s=this._GetLocalUrlBlob(t);if(s)return e.BlobToArrayBuffer(s);if(e.IsRelativeURL(t)){const s=t.toLowerCase();return this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsArrayBuffer(s):"local"===this._defaultLoadPolicy?this._promiseThrottle.Add(()=>e.FetchArrayBuffer(s)):e.FetchArrayBuffer(s)}return e.FetchArrayBuffer(t)}FetchText(t){const s=this._GetLocalUrlBlob(t);if(s)return e.BlobToString(s);if(e.IsRelativeURL(t)){const s=t.toLowerCase();return this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsText(s):"local"===this._defaultLoadPolicy?this._promiseThrottle.Add(()=>e.FetchText(s)):e.FetchText(s)}return e.FetchText(t)}async FetchJson(e){return e=await this.FetchText(e),JSON.parse(e)}_CordovaFetchLocalFileAs(e,t){return this._runtime.PostComponentMessageToDOMAsync("runtime","cordova-fetch-local-file",{filename:e,as:t})}CordovaFetchLocalFileAsText(e){return this._CordovaFetchLocalFileAs(e,"text")}async CordovaFetchLocalFileAsBlob(e){const t=await this._CordovaFetchLocalFileAs(e,"buffer");return e=c(e),new Blob([t],{type:e})}async CordovaFetchLocalFileAsBlobURL(e){e=e.toLowerCase();var t=this._localBlobUrlCache.get(e);return t||(t=await this.CordovaFetchLocalFileAsBlob(e),t=URL.createObjectURL(t),this._localBlobUrlCache.set(e,t),t)}CordovaFetchLocalFileAsArrayBuffer(e){return this._CordovaFetchLocalFileAs(e,"buffer")}GetMediaFileUrl(e){return this._HasLocalUrlBlob(e)?this.GetLocalUrlAsBlobUrl(e):this._mediaSubfolder+e.toLowerCase()}GetProjectFileUrl(t,s=""){if(e.IsAbsoluteURL(t)){if(s)throw Error("cannot specify subfolder with remote URL");return Promise.resolve(t)}return this._HasLocalUrlBlob(t)?Promise.resolve(this.GetLocalUrlAsBlobUrl(t)):this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlobURL(s+t):Promise.resolve(s+t.toLowerCase())}GetProjectFileIframeUrl(t){if(e.IsAbsoluteURL(t))return Promise.resolve(t);var s=t.indexOf("?"),i=-1===s?"":t.substr(s);return s=-1===s?t:t.substr(0,s),this._HasLocalUrlBlob(s)?(t=this._localBlobSWUrls.get(s)||this.GetLocalUrlAsBlobUrl(s),!t.startsWith("blob:")&&this._swClientId&&(t=new URL(t),i=new URLSearchParams(i),i.set("__c3_client_id",this._swClientId),t.search=i.toString(),t=t.toString()),Promise.resolve(t)):this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlobURL(s):Promise.resolve(t.toLowerCase())}LoadProjectFileUrl(e){return this.GetProjectFileUrl(e)}LoadImage(s){if(s.loadPolicy&&!t.has(s.loadPolicy))throw Error("invalid load policy");let i=this._assetsByUrl.get(s.url);return i||(i=e.New(e.ImageAsset,this,{url:s.url,size:s.size||0,loadPolicy:s.loadPolicy||this._defaultLoadPolicy}),this._allAssets.push(i),this._assetsByUrl.set(i.GetURL(),i),this._hasFinishedInitialLoad||(this._totalAssetSizeToLoad+=i.GetSize(),this._loadPromises.push(i.Load().then(()=>this._AddLoadedSize(i.GetSize())))),i)}async WaitForAllToLoad(){try{await Promise.all(this._loadPromises),this._lastLoadProgress=1}catch(e){console.error("Error loading: ",e),this._hasHadErrorLoading=!0,this._FireLoadingProgressEvent()}}SetInitialLoadFinished(){this._hasFinishedInitialLoad=!0}HasHadErrorLoading(){return this._hasHadErrorLoading}_AddLoadedSize(e){this._assetSizeLoaded+=e,this._loadingRateLimiter.Call()}_FireLoadingProgressEvent(){const t=e.New(e.Event,"loadingprogress");this._lastLoadProgress=e.clamp(this._assetSizeLoaded/this._totalAssetSizeToLoad,0,1),t.progress=this._lastLoadProgress,this._runtime.Dispatcher().dispatchEvent(t)}GetLoadProgress(){return this._lastLoadProgress}_SetWebFonts(t){e.shallowAssignArray(this._webFonts,t),this._webFonts.length&&this._loadPromises.push(this._LoadWebFonts())}_LoadWebFonts(){if("undefined"==typeof FontFace)return Promise.resolve();const e=[];for(const[t,s,i]of this._webFonts)this._totalAssetSizeToLoad+=i,e.push(this._LoadWebFont(t,s).then(()=>this._AddLoadedSize(i)));return Promise.all(e)}async _LoadWebFont(e,t){try{const s=await this.GetProjectFileUrl(t,this._fontsSubfolder),i=new FontFace(e,`url('${s}')`);this._runtime.IsInWorker()?self.fonts.add(i):document.fonts.add(i),await i.load()}catch(t){console.warn(`[C3 runtime] Failed to load web font '${e}': `,t)}}IsAudioFormatSupported(e){return!!this._supportedAudioFormats[e]}_SetAudioFiles(e,t){this._preloadSounds=!!t;for(const[t,s,i]of e)this._audioFiles.set(t,{fileName:t,formats:s.map(e=>({type:e[0],fileExtension:e[1],fullName:t+e[1],fileSize:e[2]})),isMusic:i})}GetPreferredAudioFile(e){if(e=this._audioFiles.get(e.toLowerCase()),!e)return null;let t=null;for(const s of e.formats)if(t||"audio/webm; codecs=opus"!==s.type||(t=s),this.IsAudioFormatSupported(s.type))return s;return t}GetProjectAudioFileUrl(e){return(e=this.GetPreferredAudioFile(e))?{url:this.GetMediaFileUrl(e.fullName),type:e.type}:null}GetAudioToPreload(){if(this._preloadSounds){const e=[];for(const t of this._audioFiles.values()){if(t.isMusic)continue;const s=this.GetPreferredAudioFile(t.fileName);s&&e.push({originalUrl:t.fileName,url:this.GetMediaFileUrl(s.fullName),type:s.type,fileSize:s.fileSize})}return e}return[]}GetIAssetManager(){return this._iAssetManager}async LoadScripts(...t){const s=await Promise.all(t.map(e=>this.GetProjectFileUrl(e)));this._runtime.IsInWorker()?1===t.length?(t=t[0],await self.c3_import((e.IsRelativeURL(t)?"./":"")+t)):(t=t.map(t=>`import "${e.IsRelativeURL(t)?"./":""}${t}";`).join("\n"),t=URL.createObjectURL(new Blob([t],{type:"application/javascript"})),await self.c3_import(t)):await Promise.all(s.map(e=>d(e)))}async CompileWebAssembly(t){return WebAssembly.compileStreaming?(t=await this.GetProjectFileUrl(t),await WebAssembly.compileStreaming(fetch(t))):(t=await e.FetchArrayBuffer(t),await WebAssembly.compile(t))}async LoadStyleSheet(e){return e=await this.GetProjectFileUrl(e),await this._runtime.PostComponentMessageToDOMAsync("runtime","add-stylesheet",{url:e})}}}{const e=self.C3;e.Asset=class extends e.DefendedBase{constructor(e,t){super(),this._assetManager=e,this._runtime=e.GetRuntime(),this._url=t.url,this._size=t.size,this._loadPolicy=t.loadPolicy,this._blob=null,this._isLoaded=!1,this._loadPromise=null}Release(){this._blob=this._runtime=this._assetManager=this._loadPromise=null}GetURL(){return this._url}GetSize(){return this._size}Load(){return"local"===this._loadPolicy||this._blob?(this._isLoaded=!0,Promise.resolve()):this._loadPromise?this._loadPromise:this._loadPromise=this._assetManager.FetchBlob(this._url,this._loadPolicy).then(e=>(this._isLoaded=!0,this._loadPromise=null,this._blob=e)).catch(e=>console.error("Error loading resource: ",e))}IsLoaded(){return this._isLoaded}GetBlob(){return this._blob?Promise.resolve(this._blob):this._loadPromise?this._loadPromise:this._assetManager.FetchBlob(this._url,this._loadPolicy)}}}{const e=self.C3,t=new e.PromiseThrottle,s=new Set;e.ImageAsset=class extends e.Asset{constructor(e,t){super(e,t),this._webglTexture=this._texturePromise=null,this._refCount=0,this._imageHeight=this._imageWidth=-1,s.add(this)}Release(){if(this.ReleaseTexture(),0!==this._refCount)throw Error("released image asset which still has texture references");this._texturePromise=null,s.delete(this),super.Release()}static OnWebGLContextLost(){for(const e of s)e._texturePromise=null,e._webglTexture=null,e._refCount=0}LoadStaticTexture(e,s){return s=s||{},this._refCount++,this._webglTexture?Promise.resolve(this._webglTexture):this._texturePromise?this._texturePromise:(s.anisotropy=this._runtime.GetCanvasManager().GetTextureAnisotropy(),this._texturePromise=this.GetBlob().then(i=>t.Add(()=>e.CreateStaticTextureAsync(i,s).then(t=>(this._texturePromise=null,0===this._refCount?(e.DeleteTexture(t),null):(this._webglTexture=t,this._imageWidth=t.GetWidth(),this._imageHeight=t.GetHeight(),this._webglTexture))))).catch(e=>{throw console.error("Failed to load texture: ",e),e}))}ReleaseTexture(){if(0>=this._refCount)throw Error("texture released too many times");this._refCount--,0===this._refCount&&this._webglTexture&&(this._webglTexture.GetRenderer().DeleteTexture(this._webglTexture),this._webglTexture=null)}GetTexture(){return this._webglTexture}GetWidth(){return this._imageWidth}GetHeight(){return this._imageHeight}async LoadToDrawable(){const t=await this.GetBlob();return e.Supports.ImageBitmapOptions?await createImageBitmap(t,{premultiplyAlpha:"none"}):e.Supports.ImageBitmap?await createImageBitmap(t):await e.BlobToImage(t)}}}{const e=self.C3;function b(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()}e.RenderCell=class extends e.DefendedBase{constructor(e,t,s){super(),this._grid=e,this._x=t,this._y=s,this._instances=[],this._isSorted=!0,this._pendingRemoval=new Set,this._isAnyPendingRemoval=!1}Release(){e.clearArray(this._instances),this._pendingRemoval.clear(),this._grid=null}Reset(){e.clearArray(this._instances),this._isSorted=!0,this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1}SetChanged(){this._isSorted=!1}IsEmpty(){return!this._instances.length||!(this._instances.length>this._pendingRemoval.size)&&(this._FlushPending(),!0)}Insert(e){this._pendingRemoval.has(e)?(this._pendingRemoval.delete(e),0===this._pendingRemoval.size&&(this._isAnyPendingRemoval=!1)):(this._instances.push(e),this._isSorted=1===this._instances.length)}Remove(e){this._pendingRemoval.add(e),this._isAnyPendingRemoval=!0,50<=this._pendingRemoval.size&&this._FlushPending()}_FlushPending(){this._isAnyPendingRemoval&&(this._instances.length===this._pendingRemoval.size?this.Reset():(e.arrayRemoveAllInSet(this._instances,this._pendingRemoval),this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1))}_EnsureSorted(){this._isSorted||(this._instances.sort(b),this._isSorted=!0)}Dump(e){this._FlushPending(),this._EnsureSorted(),this._instances.length&&e.push(this._instances)}}}{const e=self.C3;e.RenderGrid=class extends e.DefendedBase{constructor(t,s){super(),this._cellWidth=t,this._cellHeight=s,this._cells=e.New(e.PairMap)}Release(){this._cells.Release(),this._cells=null}GetCell(t,s,i){let r=this._cells.Get(t,s);return r||(i?(r=e.New(e.RenderCell,this,t,s),this._cells.Set(t,s,r),r):null)}XToCell(e){return Math.floor(e/this._cellWidth)}YToCell(e){return Math.floor(e/this._cellHeight)}Update(e,t,s){if(t)for(let i=t.getLeft(),r=t.getRight();i<=r;++i)for(let r=t.getTop(),n=t.getBottom();r<=n;++r){if(s&&s.containsPoint(i,r))continue;const t=this.GetCell(i,r,!1);t&&(t.Remove(e),t.IsEmpty()&&this._cells.Delete(i,r))}if(s)for(let i=s.getLeft(),r=s.getRight();i<=r;++i)for(let r=s.getTop(),n=s.getBottom();r<=n;++r)t&&t.containsPoint(i,r)||this.GetCell(i,r,!0).Insert(e)}QueryRange(e,t){let s=this.XToCell(e.getLeft());const i=this.YToCell(e.getTop()),r=this.XToCell(e.getRight());for(e=this.YToCell(e.getBottom());s<=r;++s)for(let r=i;r<=e;++r){const e=this.GetCell(s,r,!1);e&&e.Dump(t)}}MarkRangeChanged(e){let t=e.getLeft();const s=e.getTop(),i=e.getRight();for(e=e.getBottom();t<=i;++t)for(let i=s;i<=e;++i){const e=this.GetCell(t,i,!1);e&&e.SetChanged()}}}}{const e=self.C3,s=new e.Rect,i=new e.Quad,r=[];new e.Rect,new e.Rect;const n=self.glMatrix,a=n.vec3,o=n.vec4,h=n.mat4,l=h.create(),c=a.create(),u=o.create(),_=a.create(),d=a.create(),p=a.create(),g=e.New(e.Vector2);function t(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()}function w(e,t){return e.GetWorldInfo().GetZElevation()-t.GetWorldInfo().GetZElevation()}e.New(e.Rect);const m=[],f=[],S=[];e.Layer=class extends e.DefendedBase{constructor(t,s,i){super(),this._layout=t,this._runtime=t.GetRuntime(),this._parentLayer=s,this._name=i[0],this._index=-1,this._sid=i[2],this._isVisible=!!i[3],this._backgroundColor=e.New(e.Color),this._backgroundColor.setFromJSON(i[4].map(e=>e/255)),this._isTransparent=!!i[5],this._parallaxX=i[6],this._parallaxY=i[7],this._color=e.New(e.Color,1,1,1,i[8]),this._premultipliedColor=e.New(e.Color),this._isForceOwnTexture=i[9],this._renderAs3d=i[17],this._useCameraDistanceDrawOrder=i[18],this._useRenderCells=i[10],this._scaleRate=i[11],this._blendMode=i[12],this._curRenderTarget=null,this._scale=1,this._zElevation=i[16],this._scrollY=this._scrollX=this._angle=0,this._hasOwnScrollPosition=!1,this._viewport=e.New(e.Rect),this._viewportZ0=e.New(e.Rect),this._viewport3D=e.New(e.Rect),this._projectionMatrix=h.create(),this._isProjectionMatrixChanged=!0,this._modelViewMatrix=h.create(),this._isMVMatrixChanged=!0,this._viewFrustum=e.New(e.Gfx.ViewFrustum),this._isViewFrustumChanged=!0,this._startupInitialInstances=[],this._initialInstancesData=i[14],this._initialInstances=[],this._createdGlobalUids=[],this._initialUIDsToInstanceData=new Map,this._instances=[],this._anyInstanceZElevated=this._zIndicesUpToDate=!1;const r=this._runtime.GetCanvasManager();this._effectList=e.New(e.EffectList,this,i[15]),this._effectChain=e.New(e.Gfx.EffectChain,r.GetEffectChainManager(),{drawContent:(e,t)=>{t=t.GetContentObject();const s=t.GetRenderTarget();e.SetColor(t.GetPremultipliedColor()),e.DrawRenderTarget(s),e.InvalidateRenderTarget(s),r.ReleaseAdditionalRenderTarget(s)},getShaderParameters:e=>this.GetEffectList().GetEffectParametersForIndex(e)}),this._wasDefaultColor=this._needsRebuildEffectChainSteps=!0,this._renderGrid=null,this._lastRenderList=[],this._isRenderListUpToDate=!1,this._lastRenderCells=e.New(e.Rect,0,0,-1,-1),this._curRenderCells=e.New(e.Rect,0,0,-1,-1),this._iLayer=new self.ILayer(this),this._UpdatePremultipliedColor(),this.UsesRenderCells()&&(this._renderGrid=e.New(e.RenderGrid,this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight())),this._subLayers=i[19].map(t=>e.New(e.Layer,this._layout,this,t))}_Init(){for(const e of this._initialInstancesData){const t=this._runtime.GetObjectClassByIndex(e[1]);this._layout._AddInitialObjectClass(t),t.GetDefaultInstanceData()||(t.SetDefaultInstanceData(e),t._SetDefaultLayerIndex(this._index)),this._initialInstances.push(e),this._initialUIDsToInstanceData.set(e[2],e)}e.shallowAssignArray(this._startupInitialInstances,this._initialInstances),this._initialInstancesData=null}Release(){this._runtime=this._layout=null}GetInitialInstanceData(e){return this._initialUIDsToInstanceData.get(e)}CreateInitialInstances(t){const s=this._layout.IsFirstVisit();let i=0;const r=this._initialInstances;for(let e=0,a=r.length;e<a;++e){var n=r[e];const a=this._runtime.GetObjectClassByIndex(n[1]);let o=!0;a.HasPersistBehavior()&&!s||(n=this._runtime.CreateInstanceFromData(n,this,!0),t.push(n),a.IsGlobal()&&(o=!1,this._createdGlobalUids.push(n.GetUID()))),o&&(r[i]=r[e],++i)}e.truncateArray(r,i),this._runtime.FlushPendingInstances(),this.SetZIndicesChanged()}_AddInstance(e,t){const s=e.GetWorldInfo();if(s.GetLayer()!==this)throw Error("instance added to wrong layer");this._instances.push(e),0!==s.GetZElevation()&&(this._anyInstanceZElevated=!0),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged(),this.SetZIndicesChanged()}_MaybeAddInstance(e){this._instances.includes(e)||(this._instances.push(e),0!==e.GetWorldInfo().GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged())}_PrependInstance(e,t){const s=e.GetWorldInfo();if(s.GetLayer()!==this)throw Error("instance added to wrong layer");this._instances.unshift(e),0!==s.GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged(),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged()}_RemoveInstance(e,t){const s=this._instances.indexOf(e);0>s||(t&&this.UsesRenderCells()&&e.GetWorldInfo()._RemoveFromRenderCells(),this._instances.splice(s,1),this.SetZIndicesChanged(),this._MaybeResetAnyInstanceZElevatedFlag())}_SetAnyInstanceZElevated(){this._anyInstanceZElevated=!0}_MaybeResetAnyInstanceZElevatedFlag(){0===this._instances.length&&(this._anyInstanceZElevated=!1)}_SortInstancesByLastCachedZIndex(e){if(e){for(var s of(e=new Set,this._instances)){var i=s.GetWorldInfo()._GetLastCachedZIndex();0<=i&&e.add(i)}s=-1;for(const t of this._instances)if(i=t.GetWorldInfo(),!(0<=i._GetLastCachedZIndex())){for(++s;e.has(s);)++s;i._SetZIndex(s)}}this._instances.sort(t)}_Start(){}_End(){for(const e of this._instances)e.GetObjectClass().IsGlobal()||this._runtime.DestroyInstance(e);this._runtime.FlushPendingInstances(),e.clearArray(this._instances),this._anyInstanceZElevated=!1,this.SetZIndicesChanged()}RecreateInitialObjects(e,t,s,i,r){const n=this._runtime.GetEventSheetManager(),a=this._runtime.GetAllObjectClasses(),o=e.IsFamily(),h=[];for(const u of this._initialInstances){var l=u[0];if(t.containsPoint(l[0],l[1])){if(l=a[u[1]],l!==e){if(!o)continue;if(!e.FamilyHasMember(l))continue}l=this;var c=this._runtime.GetCurrentLayout();this.GetLayout()!==c&&((l=c.GetLayerByName(this.GetName()))||(l=c.GetLayerByIndex(this.GetIndex()))),c=this._runtime.CreateInstanceFromData(u,l,!1,void 0,void 0,!1,r),l.SortAndAddInstancesByZIndex(c),l=c.GetWorldInfo(),l.OffsetXY(s,i),l.SetBboxChanged(),n.BlockFlushingInstances(!0),c._TriggerOnCreatedOnSelfAndRelated(),n.BlockFlushingInstances(!1),h.push(c)}}return h}GetInstanceCount(){return this._instances.length}GetLayout(){return this._layout}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}GetSID(){return this._sid}GetRuntime(){return this._runtime}GetDevicePixelRatio(){return this._runtime.GetDevicePixelRatio()}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){const e=this.HasDefaultColor();if(this._needsRebuildEffectChainSteps||e!==this._wasDefaultColor){var t=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(t.map(e=>e.GetShaderProgram()),{indexMap:t.map(e=>e.GetIndex()),forcePreDraw:!e,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasDefaultColor=e}}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}UsesRenderCells(){return this._useRenderCells&&!this._useCameraDistanceDrawOrder}GetRenderGrid(){return this._renderGrid}SetRenderListStale(){this._isRenderListUpToDate=!1}IsVisible(){for(const e of this.selfAndParentLayers())if(!e._IsVisibleFlagSet())return!1;return!0}_IsVisibleFlagSet(){return this._isVisible}SetVisible(e){e=!!e,this._isVisible!==e&&(this._isVisible=e,this._runtime.UpdateRender())}SetOwnScrollPositionEnabled(e){e=!!e,this._hasOwnScrollPosition!==e&&((this._hasOwnScrollPosition=e)&&(e=this.GetLayout(),this._scrollX=e.GetScrollX(),this._scrollY=e.GetScrollY()),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}IsOwnScrollPositionEnabled(){return this._hasOwnScrollPosition}SetScrollX(e){var t=this.GetLayout();const s=t.GetScrollLeftBound();t=t.GetScrollRightBound(),e>t&&(e=t),e<s&&(e=s),this._scrollX!==e&&(this._scrollX=e,this.IsOwnScrollPositionEnabled()&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender()))}SetScrollY(e){var t=this.GetLayout();const s=t.GetScrollTopBound();t=t.GetScrollBottomBound(),e>t&&(e=t),e<s&&(e=s),this._scrollY!==e&&(this._scrollY=e,this.IsOwnScrollPositionEnabled()&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender()))}GetScrollX(){return this.IsOwnScrollPositionEnabled()?this._scrollX:this.GetLayout().GetScrollX()}GetScrollY(){return this.IsOwnScrollPositionEnabled()?this._scrollY:this.GetLayout().GetScrollY()}GetViewport(){return this._viewport}GetViewport3D(){return this._viewport3D}_GetVanishingPoint(){const e=this.GetLayout();return[e.GetVanishingPointX(),e.GetVanishingPointY()]}GetViewportForZ(t,s){var i=this._viewportZ0;if(0===t)s.copy(i);else{let o=i.midX(),h=i.midY();var r=this.Get2DScaleFactorToZ(t);const l=i.width()/r;i=i.height()/r;const[c,u]=this._GetVanishingPoint();if(.5!==c||.5!==u){const s=this.GetCameraZ();var n=this._runtime,a=100/s;r=(c-.5)*n.GetViewportWidth()/a,n=(u-.5)*n.GetViewportHeight()/a,a=this.GetAngle(),0!==a&&(g.set(r,n),g.rotate(a),r=g.getX(),n=g.getY()),t=e.unlerp(s,0,t),o+=e.lerp(r,0,t),h+=e.lerp(n,0,t)}s.set(o-l/2,h-i/2,o+l/2,h+i/2)}}GetOpacity(){return this._color.getA()}SetOpacity(t){t=e.clamp(t,0,1),this._color.getA()!==t&&(this._color.setA(t),this._UpdatePremultipliedColor(),this._runtime.UpdateRender())}_UpdatePremultipliedColor(){this._premultipliedColor.copy(this._color),this._premultipliedColor.premultiply()}GetPremultipliedColor(){return this._premultipliedColor}HasDefaultColor(){return this._color.equalsRgba(1,1,1,1)}GetScaleRate(){return this._scaleRate}SetScaleRate(e){this._scaleRate!==e&&(this._scaleRate=e,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetParallaxX(){return this._parallaxX}GetParallaxY(){return this._parallaxY}SetParallax(e,t){if((this._parallaxX!==e||this._parallaxY!==t)&&(this._parallaxX=e,this._parallaxY=t,this._SetMVMatrixChanged(),this._runtime.UpdateRender(),1!==this._parallaxX||1!==this._parallaxY))for(const e of this._instances)e.GetObjectClass()._SetAnyInstanceParallaxed(!0)}SetParallaxX(e){this.SetParallax(e,this.GetParallaxY())}SetParallaxY(e){this.SetParallax(this.GetParallaxX(),e)}SetZElevation(e){this._zElevation!==e&&(this._zElevation=e,this._runtime.UpdateRender())}GetZElevation(){return this._zElevation}SetAngle(t){t=e.clampAngle(t),this._angle!==t&&(this._angle=t,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetAngle(){return e.clampAngle(this._layout.GetAngle()+this._angle)}GetOwnAngle(){return this._angle}HasInstances(){return 0<this._instances.length}_GetInstances(){return this._instances}_GetInstancesInDrawOrder(){return this.RendersIn3DMode()&&this._useCameraDistanceDrawOrder?(e.shallowAssignArray(S,this._GetInstances()),S.sort((e,t)=>this._SortInstancesByCameraDistance(e,t)),S):this._GetInstances()}_AppendAllInstancesIncludingSubLayersInDrawOrder(t){e.appendArray(t,this._GetInstancesInDrawOrder())
;for(const e of this._subLayers)e.IsVisible()&&0<e.GetOpacity()&&e._AppendAllInstancesIncludingSubLayersInDrawOrder(t)}_SortInstancesByCameraDistance(e,t){var s=this.GetLayout().Get3DCameraPosition(),i=s[0],r=s[1];s=s[2];var n=e.GetWorldInfo();const a=t.GetWorldInfo();return t=n.GetX()-i,e=n.GetY()-r,n=n.GetZElevation()-s,i=a.GetX()-i,r=a.GetY()-r,s=a.GetZElevation()-s,i*i+r*r+s*s-(t*t+e*e+n*n)}GetBackgroundColor(){return this._backgroundColor}IsTransparent(){return this._isTransparent}SetTransparent(e){e=!!e,this._isTransparent!==e&&(this._isTransparent=e,this._runtime.UpdateRender())}IsForceOwnTexture(){return this._isForceOwnTexture}SetForceOwnTexture(e){e=!!e,this._isForceOwnTexture!==e&&(this._isForceOwnTexture=e,this._runtime.UpdateRender())}RendersIn2DMode(){return!this.GetRuntime().Uses3DFeatures()||!this._renderAs3d}RendersIn3DMode(){return!this.RendersIn2DMode()}Has3DCamera(){return this.RendersIn3DMode()&&this.GetLayout().Is3DCameraEnabled()}SelfAndAllSubLayersHave3DCamera(){if(!this.Has3DCamera())return!1;for(const e of this._subLayers)if(!e.SelfAndAllSubLayersHave3DCamera())return!1;return!0}SetBlendMode(e){this._blendMode!==e&&(this._blendMode=e,this._runtime.UpdateRender())}GetBlendMode(){return this._blendMode}IsRootLayer(){return!this._parentLayer}GetParentLayer(){return this._parentLayer}GetSubLayers(){return this._subLayers}HasAnySubLayers(){return 0<this._subLayers.length}HasAnyVisibleSubLayer(){for(const e of this._subLayers)if(e.ShouldDraw())return!0;return!1}*selfAndAllSubLayers(){for(const e of this._subLayers)yield*e.selfAndAllSubLayers();yield this}*parentLayers(){let e=this.GetParentLayer();for(;e;)yield e,e=e.GetParentLayer()}*selfAndParentLayers(){yield this,yield*this.parentLayers()}IsTransformCompatibleWith(e){return this===e||this._parallaxX===e._parallaxX&&this._parallaxY===e._parallaxY&&this._scale===e._scale&&this._scaleRate===e._scaleRate&&this._angle===e._angle&&this.GetScrollX()===e.GetScrollX()&&this.GetScrollY()===e.GetScrollY()}SaveTransform(){return{parallaxX:this.GetParallaxX(),parallaxY:this.GetParallaxY(),scale:this.GetOwnScale(),scaleRate:this.GetScaleRate(),angle:this.GetOwnAngle(),hasOwnScroll:this.IsOwnScrollPositionEnabled(),scrollX:this.GetScrollX(),scrollY:this.GetScrollY()}}RestoreTransform(e){this.SetParallax(e.parallaxX,e.parallaxY),this.SetOwnScale(e.scale),this.SetScaleRate(e.scaleRate),this.SetAngle(e.angle),this.SetOwnScrollPositionEnabled(e.hasOwnScroll),this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY)}_RemoveAllInstancesInSet(t){0!==t.size&&0<e.arrayRemoveAllInSet(this._instances,t)&&(this._MaybeResetAnyInstanceZElevatedFlag(),this.SetZIndicesChanged())}SetZIndicesChanged(){this._isRenderListUpToDate=this._zIndicesUpToDate=!1}_UpdateZIndices(){if(!this._zIndicesUpToDate){if(this._instances.sort(w),this.UsesRenderCells())for(let e=0,t=this._instances.length;e<t;++e){const t=this._instances[e].GetWorldInfo();t._SetZIndex(e),this._renderGrid.MarkRangeChanged(t.GetRenderCellRange())}else for(let e=0,t=this._instances.length;e<t;++e)this._instances[e].GetWorldInfo()._SetZIndex(e);this._zIndicesUpToDate=!0}}MoveInstanceAdjacent(t,s,i){var r=t.GetWorldInfo();if(s=s.GetWorldInfo(),r.GetLayer()!==this||s.GetLayer()!==this)throw Error("can't arrange Z order unless both objects on this layer");return r=r.GetZIndex(),s=s.GetZIndex(),r!==s+(i?1:-1)&&(e.arrayRemove(this._instances,r),r<s&&s--,i&&s++,s===this._instances.length?this._instances.push(t):this._instances.splice(s,0,t),this.SetZIndicesChanged(),!0)}_MergeSortedZArrays(e,t){const s=[];let i=0,r=0,n=e.length,a=t.length;for(;i<n&&r<a;){const n=e[i],a=t[r];n.GetWorldInfo()._GetLastCachedZIndex()<a.GetWorldInfo()._GetLastCachedZIndex()?(s.push(n),++i):(s.push(a),++r)}for(;i<n;++i)s.push(e[i]);for(;r<a;++r)s.push(t[r]);return s}_MergeAllSortedZArrays_pass(e){const t=[],s=e.length;for(let i=0;i<s-1;i+=2)t.push(this._MergeSortedZArrays(e[i],e[i+1]));return 1==s%2&&t.push(e[s-1]),t}_MergeAllSortedZArrays(e){for(;1<e.length;)e=this._MergeAllSortedZArrays_pass(e);return e[0]}_GetRenderCellInstancesToDraw(){return this._UpdateZIndices(),e.clearArray(r),this._renderGrid.QueryRange(this._viewport,r),r.length?1===r.length?r[0]:this._MergeAllSortedZArrays(r):[]}ShouldDraw(){return this.IsVisible()&&0<this.GetOpacity()&&this._DrawsAnyContentInSelfOrSubLayers()}_DrawsAnyContentInSelfOrSubLayers(){if(this.HasInstances()||!this.IsTransparent())return!0;for(const e of this._subLayers)if(e._DrawsAnyContentInSelfOrSubLayers())return!0;return!1}UsesOwnTexture(){return this.IsForceOwnTexture()||!this.HasDefaultColor()||0!==this.GetBlendMode()||this._effectList.HasAnyActiveEffect()}SelfOrAnySubLayerUsesOwnTexture(){if(this.UsesOwnTexture())return!0;for(const e of this._subLayers)if(e.SelfOrAnySubLayerUsesOwnTexture())return!0;return!1}GetRenderTarget(){return this._curRenderTarget}Get2DScaleFactorToZ(e){if(this._layout.IsOrthographicProjection())return 1;{const t=this.GetCameraZ();return t/(t-e)}}GetCameraZ(){return 100/this.GetNormalScale()}_SetMVMatrixChanged(){this._isViewFrustumChanged=this._isMVMatrixChanged=!0}_GetModelViewMatrix(e){return this._isMVMatrixChanged&&(this._CalculateModelViewMatrix(e,this._modelViewMatrix,0,0,null),this._isMVMatrixChanged=!1),this._modelViewMatrix}GetCameraPosition(){if(this.Has3DCamera()){const e=this.GetLayout().Get3DCameraPosition();return[e[0],e[1],e[2]]}return this._Get2DCameraPosition()}_Get2DCameraPosition(e=0,t=0){var s=this._runtime,i=this.GetLayout(),r=s.GetRenderScale(),n=s.GetParallaxXOrigin(),a=s.GetParallaxYOrigin();n=(this.GetScrollX()-n)*this._parallaxX+n,a=(this.GetScrollY()-a)*this._parallaxY+a,s.IsPixelRoundingEnabled()&&(n=Math.round(n),a=Math.round(a)),e=(n+e)*r,t=(a+t)*r,i=i.IsOrthographicProjection()?100:this.GetCameraZ();const[o,h]=this._GetVanishingPoint();return.5===o&&.5===h||(n=100/i,a=(o-.5)*s.GetViewportWidth()*r/n,s=(h-.5)*s.GetViewportHeight()*r/n,r=this.GetAngle(),0!==r&&(g.set(a,s),g.rotate(r),a=g.getX(),s=g.getY()),e+=a,t+=s),[e,t,i]}_CalculateModelViewMatrix(e,t,s,i,r){const n=this._runtime;var o=this.GetLayout();const l=n.GetRenderScale();if(this.Has3DCamera()){a.copy(_,o.Get3DCameraPosition()),a.copy(d,o.Get3DCameraLookAt()),a.copy(p,o.Get3DCameraUpVector()),s=n.GetParallaxXOrigin(),i=n.GetParallaxYOrigin(),o=d[0]-_[0];const e=d[1]-_[1],t=d[2]-_[2];_[0]=(_[0]-s)*this._parallaxX+s,_[1]=(_[1]-i)*this._parallaxY+i,_[2]*=Math.max(this._parallaxX,this._parallaxY),d[0]=_[0]+o,d[1]=_[1]+e,d[2]=_[2]+t,a.set(c,l,l,1),a.multiply(_,_,c),a.multiply(d,d,c)}else{const[e,t,r]=this._Get2DCameraPosition(s,i);a.set(_,e,t,r),a.set(d,e,t,r-100),s=this.GetAngle(),0===s?a.set(p,0,1,0):a.set(p,Math.sin(s),Math.cos(s),0)}e.CalculateLookAtModelView(t,_,d,p,r||n.GetCanvasManager().GetDrawHeight()),1!==l&&(a.set(c,l,l,1),h.scale(t,t,c))}_SetProjectionMatrixChanged(){this._isViewFrustumChanged=this._isProjectionMatrixChanged=!0}_GetProjectionMatrix(e){return this._isProjectionMatrixChanged&&(this._CalculateProjectionMatrix(e),this._isProjectionMatrixChanged=!1),this._projectionMatrix}_CalculateProjectionMatrix(e){var t=this._runtime.GetCanvasManager();const[s,i]=this._GetVanishingPoint();if(this._layout.IsOrthographicProjection())e.CalculateOrthographicMatrix(this._projectionMatrix,t.GetDrawWidth(),t.GetDrawHeight());else if(.5===s&&.5===i)h.copy(this._projectionMatrix,t.GetDefaultProjectionMatrix());else{const r=t.GetDrawWidth();t=t.GetDrawHeight(),e.CalculatePerspectiveMatrix(this._projectionMatrix,r/t,s,i)}}_SetTransform(e,t=!0,s=0,i=0,r=0){t&&e.SetProjectionMatrix(this._GetProjectionMatrix(e)),0===s&&0===i&&0===r?t=this._GetModelViewMatrix(e):(this._CalculateModelViewMatrix(e,l,s,i,r),t=l),e.SetModelViewMatrix(t)}PrepareForDraw(e){this._SetTransform(e),e.SetBaseZ(this.GetZElevation())}Draw(e,t,s){var i=this._runtime.GetCanvasManager();const r=this.UsesOwnTexture();var n=null;let a=null;if(this._runtime.IsGPUProfiling())if(e.IsWebGL()){const t=i.GetLayerTimingsBuffer(this);t&&(a=t.AddTimeElapsedQuery(),e.StartQuery(a))}else e.IsWebGPU()&&e.WriteTimestamp(2*(this.GetIndex()+1));r?(n={sampling:this._runtime.GetSampling()},"low"===i.GetCurrentFullscreenScalingQuality()&&(n.width=i.GetDrawWidth(),n.height=i.GetDrawHeight()),this._curRenderTarget=n=this._runtime.GetAdditionalRenderTarget(n),e.SetRenderTarget(n),this.IsTransparent()&&e.ClearRgba(0,0,0,0)):(this._curRenderTarget=t,e.SetRenderTarget(t)),this.IsTransparent()||e.Clear(this._backgroundColor),this._layout._DrawLayerList(e,this._curRenderTarget,this._subLayers,r&&this.IsTransparent()),this._SetTransform(e),e.SetBaseZ(this.GetZElevation()),e.SetDepthEnabled(this.RendersIn3DMode()),this.GetNormalScale()>Number.EPSILON&&(this._UpdateZIndices(),i=this.UsesRenderCells()&&0===this.GetZElevation()&&!this._anyInstanceZElevated,this.Has3DCamera()?this._DrawInstances_3DCamera(e):i?this._DrawInstances_RenderCells(e):this._DrawInstances(e,this._GetInstancesInDrawOrder())),e.SetBaseZ(0),e.SetCurrentZ(0),r&&(e.SetDepthEnabled(!1),this._DrawLayerOwnTextureToRenderTarget(e,n,t,s)),a&&e.EndQuery(a),this._runtime.IsGPUProfiling()&&e.IsWebGPU()&&e.WriteTimestamp(2*(this.GetIndex()+1)+1),this._curRenderTarget=null}_DrawInstances(e,t){const s=this._viewport,i=this._curRenderTarget,r=this.GetLayout().IsOrthographicProjection(),n=this.GetLayout().HasVanishingPointOutsideViewport();let a=null;for(let o=0,h=t.length;o<h;++o){const h=t[o];if(h===a)continue;a=h;const l=h.GetWorldInfo();l.IsVisible()&&l.IsInViewport(s,n,r)&&this._DrawInstanceMaybeWithEffects(h,l,e,i)}}_DrawInstances_3DCamera(t){const s=this._curRenderTarget,i=this._GetViewFrustum(),r=this._GetInstancesInDrawOrder();for(let h=0,l=r.length;h<l;){var n=r[h],a=n.GetWorldInfo();if(!a.IsVisible()||!a.IsInViewport3D(i)){++h;continue}(!n.RendersToOwnZPlane()||0<a.GetDepth())&&f.push(n);var o=n.GetWorldInfo().GetTotalZElevation();m.push(n);let c=h+1;for(;c<l;++c){const e=r[c],t=e.GetWorldInfo();if(t.IsVisible()&&t.IsInViewport3D(i)){if(t.GetTotalZElevation()!==o)break;e.RendersToOwnZPlane()?(0<t.GetDepth()&&f.push(e),m.push(e)):f.push(e)}}if(1!==m.length||m[0].MustMitigateZFighting()){this._DrawCoplanarInstances_3DCamera(t,m);for(let e=0,i=f.length;e<i;++e)n=f[e],a=n.GetWorldInfo(),a._SetDrawNonBackFacesOnly(!0),this._DrawInstanceMaybeWithEffects(n,a,t,s),a._SetDrawNonBackFacesOnly(!1)}else{this._DrawInstanceMaybeWithEffects(n,a,t,s);for(let e=0,i=f.length;e<i;++e)a=f[e],a!==n&&(o=a.GetWorldInfo(),o.GetLayer()._DrawInstanceMaybeWithEffects(a,o,t,s))}h=c,e.clearArray(m),e.clearArray(f)}}_DrawCoplanarInstances_3DCamera(e,t){const s=this._curRenderTarget;e.CoplanarStartStencilPass();for(let s=0,n=t.length;s<n;++s){var i=t[s],r=i.GetWorldInfo();r._SetDrawBackFaceOnly(!0),this._DrawInstance(i,r,e)}e.CoplanarStartColorPass();for(let n=0,a=t.length;n<a;++n)i=t[n],r=i.GetWorldInfo(),this._DrawInstanceMaybeWithEffects(i,r,e,s),r._SetDrawBackFaceOnly(!1);e.CoplanarRestoreStandardRendering()}_DrawInstances_RenderCells(t){var s=this._renderGrid;const i=this._curRenderCells,r=this._lastRenderCells,n=this._viewport;i.set(s.XToCell(n.getLeft()),s.YToCell(n.getTop()),s.XToCell(n.getRight()),s.YToCell(n.getBottom())),this._isRenderListUpToDate&&i.equals(r)?s=this._lastRenderList:(s=this._GetRenderCellInstancesToDraw(),this._isRenderListUpToDate=!0,r.copy(i)),this._DrawInstances(t,s),s!==this._lastRenderList&&e.shallowAssignArray(this._lastRenderList,s)}_DrawInstanceMaybeWithEffects(e,t,s,i){t.HasAnyActiveEffect()?this._DrawInstanceWithEffectsAndRestore(e,t,s,i):this._DrawInstance(e,t,s)}_DrawInstance(e,t,s){t=t.GetRendererStateGroup(),s.GetCurrentStateGroup()!==t&&t.Apply(),e.Draw(s)}_DrawInstanceWithEffectsAndRestore(e,t,s,i){this._DrawInstanceWithEffects(e,t,s,i,null)&&this._SetTransform(s)}_DrawInstanceWithEffects(e,t,s,i,r){const n=t.GetInstanceEffectList().GetEffectChain();return n.Render(s,i,{contentObject:e,blendMode:t.GetBlendMode(),devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:t.GetBoundingBox(),drawSurfaceRect:n.IsFastPath()?null:this._InstanceBoxToDrawSurface(t),drawContentHook:r&&r.drawContentHook,compositOffX:r&&r.compositOffX,compositOffY:r&&r.compositOffY,updateOwnProjection:r&&r.updateOwnProjection}),s.SetBaseZ(this.GetZElevation()),n.DidChangeTransform()}_DrawLayerOwnTextureToRenderTarget(e,t,s,i){const r=this._effectList.GetActiveEffectTypes(),n=this._runtime;0===r.length?(e.SetRenderTarget(s),e.SetTextureFillMode(),i&&0===this._blendMode&&this.HasDefaultColor()?e.CopyRenderTarget(t):(e.SetBlendMode(this._blendMode),e.SetColor(this._premultipliedColor),e.DrawRenderTarget(t)),e.InvalidateRenderTarget(t),n.ReleaseAdditionalRenderTarget(t)):this.GetEffectChain().Render(e,s,{contentObject:this,blendMode:this.GetBlendMode(),devicePixelRatio:n.GetEffectDevicePixelRatioParam(),layerScale:n.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:this.GetViewport(),drawSurfaceRect:null,invalidateRenderTargets:!0})}GetOwnScale(){return this._scale}SetOwnScale(e){this._scale!==e&&(this._scale=e,this._layout.BoundScrolling(),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetRenderScale(){return this.GetNormalScale()*this._runtime.GetRenderScale()}GetDisplayScale(){return this.GetNormalScale()*this._runtime.GetDisplayScale()}GetNormalScale(){return(this._scale*this._layout.GetScale()-1)*this._scaleRate+1}UpdateViewport(){var e=this._runtime.GetParallaxXOrigin(),t=this._runtime.GetParallaxYOrigin(),r=(this.GetScrollX()-e)*this._parallaxX+e,n=(this.GetScrollY()-t)*this._parallaxY+t;e=this.GetNormalScale(),t=this._runtime.GetViewportWidth()/e,e=this._runtime.GetViewportHeight()/e,r-=t/2;let a=n-e/2;this._runtime.IsPixelRoundingEnabled()&&(r=Math.round(r),a=Math.round(a)),n=this._viewportZ0,n.set(r,a,r+t,a+e),t=this.GetAngle(),0!==t&&(s.copy(n),s.offset(-n.midX(),-n.midY()),i.setFromRotatedRect(s,t),i.getBoundingBox(s),s.offset(n.midX(),n.midY()),n.copy(s)),t=this._zElevation,this.GetViewportForZ(t,this._viewport),this.Has3DCamera()?this.CalculateViewport3D(t,this._viewport3D):this._viewport3D.copy(this._viewport)}CalculateViewport3D(e,t){var s=this._runtime.GetCanvasManager(),i=s.GetCssWidth();s=s.GetCssHeight();const[r,n]=this.CanvasCssToLayer(0,0,e),[a,o]=this.CanvasCssToLayer(i,0,e),[h,l]=this.CanvasCssToLayer(i,s,e),[c,u]=this.CanvasCssToLayer(0,s,e);e=Math.min(r,a,h,c),i=Math.min(n,o,l,u),s=Math.max(r,a,h,c);let _=Math.max(n,o,l,u);isFinite(e)||(e=-1/0),isFinite(i)||(i=-1/0),isFinite(s)||(s=1/0),isFinite(_)||(_=1/0),t.set(e,i,s,_)}CanvasCssToLayer(e,t,s=0){return this._CanvasToLayer(e,t,s,this.GetDisplayScale())}DrawSurfaceToLayer(e,t,s=0){return this._CanvasToLayer(e,t,s,this.GetRenderScale()*this.GetDevicePixelRatio())}_CanvasToLayer(t,s,i,r){var n=this._runtime,a=n.GetRenderer();const h=this.GetNormalScale(),l=n.GetViewportWidth()/h;return n=n.GetViewportHeight()/h,o.set(u,0,0,l,n),t/=r,s=u[3]-s/r,r=this._GetProjectionMatrix(a),a=this._GetModelViewMatrix(a),e.Gfx.UnprojectScreenToWorldZ(t,s,i,a,r,u,c)?[c[0],c[1]]:[NaN,NaN]}CanvasCssToLayer_DefaultTransform(e,t){const s=this._scale,i=this._scaleRate,r=this._parallaxX,n=this._parallaxY,a=this._angle;return this._parallaxY=this._parallaxX=this._scaleRate=this._scale=1,this._angle=0,this._SetMVMatrixChanged(),e=this.CanvasCssToLayer(e,t),this._scale=s,this._scaleRate=i,this._parallaxX=r,this._parallaxY=n,this._angle=a,this._SetMVMatrixChanged(),e}LayerToCanvasCss(e,t,s=0){return this._LayerToCanvas(e,t,s,this.GetDisplayScale())}LayerToDrawSurface(e,t,s=0){return this._LayerToCanvas(e,t,s,this.GetRenderScale()*this.GetDevicePixelRatio())}_LayerToCanvas(t,s,i,r){var n=this._runtime,a=n.GetRenderer();const h=this.GetNormalScale();var l=n.GetViewportWidth()/h;return n=n.GetViewportHeight()/h,o.set(u,0,0,l,n),l=this._GetProjectionMatrix(a),a=this._GetModelViewMatrix(a),e.Gfx.Project(t,s,i,a,l,u,c)?[c[0]*r,(u[3]-c[1])*r]:[NaN,NaN]}_GetLayerToDrawSurfaceScale(e,t){return e*=this.GetRenderScale()*this.GetDevicePixelRatio(),0!==t&&(e*=this.Get2DScaleFactorToZ(t)),e}_InstanceBoxToDrawSurface(e){var t=e.GetBoundingBox(),i=e.GetTotalZElevation();e=e.GetDepth();const r=i+e,n=t.getLeft(),a=t.getTop(),o=t.getRight();if(t=t.getBottom(),this.Has3DCamera()){if(this._IsPointBehindNearPlane(n,a,i)||this._IsPointBehindNearPlane(o,a,i)||this._IsPointBehindNearPlane(o,t,i)||this._IsPointBehindNearPlane(n,t,i)||0<e&&(this._IsPointBehindNearPlane(n,a,r)||this._IsPointBehindNearPlane(o,a,r)||this._IsPointBehindNearPlane(o,t,r)||this._IsPointBehindNearPlane(n,t,r)))return null}else if(r>=this.GetCameraZ())return null;let[h,l]=this.LayerToDrawSurface(n,a,i),[c,u]=this.LayerToDrawSurface(o,t,i);if(0!==this.GetAngle()||0<e){const[s,_]=this.LayerToDrawSurface(o,a,i),[d,p]=this.LayerToDrawSurface(n,t,i);if(0<e){const[e,g]=this.LayerToDrawSurface(n,a,r),[m,f]=this.LayerToDrawSurface(o,a,r),[S,y]=this.LayerToDrawSurface(o,t,r),[G,T]=this.LayerToDrawSurface(n,t,r);i=Math.min(h,c,s,d,e,m,S,G),c=Math.max(h,c,s,d,e,m,S,G),h=i,i=Math.min(l,u,_,p,g,f,y,T),u=Math.max(l,u,_,p,g,f,y,T),l=i}else i=Math.min(h,c,s,d),c=Math.max(h,c,s,d),h=i,i=Math.min(l,u,_,p),u=Math.max(l,u,_,p),l=i}return s.set(h,l,c,u),s}_GetViewFrustum(){return this._isViewFrustumChanged&&(this._UpdateViewFrustum(),this._isViewFrustumChanged=!1),this._viewFrustum}_UpdateViewFrustum(){var e=this._runtime.GetRenderer();const t=this._GetProjectionMatrix(e);e=this._GetModelViewMatrix(e),this._viewFrustum.CalculatePlanes(e,t)}_IsPointBehindNearPlane(e,t,s){return this._GetViewFrustum().IsBehindNearPlane(e,t,s)}_SaveToJson(){return{s:this.GetOwnScale(),a:this.GetOwnAngle(),vl:this._viewport.getLeft(),vt:this._viewport.getTop(),vr:this._viewport.getRight(),vb:this._viewport.getBottom(),v:this._IsVisibleFlagSet(),bc:this._backgroundColor.toJSON(),t:this.IsTransparent(),sx:this._scrollX,sy:this._scrollY,hosp:this._hasOwnScrollPosition,px:this.GetParallaxX(),py:this.GetParallaxY(),c:this._color.toJSON(),sr:this.GetScaleRate(),fx:this._effectList.SaveToJson(),cg:this._createdGlobalUids}}_LoadFromJson(t){this._scale=t.s,this._angle=t.a,this._viewport.set(t.vl,t.vt,t.vr,t.vb),this._isVisible=!!t.v,this._backgroundColor.setFromJSON(t.bc),this._isTransparent=!!t.t,t.hasOwnProperty("sx")&&(this._scrollX=t.sx),t.hasOwnProperty("sy")&&(this._scrollY=t.sy),t.hasOwnProperty("hosp")&&(this._hasOwnScrollPosition=!!t.hosp),this._parallaxX=t.px,this._parallaxY=t.py,this._color.setFromJSON(t.c),this._scaleRate=t.sr,e.shallowAssignArray(this._createdGlobalUids,t.cg),e.shallowAssignArray(this._initialInstances,this._startupInitialInstances);const s=new Set(this._createdGlobalUids);let i=0;for(let e=0,t=this._initialInstances.length;e<t;++e)s.has(this._initialInstances[e][2])||(this._initialInstances[i]=this._initialInstances[e],++i);e.truncateArray(this._initialInstances,i),this._effectList.LoadFromJson(t.fx),this._needsRebuildEffectChainSteps=!0,this._SortInstancesByLastCachedZIndex(!1),this.SetZIndicesChanged()}GetILayer(){return this._iLayer}SortAndAddInstancesByZIndex(e){if(!this._instances.includes(e))if(e.HasChildren()){var t=[...e.allChildren()];for(var s of(t.push(e),t.sort((e,t)=>(e=e.GetWorldInfo().GetSceneGraphZIndex(),t=t.GetWorldInfo().GetSceneGraphZIndex(),e-t)),t))if(s.IsInContainer())for(const i of s.siblings())t.includes(i)||(e=[...i.allChildren()],e.push(i),e.sort((e,t)=>(e=e.GetWorldInfo().GetSceneGraphZIndex(),t=t.GetWorldInfo().GetSceneGraphZIndex(),e-t)),e&&e.length&&t.splice(t.length,0,...e));for(const e of t)this._AddInstance(e,!0)}else if(this._AddInstance(e,!0),e.IsInContainer())for(t of e.siblings())if(s=[...t.allChildren()],s.push(t),s.sort((e,t)=>(e=e.GetWorldInfo().GetSceneGraphZIndex(),t=t.GetWorldInfo().GetSceneGraphZIndex(),e-t)),s&&s.length)for(const e of s)this._AddInstance(e,!0)}}}{const e=self.C3,t=self.C3Debugger;e.New(e.Rect),e.New(e.Rect);const s=e.New(e.Rect),i=e.New(e.Color),r=self.glMatrix.vec3,n=[],a=[],o=[],h=[];function m(e,t,s,i){return e[0]===Math.fround(t)&&e[1]===Math.fround(s)&&e[2]===Math.fround(i)}let l=null;function v(e,t){l!==e&&(e.PrepareForDraw(t),l=e)}e.Layout=class extends e.DefendedBase{constructor(t,s,i){super(),this._layoutManager=t,this._runtime=t.GetRuntime(),this._name=i[0],this._originalWidth=i[1],this._originalHeight=i[2],this._width=i[1],this._height=i[2],this._isUnboundedScrolling=!!i[3],this._isOrthographicProjection=!!i[4],this._vanishingPointX=i[5],this._vanishingPointY=i[6],this._eventSheetName=i[7],this._eventSheet=null,this._sid=i[8],this._index=s,this._scrollY=this._scrollX=0,this._scale=1,this._angle=0,this._initialObjectClasses=new Set,this._textureLoadedTypes=new Set,this._textureLoadPendingPromises=new Set,this._createdInstances=[],this._initialNonWorld=[],this._is3dCameraEnabled=!1,this._cam3dposition=r.create(),this._cam3dlook=r.create(),this._cam3dup=r.create(),this._rootLayers=[],this._allLayersFlat=[],this._layersByName=new Map,this._layersBySid=new Map;const n=this._runtime.GetCanvasManager();this._effectList=e.New(e.EffectList,this,i[11]),this._effectChain=e.New(e.Gfx.EffectChain,n.GetEffectChainManager(),{drawContent:(e,t)=>{t=t.GetContentObject().GetRenderTarget(),e.ResetColor(),e.DrawRenderTarget(t),e.InvalidateRenderTarget(t),n.ReleaseAdditionalRenderTarget(t)},getShaderParameters:e=>this.GetEffectList().GetEffectParametersForIndex(e)}),this._needsRebuildEffectChainSteps=!0,this._wasFullScreenQualityLow=!1,this._curRenderTarget=null,this._persistData={},this._isFirstVisit=!0,this._iLayout=new self.ILayout(this),this._userScriptDispatcher=e.New(e.Event.Dispatcher);for(const t of i[9])this._rootLayers.push(e.New(e.Layer,this,null,t));this._allLayersFlat=[...this.allLayers()];for(let e=0,s=this._allLayersFlat.length;e<s;++e)t=this._allLayersFlat[e],t._SetIndex(e),t._Init(),this._layersByName.set(t.GetName().toLowerCase(),t),this._layersBySid.set(t.GetSID(),t);for(const e of i[10]){if(i=this._runtime.GetObjectClassByIndex(e[1]),!i)throw Error("missing nonworld object class");i.GetDefaultInstanceData()||i.SetDefaultInstanceData(e),this._initialNonWorld.push(e),this._AddInitialObjectClass(i)}}Release(){for(const e of this._allLayersFlat)e.Release();e.clearArray(this._allLayersFlat),this._textureLoadPendingPromises.clear(),this._runtime=this._layoutManager=this._eventSheet=null}GetRuntime(){return this._runtime}GetName(){return this._name}GetSID(){return this._sid}GetIndex(){return this._index}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){const e="low"===this._runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality();if(this._needsRebuildEffectChainSteps||this._wasFullScreenQualityLow!==e){var t=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(t.map(e=>e.GetShaderProgram()),{indexMap:t.map(e=>e.GetIndex()),forcePostDraw:e,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasFullScreenQualityLow=e}}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}GetMinLayerScale(){let e=this._allLayersFlat[0].GetNormalScale();for(let t=1,s=this._allLayersFlat.length;t<s;++t){const s=this._allLayersFlat[t];0===s.GetParallaxX()&&0===s.GetParallaxY()||(e=Math.min(e,s.GetNormalScale()))}return e}_GetScrollBoundMarginHorizontal(){return.5*this._runtime.GetViewportWidth()/this.GetMinLayerScale()}_GetScrollBoundMarginVertical(){return.5*this._runtime.GetViewportHeight()/this.GetMinLayerScale()}GetScrollLeftBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginHorizontal()}GetScrollRightBound(){return this.IsUnboundedScrolling()?1/0:this.GetWidth()-this._GetScrollBoundMarginHorizontal()}GetScrollTopBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginVertical()}GetScrollBottomBound(){return this.IsUnboundedScrolling()?1/0:this.GetHeight()-this._GetScrollBoundMarginVertical()}SetScrollX(e){const t=this.GetScrollLeftBound(),s=this.GetScrollRightBound();e>s&&(e=s),e<t&&(e=t),this._scrollX!==e&&(this._scrollX=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollX(){return this._scrollX}SetScrollY(e){const t=this.GetScrollTopBound(),s=this.GetScrollBottomBound();e>s&&(e=s),e<t&&(e=t),this._scrollY!==e&&(this._scrollY=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollY(){return this._scrollY}IsUnboundedScrolling(){return this._isUnboundedScrolling}BoundScrolling(){this.SetScrollX(this.GetScrollX()),this.SetScrollY(this.GetScrollY());for(const e of this._allLayersFlat)e.IsOwnScrollPositionEnabled()&&(e.SetScrollX(e.GetScrollX()),e.SetScrollY(e.GetScrollY()))}SetVanishingPointXY(e,t){this._vanishingPointX===e&&this._vanishingPointY===t||(this._vanishingPointX=e,this._vanishingPointY=t,this.IsPerspectiveProjection()&&(this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender()))}GetVanishingPointX(){return this.IsOrthographicProjection()?.5:this._vanishingPointX}GetVanishingPointY(){return this.IsOrthographicProjection()?.5:this._vanishingPointY}HasVanishingPointOutsideViewport(){const e=this.GetVanishingPointX(),t=this.GetVanishingPointY();return 0>e||1<e||0>t||1<t}SetPerspectiveProjection(){this._isOrthographicProjection&&(this._isOrthographicProjection=!1,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}SetOrthographicProjection(){this._isOrthographicProjection||(this._isOrthographicProjection=!0,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}IsOrthographicProjection(){return this._isOrthographicProjection}IsPerspectiveProjection(){return!this.IsOrthographicProjection()}Set3DCameraEnabled(e){e=!!e,this._is3dCameraEnabled!==e&&(this._is3dCameraEnabled=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}Is3DCameraEnabled(){return this._is3dCameraEnabled}Set3DCameraOrientation(e,t,s,i,n,a,o,h,l){m(this._cam3dposition,e,t,s)&&m(this._cam3dlook,i,n,a)&&m(this._cam3dup,o,h,l)||(r.set(this._cam3dposition,e,t,s),r.set(this._cam3dlook,i,n,a),r.set(this._cam3dup,o,h,l),this.Set3DCameraChanged())}Set3DCameraChanged(){this._SetAllLayersMVChanged(),this._runtime.UpdateRender()}Get3DCameraPosition(){return this._cam3dposition}Get3DCameraLookAt(){return this._cam3dlook}Get3DCameraUpVector(){return this._cam3dup}GetScale(){return this._scale}SetScale(e){this._scale!==e&&(this._scale=e,this._SetAllLayersMVChanged(),this.BoundScrolling(),this._runtime.UpdateRender())}SetAngle(t){t=e.clampAngle(t),this._angle!==t&&(this._angle=t,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetAngle(){return this._angle}GetWidth(){return this._width}SetWidth(e){!isFinite(e)||1>e||(this._width=e)}GetHeight(){return this._height}SetHeight(e){!isFinite(e)||1>e||(this._height=e)}GetEventSheet(){return this._eventSheet}*allLayers(){for(const e of this._rootLayers)yield*e.selfAndAllSubLayers()}GetLayers(){return this._allLayersFlat}GetLayerCount(){return this._allLayersFlat.length}GetLayer(e){return"number"==typeof e?this.GetLayerByIndex(e):this.GetLayerByName(e.toString())}GetLayerByIndex(t){return t=e.clamp(Math.floor(t),0,this._allLayersFlat.length-1),this._allLayersFlat[t]}GetLayerByName(e){return this._layersByName.get(e.toLowerCase())||null}GetLayerBySID(e){return this._layersBySid.get(e)||null}_SetAllLayersProjectionChanged(){for(const e of this._allLayersFlat)e._SetProjectionMatrixChanged()}_SetAllLayersMVChanged(){for(const e of this._allLayersFlat)e._SetMVMatrixChanged()}SaveTransform(){return{scrollX:this.GetScrollX(),scrollY:this.GetScrollY(),scale:this.GetScale(),angle:this.GetAngle(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY()}}RestoreTransform(e){this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this.SetScale(e.scale),this.SetAngle(e.angle),this.SetVanishingPointXY(e.vpX,e.vpY)}GetLayoutBackgroundColor(){let e=this._rootLayers.filter(e=>e.ShouldDraw())[0];for(;e;){if(!e.IsTransparent())return i.copyRgb(e.GetBackgroundColor()),i.setA(1),i;if(e.UsesOwnTexture())return i.setRgba(0,0,0,0),i;e=e.GetSubLayers().filter(e=>e.ShouldDraw())[0]}return i.setRgba(0,0,0,0),i}IsFirstVisit(){return this._isFirstVisit}_GetInitialObjectClasses(){return[...this._initialObjectClasses]}_AddInitialObjectClass(e){if(e.IsInContainer())for(const t of e.GetContainer().GetObjectTypes())this._initialObjectClasses.add(t);else this._initialObjectClasses.add(e)}_GetTextureLoadedObjectTypes(){return[...this._textureLoadedTypes]}_Load(t,s){if(t===this||!s)return Promise.resolve();t&&(e.CopySet(this._textureLoadedTypes,t._textureLoadedTypes),t._textureLoadedTypes.clear()),t=[];for(const e of this._initialObjectClasses)this._textureLoadedTypes.has(e)||(t.push(e.LoadTextures(s)),this._textureLoadedTypes.add(e));return Promise.all(t)}async MaybeLoadTexturesFor(e){if(e.IsFamily())throw Error("cannot load textures for family");var t=this._runtime.GetRenderer();!t||t.IsContextLost()||this._textureLoadedTypes.has(e)||(this._textureLoadedTypes.add(e),t=e.LoadTextures(t),this._AddPendingTextureLoadPromise(t),await t,e.OnDynamicTextureLoadComplete(),this._runtime.UpdateRender())}_AddPendingTextureLoadPromise(e){this._textureLoadPendingPromises.add(e),e.then(()=>this._textureLoadPendingPromises.delete(e)).catch(()=>this._textureLoadPendingPromises.delete(e))}WaitForPendingTextureLoadsToComplete(){return Promise.all([...this._textureLoadPendingPromises])}MaybeUnloadTexturesFor(e){if(e.IsFamily()||0<e.GetInstanceCount())throw Error("cannot unload textures");const t=this._runtime.GetRenderer();t&&this._textureLoadedTypes.has(e)&&(this._textureLoadedTypes.delete(e),e.ReleaseTextures(t))}_Unload(e,t){if(e!==this&&t)for(const t of this._textureLoadedTypes)t.IsGlobal()||e._initialObjectClasses.has(t)||(t.ReleaseTextures(),this._textureLoadedTypes.delete(t))}_OnWebGLContextLost(){this._textureLoadedTypes.clear()}async _StartRunning(t){const s=this._runtime,i=this._layoutManager,r=s.GetEventSheetManager();this._eventSheetName&&(this._eventSheet=r.GetEventSheetByName(this._eventSheetName),this._eventSheet._UpdateDeepIncludes()),i._SetMainRunningLayout(this),this._width=this._originalWidth,this._height=this._originalHeight,this._scrollX=s.GetOriginalViewportWidth()/2,this._scrollY=s.GetOriginalViewportHeight()/2,this.BoundScrolling(),this._MoveGlobalObjectsToThisLayout(t),this._runtime.SetUsingCreatePromises(!0),this._CreateInitialInstances(),this._isFirstVisit||this._CreatePersistedInstances(),this._CreateAndLinkContainerInstances(this._createdInstances),this._CreateInitialNonWorldInstances(),i.ClearPendingChangeLayout(),s.FlushPendingInstances(),this._runtime.SetUsingCreatePromises(!1);const n=this._runtime.GetCreatePromises();if(await Promise.all(n),e.clearArray(n),!s.IsLoadingState()){for(const e of this._createdInstances)e.SetupInitialSceneGraphConnections();for(const e of this._createdInstances)e._TriggerOnCreated()}e.clearArray(this._createdInstances),await Promise.all([...this._initialObjectClasses].map(e=>e.PreloadTexturesWithInstances(this._runtime.GetRenderer()))),t&&(s.Dispatcher().dispatchEvent(new e.Event("beforefirstlayoutstart")),await s.DispatchUserScriptEventAsyncWait(new e.Event("beforeprojectstart"))),await this.DispatchUserScriptEventAsyncWait(new e.Event("beforelayoutstart")),s.IsLoadingState()||await s.TriggerAsync(e.Plugins.System.Cnds.OnLayoutStart,null,null),await this.DispatchUserScriptEventAsyncWait(new e.Event("afterlayoutstart")),t&&(s.Dispatcher().dispatchEvent(new e.Event("afterfirstlayoutstart")),await s.DispatchUserScriptEventAsyncWait(new e.Event("afterprojectstart"))),r._RunQueuedTriggers(i),await this.WaitForPendingTextureLoadsToComplete(),this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._isFirstVisit=!1}_MoveGlobalObjectsToThisLayout(t){for(const t of this._runtime.GetAllObjectClasses())if(!t.IsFamily()&&t.IsWorldType())for(const i of t.GetInstances()){
const t=i.GetWorldInfo();var s=t.GetLayer();s=e.clamp(s.GetIndex(),0,this._allLayersFlat.length-1),s=this._allLayersFlat[s],t._SetLayer(s),s._MaybeAddInstance(i)}if(!t)for(const e of this._allLayersFlat)e._SortInstancesByLastCachedZIndex(!1)}_CreateInitialInstances(){for(const e of this._allLayersFlat)e.CreateInitialInstances(this._createdInstances),e.UpdateViewport(),e._Start()}_CreatePersistedInstances(){let t=!1;for(const[i,r]of Object.entries(this._persistData)){const n=this._runtime.GetObjectClassBySID(parseInt(i,10));if(n&&!n.IsFamily()&&n.HasPersistBehavior()){for(const e of r){var s=null;n.IsWorldType()&&(s=this.GetLayerBySID(e.w.l),!s)||(s=this._runtime.CreateInstanceFromData(n,s,!1,0,0,!0),s.LoadFromJson(e),t=!0,this._createdInstances.push(s))}e.clearArray(r)}}for(const e of this._allLayersFlat)e._SortInstancesByLastCachedZIndex(!0),e.SetZIndicesChanged();t&&(this._runtime.FlushPendingInstances(),this._runtime._RefreshUidMap())}_CreateAndLinkContainerInstances(e){for(const s of e){if(!s.IsInContainer())continue;const i=s.GetWorldInfo(),r=s.GetIID();for(const n of s.GetObjectClass().GetContainer().objectTypes())if(n!==s.GetObjectClass()){var t=n.GetInstances();t.length>r?s._AddSibling(t[r]):(t=i?this._runtime.CreateInstanceFromData(n,i.GetLayer(),!0,i.GetX(),i.GetY(),!0):this._runtime.CreateInstanceFromData(n,null,!0,0,0,!0),this._runtime.FlushPendingInstances(),n._UpdateIIDs(),s._AddSibling(t),e.push(t))}}}_CreateInitialNonWorldInstances(){for(const e of this._initialNonWorld)this._runtime.GetObjectClassByIndex(e[1]).IsInContainer()||this._runtime.CreateInstanceFromData(e,null,!0)}_CreateGlobalNonWorlds(){const t=[],s=this._initialNonWorld;let i=0;for(let e=0,r=s.length;e<r;++e){const r=s[e],n=this._runtime.GetObjectClassByIndex(r[1]);n.IsGlobal()?n.IsInContainer()&&n.GetContainer().HasAnyWorldType()||t.push(this._runtime.CreateInstanceFromData(r,null,!0)):(s[i]=r,++i)}e.truncateArray(s,i),this._runtime.FlushPendingInstances(),this._CreateAndLinkContainerInstances(t)}RecreateInitialObjects(e,t,s,i,r,n){if(s)return s.RecreateInitialObjects(e,t,i,r,n);s=[];for(const a of this._allLayersFlat)s.push(a.RecreateInitialObjects(e,t,i,r,n));return s.flat()}async _StopRunning(){const t=this._layoutManager;this._runtime.IsLoadingState()||await this._runtime.TriggerAsync(e.Plugins.System.Cnds.OnLayoutEnd,null,null),t.SetIsEndingLayout(!0),this._runtime.GetEventSheetManager().ClearAllScheduledWaits(),this._isFirstVisit||this._SavePersistData();for(const e of this._allLayersFlat)e._End();for(const e of this._runtime.GetAllObjectClasses())if(!(e.IsGlobal()||e.IsWorldType()||e.GetPlugin().IsSingleGlobal()||e.IsFamily())){for(const t of e.GetInstances())this._runtime.DestroyInstance(t);this._runtime.FlushPendingInstances()}t.SetIsEndingLayout(!1),t.GetMainRunningLayout()===this&&t._SetMainRunningLayout(null)}_SaveInstanceToPersist(e){const t=e.GetObjectClass().GetSID().toString();this._persistData.hasOwnProperty(t)||(this._persistData[t]=[]),this._persistData[t].push(e.SaveToJson())}_SavePersistData(){for(const e of this._allLayersFlat){e._UpdateZIndices();for(const t of e._GetInstances()){const e=t.GetObjectClass();!e.IsGlobal()&&e.HasPersistBehavior()&&this._SaveInstanceToPersist(t)}}}ResetPersistData(){this._persistData={},this._isFirstVisit=!0}GetRenderTarget(){return this._curRenderTarget}UsesOwnTexture(){const e=this._runtime,t=e.GetRenderer().IsWebGL();return"low"===e.GetCanvasManager().GetCurrentFullscreenScalingQuality()||t&&e.UsesAnyBackgroundBlending()||"low-latency"===e.GetCompositingMode()||this._effectList.HasAnyActiveEffect()||t&&e.Uses3DFeatures()}Draw(e){const t=this._runtime.GetCanvasManager(),s=this.UsesOwnTexture();if(s){"low-latency"!==this._runtime.GetCompositingMode()&&(e.SetRenderTarget(null),e.ClearRgba(0,0,0,0));const s={sampling:this._runtime.GetSampling(),isSampled:e.IsWebGPU()||this._runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect()};"low"===t.GetCurrentFullscreenScalingQuality()&&(s.width=t.GetDrawWidth(),s.height=t.GetDrawHeight()),this._curRenderTarget=this._runtime.GetAdditionalRenderTarget(s)}else this._curRenderTarget=null;e.SetRenderTarget(this._curRenderTarget),e.Clear(this.GetLayoutBackgroundColor()),this._runtime.Uses3DFeatures()&&e.ClearDepth();for(const e of this._allLayersFlat)e.UpdateViewport();this._DrawLayerList(e,this._curRenderTarget,this._rootLayers,!0),s&&(e.SetDepthEnabled(!1),this._DrawLayoutOwnTextureToRenderTarget(e,this._curRenderTarget)),this._curRenderTarget=null}_DrawLayerList(t,s,i,r){i=i.filter(e=>e.ShouldDraw());for(let a=0,o=i.length;a<o;){const h=i[a];if(h.SelfAndAllSubLayersHave3DCamera()&&!h.SelfOrAnySubLayerUsesOwnTexture()){n.push(h);for(let e=a+1;e<o;++e){const t=i[e];if(!t.SelfAndAllSubLayersHave3DCamera()||t.SelfOrAnySubLayerUsesOwnTexture())break;n.push(i[e])}if(2<=n.length||1===n.length&&n[0].HasAnyVisibleSubLayer()){this._Draw3DLayers(t,s,n),a+=n.length,e.clearArray(n);continue}e.clearArray(n)}h.Draw(t,s,r&&0===a),++a}}_DrawLayoutOwnTextureToRenderTarget(e,t){const i=this._effectList.GetActiveEffectTypes(),r=this._runtime;0===i.length?(e.SetRenderTarget(null),e.SetTextureFillMode(),e.CopyRenderTarget(t),e.InvalidateRenderTarget(t),r.ReleaseAdditionalRenderTarget(t)):(s.set(0,0,r.GetViewportWidth(),r.GetViewportHeight()),this.GetEffectChain().Render(e,null,{contentObject:this,blendMode:3,devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetScale(),layerAngle:this.GetAngle(),layoutRect:s,drawSurfaceRect:null,invalidateRenderTargets:!0}))}_Draw3DLayers(t,s,r){r[0].IsTransparent()||(i.copyRgb(r[0].GetBackgroundColor()),i.setA(1),t.Clear(i));var n=this._runtime.GetCanvasManager();for(var c of(t.SetDepthEnabled(!0),r))c._UpdateZIndices(),c._AppendAllInstancesIncludingSubLayersInDrawOrder(a);r=r[0],c=null,this._runtime.IsGPUProfiling()&&(t.IsWebGL()?(n=n.GetLayerTimingsBuffer(r))&&(c=n.AddTimeElapsedQuery(),t.StartQuery(c)):t.IsWebGPU()&&t.WriteTimestamp(2*(r.GetIndex()+1)));for(let i=0,r=a.length;i<r;){var u=a[i],_=u.GetWorldInfo(),d=_.GetLayer();if(_.IsVisible()&&_.IsInViewport3D(d._GetViewFrustum())){(!u.RendersToOwnZPlane()||0<_.GetDepth())&&h.push(u);var p=u.GetWorldInfo().GetTotalZElevation();for(o.push(u),n=i+1;n<r;++n){const e=a[n],t=e.GetWorldInfo();if(t.IsVisible()&&t.IsInViewport3D(t.GetLayer()._GetViewFrustum())){if(t.GetTotalZElevation()!==p)break;e.RendersToOwnZPlane()?(0<t.GetDepth()&&h.push(e),o.push(e)):h.push(e)}}if(1!==o.length||o[0].MustMitigateZFighting()){this._Draw3DLayersCoplanarInstances(t,s,o);for(let e=0,i=h.length;e<i;++e)u=h[e],_=u.GetWorldInfo(),d=_.GetLayer(),_._SetDrawNonBackFacesOnly(!0),v(d,t),d._DrawInstanceMaybeWithEffects(u,_,t,s),_._SetDrawNonBackFacesOnly(!1)}else{v(d,t),d._DrawInstanceMaybeWithEffects(u,_,t,s);for(let e=0,i=h.length;e<i;++e)_=h[e],_!==u&&(d=_.GetWorldInfo(),p=d.GetLayer(),v(p,t),p._DrawInstanceMaybeWithEffects(_,d,t,s))}i=n,e.clearArray(o),e.clearArray(h)}else++i}c&&t.EndQuery(c),this._runtime.IsGPUProfiling()&&t.IsWebGPU()&&t.WriteTimestamp(2*(r.GetIndex()+1)+1),e.clearArray(a),l=null}_Draw3DLayersCoplanarInstances(e,t,s){e.CoplanarStartStencilPass();for(let t=0,a=s.length;t<a;++t){var i=s[t],r=i.GetWorldInfo(),n=r.GetLayer();r._SetDrawBackFaceOnly(!0),v(n,e),n._DrawInstance(i,r,e)}e.CoplanarStartColorPass();for(let a=0,o=s.length;a<o;++a)i=s[a],r=i.GetWorldInfo(),n=r.GetLayer(),v(n,e),n._DrawInstanceMaybeWithEffects(i,r,e,t),r._SetDrawBackFaceOnly(!1);e.CoplanarRestoreStandardRendering()}_SaveToJson(){const e={sx:this.GetScrollX(),sy:this.GetScrollY(),s:this.GetScale(),a:this.GetAngle(),w:this.GetWidth(),h:this.GetHeight(),ortho:this.IsOrthographicProjection(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY(),fv:this._isFirstVisit,persist:this._persistData,fx:this._effectList.SaveToJson(),layers:{}};for(const t of this._allLayersFlat)e.layers[t.GetSID().toString()]=t._SaveToJson();return e}_LoadFromJson(e){this._scrollX=e.sx,this._scrollY=e.sy,this._scale=e.s,this._angle=e.a,this._width=e.w,this._height=e.h,this._isOrthographicProjection=!!e.ortho,e.hasOwnProperty("vpX")&&(this._vanishingPointX=e.vpX),e.hasOwnProperty("vpY")&&(this._vanishingPointY=e.vpY),this._isFirstVisit=!!e.fv,this._persistData=e.persist,this._effectList.LoadFromJson(e.fx),this._needsRebuildEffectChainSteps=!0;for(const[t,s]of Object.entries(e.layers))e=parseInt(t,10),(e=this.GetLayerBySID(e))&&e._LoadFromJson(s);this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged()}GetILayout(){return this._iLayout}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.layout=this.GetILayout();var s=this._runtime;(s=s.IsDebug()&&!s.GetEventSheetManager().IsInEventEngine())&&t.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),s&&t.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.layout=this.GetILayout(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}}}{const e=self.C3;e.LayoutManager=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._allLayouts=[],this._layoutsByName=new Map,this._layoutsBySid=new Map,this._mainRunningLayout=null,this._runningSubLayouts=[],this._firstLayout=null,this._isEndingLayout=0,this._pendingChangeLayout=null}Release(){this._pendingChangeLayout=this._firstLayout=this._mainRunningLayout=this._runtime=null,e.clearArray(this._allLayouts),this._layoutsByName.clear(),this._layoutsBySid.clear(),e.clearArray(this._runningSubLayouts)}Create(t){t=e.New(e.Layout,this,this._allLayouts.length,t),this._allLayouts.push(t),this._layoutsByName.set(t.GetName().toLowerCase(),t),this._layoutsBySid.set(t.GetSID(),t)}GetRuntime(){return this._runtime}SetFirstLayout(e){this._firstLayout=e}GetFirstLayout(){if(this._firstLayout)return this._firstLayout;if(this._allLayouts.length)return this._allLayouts[0];throw Error("no first layout")}GetLayoutByName(e){return this._layoutsByName.get(e.toLowerCase())||null}GetLayoutBySID(e){return this._layoutsBySid.get(e)||null}GetLayoutByIndex(t){return t=e.clamp(Math.floor(t),0,this._allLayouts.length-1),this._allLayouts[t]}GetLayout(e){return"number"==typeof e?this.GetLayoutByIndex(e):this.GetLayoutByName(e.toString())}GetAllLayouts(){return this._allLayouts}_SetMainRunningLayout(e){this._mainRunningLayout=e}GetMainRunningLayout(){return this._mainRunningLayout}_AddRunningSubLayout(e){if(this._runningSubLayouts.includes(e))throw Error("layout already running");this._runningSubLayouts.push(e)}_RemoveRunningSubLayout(e){if(e=this._runningSubLayouts.indexOf(e),-1===e)throw Error("layout not running");this._runningSubLayouts.splice(e,1)}*runningLayouts(){this._mainRunningLayout&&(yield this._mainRunningLayout),this._runningSubLayouts.length&&(yield*this._runningSubLayouts)}IsLayoutRunning(e){return this._mainRunningLayout===e||this._runningSubLayouts.includes(e)}SetIsEndingLayout(e){if(e)this._isEndingLayout++;else{if(0>=this._isEndingLayout)throw Error("already unset");this._isEndingLayout--}}IsEndingLayout(){return 0<this._isEndingLayout}ChangeMainLayout(e){this._pendingChangeLayout=e}ClearPendingChangeLayout(){this._pendingChangeLayout=null}IsPendingChangeMainLayout(){return!!this._pendingChangeLayout}GetPendingChangeMainLayout(){return this._pendingChangeLayout}SetAllLayerProjectionChanged(){const e=this.GetMainRunningLayout();e&&e._SetAllLayersProjectionChanged()}SetAllLayerMVChanged(){const e=this.GetMainRunningLayout();e&&e._SetAllLayersMVChanged()}}}{const e=self.C3,t=/<(.+?)>/g;e.TimelineManager=class extends e.DefendedBase{constructor(t){super(),this._runtime=t,this._timelineDataManager=e.New(e.TimelineDataManager),this._pluginInstance=null,this._timelines=[],this._timelinesByName=new Map,this._objectClassToTimelineMap=new Map,this._timelinesCreatedByTemplate=new Map,this._scheduledTimelines=[],this._playingTimelines=[],this._markedForRemovalTimelines=[],this._isTickingTimelines=this._changingLayout=this._hasRuntimeListeners=!1,this._tickFunc=(()=>this._OnTick()),this._tick2Func=(()=>this._OnTick2()),this._beforeLayoutChange=(()=>this._OnBeforeChangeLayout()),this._layoutChange=(()=>this._OnAfterChangeLayout()),this._instanceDestroy=(e=>this._OnInstanceDestroy(e.instance)),this._afterLoad=(e=>this._OnAfterLoad()),this._destroyedWhileLoadingState=[],this._renderChange=0}Release(){this.RemoveRuntimeListeners(),this._afterLoad=this._instanceDestroy=this._layoutChange=this._beforeLayoutChange=this._tick2Func=this._tickFunc=null;for(const e of this._timelines)e.Stop(),e.Release();e.clearArray(this._timelines),this._timelines=null,this._timelineDataManager.Release(),this._timelineDataManager=null,e.clearArray(this._scheduledTimelines),this._scheduledTimelines=null,e.clearArray(this._playingTimelines),this._playingTimelines=null,e.clearArray(this._markedForRemovalTimelines),this._markedForRemovalTimelines=null,this._timelinesByName.clear(),this._timelinesByName=null,this._objectClassToTimelineMap.clear(),this._objectClassToTimelineMap=null,this._timelinesCreatedByTemplate.clear(),this._timelinesCreatedByTemplate=null,e.clearArray(this._destroyedWhileLoadingState),this._runtime=this._destroyedWhileLoadingState=null}AddRuntimeListeners(){const e=this._runtime.Dispatcher();e.addEventListener("pretick",this._tickFunc),e.addEventListener("tick2",this._tick2Func),e.addEventListener("beforelayoutchange",this._beforeLayoutChange),e.addEventListener("layoutchange",this._layoutChange),e.addEventListener("instancedestroy",this._instanceDestroy),e.addEventListener("afterload",this._afterLoad)}RemoveRuntimeListeners(){const e=this._runtime.Dispatcher();e.removeEventListener("pretick",this._tickFunc),e.removeEventListener("tick2",this._tick2Func),e.removeEventListener("beforelayoutchange",this._beforeLayoutChange),e.removeEventListener("layoutchange",this._layoutChange),e.removeEventListener("instancedestroy",this._instanceDestroy),e.removeEventListener("afterload",this._afterLoad)}Create(t){this._timelineDataManager.Add(t),t=e.TimelineState.CreateInitial(t,this),this.Add(t),this.SetTimelineObjectClassesToMap(t),this._timelinesCreatedByTemplate.set(t.GetName(),0)}CreateFromTemplate(t){var s=this.GetTimelineDataManager();return t=t.GetTemplateName(),s=s.Get(t),s=e.TimelineState.CreateFromTemplate(`${t}:${this._timelinesCreatedByTemplate.get(t)}`,s,this),this._IncreaseTemplateTimelinesCount(t),this.Add(s),s}_IncreaseTemplateTimelinesCount(e){this._timelinesCreatedByTemplate.set(e,this._timelinesCreatedByTemplate.get(e)+1)}_SetCreatedTemplateTimelinesCount(){for(const e of this._timelines){if(e.IsTemplate())continue;const t=e.GetTemplateName();this._IncreaseTemplateTimelinesCount(t)}}_ClearCreatedTemplateTimelinesCount(){for(const e of this._timelinesCreatedByTemplate.keys())this._timelinesCreatedByTemplate.set(e,0)}Add(e){this._timelines.push(e),this._timelinesByName.set(e.GetName().toLowerCase(),e)}Remove(t){t.Removed(),t.IsTemplate()||(e.arrayFindRemove(this._timelines,t),e.arrayFindRemove(this._scheduledTimelines,t),e.arrayFindRemove(this._playingTimelines,t),e.arrayFindRemove(this._markedForRemovalTimelines,t),this._timelinesByName.delete(t.GetName().toLowerCase()),this.RemoveTimelineFromObjectClassMap(t),t.IsReleased()||t.Release())}Trigger(e){this._runtime.Trigger(e,this._pluginInstance,null)}GetRuntime(){return this._runtime}GetTimelineDataManager(){return this._timelineDataManager}SetPluginInstance(e){this._pluginInstance=e}GetPluginInstance(){return this._pluginInstance}*GetTimelines(){for(const e of this._timelines)yield e}SetTimelineObjectClassToMap(e,t){this._objectClassToTimelineMap.has(e)||this._objectClassToTimelineMap.set(e,new Set),this._objectClassToTimelineMap.get(e).add(t)}SetTimelineObjectClassesToMap(e){for(const t of e.GetObjectClasses())this.SetTimelineObjectClassToMap(t,e)}RemoveTimelineFromObjectClassMap(e){for(const[t,s]of this._objectClassToTimelineMap.entries())s.has(e)&&(s.delete(e),0===s.size&&this._objectClassToTimelineMap.delete(t))}GetTimelinesForObjectClass(e){if(this._objectClassToTimelineMap.has(e))return this._objectClassToTimelineMap.get(e)}GetTimelineOfTemplateForInstances(e,t){if(t)for(const s of this._timelines)if(t.every(e=>s.HasTrackInstance(e.instance,e.trackId))&&s.GetName().includes(e.GetName()))return s}GetTimelineByName(e){return this._timelinesByName.get(e.toLowerCase())||null}GetScheduledOrPlayingTimelineByName(e){for(const t of this._scheduledTimelines)if(t.GetName()===e)return t;for(const t of this._playingTimelines)if(t.GetName()===e)return t;return null}*GetTimelinesByName(e){if(t.test(e)){let i;t.lastIndex=0;var s=new Set;do{if(i=t.exec(e)){const e=i[1].split(",");for(const t of e)s.add(t)}}while(i);for(const t of s.values())(e=this.GetTimelineByName(t))&&(yield e);s.clear()}else(s=this.GetTimelineByName(e))&&(yield s)}*GetTimelinesByTags(e){for(const t of this._timelines)t.HasTags(e)&&(yield t)}AddScheduledTimeline(e){this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e),this._MaybeEnableRuntimeListeners()}RemovePlayingTimeline(t){e.arrayFindRemove(this._playingTimelines,t),this._MaybeDisableRuntimeListeners()}ScheduleTimeline(e){this._playingTimelines.includes(e)?(e.SetPlaying(!0),e.SetScheduled(!1),e.SetMarkedForRemoval(!1)):(e.SetPlaying(!1),e.SetScheduled(!0),e.SetMarkedForRemoval(!1),this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e)),this._MaybeEnableRuntimeListeners()}DeScheduleTimeline(t){t.SetPlaying(!1),t.SetScheduled(!1),t.ResolvePlayPromise(),e.arrayFindRemove(this._scheduledTimelines,t),this._MaybeDisableRuntimeListeners()}CompleteTimeline(t){t.SetPlaying(!1),t.SetScheduled(!1),t.SetMarkedForRemoval(!0),this._markedForRemovalTimelines.push(t),e.arrayFindRemove(this._playingTimelines,t)}CompleteTimelineBeforeChangeOfLayout(t){t.SetPlaying(!1),t.SetScheduled(!1),t.SetMarkedForRemoval(!1),t.SetPlaybackRate(1),e.arrayFindRemove(this._playingTimelines,t)}CompleteTimelineAndResolve(e){this.CompleteTimeline(e),e.ResolvePlayPromise()}_OnTick(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){for(this._isTickingTimelines=!0;this._scheduledTimelines.length;){var e=this._scheduledTimelines.pop();e.SetInitialState(),0!==e.GetRenderChange()&&(this._renderChange=1),this._playingTimelines.push(e)}e=this._runtime._GetDtFast();var t=this._runtime.GetDt1(),s=this._runtime.GetTimeScale();for(let i=this._playingTimelines.length-1;0<=i;i--)this._playingTimelines[i].Tick(e,s,t);this._isTickingTimelines=!1,0!==this._renderChange&&this.GetRuntime().UpdateRender()}}_OnTick2(){if(!this.GetRuntime().IsLoadingState()&&this._hasRuntimeListeners&&!this._changingLayout){var t;for(let e=0,s=this._markedForRemovalTimelines.length;e<s;e++){const s=this._markedForRemovalTimelines[e];t||(t=new Set),s.Removed(),this._MaybeExecuteTimelineFinishTriggers(s),t.add(s)}if(t){e.arrayRemoveAllInSet(this._markedForRemovalTimelines,t),this._renderChange=0;for(let e=0,t=this._playingTimelines.length;e<t;e++)if(0!==this._playingTimelines[e].GetRenderChange()){this._renderChange=1;break}}this._MaybeDisableRuntimeListeners()}}_MaybeExecuteTimelineFinishTriggers(e){e.IsReleased()||e.HasValidTracks()&&e.IsComplete()&&e.InitialStateSet()&&e.FinishTriggers()}_MaybeEnableRuntimeListeners(){this._hasRuntimeListeners||(this._hasRuntimeListeners=!0)}_MaybeDisableRuntimeListeners(){this._markedForRemovalTimelines.length||this._playingTimelines.length||this._scheduledTimelines.length||this._isTickingTimelines||(this._hasRuntimeListeners=!1)}_OnBeforeChangeLayout(){for(this._changingLayout=!0;this._scheduledTimelines.length;)this.DeScheduleTimeline(this._scheduledTimelines.pop());const t=new Set;for(const e of this._playingTimelines)e._OnBeforeChangeLayout()&&(e.Removed(),t.add(e));e.arrayRemoveAllInSet(this._playingTimelines,t),t.clear();for(const e of this._markedForRemovalTimelines)e._OnBeforeChangeLayout()&&(e.Removed(),t.add(e));e.arrayRemoveAllInSet(this._markedForRemovalTimelines,t),this._MaybeDisableRuntimeListeners();for(const e of this._timelines)e.CleanCaches()}_OnAfterChangeLayout(){this._changingLayout=!1}_OnInstanceDestroy(e){var t=e.GetObjectClass();if(t=this.GetTimelinesForObjectClass(t))if(this._runtime.IsLoadingState())this._destroyedWhileLoadingState.push(e);else for(const e of t)e.IsTemplate()||(e.IsReleased()?this.Remove(e):e.HasValidTracks()||(this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e)))}_OnAfterLoad(){for(const e of this._destroyedWhileLoadingState)this._OnInstanceDestroy(e);e.clearArray(this._destroyedWhileLoadingState)}_SaveToJson(){return{timelinesJson:this._SaveTimelinesToJson(),scheduledTimelinesJson:this._SaveScheduledTimelinesToJson(),playingTimelinesJson:this._SavePlayingTimelinesToJson(),markedForRemovalTimelinesJson:this._SaveMarkedForRemovalTimelinesToJson(),hasRuntimeListeners:this._hasRuntimeListeners,changingLayout:this._changingLayout,isTickingTimelines:this._isTickingTimelines}}_LoadFromJson(e){e&&(this._ClearCreatedTemplateTimelinesCount(),this._LoadTimelinesFromJson(e.timelinesJson),this._LoadScheduledTimelinesFromJson(e.scheduledTimelinesJson),this._LoadPlayingTimelinesFromJson(e.playingTimelinesJson),this._LoadMarkedForRemovalTimelinesFromJson(e.markedForRemovalTimelinesJson),this._hasRuntimeListeners=!e.hasRuntimeListeners,this._changingLayout=!!e.changingLayout,this._isTickingTimelines=!!e.isTickingTimelines,this._SetCreatedTemplateTimelinesCount(),this._MaybeEnableRuntimeListeners(),this._MaybeDisableRuntimeListeners())}_SaveTimelinesToJson(){return this._timelines.map(e=>e._SaveToJson())}_LoadTimelinesFromJson(e){for(const t of e){if(e=this.GetTimelineByName(t.name),!e){if(e=this._GetTemplateNameFromJson(t),!e)continue;e=this.GetTimelineByName(e),e=this.CreateFromTemplate(e)}e._LoadFromJson(t),e.HasTracks()||this.Remove(e)}}_GetTemplateNameFromJson(e){return(e=e.name.split(":"))&&2===e.length?e[0]:null}_SaveScheduledTimelinesToJson(){return this._SaveTimelines(this._scheduledTimelines)}_LoadScheduledTimelinesFromJson(e){this._LoadTimelines(e,this._scheduledTimelines)}_SavePlayingTimelinesToJson(){return this._SaveTimelines(this._playingTimelines)}_LoadPlayingTimelinesFromJson(e){this._LoadTimelines(e,this._playingTimelines)}_SaveMarkedForRemovalTimelinesToJson(){return this._SaveTimelines(this._markedForRemovalTimelines)}_LoadMarkedForRemovalTimelinesFromJson(e){this._LoadTimelines(e,this._markedForRemovalTimelines)}_IsTimelineInJson(e,t){for(const s of t)if(s===e.GetName())return!0;return!1}_SaveTimelines(e){return e.map(e=>e.GetName())}_LoadTimelines(t,s){var i=new Set;for(const e of s)this._IsTimelineInJson(e,t)||i.add(e);e.arrayRemoveAllInSet(s,i),i=(e=>t=>t.GetName()===e);for(const e of t)(t=this.GetTimelineByName(e))&&(s.find(i(e))||s.push(t))}}}{const e=self.C3;e.TimelineState=class extends e.DefendedBase{constructor(e,t,s){super(),this._runtime=s.GetRuntime(),this._timelineManager=s,this._timelineDataItem=t,this._name=e,this._tracks=[],this._tracksLength=0,this._beforeAndAfterTracks=null,this._beforeAndAfterTracksLength=0,this.CreateTrackStates(),this._playResolve=this._playPromise=null,this._playheadTime=0,this._playbackRate=1,this._pingPongState=0,this._currentRepeatCount=1,this._initialStateSet=this._isScheduled=this._isPlaying=!1,this._complete=!0,this._markedForRemoval=this._released=!1,this._completedTick=-1,this._firstTick=this._finishedTriggers=this._isTemplate=this._implicitPause=!1,this._lastDelta=NaN,this._tags=[""],this._stringTags="",this._tagsChanged=!1,this._hasNestedContent=this._renderChange=0}static CreateInitial(t,s){var i=s.GetTimelineDataManager();const r=i.GetNameId();return i=i.Get(t[r]),t=e.New(e.TimelineState,t[r],i,s),t.SetIsTemplate(!0),t}static CreateFromTemplate(t,s,i){return e.New(e.TimelineState,t,s,i)}Release(){if(!this.IsReleased()){this._timelineManager.DeScheduleTimeline(this),this._timelineManager.CompleteTimelineAndResolve(this);for(const e of this._tracks)e.Release();e.clearArray(this._tracks),this._timelineDataItem=this._timelineManager=this._runtime=this._tracks=null,this._released=!0,this._playResolve=this._playPromise=null}}CreateTrackStates(){for(const t of this._timelineDataItem.GetTrackData().trackDataItems())this._tracksLength=this._tracks.push(e.TrackState.Create(this,t))}GetTimelineManager(){return this._timelineManager}GetRuntime(){return this._runtime}GetTracks(){return this._tracks}GetSimilarPropertyTracks(e,t,s){if(this._hasNestedContent){var i;for(let n=0;n<this._tracks.length;n++){var r=this._tracks[n];e===r.GetInstance()&&(r=r.GetPropertyTrack(s))&&t.constructor===r.GetSourceAdapter().constructor&&(i||(i=[]),i.push(r))}return i}}HasTracks(){return!!this._tracks.length}GetTrackById(t){for(const s of this._tracks)if(e.equalsNoCase(s.GetId(),t))return s;return null}GetTrackByName(t){for(const s of this._tracks)if(!s.IsInstanceTrack()&&e.equalsNoCase(s.GetName(),t))return s;return null}SetName(e){this._name=e}GetName(){return this._name}GetTimelineDataItem(){return this._timelineDataItem}GetTemplateName(){return this._timelineDataItem.GetName()}GetTotalTime(){return this._timelineDataItem.GetTotalTime()}SetTotalTime(e){this._timelineDataItem.SetTotalTime(e)}GetStep(){return this._timelineDataItem.GetStep()}SetStep(e){this._timelineDataItem.SetStep(e)}GetInterpolationMode(){return this._timelineDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._timelineDataItem.SetInterpolationMode(e)}GetResultMode(){return this._timelineDataItem.GetResultMode()}SetResultMode(e){this._timelineDataItem.GetResultMode(e)}SetEase(e){for(const t of this.GetTracks())t.SetEase(e)}GetLoop(){return this._timelineDataItem.GetLoop()}SetLoop(e){return this._timelineDataItem.SetLoop(e)}GetPingPong(){return this._timelineDataItem.GetPingPong()}SetPingPong(e){return this._timelineDataItem.SetPingPong(e)}GetRepeatCount(){return this._timelineDataItem.GetRepeatCount()}SetPlaybackRate(e){return this._playbackRate=e}GetPlaybackRate(){return this._playbackRate}IsForwardPlayBack(){return!this.IsPlaying()||0<this._playbackRate}GetPlayPromise(){return this._playPromise?this._playPromise:this._playPromise=new Promise(e=>{this._playResolve=e})}ResolvePlayPromise(){this._playPromise&&(this._playResolve(),this._playResolve=this._playPromise=null)}SetTags(t){this._tags=e.TimelineState._GetTagArray(t),this._tagsChanged=!0}GetTags(){return this._tags}GetStringTags(){return this._tagsChanged&&(this._stringTags=this._tags.join(" ")),this._tagsChanged=!1,this._stringTags}HasTags(t){return!(!this._tags||!this._tags.length)&&(!(!(t=e.TimelineState._GetTagArray(t))||!t.length)&&t.every(e.TimelineState._HasTag,this))}OnStarted(){e.Plugins.Timeline.Cnds.SetTriggerTimeline(this),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineStarted),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineStartedByName),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineStartedByTags),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnAnyTimelineStarted),e.Plugins.Timeline.Cnds.SetTriggerTimeline(null)}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){this._finishedTriggers||(this._finishedTriggers=!0,e.Plugins.Timeline.Cnds.SetTriggerTimeline(this),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineFinished),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineFinishedByName),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineFinishedByTags),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnAnyTimelineFinished),e.Plugins.Timeline.Cnds.SetTriggerTimeline(null))}SetPlaying(e){this._isPlaying=e}IsCompletedTick(){return this._completedTick===this._runtime.GetTickCount()}IsPlaying(e=!1){return!!(this.IsCompletedTick()||this.IsScheduled()&&!e)||this._isPlaying}_IsPlaying(){return this.IsPlaying(!0)}IsPaused(){return this._IsPaused()}_IsPaused(){return!(this.IsReleased()||this.IsScheduled()||this._IsPlaying()||this.IsComplete())}SetScheduled(e){this._isScheduled=e}IsScheduled(){return this._isScheduled}SetComplete(e){this._complete=e,e=this.GetTime(),(0>=e||e>=this.GetTotalTime())&&(this._complete=!0)}IsComplete(){return this._complete}IsReleased(){return this._released}SetMarkedForRemoval(e){this._markedForRemoval=e}IsMarkedForRemoval(){return this._markedForRemoval}SetImplicitPause(e){this._implicitPause=e}IsImplicitPause(){return this._implicitPause}SetIsTemplate(e){this._isTemplate=!!e}IsTemplate(){return this._isTemplate}InitialStateSet(){return this._initialStateSet}GetTime(){return this._playheadTime}SetTime(e){const t=this.GetTime();this._SetTime(e),this.SetComplete(!1),this.IsComplete()||this.SetImplicitPause(!0),(this._IsPlaying()||this.IsScheduled()||!this._initialStateSet)&&(this._IsPlaying()||this.IsScheduled()||this._initialStateSet?this._IsPlaying()?this.Stop():this.IsScheduled()&&(this._timelineManager.DeScheduleTimeline(this),this.SetInitialStateFromSetTime()):this.SetInitialStateFromSetTime()),this._SetUpdateStateBefore(),this._Interpolate(e,!1,!0,!0,t),this._SetUpdateStateAfter(),this._renderChange&&this.GetRuntime().UpdateRender(),this._OnSetTime()}_SetTime(e){0>e?this._playheadTime=0:e>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=e}_OnSetTime(){e.Plugins.Timeline&&this.constructor===e.TimelineState&&(e.Plugins.Timeline.Cnds.SetTriggerTimeline(this),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimeSet),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimeSetByName),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimeSetByTags),e.Plugins.Timeline.Cnds.SetTriggerTimeline(null))}_CanResume(){if(!this.GetLoop())if(this.GetPingPong()&&1===this._pingPongState){if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(0>=this.GetTime())return!1}else if(!this.GetLoop()&&!this.GetPingPong())if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(0>=this.GetTime())return!1;return!0}Resume(){this.IsReleased()||this._CanResume()&&this.Play(!0)}Play(e=!1){return!this.IsReleased()&&!this.IsScheduled()&&(this._IsPlaying()&&this.IsCompletedTick()?this._SchedulePlayingTimeline():!(this._IsPlaying()||!(this.IsComplete()||e||this.IsImplicitPause()))&&this._ScheduleStoppedTimeline())}_SchedulePlayingTimeline(){return this.SetImplicitPause(!1),this._timelineManager.RemovePlayingTimeline(this),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}_ScheduleStoppedTimeline(){return this.SetImplicitPause(!1),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}Stop(e=!1){this.IsReleased()||(this.SetComplete(e),this._timelineManager.CompleteTimeline(this),this.IsComplete()&&this.ResolvePlayPromise())}Reset(e=!0,t=!1){if(!this.IsReleased()){if(!this._IsPlaying()&&this.IsScheduled())return this._timelineManager.DeScheduleTimeline(this);if(!this.IsComplete()){this.Stop(!0),this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime());var s=this.GetTime();this._SetUpdateStateBefore(),t?this._InterpolateBeforeChangeLayout(s):this._Interpolate(s,!1,!1,!0),e&&this._OnSetTime(),this._SetUpdateStateAfter(),this._renderChange&&e&&this.GetRuntime().UpdateRender()}}}ResetBeforeChangeLayout(){this.Reset(!1,!0)}_InterpolateBeforeChangeLayout(e){this._Interpolate(e,!1,!1,!0,NaN,!1,!0)}_OnBeforeChangeLayout(){return!!this.IsReleased()||!this.HasValidGlobalTracks()&&(this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.ResetBeforeChangeLayout(),!0)}SetInitialStateFromSetTime(){this.SetInitialState(!0)}SetInitialState(e){if(!this.IsMarkedForRemoval()){if(e){this._firstTick=this._initialStateSet=!0,this._SetUpdateStateBefore();for(const e of this._tracks)e.SetInitialState()}else if(this.SetPlaying(!0),this.SetScheduled(!1),this.OnStarted(),this.IsComplete()){this._completedTick=-1,this._pingPongState=0,this._currentRepeatCount=1,this._finishedTriggers=this._complete=!1,this._firstTick=this._initialStateSet=!0,
this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime()),this._SetUpdateStateBefore();for(const e of this._tracks)e.SetInitialState()}else{this._firstTick=!0,this._SetUpdateStateBefore();for(const e of this._tracks)e.SetResumeState()}this._SetUpdateStateAfter()}}GetRenderChange(){return this._renderChange}_SetUpdateStateBefore(){this._hasNestedContent=0;for(const e of this._tracks)e.IsNested()&&(this._hasNestedContent=1)}_SetUpdateStateAfter(){this._renderChange=0;for(const e of this._tracks)e._SetUpdateState(),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1),this._beforeAndAfterTracks||1!==e.GetNeedsBeforeAndAfter()||(this._beforeAndAfterTracks||(this._beforeAndAfterTracks=[]),this._beforeAndAfterTracksLength=this._beforeAndAfterTracks.push(e))}Tick(e,t,s){if(0!==e||0!==this._lastDelta){this._lastDelta=e,s=this._playheadTime,t=s+e*t*this._playbackRate,e=this._timelineDataItem._totalTime,this._playheadTime=0>t?0:t>=e?e:t;var i=!1;t=this.GetLoop();var r=this.GetPingPong();if(t||r?t&&!r?0<this._playbackRate?this._playheadTime>=e&&this._SetTime(0):0>=this._playheadTime&&this._SetTime(e):!t&&r?0<this._playbackRate?this._playheadTime>=e&&(this._SetTime(e),this.SetPlaybackRate(-1*this.GetPlaybackRate()),1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):i=!0:0===this._pingPongState&&(this._pingPongState=1)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):i=!0:0===this._pingPongState&&(this._pingPongState=1)):t&&r&&(0<this._playbackRate?this._playheadTime>=e&&(this._SetTime(e),this.SetPlaybackRate(-1*this.GetPlaybackRate())):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()))):0<this._playbackRate?this._playheadTime>=e&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTime(0)):(this._SetTime(e),i=!0)):0>=this._playheadTime&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTime(e)):(this._SetTime(0),i=!0)),t=this._tracksLength,i){for(i=0;i<t;i++)this._tracks[i].SetEndState();this.Stop(!0),this.OnCompleted()}else{for(r=this._beforeAndAfterTracksLength,i=0;i<r;i++)this._beforeAndAfterTracks[i].BeforeInterpolate();if(1===this._hasNestedContent)for(i=0;i<t;i++){const t=this._tracks[i],r=t.GetStartOffset(),n=s-r;0>this._playheadTime-r&&0<n?(this._playheadTime=0>r?0:r>=e?e:r,t.Interpolate(r,!0,!1,!1,this._firstTick,!1)):t.Interpolate(this._playheadTime,!0,!1,!1,this._firstTick,!1)}else for(i=0;i<t;i++)this._tracks[i].Interpolate(this._playheadTime,!0,!1,!1,this._firstTick,!1);for(i=0;i<r;i++)this._beforeAndAfterTracks[i].AfterInterpolate();this._firstTick&&(this._firstTick=!1)}}}_Interpolate(e,t=!1,s=!1,i=!1,r=NaN,n=!1,a=!1){for(var o of this._tracks)o.BeforeInterpolate();for(const n of this._tracks){if(o=e,"number"==typeof r){const e=this.GetTime()-n.GetStartOffset(),t=r-n.GetStartOffset();0>e&&0<t&&(o=n.GetStartOffset(),this._SetTime(o))}n.Interpolate(o,t,s,i,this._firstTick,a)}for(const e of this._tracks)e.AfterInterpolate();this._firstTick&&n&&(this._firstTick=!1)}AddTrack(){var t=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();return t=e.TrackState.Create(this,t),this._tracksLength=this._tracks.push(t),t}Removed(){if(!this.IsReleased())for(const e of this._tracks)e.TimelineRemoved()}CleanCaches(){for(const e of this._tracks)e.CleanCaches()}ClearTrackInstances(){for(const e of this._tracks)e.ClearInstance()}SetTrackInstance(e,t){if(t)for(const s of this._tracks)if(s.IsInstanceTrack()){if(e){if(s.GetId()!==e)continue}else if(s.HasInstance())continue;s.SetInstance(t),this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this);break}}HasTrackInstance(e,t){for(const s of this._tracks)if(s.IsInstanceTrack())if(t){if(t===s.GetId()&&e===s.GetInstance())return!0}else if(e===s.GetInstance())return!0;return!1}HasValidTracks(){return this._tracks.some(e=>!e.IsInstanceTrack()||e.CanInstanceBeValid())}HasValidGlobalTracks(){return this._tracks.some(e=>!!e.IsInstanceTrack()&&(!!e.CanInstanceBeValid()&&(!!(e=e.GetObjectClass())&&e.IsGlobal())))}GetPropertyTrack(e){for(const t of this.GetTracks())for(const s of t.GetPropertyTracks())if(s.GetPropertyName()===e)return s}GetTrackFromInstance(e){for(const t of this._tracks)if(e===t.GetInstance())return t;return null}GetKeyframeWithTags(e){e=e?e.split(" "):[],e=[...new Set(e.map(e=>e.toLowerCase().trim())).values()];for(const t of this.GetTracks())for(const s of t.GetKeyframeDataItems())if(e.every(e=>s.HasTag(e)))return s}GetObjectClasses(){const e=[];for(const t of this.GetTracks())e.push(t.GetObjectClass());return e.filter(e=>e)}_SaveToJson(){return{tracksJson:this._SaveTracksToJson(),name:this._name,playheadTime:this.GetTime(),playbackRate:this._playbackRate,pingPongState:this._pingPongState,currentRepeatCount:this._currentRepeatCount,isPlaying:this._isPlaying,isScheduled:this._isScheduled,initialStateSet:this._initialStateSet,finishedTriggers:this._finishedTriggers,complete:this._complete,released:this._released,markedForRemoval:this._markedForRemoval,completedTick:this._completedTick,implicitPause:this._implicitPause,isTemplate:this._isTemplate,tags:this._tags.join(" "),stringTags:this._stringTags,tagsChanged:this._tagsChanged,firstTick:this._firstTick}}_LoadFromJson(e){e&&(this._LoadTracksFromJson(e.tracksJson),this._name=e.name,this._playheadTime=e.playheadTime,this._playbackRate=e.playbackRate,this._pingPongState=e.pingPongState,this._currentRepeatCount=e.currentRepeatCount,this._isPlaying=!!e.isPlaying,this._isScheduled=!!e.isScheduled,this._initialStateSet=!!e.initialStateSet,this._finishedTriggers=!!e.hasOwnProperty("finishedTriggers")&&!!e.finishedTriggers,this._complete=!!e.complete,this._released=!!e.released,this._markedForRemoval=!!e.markedForRemoval,this._completedTick=e.completedTick,this._implicitPause=!!e.implicitPause,this._isTemplate=!!e.isTemplate,this._tags=e.tags.split(" "),this._stringTags=e.stringTags,this._tagsChanged=!!e.tagsChanged,this._firstTick=!!e.firstTick)}_SaveTracksToJson(){return this._tracks.map(e=>e._SaveToJson())}_LoadTracksFromJson(e){e.forEach((e,t)=>{this._tracks[t]._LoadFromJson(e)}),this._tracks.filter(e=>e.CanInstanceBeValid())}static _HasTag(e){const t=this.GetTags();return""===e?1===t.length&&""===t[0]:t.includes(e)}static _GetTagArray(t){return e.IsArray(t)?t.slice(0):e.IsString(t)?t.split(" "):void 0}}}{const e=self.C3;e.TrackState=class extends e.DefendedBase{constructor(e,t){super(),this._timeline=e,this._trackDataItem=t,this._trackData=t.GetTrackData(),this._objectClassIndex=this._instanceUid=NaN,this._worldInfo=this._instance=null,this._isNested=0<t.GetStartOffset(),this._endStateOfNestedSet=this._initialStateOfNestedSet=!1,this._lastKeyframeDataItem=null,this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray(),this._propertyTracks=[],this.CreatePropertyTrackStates(),this._needsBeforeAndAfter=this._renderChange=this._worldInfoChange=0}static Create(t,s){return e.New(e.TrackState,t,s)}Release(){this._keyframeDataItems=null;for(const e of this._propertyTracks)e.Release();e.clearArray(this._propertyTracks),this._lastKeyframeDataItem=this._trackDataItem=this._worldInfo=this._instance=this._timeline=this._propertyTracks=null}CreatePropertyTrackStates(){for(const t of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(e.PropertyTrackState.Create(this,t))}TimelineRemoved(){for(const e of this._propertyTracks)e.TimelineRemoved()}CleanCaches(){for(const e of this._propertyTracks)e.CleanCaches();this._worldInfo=this._instance=null}GetTimeline(){return this._timeline}GetRuntime(){return this._timeline.GetRuntime()}GetKeyframeDataItems(){return this._keyframeDataItems?this._keyframeDataItems:this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray()}GetPropertyTracks(){return this._propertyTracks}GetPropertyTrack(e){for(let t=0;t<this._propertyTracks.length;t++){const s=this._propertyTracks[t];if(s.GetPropertyName()===e)return s}}MaybeGetInstance(){this._instance||this.GetInstance()}IsInstanceValid(){return!!this._instance&&!this._instance.IsDestroyed()}CanInstanceBeValid(){if(!this.IsInstanceTrack())return!1;var e=this.GetInstanceUID();return!!(e=this.GetRuntime().GetInstanceByUID(e))&&!e.IsDestroyed()}GetObjectClass(){if(this.IsInstanceTrack()){var e=this.GetObjectClassIndex();if(-1!==e)return this.GetRuntime().GetObjectClassByIndex(e)}}ClearInstance(){this._instance=null,this._instanceUid=-1,this._worldInfo=null,this._objectClassIndex=-1}HasInstance(){return!!this._instance}GetInstance(){if(this._instance&&this.IsInstanceValid())return this._instance;const e=this.GetInstanceUID();return this._instance=this.GetRuntime().GetInstanceByUID(e)}SetInstance(e){if(this._instance!==e){this.CleanCaches(),this._instance=e,this._objectClassIndex=e.GetObjectClass().GetIndex(),this._instanceUid=e.GetUID(),this._worldInfo=e.GetWorldInfo();for(const n of this.propertyTrackItems()){const a=n.sourceAdapter;switch(n.propertyTrack.GetSourceAdapterId()){case"instance-variable":a.GetEditorIndex();var t=e.GetObjectClass(),s=t.GetInstanceVariableIndexByName(n.name),i=t.GetInstanceVariableName(s);t=t.GetInstanceVariableType(s),i===n.name&&t===n.type&&a.UpdateInstanceVariableIndex(s);break;case"behavior":var r=n.behaviorType;s=this.GetObjectClass(),i=e.GetObjectClass(),t=a.GetBehaviorType(i),r&&t&&(r=r.GetName(),s.GetBehaviorIndexByName(r),i.GetBehaviorIndexByName(r),a.GetEditorIndex(),a.UpdateBehaviorTypeSid(t.GetSID()))}}}}*propertyTrackItems(){for(const s of this._propertyTracks){var e=s.GetSourceAdapter(),t=this.GetObjectClass();const i={propertyTrack:s,sourceAdapter:e};switch(s.GetSourceAdapterId()){case"world-instance":i.property=s.GetPropertyName();break;case"instance-variable":e=e.GetEditorIndex(),i.name=t.GetInstanceVariableName(e),i.type=t.GetInstanceVariableType(e);break;case"effect":t=t.GetEffectList(),e=e.GetEffectType(t),i.effectType=e;break;case"behavior":e=e.GetBehaviorType(t),i.behaviorType=e;break;case"plugin":i.plugin=t.GetPlugin()}yield i}}GetWorldInfo(){if(this._worldInfo&&this.IsInstanceValid())return this._worldInfo;const e=this.GetInstance();return e&&(this._worldInfo=e.GetWorldInfo()),this._worldInfo}GetTrackDataItem(){return this._trackDataItem}GetInstanceUID(){return this._instanceUid?this._instanceUid:this._trackDataItem.GetInstanceUID()}SetInstanceUID(e){this._trackDataItem.SetInstanceUID(e)}GetInterpolationMode(){return this._trackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._trackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._trackDataItem.GetResultMode()}GetId(){return this._trackDataItem.GetId()}GetStartOffset(){return this._trackDataItem.GetStartOffset()}GetLocalTotalTime(){return this._trackDataItem.GetLocalTotalTime()}SetLocalTotalTime(e){this._trackDataItem.SetLocalTotalTime(e)}SetResultMode(e){this._trackDataItem.SetResultMode(e)}SetEase(e){for(const t of this.GetKeyframeDataItems())t.SetEase(e);for(const t of this.GetPropertyTracks())t.SetEase(e)}GetEnable(){return this._trackDataItem.GetEnable()}SetEnable(e){this._trackDataItem.SetEnable(e)}GetObjectClassIndex(){return isNaN(this._objectClassIndex)?this._trackDataItem.GetObjectClassIndex():this._objectClassIndex}SetObjectClassIndex(e){this._trackDataItem.SetObjectClassIndex(e)}SetOriginalWidth(e){this._trackDataItem.SetOriginalWidth(e)}GetOriginalWidth(){const e=this.GetInstance();return e&&e.GetSdkInstance().IsOriginalSizeKnown()?e.GetSdkInstance().GetOriginalWidth():this._trackDataItem.GetOriginalWidth()}SetOriginalHeight(e){this._trackDataItem.SetOriginalHeight(e)}GetOriginalHeight(){const e=this.GetInstance();return e&&e.GetSdkInstance().IsOriginalSizeKnown()?e.GetSdkInstance().GetOriginalHeight():this._trackDataItem.GetOriginalHeight()}GetType(){return this._trackDataItem.GetType()}GetName(){return this._trackDataItem.GetName()}IsInstanceTrack(){return 0===this.GetType()}IsValueTrack(){return 1===this.GetType()}IsAudioTrack(){return 2===this.GetType()}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}IsNested(){return this._isNested}SetInitialState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){var e=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(const t of this._propertyTracks)t.SetInitialState(e),0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some(e=>e.GetNeedsBeforeAndAfter())&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e),this._endStateOfNestedSet=this._initialStateOfNestedSet=!1,this.Interpolate(e)}}SetResumeState(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){this._timeline.IsForwardPlayBack();var e=this._timeline.GetTime()-this.GetStartOffset();this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e);for(const t of this._propertyTracks)t.SetResumeState(e)}}SetEndState(){if(!(this.GetTimeline().IsComplete()||(this.MaybeGetInstance(),!this.IsInstanceValid()&&this.IsInstanceTrack()||this._isNested))){const e=this._timeline.GetTime(),t=this.GetStartOffset()+this.GetLocalTotalTime();e>=t?this.Interpolate(this.GetLocalTotalTime(),!0,!1,!0):0>=e&&this.Interpolate(0,!0,!1,!0)}}_SetUpdateState(){for(let e=0,t=this._propertyTracks.length;e<t;e++){const t=this._propertyTracks[e];t._SetUpdateState(),0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1)}}BeforeInterpolate(){const e=this._propertyTracks.length;for(let t=0;t<e;t++)this._propertyTracks[t].BeforeInterpolate()}Interpolate(e,t=!1,s=!1,i=!1,r=!1,n=!1){this._instance||this.GetInstance();const a=this._instance&&!this._instance.IsDestroyed(),o=0===this._trackDataItem._type;if(!(!a&&o||n&&o&&this.GetObjectClass().IsGlobal()||(e-=this.GetStartOffset(),0>e))){this.MaybeSetInitialStateOfNestedTrack(e,t),this.MaybeTriggerKeyframeReachedConditions(e,t,r);for(let t=0,r=this._propertyTracks.length;t<r;t++)this._propertyTracks[t].Interpolate(e,s,i);this.MaybeSetEndStateOfNestedTrack(e,t),0!==this._worldInfoChange&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo&&this._worldInfo.SetBboxChanged())}}AfterInterpolate(){const e=this._propertyTracks.length;for(let t=0;t<e;t++)this._propertyTracks[t].AfterInterpolate()}MaybeSetInitialStateOfNestedTrack(e,t){if(t&&this._isNested&&!this._initialStateOfNestedSet){if(this.GetTimeline().IsForwardPlayBack()){if(0>e)return;for(const e of this._propertyTracks)e.Interpolate(0,!1,!0)}else{if(e>this.GetLocalTotalTime())return;for(const e of this._propertyTracks)e.Interpolate(this.GetLocalTotalTime(),!1,!0)}for(const e of this._propertyTracks)e.SetInitialState();this._initialStateOfNestedSet=!0}}MaybeSetEndStateOfNestedTrack(e,t){if(t&&this._isNested&&!this._endStateOfNestedSet)if(this.GetTimeline().IsForwardPlayBack()){if(e>=this.GetLocalTotalTime()){for(const e of this._propertyTracks)e.Interpolate(this.GetLocalTotalTime(),!1,!0);this._endStateOfNestedSet=!0}}else if(0>=e){for(const e of this._propertyTracks)e.Interpolate(0,!1,!0);this._endStateOfNestedSet=!0}}MaybeTriggerKeyframeReachedConditions(t,s,i){if(!i&&s&&e.Plugins.Timeline){s=this.GetTimeline(),i=this._lastKeyframeDataItem.GetNext();var r=this._lastKeyframeDataItem.GetTime(),n=i?i.GetTime():s.GetTotalTime();(t<=r||t>=n)&&(this._lastKeyframeDataItem=this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(t,this._trackDataItem),s.IsForwardPlayBack()?i&&this.OnKeyframeReached(this._lastKeyframeDataItem):this._lastKeyframeDataItem.GetNext()&&this.OnKeyframeReached(this._lastKeyframeDataItem))}}_GetLastKeyFrameBeforeTime(e){const t=this._trackData.GetKeyFrameDataItemAtTime(e,this._trackDataItem);return t||this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(e,this._trackDataItem)}OnKeyframeReached(t){const s=this.GetTimeline();e.Plugins.Timeline.Cnds.SetTriggerTimeline(s),e.Plugins.Timeline.Cnds.SetTriggerKeyframe(t),t=s.GetTimelineManager(),t.Trigger(e.Plugins.Timeline.Cnds.OnAnyKeyframeReached),t.Trigger(e.Plugins.Timeline.Cnds.OnKeyframeReached),e.Plugins.Timeline.Cnds.SetTriggerTimeline(null),e.Plugins.Timeline.Cnds.SetTriggerKeyframe(null)}AddKeyframe(){return this._trackDataItem.GetKeyframeData().AddEmptyKeyframeDataItem()}AddPropertyTrack(){var t=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem();return t=e.PropertyTrackState.Create(this,t),this._propertyTracks.push(t),t}DeleteKeyframes(e){this._trackDataItem.GetKeyframeData().DeleteKeyframeDataItems(e)}DeletePropertyKeyframes(e){for(const t of this._propertyTracks)t.DeletePropertyKeyframes(e)}SaveState(){for(const e of this._propertyTracks)e.SaveState()}CompareInitialStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack())for(const e of this._propertyTracks)e.CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack()){var e=!1;for(const t of this._propertyTracks){const s=t.CompareSaveStateWithCurrent();!e&&s&&(e=!0)}e&&(e=this.AddKeyframe(),e.SetTime(this.GetTimeline().GetTime()),e.SetEase("noease"),e.SetEnable(!0),e.SetTags(""))}}_SaveToJson(){var e=this.GetInstance();return e=e?e.GetUID():this.GetInstanceUID(),{propertyTracksJson:this._SavePropertyTracksToJson(),lastKeyframeDataItemJson:this._SaveLastKeyframeDataItemToJson(),initialStateOfNestedSet:this._initialStateOfNestedSet,endStateOfNestedSet:this._endStateOfNestedSet,instanceUid:e}}_LoadFromJson(e){e&&(this._LoadPropertyTracksFromJson(e.propertyTracksJson),this._LoadLastKeyframeDataItemFromJson(e.lastKeyframeDataItemJson),this._LoadInstanceFromJson(e.instanceUid),this._initialStateOfNestedSet=!1,e.hasOwnProperty.initialStateOfNestedSet&&(this._initialStateOfNestedSet=e.initialStateOfNestedSet),this._endStateOfNestedSet=!1,e.hasOwnProperty.endStateOfNestedSet&&(this._endStateOfNestedSet=e.endStateOfNestedSet))}_SaveLastKeyframeDataItemToJson(){return this._trackDataItem.GetKeyframeData().GetKeyframeDataItemIndex(this._lastKeyframeDataItem)}_SavePropertyTracksToJson(){return this._propertyTracks.map(e=>e._SaveToJson())}_LoadPropertyTracksFromJson(e){e.forEach((e,t)=>{this._propertyTracks[t]._LoadFromJson(e)})}_LoadInstanceFromJson(t){if(e.IsFiniteNumber(t)&&(t=this.GetRuntime().GetInstanceByUID(t))){var s=this.GetTimeline();s.ClearTrackInstances(),s.SetTrackInstance(this._trackDataItem.GetId(),t)}}_LoadLastKeyframeDataItemFromJson(e){this._lastKeyframeDataItem=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemFromIndex(e)}}}{const e=self.C3;e.PropertyTrackState=class extends e.DefendedBase{constructor(e,t){super(),this._track=e,this._propertyTrackDataItem=t,this._propertyTrackData=t.GetPropertyTrackData(),this._needsBeforeAndAfter=this._renderChange=this._worldInfoChange=0,this._sourceAdapter=this.GetSourceAdapter(),this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),this._absoluteValueObject=this._lastPropertyKeyframeDataItem=null}static Create(t,s){return e.New(e.PropertyTrackState,t,s)}Release(){this._track=null,this._sourceAdapter&&(this._sourceAdapter.Release(),this._sourceAdapter=null),this._propertyTrackData=this._propertyTrackDataItem=this._propertyKeyframeDataItems=null}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}HasAbsoluteValueObject(){return!!this._absoluteValueObject}SetAbsoluteValueObject(e){this._absoluteValueObject=e}GetAbsoluteValueObject(){return this._absoluteValueObject}GetTrack(){return this._track}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyTrackData(){return this._propertyTrackData}GetTimeline(){return this._track.GetTimeline()}GetRuntime(){return this._track.GetRuntime()}GetInstance(){return this._track.GetInstance()}GetSourceAdapter(){if(this._sourceAdapter)return this._sourceAdapter;let t;switch(this._propertyTrackDataItem.GetSourceAdapterId()){case"behavior":t=new e.PropertyTrackState.BehaviorSourceAdapter(this);break;case"effect":t=new e.PropertyTrackState.EffectSourceAdapter(this),this._renderChange=1;break;case"instance-variable":t=new e.PropertyTrackState.InstanceVariableSourceAdapter(this);break;case"plugin":t=new e.PropertyTrackState.PluginSourceAdapter(this),this._renderChange=1;break;case"world-instance":t=new e.PropertyTrackState.PropertySourceAdapter(this),this._worldInfoChange=this._renderChange=1;break;case"value":t=new e.PropertyTrackState.ValueSourceAdapter(this);break;case"audio":t=new e.PropertyTrackState.AudioSourceAdapter(this)}return this._sourceAdapter=t}GetSourceAdapterId(){return this._propertyTrackDataItem.GetSourceAdapterId()}SetSourceAdapterId(e){this._propertyTrackDataItem.SetSourceAdapterId(e)}GetSourceAdapterArgs(){return this._propertyTrackDataItem.GetSourceAdapterArguments()}SetSourceAdapterArgs(e){this._propertyTrackDataItem.SetSourceAdapterArguments(e)}GetSourceAdapterValue(){return this.GetSourceAdapter().GetValue()}GetPropertyName(){return this._propertyTrackDataItem.GetProperty()}SetPropertyName(e){this._propertyTrackDataItem.SetProperty(e)}GetPropertyType(){return this._propertyTrackDataItem.GetType()}SetPropertyType(e){this._propertyTrackDataItem.SetType(e)}GetPropertyKeyframeType(){return this.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem).GetType()}GetMin(){return this._propertyTrackDataItem.GetMin()}SetMin(e){this._propertyTrackDataItem.SetMin(e)}GetMax(){return this._propertyTrackDataItem.GetMax()}SetMax(e){this._propertyTrackDataItem.SetMax(e)}GetEnable(){return this._propertyTrackDataItem.GetEnable()}SetEnable(e){this._propertyTrackDataItem.SetEnable(e)}GetInterpolationMode(){return this._propertyTrackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._propertyTrackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._propertyTrackDataItem.GetResultMode()}SetResultMode(e){this._propertyTrackDataItem.SetResultMode(e)}SetEase(e){for(const t of this.GetPropertyKeyframeDataItems())t.SetEase(e)}CanHavePropertyKeyframes(){return this._propertyTrackDataItem.CanHavePropertyKeyframes()}GetPropertyKeyframeDataItems(){return this._propertyKeyframeDataItems?this._propertyKeyframeDataItems:this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()}*GetPropertyKeyframeValues(){for(const e of this.GetPropertyKeyframeDataItems())yield e.GetValueWithResultMode()}TimelineRemoved(){this.GetSourceAdapter().TimelineRemoved()}CleanCaches(){this.GetSourceAdapter().CleanCaches()}GetCurrentState(){return this.GetSourceAdapter().GetCurrentState()}SetInitialState(e){this.GetSourceAdapter().SetInitialState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e),this._SetUpdateState()}SetResumeState(e){this.GetSourceAdapter().SetResumeState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e)}_SetUpdateState(){var e=this.GetTrack();if(this._needsBeforeAndAfter=0,e.IsInstanceTrack()){var t=this.GetTimeline();e=e.GetInstance();const s=this.GetSourceAdapter(),i=this.GetPropertyName();s.MayNeedBeforeAndAfterInterpolate()?(t=t.GetSimilarPropertyTracks(e,s,i))&&t.length&&(this._needsBeforeAndAfter=1):this._needsBeforeAndAfter=0}}_GetLastPropertyKeyFrameBeforeTime(e){const t=this.GetTimeline(),s=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem);return s||(t.IsForwardPlayBack()?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem):this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem))}BeforeInterpolate(){this._sourceAdapter.BeforeInterpolate()}Interpolate(e,t=!1,s=!1){let i;if(t)var r=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){var n=this.GetTimeline();const t=this._lastPropertyKeyframeDataItem.GetNext();r=this._lastPropertyKeyframeDataItem.GetTime(),n=t?t.GetTime():n.GetTotalTime(),(e<=r||e>=n)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);r=this._lastPropertyKeyframeDataItem}r&&(i=r.GetNext()),this._sourceAdapter.Interpolate(e,r,i,t,s)}GetInterpolatedValue(e){if(this._lastPropertyKeyframeDataItem){var t=this.GetTimeline();const i=this._lastPropertyKeyframeDataItem.GetNext();var s=this._lastPropertyKeyframeDataItem.GetTime();t=i?i.GetTime():t.GetTotalTime(),(e<=s||e>=t)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);return s=this._lastPropertyKeyframeDataItem,t=s.GetNext(),this._sourceAdapter.GetInterpolatedValue(e,s,t)}AfterInterpolate(){this._sourceAdapter.AfterInterpolate()}static GetStartPropertyKeyframeForTime(e,t){const s=t.GetPropertyTrackDataItem();return t._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,s)}static GetEndPropertyKeyframeForTime(e,t){const s=t.GetPropertyTrackDataItem();return t._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,s)}AddPropertyKeyframe(){const e=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,e}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null,this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(e)}SaveState(){this.GetSourceAdapter().SaveState()}CompareInitialStateWithCurrent(){if(this.GetSourceAdapter().CompareInitialStateWithCurrent()){const e=this._propertyTrackData.GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem),t=this.GetSourceAdapter().GetCurrentState();e.SetAbsoluteValue(t)}}CompareSaveStateWithCurrent(){const e=this.GetSourceAdapter().CompareSaveStateWithCurrent();return e&&this.AddPropertyKeyframeAtCurrentTime(),this.GetSourceAdapter().ClearSaveState(),e}AddPropertyKeyframeAtCurrentTime(){const t=this.GetTimeline().GetTime(),s=this.GetSourceAdapter(),i=e.PropertyTrackState.GetStartPropertyKeyframeForTime(t,this),r=this.AddPropertyKeyframe();r.SetType(i.GetType()),r.SetTime(t),r.SetEase(i.GetEase()),r.SetEnable(!0),r.SetValue(s.GetValueAtTime()),r.SetAbsoluteValue(s.GetCurrentState())}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson)}}}{const e=self.C3.PropertyTrackState;e.PropertySourceAdapter=class{constructor(e){this._propertyTrack=e,this._propertyAdapter=null,this.GetPropertyAdapter()}Release(){this._propertyAdapter&&(this._propertyAdapter.Release(),this._propertyAdapter=null),this._propertyTrack=null}MayNeedBeforeAndAfterInterpolate(){return this._propertyAdapter.MayNeedBeforeAndAfterInterpolate()}GetPropertyTrack(){return this._propertyTrack}TimelineRemoved(){this._propertyAdapter&&this._propertyAdapter.TimelineRemoved()}CleanCaches(){this._propertyAdapter&&this._propertyAdapter.CleanCaches()}GetPropertyAdapter(){return this._propertyAdapter?this._propertyAdapter:this._propertyAdapter=this._CreatePropertyAdapter()}GetEditorIndex(){}GetIndex(){return this.GetEditorIndex()}GetTarget(){}SetInitialState(){this.GetPropertyAdapter().SetInitialState()}SetResumeState(){this.GetPropertyAdapter().SetResumeState()}BeforeInterpolate(){this._propertyAdapter.BeforeChangeProperty()}Interpolate(t,s,i,r,n){let a;switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":a=e.NumericTypeAdapter.Interpolate(t,s,i,this._propertyTrack);break;case"angle":a=e.AngleTypeAdapter.Interpolate(t,s,i,this._propertyTrack);break;case"boolean":a=e.BooleanTypeAdapter.Interpolate(t,s,i,this._propertyTrack);break;case"color":a=e.ColorTypeAdapter.Interpolate(t,s,i,this._propertyTrack);break;case"text":a=e.TextTypeAdapter.Interpolate(t,s,i,this._propertyTrack)}this._propertyAdapter.ChangeProperty(t,a,s,i,r,n)}GetInterpolatedValue(t,s,i){switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":return e.NumericTypeAdapter.Interpolate(t,s,i,this._propertyTrack);case"angle":return e.AngleTypeAdapter.Interpolate(t,s,i,this._propertyTrack);case"boolean":return e.BooleanTypeAdapter.Interpolate(t,s,i,this._propertyTrack);case"color":return e.ColorTypeAdapter.Interpolate(t,s,i,this._propertyTrack);case"text":return e.TextTypeAdapter.Interpolate(t,s,i,this._propertyTrack)}}AfterInterpolate(){this._propertyAdapter.AfterChangeProperty()}SaveState(){this.GetPropertyAdapter().SetSaveState()}ClearSaveState(){this.GetPropertyAdapter().ClearSaveState()}GetCurrentState(){return this.GetPropertyAdapter().GetCurrentState()}CompareInitialStateWithCurrent(){return this.GetPropertyAdapter().CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){return this.GetPropertyAdapter().CompareSaveStateWithCurrent()}GetValueAtTime(){const t=this._propertyTrack,s=t.GetTrack().GetTimeline().GetTime(),i=e.GetStartPropertyKeyframeForTime(s,t),r=i.GetNext();switch(t.GetPropertyKeyframeType()){case"numeric":return e.NumericTypeAdapter.Interpolate(s,i,r,t);case"angle":return e.AngleTypeAdapter.Interpolate(s,i,r,t);case"boolean":return e.BooleanTypeAdapter.Interpolate(s,i,r,t);case"color":return e.ColorTypeAdapter.Interpolate(s,i,r,t);case"text":return e.TextTypeAdapter.Interpolate(s,i,r,t)}}_CreatePropertyAdapter(){const t=this._propertyTrack;switch(t.CanHavePropertyKeyframes()?t.GetPropertyKeyframeType():""){case"combo":case"boolean":case"text":case"string":return new e.PropertyInterpolationAdapter.NoInterpolationAdapter(this);case"numeric":case"number":case"angle":return"combo"===this._propertyTrack.GetPropertyType()?new e.PropertyInterpolationAdapter.NoInterpolationAdapter(this):new e.PropertyInterpolationAdapter.NumericInterpolationAdapter(this);case"color":case"offsetColor":return new e.PropertyInterpolationAdapter.ColorInterpolationAdapter(this);default:return new e.PropertyInterpolationAdapter.NumericInterpolationAdapter(this)}}_SaveToJson(){return{propertyAdapterJson:this.GetPropertyAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetPropertyAdapter()._LoadFromJson(e.propertyAdapterJson)}}}{const e=self.C3;class t extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._updatedIndex=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]}GetIndex(){return this._updatedIndex?this._updatedIndex:super.GetIndex()}GetTarget(){return this._propertyTrack.GetTrack().GetInstance()}UpdateInstanceVariableIndex(e){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]!==e&&(this._updatedIndex=e)}Interpolate(e,t,s,i,r){this.GetPropertyAdapter().CanChange(t.GetValue())&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){if(this.GetPropertyAdapter().CanChange(t.GetValue()))return super.GetInterpolatedValue(e,t,s)}_SaveToJson(){return Object.assign(super._SaveToJson(),{index:this._updatedIndex})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._updatedIndex=e.index)}}
e.PropertyTrackState.InstanceVariableSourceAdapter=t}{const e=self.C3;class t extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._sid=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[1]}GetTarget(){var e=this._propertyTrack.GetPropertyTrackDataItem(),t=this._propertyTrack.GetTrack();return e=this._sid?this._sid:e.GetSourceAdapterArguments()[0],t=t.GetInstance(),e=t.GetBehaviorIndexBySID(e),t.GetBehaviorInstances()[e].GetSdkInstance()}GetBehaviorType(e){const t=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[2];return e.GetBehaviorTypeByName(t)}UpdateBehaviorTypeSid(e){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]!==e&&(this._sid=e)}Interpolate(e,t,s,i,r){const n=this._propertyTrack.GetTrack().GetInstance();this.GetBehaviorType(n.GetObjectClass())&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){const i=this._propertyTrack.GetTrack().GetInstance();if(this.GetBehaviorType(i.GetObjectClass()))return super.GetInterpolatedValue(e,t,s)}_SaveToJson(){return Object.assign(super._SaveToJson(),{sid:this._sid})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._sid=e.sid)}}e.PropertyTrackState.BehaviorSourceAdapter=t}{const e=self.C3;class t extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[1]}GetTarget(){const e=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList();var t=e.GetEffectList();return t=this.GetEffectType(t).GetIndex(),e.IsEffectIndexActive(t)?e.GetEffectParametersForIndex(t):null}GetEffectType(e){const t=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0];return e.GetEffectTypeByName(t)}Interpolate(e,t,s,i,r){this._IsEffectActive()&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){if(this._IsEffectActive())return super.GetInterpolatedValue(e,t,s)}_IsEffectActive(){const e=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList();var t=e.GetEffectList();if(t=this.GetEffectType(t))return t=t.GetIndex(),e.IsEffectIndexActive(t)}}e.PropertyTrackState.EffectSourceAdapter=t}{const e=self.C3;class t extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[0]}GetTarget(){return this._propertyTrack.GetTrack().GetInstance().GetSdkInstance()}Interpolate(e,t,s,i,r){var n=this._propertyTrack.GetTrack();const a=n.GetObjectClass().GetPlugin();n=n.GetInstance().GetObjectClass().GetPlugin(),a===n&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){var i=this._propertyTrack.GetTrack();const r=i.GetObjectClass().GetPlugin();if(i=i.GetInstance().GetObjectClass().GetPlugin(),r===i)return super.GetInterpolatedValue(e,t,s)}}e.PropertyTrackState.PluginSourceAdapter=t}{const e=self.C3;class t extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._value=0,this._init=!1}MayNeedBeforeAndAfterInterpolate(){return!1}SetInitialState(){const e=this._propertyTrack.GetPropertyTrackData();let t=this._propertyTrack.GetPropertyTrackDataItem();t=e.GetFirstPropertyKeyframeDataItem(t),this._value=t.GetValueWithResultMode()}SetResumeState(){}GetValue(){return this._init||this._propertyTrack.Interpolate(0),this._value}Interpolate(t,s,i,r,n){this._value=e.PropertyTrackState.NumericTypeAdapter.Interpolate(t,s,i,this._propertyTrack),this._init=!0}SaveState(){}ClearSaveState(){}GetCurrentState(){return this._value}CompareInitialStateWithCurrent(){return!1}CompareSaveStateWithCurrent(){return!1}_SaveToJson(){return{value:this._value,init:this._init}}_LoadFromJson(e){e&&(this._value=e.value,this._init=!e.hasOwnProperty("init")||e.init)}}e.PropertyTrackState.ValueSourceAdapter=t}{const e=self.C3;class t extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._audioPlaybackStarted=!1,this._expressions=this._actions=this._sdkInstance=null,this._timeline=this._propertyTrack.GetTimeline(),this._track=this._propertyTrack.GetTrack(),this._sourceAdapterArgs=this._propertyTrack.GetSourceAdapterArgs(),this._fileArgs=this._sourceAdapterArgs[0],this._startOffsetTime=this._sourceAdapterArgs[1],this._audioTag=this._sourceAdapterArgs[3]?this._sourceAdapterArgs[3]:Math.random().toString(36).slice(2),this._volume=this._pauseVolume=this._pauseTime=NaN,this._audioSource=null,this._Initialize()}Release(){super.Release(),this._audioSource=this._fileArgs=this._sourceAdapterArgs=this._track=this._timeline=this._expressions=this._actions=this._sdkInstance=null}_Initialize(){if(self.C3.Plugins.Audio){var e=this._propertyTrack.GetRuntime().GetObjectClassByName("audio");e&&(this._sdkInstance=e.GetSingleGlobalInstance().GetSdkInstance()),this._actions=self.C3.Plugins.Audio.Acts,this._expressions=self.C3.Plugins.Audio.Exps}}_MaybeSetAudioSource(){if(!this._audioSource){var e=this._propertyTrack.GetTrack().GetPropertyTrack("audioSource");e&&(this._audioSource=e.GetSourceAdapter())}}_GetPauseVolume(){const e=this._propertyTrack.GetTrack().GetPropertyTrack("volume");return e?e.GetSourceAdapter()._pauseVolume:this._pauseVolume}TimelineRemoved(){super.TimelineRemoved(),this._audioPlaybackStarted=!1,this._sdkInstance&&(this._expressions&&(this._pauseTime=this._expressions.PlaybackTime.call(this._sdkInstance,this._audioTag),this._pauseVolume=this._expressions.Volume.call(this._sdkInstance,this._audioTag)),this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag))}GetAudioTag(){return this._audioTag}GetVolume(){return this._volume}SetVolume(e){this._volume=e}SetInitialState(){super.SetInitialState(),this._pauseTime=NaN,this._audioPlaybackStarted=!1}SetResumeState(){super.SetResumeState();const e=this._propertyTrack.GetTimeline().GetTime();switch(this._pauseTime=e-this._startOffsetTime,this._propertyTrack.GetPropertyName()){case"volume":this._pauseVolume=this._propertyTrack.GetInterpolatedValue(e)}this._audioPlaybackStarted=!1}Interpolate(e,t,s,i,r){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"audioSource":if(!this._timeline.IsForwardPlayBack())break;if(i){this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag);break}if(e<this._startOffsetTime){this._audioPlaybackStarted=!1;break}if(t=this._expressions.PlaybackRate.call(this._sdkInstance,this._audioTag),s=this._timeline.GetPlaybackRate(),s!==t&&this._actions.SetPlaybackRate.call(this._sdkInstance,this._audioTag,s),this._audioPlaybackStarted)break;if(this._audioPlaybackStarted=!0,isNaN(this._pauseTime)){const t=self.performance.now(),s=e-this._startOffsetTime;this._sdkInstance.PostToDOMAsync("get-suspended").then(e=>{if("suspended"===e)this._audioPlaybackStarted=!1;else if(e=(self.performance.now()-t)/1e3,e=s+e,this._actions){let t=this.GetVolume();isNaN(t)?(this.SetVolume(0),t=0):this.SetVolume(t),this._actions.Play.call(this._sdkInstance,this._fileArgs,0,t,this._audioTag,e)}})}else{const e=this._pauseTime;this._pauseTime=NaN;const t=this._GetPauseVolume();this._pauseVolume=NaN,this._sdkInstance.PostToDOMAsync("get-suspended").then(s=>{"suspended"===s?this._audioPlaybackStarted=!1:this._actions&&(this.SetVolume(t),this._actions.Play.call(this._sdkInstance,this._fileArgs,0,t,this._audioTag,e))})}break;case"volume":this._MaybeSetAudioSource(),super.Interpolate(e,t,s,i,r)}}GetInterpolatedValue(e,t,s){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"volume":return this._MaybeSetAudioSource(),super.GetInterpolatedValue(e,t,s)}}Getter(e,t){return this._audioSource?this._audioSource.GetVolume():0}Setter(e,t,s,i){this._audioSource&&this._audioSource.SetVolume(this.Getter()+t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}AbsoluteSetter(e,t,s){this._audioSource&&this._audioSource.SetVolume(t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}DoesRounding(){return!0}_SaveToJson(){return{audioPlaybackStarted:this._audioPlaybackStarted,audioTag:this._audioTag,pauseTime:this._pauseTime,pauseVolume:this._pauseVolume,volume:this._volume}}_LoadFromJson(e){e&&(this._audioPlaybackStarted=e.audioPlaybackStarted,this._audioTag=e.audioTag,this._pauseTime=e.pauseTime,this._pauseVolume=e.pauseVolume,this._volume=e.volume,this._Initialize())}}e.PropertyTrackState.AudioSourceAdapter=t}self.C3.PropertyTrackState.PropertyInterpolationAdapter=class{constructor(e){this._sourceAdapter=e,this._propertyTrack=e.GetPropertyTrack(),this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo(),this._property=this._propertyTrack.GetPropertyName(),this._firstAbsoluteUpdate=!1,this._target=this._saveState=null}Release(){this._target=this._saveState=this._worldInfo=this._propertyTrack=this._sourceAdapter=null}MayNeedBeforeAndAfterInterpolate(){return!1}TimelineRemoved(){}CleanCaches(){this._target=this._saveState=this._worldInfo=null}GetSourceAdapter(){return this._sourceAdapter}GetPropertyTrack(){return this._propertyTrack}GetWorldInfo(){return this._worldInfo?this._worldInfo:this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo()}SetFirstAbsoluteUpdate(e){this._firstAbsoluteUpdate=!!e}GetFirstAbsoluteUpdate(){return this._firstAbsoluteUpdate}SetInitialState(){}SetResumeState(){}SetSaveState(){this._saveState=this.GetCurrentState()}ClearSaveState(){this._saveState=null}GetCurrentState(){}CompareInitialStateWithCurrent(){}CompareSaveStateWithCurrent(){}CanChange(e){return typeof this._Getter()==typeof e}BeforeChangeProperty(){}ChangeProperty(e,t,s,i,r){}AfterChangeProperty(){}_FirstKeyframeGetter(){return this._PickTimelinePlaybackMode(()=>{const e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(e)},()=>{const e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e)}).GetAbsoluteValue()}_CurrentKeyframeGetter(){const e=this._propertyTrack.GetTimeline().GetTime()-this._propertyTrack.GetTrack().GetStartOffset();return this._PickTimelinePlaybackMode(()=>{const t=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,t)},()=>{const t=this._propertyTrack.GetPropertyTrackDataItem(),s=this._propertyTrack.GetPropertyTrackData(),i=s.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,t);return i||s.GetLastPropertyKeyframeDataItem(t)}).GetAbsoluteValue()}_PickTimelinePlaybackMode(e,t){return this._propertyTrack.GetTimeline().IsForwardPlayBack()?e():t()}_PickResultMode(e,t){return"relative"===this._propertyTrack.GetResultMode()?e():t()}_PickFirstAbsoluteUpdate(e,t){return this.GetFirstAbsoluteUpdate()?(this.SetFirstAbsoluteUpdate(!1),e()):t()}_GetAbsoluteInitialValue(e){}_GetIndex(){return this._sourceAdapter.GetIndex()}_GetTarget(){return this._target?this._target:this._target=this._sourceAdapter.GetTarget()}_PickSource(e,t,s,i,r,n){switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":return e();case"effect":return t();case"instance-variable":return s();case"plugin":return i();case"world-instance":return r();case"audio":return n()}}_SaveToJson(){return{firstAbsoluteUpdate:this._firstAbsoluteUpdate,saveState:this._saveState}}_LoadFromJson(e){e&&(this._firstAbsoluteUpdate=e.firstAbsoluteUpdate,this._saveState=e.saveState)}_GetPropertyKeyframeStubs(e,t=!1){const s=[];for(const i of e){e=i.GetTrack().GetStartOffset();for(const r of i.GetPropertyKeyframeDataItems())t&&0===r.GetTime()?s.push({time:e+r.GetTime(),value:r.GetAbsoluteValue()}):t||s.push({time:e+r.GetTime(),value:r.GetAbsoluteValue()})}return s.sort((e,t)=>e.time-t.time)}_GetLastPropertyKeyframeStub(e,t,s){return this._GetPropertyKeyframeStubLowerThanPlayhead(t,s)}_GetPropertyKeyframeStubLowerThanPlayhead(e,t){for(let s=t.length-1;0<=s;s--)if(t[s].time<=e)return t[s];return null}};{const e=self.C3,t=new Map,s=[0,0,0];class i extends e.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetInitialState(){}SetResumeState(){}GetCurrentState(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return this._ToColorArray(t.GetPropertyValueByIndex(s));case"effect":return this._ToColorArray(t[s]);case"plugin":return this._ToColorArray(t.GetPropertyValueByIndex(s));case"world-instance":return this._ToColorArray(this._Getter())}}CompareInitialStateWithCurrent(){const e=this._FirstKeyframeGetter();return!this._CompareColors(e,this._Getter())}CompareSaveStateWithCurrent(){return!e.IsNullOrUndefined(this._saveState)&&!this._CompareColors(this._saveState,this._Getter())}_CompareColors(e,t){return e.equalsIgnoringAlpha(t)}_FirstKeyframeGetter(){const e=super._FirstKeyframeGetter();return this._GetColorFromArray(e)}_CurrentKeyframeGetter(){const e=super._CurrentKeyframeGetter();return this._GetColorFromArray(e)}_GetAbsoluteInitialValue(e){}_ToColorArray(t){return e.IsInstanceOf(t,e.Color)?t.toArray().slice(0,3):t.slice(0,3)}_GetColorFromArray(t){return e.IsInstanceOf(t,e.Color)?t:new e.Color(t[0],t[1],t[2],1)}CanChange(e){return!0}MayNeedBeforeAndAfterInterpolate(){return!0}BeforeChangeProperty(){var s=this._propertyTrack.GetTimeline(),i=this._propertyTrack.GetInstance();const r=this._propertyTrack.GetSourceAdapter();(s=s.GetSimilarPropertyTracks(i,r,this._property))&&1<s.length&&(t.has(i)||t.set(i,new Map),i=t.get(i),s=this._propertyTrack.GetSourceAdapterId(),i.has(s)||i.set(s,new Map),i=i.get(s),i.has(this._property)||i.set(this._property,{used:!1,color:new e.Color(0,0,0,1)}))}_GetTmpColor(e,s,i){return e=t.get(e).get(s).get(i),e.used=!0,e.color}ChangeProperty(t,s,i,r,n){n=this._propertyTrack.GetTimeline(),r=this._propertyTrack.GetTrack(),t=this._propertyTrack.GetInstance();var a=this._propertyTrack.GetSourceAdapter();i=this._propertyTrack.GetSourceAdapterId(),(a=n.GetSimilarPropertyTracks(t,a,this._property))&&1<a.length?(a=this._GetPropertyKeyframeStubs(a,!0),(n=this._GetLastPropertyKeyframeStub(n,n.GetTime(),a))&&(r=r.GetStartOffset(),a=n.time-r,0===a?this._GetTmpColor(t,i,this._property).addRgb(s[0],s[1],s[2]):0>a||(n=s[0],r=s[1],s=s[2],a=this._propertyTrack.Interpolate(a,!1,!0),n=e.Color.DiffChannel(n,a[0]),r=e.Color.DiffChannel(r,a[1]),s=e.Color.DiffChannel(s,a[2]),this._GetTmpColor(t,i,this._property).addRgb(n,r,s)))):this._Setter(s[0],s[1],s[2])}AfterChangeProperty(){const e=this._propertyTrack.GetInstance();if(t.has(e)){var s=t.get(e),i=this._propertyTrack.GetSourceAdapterId();if(s.has(i)){var r=s.get(i);if(r.has(this._property)){var n=r.get(this._property),a=n.color;n.used&&this._Setter(a.getR(),a.getG(),a.getB()),0===r.size&&s.delete(i),0===s.size&&t.delete(e)}}}}_Getter(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return this._GetColorFromArray(t.GetPropertyValueByIndex(s));case"effect":return t[s].clone();case"plugin":return this._GetColorFromArray(t.GetPropertyValueByIndex(s));case"world-instance":return this.GetWorldInfo().GetUnpremultipliedColor().clone()}}_Setter(e,t,i){const r=this._propertyTrack.GetSourceAdapterId(),n=this._GetTarget(),a=this._GetIndex();switch(r){case"behavior":s[0]=e,s[1]=t,s[2]=i,n.SetPropertyValueByIndex(a,s);break;case"effect":n[a].setRgb(e,t,i);break;case"plugin":s[0]=e,s[1]=t,s[2]=i,n.SetPropertyValueByIndex(a,s);break;case"world-instance":this.GetWorldInfo().SetUnpremultipliedColorRGB(e,t,i)}}_SaveToJson(){}_LoadFromJson(e){}}e.PropertyTrackState.PropertyInterpolationAdapter.ColorInterpolationAdapter=i}{const e=self.C3,t=e.PropertyTrackState;class s extends e.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetInitialState(){}SetResumeState(){}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!e.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}MayNeedBeforeAndAfterInterpolate(){return!1}ChangeProperty(e,s,i,r,n){i=this._propertyTrack;const a=i.GetTrack();r=i.GetSourceAdapterId(),n=i.GetTimeline();var o=a.GetInstance();const h=i.GetSourceAdapter();switch((o=n.GetSimilarPropertyTracks(o,h,this._property))&&1<o.length&&(o=this._GetPropertyKeyframeStubs(o),e+=a.GetStartOffset(),e=this._GetLastPropertyKeyframeStub(n,e,o))&&(s=e.value),i.GetPropertyKeyframeType()){case"numeric":if(!t.NumericTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,r))return;break;case"angle":if(!t.AngleTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,r))return;break;case"boolean":if(!t.BooleanTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,r))return;break;case"color":if(!t.ColorTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,r))return;break;case"text":if(!t.TextTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,r))return}this._Setter(s)}_Getter(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return t.GetPropertyValueByIndex(s);case"effect":return t[s];case"instance-variable":return t.GetInstanceVariableValue(s);case"plugin":return t.GetPropertyValueByIndex(s)}}_Setter(e){const t=this._propertyTrack.GetSourceAdapterId(),s=this._GetTarget(),i=this._GetIndex();switch(t){case"behavior":s.SetPropertyValueByIndex(i,e);break;case"effect":s[i]=e;break;case"instance-variable":s.SetInstanceVariableValue(i,e);break;case"plugin":s.SetPropertyValueByIndex(i,e)}}}e.PropertyTrackState.PropertyInterpolationAdapter.NoInterpolationAdapter=s}{const e=self.C3,t=new Map,s=(e,s,i,r,n)=>t.set(e,{setter:s,absolute_setter:i,getter:r,round:n});s("offsetX",(e,t)=>e.OffsetX(t),(e,t)=>e.SetX(t),e=>e.GetX(),!0),s("offsetY",(e,t)=>e.OffsetY(t),(e,t)=>e.SetY(t),e=>e.GetY(),!0),s("offsetWidth",(e,t)=>e.OffsetWidth(t),(e,t)=>e.SetWidth(t),e=>e.GetWidth(),!0),s("offsetHeight",(e,t)=>e.OffsetHeight(t),(e,t)=>e.SetHeight(t),e=>e.GetHeight(),!0),s("offsetAngle",(e,t)=>e.OffsetAngle(t),(e,t)=>e.SetAngle(t),e=>e.GetAngle(),!1),s("offsetOpacity",(e,t,s,i)=>{s=e.GetOpacity()+t,0===i._clampAccumulator?(1<s?i._clampAccumulator+=s-1:0>s&&(i._clampAccumulator+=s),e.OffsetOpacity(t)):(e=e.GetOpacity()+t,0<t&&0<i._clampAccumulator?1<e&&(i._clampAccumulator+=e-1):0<t&&0>i._clampAccumulator?(i._clampAccumulator+=t,0<i._clampAccumulator&&(i._clampAccumulator=0)):0>t&&0<i._clampAccumulator?(i._clampAccumulator+=t,0>i._clampAccumulator&&(i._clampAccumulator=0)):0>t&&0>i._clampAccumulator&&0>e&&(i._clampAccumulator+=e))},(e,t)=>{e.SetOpacity(t)},e=>e.GetOpacity(),!1),s("offsetOriginX",(e,t)=>e.OffsetOriginX(t),(e,t)=>e.SetOriginX(t),e=>e.GetOriginX(),!1),s("offsetOriginY",(e,t)=>e.OffsetOriginY(t),(e,t)=>e.SetOriginY(t),e=>e.GetOriginY(),!1),s("offsetZElevation",(e,t)=>e.OffsetZElevation(t),(e,t)=>e.SetZElevation(t),e=>e.GetZElevation(),!0),s("offsetScaleX",(e,t,s,i)=>{i=0>e.GetWidth()?-1:1,e.GetTransformWithParentWidth(),e.OffsetWidth(s.GetOriginalWidth()*i*t)},(e,t,s)=>{e.SetWidth(s.GetOriginalWidth()*t)},(e,t)=>{const s=0>e.GetWidth()?-1:1;if(e.GetTransformWithParentWidth()){var i=e.GetParent(),r=t.GetTimeline().GetTrackFromInstance(i.GetInstance());return r?i=i.GetWidth()/r.GetOriginalWidth():(r=i.GetInstance().GetSdkInstance(),i=r.IsOriginalSizeKnown()?i.GetWidth()/r.GetOriginalWidth():1),e.GetWidth()*s/(t.GetOriginalWidth()*i)}return e.GetWidth()*s/t.GetOriginalWidth()},!1),s("offsetScaleY",(e,t,s,i)=>{i=0>e.GetHeight()?-1:1,e.GetTransformWithParentHeight(),e.OffsetHeight(s.GetOriginalHeight()*i*t)},(e,t,s)=>{e.SetHeight(s.GetOriginalHeight()*t)},(e,t)=>{const s=0>e.GetHeight()?-1:1;if(e.GetTransformWithParentHeight()){var i=e.GetParent(),r=t.GetTimeline().GetTrackFromInstance(i.GetInstance());return r?i=i.GetHeight()/r.GetOriginalHeight():(r=i.GetInstance().GetSdkInstance(),i=r.IsOriginalSizeKnown()?i.GetHeight()/r.GetOriginalHeight():1),e.GetHeight()*s/(t.GetOriginalHeight()*i)}return e.GetHeight()*s/t.GetOriginalHeight()},!1);class i extends e.PropertyTrackState.PropertyInterpolationAdapter{constructor(s){super(s),this._clampAccumulator=this._lastValue=0,this._source_adapter_absolute_setter=this._source_adapter_setter=this._source_adapter_getter=this._instance_absolute_setter=this._instance_setter=this._instance_getter=null,this._round=!1,e.IsInstanceOf(this._propertyTrack.GetTimeline(),e.TweenState)?this._typeAdapter=new e.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween(this):this._typeAdapter=new e.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline(this);const i=this._propertyTrack.GetPropertyName();switch(this._propertyTrack.GetSourceAdapterId()){case"world-instance":s=t.get(i),this._instance_getter=s.getter,this._instance_setter=s.setter,this._instance_absolute_setter=s.absolute_setter,this._round=s.round;break;case"audio":this._source_adapter_getter=s.Getter,this._source_adapter_setter=s.Setter,this._source_adapter_absolute_setter=s.AbsoluteSetter,this._round=!!s.DoesRounding()}}Release(){this._instance_absolute_setter=this._instance_setter=this._instance_getter=this._typeAdapter=null,super.Release()}MayNeedBeforeAndAfterInterpolate(){return this._typeAdapter.MayNeedBeforeAndAfterInterpolate()}GetLastValue(){return this._lastValue}SetLastValue(e){this._lastValue=e}SetInitialState(){const e=this._typeAdapter.SetInitialState();"number"==typeof e&&(this._lastValue=e),this._clampAccumulator=0}SetResumeState(){const e=this._typeAdapter.SetResumeState();"number"==typeof e&&(this._lastValue=e)}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!e.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}BeforeChangeProperty(){this._typeAdapter.BeforeChangeProperty()}ChangeProperty(e,t,s,i,r,n,a){return this._typeAdapter.ChangeProperty(e,t,s,i,r,n,a)}AfterChangeProperty(){this._typeAdapter.AfterChangeProperty()}_Getter(){const e=this._GetTarget(),t=this._GetIndex(),s=this.GetWorldInfo(),i=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":return e.GetPropertyValueByIndex(t);case"effect":return e[t];case"instance-variable":return e.GetInstanceVariableValue(t);case"plugin":return e.GetPropertyValueByIndex(t);case"world-instance":return this._instance_getter(s,i);case"audio":return this._source_adapter_getter.call(this.GetSourceAdapter(),s,i)}}_Setter(e,t,s){t=this._GetTarget(),s=this._GetIndex();const i=this.GetWorldInfo(),r=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":t.OffsetPropertyValueByIndex(s,e);break;case"effect":t[s]+=e;break;case"instance-variable":t.SetInstanceVariableOffset(s,e);break;case"plugin":t.OffsetPropertyValueByIndex(s,e);break;case"world-instance":this._instance_setter(i,e,r,this);break;case"audio":this._source_adapter_setter.call(this.GetSourceAdapter(),i,e,r,this)}}_SetterAbsolute(e,t,s){t=this._GetTarget(),s=this._GetIndex();const i=this.GetWorldInfo(),r=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":t.SetPropertyValueByIndex(s,e);break;case"effect":t[s]=e;break;case"instance-variable":t.SetInstanceVariableValue(s,e);break;case"plugin":t.SetPropertyValueByIndex(s,e);break;case"world-instance":this._instance_absolute_setter(i,e,r);break;case"audio":this._source_adapter_absolute_setter.call(this.GetSourceAdapter(),i,e,r)}}_MaybeEnsureValue(e,t,s,i,r,n){this._typeAdapter._MaybeEnsureValue(e,t,s,i,r,n)}_AddDelta(t,s,i){var r=(t.toString().split(".")[1]||"").length;t=this._Getter(),r=0===r?this._round?Math.round(t):t:e.toFixed(t,r),this._Setter(r-t,s,i)}_SaveToJson(){return Object.assign(super._SaveToJson(),{v:this._lastValue,a:this._clampAccumulator})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._lastValue=e.v,this._clampAccumulator=e.a)}}e.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapter=i}{class e{constructor(e){this._used=!1,this._value=0,this._propertyTracks=e;for(let e=0,t=this._propertyTracks.length;e<t;e++)this._propertyTracks[e].SetAbsoluteValueObject(this)}GetPropertyTracks(){return this._propertyTracks}SetUsed(){this._used=!0}GetUsed(){return this._used}SetValue(e){this._value=e}GetValue(){return this._value}Reset(){this._used=!1,this._value=0}}class t{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}SetInitialState(){const e=this._numericInterpolationAdapter;return this._numericInterpolationAdapter.GetPropertyTrack(),e._PickResultMode(()=>e._PickTimelinePlaybackMode(()=>0,()=>e.GetSourceAdapter().GetValueAtTime()),()=>{})}SetResumeState(){}MayNeedBeforeAndAfterInterpolate(){switch(this._numericInterpolationAdapter.GetPropertyTrack().GetResultMode()){case"relative":return!1;case"absolute":return!0}}BeforeChangeProperty(){var t=this._numericInterpolationAdapter.GetPropertyTrack(),s=t.GetPropertyName();switch(t.GetResultMode()){case"absolute":if(t.HasAbsoluteValueObject())t.GetAbsoluteValueObject().Reset();else{const i=t.GetTimeline(),r=t.GetInstance();t=t.GetSourceAdapter(),(s=i.GetSimilarPropertyTracks(r,t,s))&&1<s.length&&new e(s)}}}ChangeProperty(e,t,s,i,r,n){var a=this._numericInterpolationAdapter,o=this._numericInterpolationAdapter.GetPropertyTrack();switch(o.GetResultMode()){case"relative":o=a.GetLastValue(),a._Setter(t-o,s,i),n&&this._MaybeEnsureValue(e,s,i,r,o,t),a.SetLastValue(t);break;case"absolute":i=o.GetTimeline(),s=o.GetTrack(),o.GetInstance(),o.GetSourceAdapter(),o.HasAbsoluteValueObject()?(e=o.GetAbsoluteValueObject(),r=e.GetPropertyTracks(),r=a._GetPropertyKeyframeStubs(r,!0),(a=a._GetLastPropertyKeyframeStub(i,i.GetTime(),r))&&(s=s.GetStartOffset(),a=a.time-s,0===a?(e.SetUsed(),e.SetValue(e.GetValue()+t)):0>a||(o=o.GetInterpolatedValue(a),e.SetUsed(),e.SetValue(e.GetValue()+(t-o))))):a._SetterAbsolute(t)}}AfterChangeProperty(){const e=this._numericInterpolationAdapter;var t=this._numericInterpolationAdapter.GetPropertyTrack();switch(t.GetResultMode()){case"absolute":t.HasAbsoluteValueObject()&&(t=t.GetAbsoluteValueObject(),t.GetUsed()&&e._SetterAbsolute(t.GetValue()))}}_MaybeEnsureValue(e,t,s,i,r,n){const a=this._numericInterpolationAdapter;i||(t&&e===t.GetTime()?a._AddDelta(t.GetValueWithResultMode(),t,s):s&&e===s.GetTime()?a._AddDelta(s.GetValueWithResultMode(),t,s):0==n-r&&a._AddDelta(t.GetValueWithResultMode(),t,s))}}self.C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline=t}{class e{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}SetInitialState(){const e=this._numericInterpolationAdapter;return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._FirstKeyframeGetter())}SetResumeState(){const e=this._numericInterpolationAdapter;if(e._FirstKeyframeGetter()!==e._CurrentKeyframeGetter())return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._CurrentKeyframeGetter())}MayNeedBeforeAndAfterInterpolate(){return!1}BeforeChangeProperty(){}ChangeProperty(e,t,s,i,r,n){const a=this._numericInterpolationAdapter,o=a.GetLastValue();switch(a.GetPropertyTrack().GetResultMode()){case"relative":a._Setter(t-o,s,i),n&&this._MaybeEnsureValue(e,s,i,r,o,t);break;case"absolute":a.GetFirstAbsoluteUpdate()?(a.SetFirstAbsoluteUpdate(!1),a._Setter(o,s,i)):(a._Setter(t-o,s,i),n&&this._MaybeEnsureValue(e,s,i,r,o,t))}a.SetLastValue(t)}AfterChangeProperty(){}_GetAbsoluteInitialValue(e){return e-this._numericInterpolationAdapter.GetCurrentState()}_MaybeEnsureValue(e,t,s,i,r,n){const a=this._numericInterpolationAdapter;i?t&&e===t.GetTime()?a._AddDelta(t.GetValueWithResultMode(),t,s):s&&e===s.GetTime()?a._AddDelta(s.GetValueWithResultMode(),t,s):s||a._AddDelta(t.GetValueWithResultMode(),t,s):t&&e===t.GetTime()?a._AddDelta(t.GetValueWithResultMode(),t,s):s&&e===s.GetTime()?a._AddDelta(s.GetValueWithResultMode(),t,s):0==n-r&&a._AddDelta(t.GetValueWithResultMode(),t,s)}}self.C3.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween=e}{const e=self.C3,t=self.Ease;e.PropertyTrackState.NumericTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return r!==s}static Interpolate(s,i,r,n){if(!r)return r=n.GetPropertyTrackDataItem(),r=n.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(r),r.GetValueWithResultMode();var a=n.GetInterpolationMode();if("default"===a&&(a="continuous"),"combo"===n.GetPropertyType()&&(a="discrete"),"discrete"===a)return i.GetValueWithResultMode();if("continuous"===a||"step"===a){"step"===a&&(a=n.GetTimeline().GetStep(),0!==a&&(a=1/a,s=Math.floor(s*a)/a));var o=i.GetTime();const h=r.GetTime();a=i.GetValueWithResultMode();const l=r.GetValueWithResultMode();if(a===l)return a;s=e.normalize(s,o,h);const c=i.GetEase();return i=i.GetAddOn("cubic-bezier"),r=r.GetAddOn("cubic-bezier"),i&&i.GetStartEnable()&&r&&r.GetEndEnable()?(o=h-o,o=t.GetRuntimeEase(c)(o*s,0,1,o),o=t.GetRuntimeEase("cubicbezier")(o,a,a+i.GetStartAnchor(),l+r.GetEndAnchor(),l)):o=t.GetRuntimeEase(c)((h-o)*s,a,l-a,h-o),"integer"===n.GetPropertyType()?Math.floor(o):o}}}}{const e=self.C3;e.PropertyTrackState.AngleTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return r!==s}static Interpolate(t,s,i,r){if(!i)return s=r.GetPropertyTrackDataItem(),s=r.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(s),s.GetValueWithResultMode();var n=r.GetInterpolationMode();if("default"===n&&(n="continuous"),"combo"===r.GetPropertyType()&&(n="discrete"),"discrete"===n)return s.GetValueWithResultMode();if("continuous"===n||"step"===n){"step"===n&&(r=r.GetTimeline().GetStep(),0!==r&&(r=1/r,t=Math.floor(t*r)/r));const a=s.GetTime(),o=i.GetTime();if(r=s.GetValueWithResultMode(),i=i.GetValueWithResultMode(),!(n=s.GetAddOn("angle")))return r===i?r:(t=e.normalize(t,a,o),s=self.Ease.GetRuntimeEase(s.GetEase()),e.angleLerp(r,i,s(t,0,1,1)));{const h=n.GetRevolutions();if(r===i&&0===h)return r;switch(t=e.normalize(t,a,o),s=self.Ease.GetRuntimeEase(s.GetEase())(t,0,1,1),n.GetDirection()){case"closest":return e.angleLerp(r,i,s,h);case"clockwise":return e.angleLerpClockwise(r,i,s,h);case"anti-clockwise":return e.angleLerpAntiClockwise(r,i,s,h)}}}}}}self.C3.PropertyTrackState.BooleanTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return!!r!=!!s}static Interpolate(e,t,s,i){return s?t.GetValueWithResultMode()?1:0:(e=i.GetPropertyTrackDataItem(),e=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e),e.GetValueWithResultMode()?1:0)}};{const e=self.C3,t=[0,0,0],s=[0,0,0],i=[0,0,0];e.PropertyTrackState.ColorTypeAdapter=class{constructor(){}static WillChange(e,r,n,a){let o;switch(a){case"behavior":o=r.GetPropertyValueByIndex(e);break;case"effect":o=r[e];break;case"instance-variable":o=r.GetInstanceVariableValue(e);break;case"plugin":o=r.GetPropertyValueByIndex(e)}return Array.isArray(n)?(t[0]=n[0],t[1]=n[1],t[2]=n[2]):(i.parseCommaSeparatedRgb(n),t[0]=Math.floor(255*i.getR()),t[1]=Math.floor(255*i.getG()),t[2]=Math.floor(255*i.getB())),Array.isArray(o)?(s[0]=o[0],s[1]=o[1],s[2]=o[2]):(i.parseCommaSeparatedRgb(o),
s[0]=Math.floor(255*i.getR()),s[1]=Math.floor(255*i.getG()),s[2]=Math.floor(255*i.getB())),t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]}static Interpolate(s,i,r,n){if(!r){var a=n.GetPropertyTrackDataItem();return a=n.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(a),n=a.GetValueWithResultMode(),t[0]=n[0],t[1]=n[1],t[2]=n[2],t}if(a=n.GetInterpolationMode(),"default"===a&&(a="continuous"),"discrete"===a)return n=i.GetValueWithResultMode(),t[0]=n[0],t[1]=n[1],t[2]=n[2],t;if("continuous"===a||"step"===a){"step"===a&&(n=n.GetTimeline().GetStep(),0!==n&&(n=1/n,s=Math.floor(s*n)/n)),n=i.GetTime(),a=r.GetTime();var o=i.GetValueWithResultMode(),h=r.GetValueWithResultMode();s=e.normalize(s,n,a);var l=i.GetEase();i=o[0],r=o[1],o=o[2];const c=h[0],u=h[1];return h=h[2],l=self.Ease.GetRuntimeEase(l),n=a-n,a=n*s,t[0]=i===c?i:l(a,i,c-i,n),t[1]=r===u?r:l(a,r,u-r,n),t[2]=o===h?o:l(a,o,h-o,n),t}}}}self.C3.PropertyTrackState.TextTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e)}return r!==s}static Interpolate(e,t,s,i){return s?t.GetValueWithResultMode():(e=i.GetPropertyTrackDataItem(),e=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e),e.GetValueWithResultMode())}};{const e=self.C3;e.TimelineDataManager=class{constructor(){this._timelineDataItems=new Map}Release(){for(const e of this._timelineDataItems.values())e.Release();this._timelineDataItems.clear(),this._timelineDataItems=null}Add(t){t=new e.TimelineDataItem(t);const s=t.GetName();this._timelineDataItems.set(s,t)}Get(e){return this._timelineDataItems.get(e)}GetNameId(){return 0}static _CreateDataItems(t,s,i,r){if(s)for(const n of s)e.TimelineDataManager._CreateDataItem("create",n,t,i,r)}static _LoadDataItemsFromJson(t,s,i,r){t.length?s.forEach((e,s)=>{t[s]._LoadFromJson(e)}):s.forEach(s=>{e.TimelineDataManager._CreateDataItem("load",s,t,i,r)})}static _CreateDataItem(e,t,s,i,r){let n;if("function"==typeof i)switch(e){case"load":n=new i(null,r);break;case"create":n=new i(t,r)}else if("object"==typeof i)switch(i=i.map.get(t[i.prop]),e){case"load":n=new i(null,r);break;case"create":n=new i(t,r)}switch(e){case"load":n._LoadFromJson(t),s.push(n);break;case"create":if("function"==typeof n.GetEnable&&!n.GetEnable())return n.Release();s.push(n)}}}}{const e=self.C3;e.TimelineDataItem=class{constructor(t){this._name="",this._totalTime=NaN,this._step=0,this._resultMode=this._interpolationMode="default",this._pingPong=this._loop=!1,this._repeatCount=1,this._trackData=null,t&&(this._name=t[0],this._totalTime=t[1],this._step=t[2],this._interpolationMode=t[3],this._resultMode=t[4],this._loop=!!t[6],this._pingPong=!!t[7],this._repeatCount=t[8],this._trackData=new e.TrackData(t[5],this))}Release(){this._trackData.Release(),this._trackData=null}GetTrackData(){return this._trackData||(this._trackData=new e.TrackData(null,this)),this._trackData}GetName(){return this._name}SetName(e){this._name=e}GetTotalTime(){return this._totalTime}SetTotalTime(e){this._totalTime=e}GetStep(){return this._step}SetStep(e){this._step=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetLoop(){return this._loop}SetLoop(e){this._loop=e}GetPingPong(){return this._pingPong}SetPingPong(e){this._pingPong=e}GetRepeatCount(){return this._repeatCount}_SaveToJson(){return{trackDataJson:this._trackData._SaveToJson(),name:this._name,totalTime:this._totalTime,step:this._step,interpolationMode:this._interpolationMode,resultMode:this._resultMode,loop:this._loop,pingPong:this._pingPong,repeatCount:this._repeatCount}}_LoadFromJson(e){e&&(this.GetTrackData()._LoadFromJson(e.trackDataJson),this._name=e.name,this._totalTime=e.totalTime,this._step=e.step,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._loop=e.loop,this._pingPong=e.pingPong,this._repeatCount=e.repeatCount)}}}{const e=self.C3;class t{constructor(t,s){this._trackData=s,this._additionalInstanceData=this._instanceData=null,this._objectClassIndex=this._instanceUid=NaN,this._resultMode=this._interpolationMode="default",this._enabled=!1,this._propertyTrackData=this._keyframeData=null,this._id="",this._nestedData=null,this._startOffset=0,this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),this._type=0,this._name="",t&&(t[0]&&(this._instanceData=t[0],this._instanceUid=t[0][2],this._objectClassIndex=t[0][1]),this._interpolationMode=t[1],this._resultMode=t[2],this._enabled=!!t[3],t[6]&&(this._id=t[6]),t[7]&&(this._nestedData=t[7],this._startOffset=t[7][0],this._localTotalTime=t[7][1]),t[8]&&(this._additionalInstanceData=t[8]),t[8]&&(this._additionalInstanceData=t[8]),t[9]&&(this._type=t[9]),t[10]&&(this._name=t[10]),this._keyframeData=new e.KeyframeData(t[4],this),this._propertyTrackData=new e.PropertyTrackData(t[5],this))}Release(){this._trackData=this._instanceData=null,this._keyframeData&&(this._keyframeData.Release(),this._keyframeData=null),this._propertyTrackData&&(this._propertyTrackData.Release(),this._propertyTrackData=null),this._nestedData=null}GetTrackData(){return this._trackData}GetKeyframeData(){return this._keyframeData||(this._keyframeData=new e.KeyframeData(null,this)),this._keyframeData}GetPropertyTrackData(){return this._propertyTrackData||(this._propertyTrackData=new e.PropertyTrackData(null,this)),this._propertyTrackData}GetInstanceData(){return this._instanceData}GetObjectClassIndex(){return this._objectClassIndex}SetObjectClassIndex(e){this._objectClassIndex=e}GetInstanceUID(){return this._instanceUid}SetInstanceUID(e){this._instanceUid=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}GetId(){return this._id}GetStartOffset(){return this._startOffset}GetLocalTotalTime(){return this._localTotalTime}SetLocalTotalTime(e){this._localTotalTime=e}GetOriginalWidth(){return this._additionalInstanceData[0]}SetOriginalWidth(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[0]=e}GetOriginalHeight(){return this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[1]}SetOriginalHeight(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[1]=e}GetType(){return this._type}GetName(){return this._name}_SaveToJson(){return{keyframeDataJson:this._keyframeData._SaveToJson(),propertyTrackDataJson:this._propertyTrackData._SaveToJson(),instanceData:this._instanceData,additionalInstanceData:this._additionalInstanceData,instanceUid:this._instanceUid,objectClassIndex:this._objectClassIndex,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,id:this._id,nestedData:this._nestedData,type:this._type,name:this._name}}_LoadFromJson(e){e&&(this._instanceData=e.instanceData,this._instanceUid=e.instanceUid,this._objectClassIndex=e.objectClassIndex,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._id=e.id,this._type=e.type?e.type:0,this._name=e.name?e.name:"",this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),e.nestedData&&(this._nestedData=e.nestedData,this._startOffset=this._nestedData[0],this._localTotalTime=this._nestedData[1]),e.additionalInstanceData&&(this._additionalInstanceData=e.additionalInstanceData),this.GetKeyframeData()._LoadFromJson(e.keyframeDataJson),this.GetPropertyTrackData()._LoadFromJson(e.propertyTrackDataJson))}}e.TrackData=class{constructor(s,i){this._timelineDataItem=i,this._trackDataItems=[],e.TimelineDataManager._CreateDataItems(this._trackDataItems,s,t,this)}Release(){this._timelineDataItem=null;for(const e of this._trackDataItems)e.Release();e.clearArray(this._trackDataItems),this._trackDataItems=null}GetTimelineDataItem(){return this._timelineDataItem}AddEmptyTrackDataItem(){const e=new t(null,this);return this._trackDataItems.push(e),e}GetFirstKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray()[0]}GetLastKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray().at(-1)}GetKeyFrameDataItemAtTime(e,t){t=t.GetKeyframeData().GetKeyframeDataItemArray();const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()===e)return s}}GetFirstKeyFrameDataItemHigherThan(e,t){t=t.GetKeyframeData().GetKeyframeDataItemArray();const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()>e)return s}}GetFirstKeyFrameDataItemHigherOrEqualThan(e,t){t=t.GetKeyframeData().GetKeyframeDataItemArray();const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()>=e)return s}}GetFirstKeyFrameDataItemLowerOrEqualThan(e,t){t=t.GetKeyframeData().GetKeyframeDataItemArray();for(let s=t.length-1;0<=s;s--){const i=t[s];if(i.GetTime()<=e)return i}}*trackDataItems(){for(const e of this._trackDataItems)yield e}_SaveToJson(){return{trackDataItemsJson:this._trackDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(s){s&&e.TimelineDataManager._LoadDataItemsFromJson(this._trackDataItems,s.trackDataItemsJson,t,this)}}}{const e=self.C3;class t{constructor(t,s){this._propertyTrackData=s,this._sourceAdapterId="",this._type=this._property=this._sourceAdapterArguments=null,this._max=this._min=NaN,this._resultMode=this._interpolationMode="default",this._enabled=!1,this._propertyKeyframeData=null,this._canHavePropertyKeyframes=!0,t&&(this._sourceAdapterId=t[0][0],this._sourceAdapterArguments=t[0].slice(1),this._property=t[1],this._type=t[2],this._min=t[3],this._max=t[4],this._interpolationMode=t[5],this._resultMode=t[6],this._enabled=!!t[7],this._propertyKeyframeData=new e.PropertyKeyframeData(t[8],this),this._canHavePropertyKeyframes=t[9])}Release(){this._propertyKeyframeData.Release(),this._sourceAdapterArguments=this._propertyTrackData=this._propertyKeyframeData=null}GetPropertyTrackData(){return this._propertyTrackData}GetPropertyKeyframeData(){return this._propertyKeyframeData||(this._propertyKeyframeData=new e.PropertyKeyframeData(null,this)),this._propertyKeyframeData}GetSourceAdapterId(){return this._sourceAdapterId}SetSourceAdapterId(e){this._sourceAdapterId=e}GetSourceAdapterArguments(){return this._sourceAdapterArguments}SetSourceAdapterArguments(e){this._sourceAdapterArguments=e}GetProperty(){return this._property}SetProperty(e){this._property=e}GetType(){return this._type}SetType(e){this._type=e}GetMin(){return this._min}SetMin(e){this._min=e}GetMax(){return this._max}SetMax(e){this._max=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}CanHavePropertyKeyframes(){return!!this._canHavePropertyKeyframes}_SaveToJson(){return{propertyKeyframeDataJson:this._propertyKeyframeData._SaveToJson(),sourceAdapterId:this._sourceAdapterId,sourceAdapterArguments:this._sourceAdapterArguments,property:this._property,type:this._type,min:this._min,max:this._max,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,canHavePropertyKeyframes:this._canHavePropertyKeyframes}}_LoadFromJson(e){e&&(this._sourceAdapterId=e.sourceAdapterId,this._sourceAdapterArguments=e.sourceAdapterArguments,this._property=e.property,this._type=e.type,this._min=e.min,this._max=e.max,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._canHavePropertyKeyframes=e.canHavePropertyKeyframes,this.GetPropertyKeyframeData()._LoadFromJson(e.propertyKeyframeDataJson))}}e.PropertyTrackData=class{constructor(s,i){this._trackDataItem=i,this._propertyTrackDataItems=[],e.TimelineDataManager._CreateDataItems(this._propertyTrackDataItems,s,t,this)}Release(){this._trackDataItem=null;for(const e of this._propertyTrackDataItems)e.Release();e.clearArray(this._propertyTrackDataItems),this._propertyTrackDataItems=null}GetTrackDataItem(){return this._trackDataItem}AddEmptyPropertyTrackDataItem(){const e=new t(null,this);return this._propertyTrackDataItems.push(e),e}GetFirstPropertyKeyframeDataItem(e){return e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()[0]}GetLastPropertyKeyframeDataItem(e){return e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray().at(-1)}GetPropertyKeyFrameDataItemAtTime(e,t){t=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()===e)return s}}GetFirstPropertyKeyFrameDataItemHigherThan(e,t){t=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()>e)return s}}GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,t){t=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetTime()>=e)return s}}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,t){t=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();for(let s=t.length-1;0<=s;s--){const i=t[s];if(i.GetTime()<=e)return i}}*propertyTrackDataItems(){for(const e of this._propertyTrackDataItems)yield e}_SaveToJson(){return{propertyTrackDataItemsJson:this._propertyTrackDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(s){s&&e.TimelineDataManager._LoadDataItemsFromJson(this._propertyTrackDataItems,s.propertyTrackDataItemsJson,t,this)}}}{const e=self.C3;class t{constructor(e,t){this._keyframeData=t,this._time=-1,this._ease="noease",this._enable=!1,this._lowerTags=this._tags=null,e&&(this._time=e[0],this._ease=e[1],this._enable=!!e[2],this._tags=(e=e[3])?e.split(" "):[],this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase())),this._next=null)}Release(){this._keyframeData=null,e.clearArray(this._tags),this._tags=null,this._lowerTags.clear(),this._lowerTags=null}GetKeyframeData(){return this._keyframeData}GetNext(){return this._next}SetNext(e){this._next=e}GetTime(){return this._time}SetTime(e){this._time=e,this._keyframeData._LinkKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetTags(){return this._tags}SetTags(e){this._tags=e?e.split(" "):[],this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase()))}GetLowerTags(){return this._lowerTags}HasTag(e){return this._lowerTags.has(e.toLowerCase())}_SaveToJson(){return{time:this._time,ease:this._ease,enable:this._enable,tags:this._tags}}_LoadFromJson(e){e&&(this._time=e.time,this._ease=e.ease,this._enable=e.enable,this._tags=e.tags,this._lowerTags=new Set(this._tags.map(e=>e.toLowerCase())))}}e.KeyframeData=class{constructor(s,i){this._trackDataItem=i,this._keyframeDataItems=[],e.TimelineDataManager._CreateDataItems(this._keyframeDataItems,s,t,this),this._LinkKeyframeDataItems()}Release(){this._trackDataItem=null;for(const e of this._keyframeDataItems)e.Release();e.clearArray(this._keyframeDataItems),this._keyframeDataItems=null}_LinkKeyframeDataItems(){this._keyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime());for(let e=0;e<this._keyframeDataItems.length;e++)this._keyframeDataItems[e].SetNext(this._keyframeDataItems[e+1])}GetTrackDataItem(){return this._trackDataItem}GetKeyframeDataItemCount(){return this._keyframeDataItems.length}GetKeyframeDataItemArray(){return this._keyframeDataItems}AddEmptyKeyframeDataItem(){const e=new t(null,this);return this._keyframeDataItems.push(e),this._LinkKeyframeDataItems(),e}DeleteKeyframeDataItems(e){for(const t of this._keyframeDataItems){if(!e(t))continue;const s=this._keyframeDataItems.indexOf(t);-1!==s&&(t.Release(),this._keyframeDataItems.splice(s,1))}this.SortKeyframeDataItems(),this._LinkKeyframeDataItems()}SortKeyframeDataItems(){this._keyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime())}GetKeyframeDataItemIndex(e){return this._keyframeDataItems.indexOf(e)}GetKeyframeDataItemFromIndex(e){return this._keyframeDataItems[e]}*keyframeDataItems(){for(const e of this._keyframeDataItems)yield e}*keyframeDataItemsReverse(){for(let e=this._keyframeDataItems.length-1;0<=e;e--)yield this._keyframeDataItems[e]}_SaveToJson(){return{keyframeDataItemsJson:this._keyframeDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(s){s&&(e.TimelineDataManager._LoadDataItemsFromJson(this._keyframeDataItems,s.keyframeDataItemsJson,t,this),this._LinkKeyframeDataItems())}}}{const e=self.C3;class t{constructor(t,s){this._propertyKeyframeData=s,this._aValue=this._value=null,this._type="",this._time=NaN,this._ease="noease",this._enable=!1,this._addonData=null,this._addonInstance=void 0,t&&(this._value=t[0][0],this._aValue=t[0][1],this._type=t[0][2],this._time=t[1],this._ease=t[2],this._enable=!!t[3],this._addonData=null,t[4]&&(this._addonData=new e.AddonData(t[4],this)),this._next=null)}Release(){this._propertyKeyframeData=null,this._addonData&&(this._addonData.Release(),this._addonData=null)}GetAddonData(){return this._addonData}SetNext(e){this._next=e}GetNext(){return this._next}GetValue(){return this._value}SetValue(t){"color"===this._type&&e.IsFiniteNumber(t)?(this._value[0]=e.GetRValue(t),this._value[1]=e.GetGValue(t),this._value[2]=e.GetBValue(t)):this._value=t}GetAbsoluteValue(){return this._aValue}SetAbsoluteValue(t){"color"===this._type&&e.IsFiniteNumber(t)?(this._aValue[0]=e.GetRValue(t),this._aValue[1]=e.GetGValue(t),this._aValue[2]=e.GetBValue(t)):this._aValue=t}GetValueWithResultMode(){const e=this._propertyKeyframeData.GetPropertyTrackDataItem().GetResultMode();return"relative"===e?this.GetValue():"absolute"===e?this.GetAbsoluteValue():void 0}GetType(){return this._type}SetType(e){this._type=e}GetTime(){return this._time}SetTime(e){this._time=e,this._propertyKeyframeData._LinkPropertyKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetAddOn(e){if(this._addonData){if(this._addonInstance||null===this._addonInstance)return this._addonInstance;var t=this._addonData.GetAddDataItemArray();if(!t)return this._addonInstance=null;var s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetId()===e)return this._addonInstance=s}return this._addonInstance=null}}_SaveToJson(){const e=this._addonData;return{addonDataJson:e?e._SaveToJson():e,value:this._value,aValue:this._aValue,type:this._type,time:this._time,ease:this._ease,enable:this._enable}}_LoadFromJson(e){e&&(e.addonDataJson&&this._addonData._SetFromJson(e.addonDataJson),this._value=e.value,this._aValue=e.aValue,this._type=e.type,this._time=e.time,this._ease=e.ease,this._enable=e.enable)}}e.PropertyKeyframeData=class{constructor(s,i){this._propertyTrackDataItem=i,this._propertyKeyframeDataItems=[],e.TimelineDataManager._CreateDataItems(this._propertyKeyframeDataItems,s,t,this),this._LinkPropertyKeyframeDataItems()}Release(){this._propertyTrackDataItem=null;for(const e of this._propertyKeyframeDataItems)e.Release();e.clearArray(this._propertyKeyframeDataItems),this._propertyKeyframeDataItems=null}_LinkPropertyKeyframeDataItems(){this._propertyKeyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime());for(let e=0;e<this._propertyKeyframeDataItems.length;e++)this._propertyKeyframeDataItems[e].SetNext(this._propertyKeyframeDataItems[e+1])}AddEmptyPropertyKeyframeDataItem(){const e=new t(null,this);return this._propertyKeyframeDataItems.push(e),this._LinkPropertyKeyframeDataItems(),e}DeletePropertyKeyframeDataItems(e){for(const t of this._propertyKeyframeDataItems){if(!e(t))continue;const s=this._propertyKeyframeDataItems.indexOf(t);-1!==s&&(t.Release(),this._propertyKeyframeDataItems.splice(s,1))}this.SortPropertyKeyFrameDataItems(),this._LinkPropertyKeyframeDataItems()}SortPropertyKeyFrameDataItems(){this._propertyKeyframeDataItems.sort((e,t)=>e.GetTime()-t.GetTime())}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyKeyframeDataItemCount(){return this._propertyKeyframeDataItems.length}GetPropertyKeyframeDataItemArray(){return this._propertyKeyframeDataItems}*propertyKeyframeDataItems(){for(const e of this._propertyKeyframeDataItems)yield e}*propertyKeyframeDataItemsReverse(){for(let e=this._propertyKeyframeDataItems.length-1;0<=e;e--)yield this._propertyKeyframeDataItems[e]}_SaveToJson(){return{propertyKeyframeDataItemsJson:this._propertyKeyframeDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(s){s&&(e.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItems,s.propertyKeyframeDataItemsJson,t,this),this._LinkPropertyKeyframeDataItems())}}}{const e=self.C3;class t{constructor(e,t){this._addonData=t,this._id=e[0],this._data=e[1]}Release(){this._data=this._addonData=null}GetAddonData(){return this._addonData}GetId(){return this._id}_SaveToJson(){return{id:this._id,data:this._data}}_LoadFromJson(e){e&&(this._id=e.id,this._data=e.data)}}class s extends t{constructor(e,t){super(e,t),this._startAnchor=this._data[0],this._startEnable=!!this._data[1],this._endAnchor=this._data[2],this._endEnable=!!this._data[3]}Release(){super.Release()}GetStartAnchor(){return this._startAnchor}GetStartEnable(){return this._startEnable}GetEndAnchor(){return this._endAnchor}GetEndEnable(){return this._endEnable}_SaveToJson(){return Object.assign(super._SaveToJson(),{startAnchor:this._startAnchor,startEnable:!!this._startEnable,endAnchor:this._endAnchor,endEnable:!!this._endEnable})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._startAnchor=e.startAnchor,this._startEnable=!!e.startEnable,this._endAnchor=e.endAnchor,this._endEnable=!!e.endEnable)}}class i extends t{constructor(e,t){super(e,t),this._direction=this._data[0],this._revolutions=this._data[1]}Release(){super.Release()}GetDirection(){return this._direction}GetRevolutions(){return this._revolutions}_SaveToJson(){return Object.assign(super._SaveToJson(),{direction:this._direction,revolutions:this._revolutions})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._direction=e.direction,this._revolutions=e.revolutions)}}e.AddonData=class{constructor(t,r){this._propertyKeyframeDataItem=r,this._addonDataItems=[],e.TimelineDataManager._CreateDataItems(this._addonDataItems,t,{prop:0,map:new Map([["cubic-bezier",s],["angle",i]])},this)}Release(){this._propertyKeyframeDataItem=null;for(const e of this._addonDataItems)e.Release();e.clearArray(this._addonDataItems),this._addonDataItems=null}GetPropertyKeyframeDataItem(){return this._propertyKeyframeDataItem}GetAddDataItemArray(){return this._addonDataItems}*addonDataItems(){for(const e of this._addonDataItems)yield e}_SaveToJson(){return{addonDataItemsJson:this._addonDataItems.map(e=>e._SaveToJson())}}_LoadFromJson(t){t&&e.TimelineDataManager._LoadDataItemsFromJson(this._addonDataItems,t.addonDataItemsJson,{prop:"id",map:new Map([["cubic-bezier",s],["angle",i]])},this)}}}{const e=self.C3;let t=0;e.TweenState=class extends e.TimelineState{constructor(e,s){super(`tween-${t++}`,e,s),this._id="",this._destroyInstanceOnComplete=!1,this._initialValueMode="start-value",this._track=this._on_started_callbacks=this._on_completed_callbacks=this._instance=null}CreateTrackStates(){for(const t of this._timelineDataItem.GetTrackData().trackDataItems())this._tracks.push(e.TweenTrackState.Create(this,t));this._track=this._tracks[0]}AddTrack(){var t=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();return t=e.TweenTrackState.Create(this,t),this._tracks.push(t),this._track=this._tracks[0],t}GetPropertyTrack(e){return this._track.GetPropertyTracks()[0]}SetPropertyType(e){this._propertyType=e}GetInstance(){var e=this.GetTracks();if(e&&e.length&&(this._track=e=e[0])){var t=e.GetInstance();return e.IsInstanceValid()?t:void 0}}AddStartedCallback(e){this._on_started_callbacks||(this._on_started_callbacks=[]),this._on_started_callbacks.push(e)}AddCompletedCallback(e){this._on_completed_callbacks||(this._on_completed_callbacks=[]),this._on_completed_callbacks.push(e)}RemoveStartedCallback(e){this._on_started_callbacks&&(e=this._on_started_callbacks.indexOf(e),-1!==e&&this._on_started_callbacks.splice(e,1))}RemoveCompletedCallback(e){this._on_completed_callbacks&&(e=this._on_completed_callbacks.indexOf(e),-1!==e&&this._on_completed_callbacks.splice(e,1))}SetStartValue(e,t){for(const i of this._tracks)for(const r of i._propertyTracks){if(r.GetPropertyName()!==t)continue;var s=r.GetPropertyTrackData();const i=r.GetPropertyTrackDataItem();s=s.GetFirstPropertyKeyframeDataItem(i),s.SetValue(e),s.SetAbsoluteValue(e)}}_GetPropertyTrackState(e){for(const t of this._tracks)for(const s of t._propertyTracks)if(s.GetPropertyName()===e)return s}BeforeSetEndValues(e){for(const t of e)e=this._GetPropertyTrackState(t),this.SetStartValue(e.GetCurrentState(),t);if(this.IsForwardPlayBack()){var t=this.GetTotalTime()-this.GetTime();for(var s of(this.SetTotalTime(t),this._tracks))s.SetLocalTotalTime(t);this._SetTime(0)}else{for(t of(s=this.GetTime(),this.SetTotalTime(s),this._tracks))t.SetLocalTotalTime(s);this._SetTime(s)}this.SetInitialStateFromSetTime()}SetEndValue(e,t){var s=this._GetPropertyTrackState(t);t=s.GetPropertyTrackData(),s=s.GetPropertyTrackDataItem(),t=t.GetLastPropertyKeyframeDataItem(s),t.SetTime(this.GetTotalTime()),t.SetValue(e),t.SetAbsoluteValue(e)}SetId(e){this._id=e}GetId(){return this._id}SetInitialValueMode(e){this._initialValueMode=e}GetInitialValueMode(){return this._initialValueMode}SetDestroyInstanceOnComplete(e){this._destroyInstanceOnComplete=e}GetDestroyInstanceOnComplete(){return this._destroyInstanceOnComplete}OnStarted(){if(this._on_started_callbacks)for(const e of this._on_started_callbacks)e(this);if(!this.IsComplete())for(const e of this._tracks)e.CompareSaveStateWithCurrent()}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){if(!this._finishedTriggers&&(this._finishedTriggers=!0,this._on_completed_callbacks))for(const e of this._on_completed_callbacks)e(this)}SetTime(e){this._DeleteIntermediateKeyframes(),super.SetTime(e)}SetInitialState(e){if(!this.InitialStateSet()&&"current-state"===this.GetInitialValueMode())for(const e of this._tracks)e.CompareInitialStateWithCurrent();super.SetInitialState(e)}Stop(e=!1){if(super.Stop(e),!this.IsComplete())for(const e of this._tracks)e.SaveState()}Reset(e=!0,t=!1){this._DeleteIntermediateKeyframes(),super.Reset(e,t)}_DeleteIntermediateKeyframes(){for(const e of this._tracks){const t=e=>{e=e.GetTime();const t=this.GetTotalTime();return 0!==e&&e!==t};e.DeleteKeyframes(t),e.DeletePropertyKeyframes(t)}}_OnBeforeChangeLayout(){if(this.IsReleased())return!0;const e=this.GetInstance();return(!e||!e.GetObjectClass().IsGlobal())&&(this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.ResetBeforeChangeLayout(),!0)}Tick(e,t,s){if(this._instance||(this._instance=this.GetInstance()),this._instance&&!this._instance.IsDestroyed()&&(t=this._instance.GetTimeScale(),-1!==t&&(e=s*t),0!==e||0!==this._lastDelta)){this._lastDelta=e,s=this._playheadTime+e*this._playbackRate,e=this._timelineDataItem._totalTime,this._playheadTime=0>s?0:s>=e?e:s,s=!1,t=this.GetLoop();var i=this.GetPingPong();t||i?t&&!i?0<this._playbackRate?this._playheadTime>=e&&this._SetTime(0):0>=this._playheadTime&&this._SetTime(e):!t&&i?0<this._playbackRate?this._playheadTime>=e&&(this._SetTime(e),this.SetPlaybackRate(-1*this.GetPlaybackRate()),1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):s=!0:0===this._pingPongState&&(this._pingPongState=1)):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),1===this._pingPongState?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=0):s=!0:0===this._pingPongState&&(this._pingPongState=1)):t&&i&&(0<this._playbackRate?this._playheadTime>=e&&(this._SetTime(e),this.SetPlaybackRate(-1*this.GetPlaybackRate())):0>=this._playheadTime&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()))):0<this._playbackRate?this._playheadTime>=e&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTime(0)):(this._SetTime(e),s=!0)):0>=this._playheadTime&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTime(e)):(this._SetTime(0),s=!0)),s?(this._track.SetEndState(),this.Stop(!0),this.OnCompleted()):(this._track.Interpolate(this._playheadTime,!0,!1,!1,this._firstTick,!1),this._firstTick&&(this._firstTick=!1))}}_SaveToJson(){const e=super._SaveToJson(),t=this.GetTimelineDataItem();return Object.assign(e,{tweenDataItemJson:t._SaveToJson(),id:this._id,destroyInstanceOnComplete:this._destroyInstanceOnComplete,initialValueMode:this._initialValueMode})}_LoadFromJson(e){e&&(this.GetTimelineDataItem()._LoadFromJson(e.tweenDataItemJson),super._LoadFromJson(e),this._id=e.id,this._destroyInstanceOnComplete=e.destroyInstanceOnComplete,this._initialValueMode=e.initialValueMode)}static IsPlaying(e){return e.IsPlaying()}static IsPaused(e){return e.IsPaused()}static Build(t){var s=t.runtime.GetTimelineManager(),i=new e.TimelineDataItem;if(t.json){i._LoadFromJson(t.json.tweenDataItemJson);var r=new e.TweenState(i,s);return r._LoadFromJson(t.json),r}s=new e.TweenState(i,s),e.IsArray(t.propertyTracksConfig)||(t.propertyTracksConfig=[t.propertyTracksConfig]),s.SetId(t.id),s.SetTags(t.tags),s.SetInitialValueMode(t.initialValueMode),s.SetDestroyInstanceOnComplete(t.releaseOnComplete),s.SetLoop(t.loop),s.SetPingPong(t.pingPong),s.SetTotalTime(t.time),s.SetStep(0),s.SetInterpolationMode("default"),s.SetResultMode(t.propertyTracksConfig[0].resultMode),i=s.AddTrack(),i.SetInstanceUID(t.instance.GetUID()),i.SetInterpolationMode("default"),i.SetResultMode(t.propertyTracksConfig[0].resultMode),i.SetEnable(!0),i.SetObjectClassIndex(t.instance.GetObjectClass().GetIndex());var n=t.instance.GetSdkInstance(),a=n.IsOriginalSizeKnown()?n.GetOriginalWidth():t.instance.GetWorldInfo().GetWidth();for(r of(n=n.IsOriginalSizeKnown()?n.GetOriginalHeight():t.instance.GetWorldInfo().GetHeight(),i.SetOriginalWidth(a),i.SetOriginalHeight(n),a=i.AddKeyframe(),a.SetTime(0),a.SetEase("noease"),a.SetEnable(!0),a.SetTags(""),a=i.AddKeyframe(),a.SetTime(t.time),a.SetEase("noease"),a.SetEnable(!0),a.SetTags(""),t.propertyTracksConfig))a=i.AddPropertyTrack(),a.SetSourceAdapterId(r.sourceId),a.SetSourceAdapterArgs(r.sourceArgs),a.SetPropertyName(r.property),a.SetPropertyType(r.type),a.SetMin(NaN),a.SetMax(NaN),a.SetInterpolationMode("default"),a.SetResultMode(r.resultMode),a.SetEnable(!0),n=a.AddPropertyKeyframe(),n.SetType(r.valueType),n.SetTime(0),n.SetEase(r.ease),n.SetEnable(!0),n.SetValue(r.startValue),n.SetAbsoluteValue(r.startValue),n=a.AddPropertyKeyframe(),n.SetType(r.valueType),n.SetTime(t.time),n.SetEase(r.ease),n.SetEnable(!0),n.SetValue(r.endValue),n.SetAbsoluteValue(r.endValue),a.GetSourceAdapter();return s}}}{const e=self.C3;e.TweenTrackState=class extends e.TrackState{constructor(e,t){super(e,t),this._secondPropertyTrack=this._firstPropertyTrack=null}static Create(t,s){return e.New(e.TweenTrackState,t,s)}_CachePropertyTracks(){1===this._propertyTracks.length?this._firstPropertyTrack=this._propertyTracks[0]:(this._firstPropertyTrack=this._propertyTracks[0],this._secondPropertyTrack=this._propertyTracks[1])}CreatePropertyTrackStates(){for(const t of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(e.TweenPropertyTrackState.Create(this,t));this._CachePropertyTracks()}AddPropertyTrack(){var t=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem();return t=e.TweenPropertyTrackState.Create(this,t),this._propertyTracks.push(t),this._CachePropertyTracks(),t}BeforeInterpolate(){}Interpolate(e,t,s=!1,i=!1,r,n=!1){if(this._instance||this.GetInstance(),this._instance){
if(this._instance.IsDestroyed()||n&&this.GetObjectClass().IsGlobal())return!1;this._secondPropertyTrack?(this._firstPropertyTrack.Interpolate(e,s,i),this._secondPropertyTrack.Interpolate(e,s,i)):this._firstPropertyTrack.Interpolate(e,s,i),0!==this._firstPropertyTrack.GetWorldInfoChange()&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo&&this._worldInfo.SetBboxChanged())}}AfterInterpolate(){}_LoadFromJson(e){super._LoadFromJson(e),this._CachePropertyTracks()}}}{const e=self.C3;e.TweenPropertyTrackState=class extends e.PropertyTrackState{constructor(e,t){super(e,t),this._basic=!1}static Create(t,s){return e.New(e.TweenPropertyTrackState,t,s)}Interpolate(e,t=!1,s=!1){if(this._basic)var i=this._propertyKeyframeDataItems[0],r=this._propertyKeyframeDataItems[1];else{if(t)i=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){r=this.GetTimeline();const t=this._lastPropertyKeyframeDataItem.GetNext();i=this._lastPropertyKeyframeDataItem.GetTime(),r=t?t.GetTime():r.GetTotalTime(),(e<=i||e>=r)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);i=this._lastPropertyKeyframeDataItem}r=i.GetNext()}this._sourceAdapter.Interpolate(e,i,r,t,s)}AddPropertyKeyframe(){const e=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,this._basic=2>=this.GetPropertyKeyframeDataItems().length,e}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null,this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(e),this._basic=2>=this.GetPropertyKeyframeDataItems().length}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson(),basic:this._basic}}_LoadFromJson(e){e&&(this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson),this._basic=e.basic)}}}{const e=self.C3,t=self.Ease;e.Transition=class extends e.DefendedBase{constructor(s){for(var i of(super(),this._name=s[0],this._transitionKeyframes=[],s[1]))s=e.TransitionKeyframe.Create(this,i),this._transitionKeyframes.push(s);for(i=0;i<this._transitionKeyframes.length;i++)this._transitionKeyframes[i].SetNext(this._transitionKeyframes[i+1]);this._precalculatedSamples=new Map,this._transitionKeyframeCache=new Map,this._PreCalcSamples(),t.AddCustomEase(this._name,(e,t,s,i)=>this.Interpolate(e,t,s,i))}static Create(t){return e.New(e.Transition,t)}Release(){for(const e of this._transitionKeyframes)e.Release();e.clearArray(this._transitionKeyframes),this._transitionKeyframes=null,this._precalculatedSamples.clear(),this._precalculatedSamples=null,this._transitionKeyframeCache.clear(),this._transitionKeyframeCache=null}GetTransitionKeyFrameAt(e){const t=this._transitionKeyframeCache.get(e);if(t)return t;for(const t of this._transitionKeyframes)if(t.GetValueX()===e)return this._transitionKeyframeCache.set(e,t),t}GetFirstTransitionKeyFrameHigherThan(e){for(const t of this._transitionKeyframes)if(t.GetValueX()>e)return t}GetFirstTransitionKeyFrameHigherOrEqualThan(e){for(const t of this._transitionKeyframes)if(t.GetValueX()>=e)return t}GetFirstTransitionKeyFrameLowerThan(e){for(let t=this._transitionKeyframes.length-1;0<=t;t--){const s=this._transitionKeyframes[t];if(s.GetValueX()<e)return s}}GetFirstTransitionKeyFrameLowerOrEqualThan(e){for(let t=this._transitionKeyframes.length-1;0<=t;t--){const s=this._transitionKeyframes[t];if(s.GetValueX()<=e)return s}}Interpolate(s,i,r,n){var a=s/n;s=this.GetFirstTransitionKeyFrameLowerOrEqualThan(a),n=s.GetNext(),n||(s=this.GetFirstTransitionKeyFrameLowerThan(a),n=s.GetNext());var o=n.GetValueX()-s.GetValueX();a=e.mapToRange(a,s.GetValueX(),n.GetValueX(),0,o),o=s.GetValueX();const h=s.GetValueY(),l=s.GetValueX()+s.GetStartAnchorX(),c=s.GetValueY()+s.GetStartAnchorY(),u=n.GetValueX()+n.GetEndAnchorX(),_=n.GetValueY()+n.GetEndAnchorY(),d=n.GetValueX();return n=n.GetValueY(),n=t.GetRuntimeEase("spline")(a,o,h,l,c,u,_,d,n,this._precalculatedSamples.get(s)),n+=s.GetValueY(),(1-n)*i+n*(i+r)}_PreCalcSamples(){this._precalculatedSamples.clear();for(let i=0;i<this._transitionKeyframes.length-1;i++){var e=this._transitionKeyframes[i];if(!e.GetStartEnable())continue;var s=this._transitionKeyframes[i+1];const r=e.GetValueX(),n=e.GetValueX()+e.GetStartAnchorX(),a=s.GetValueX()+s.GetEndAnchorX();s=s.GetValueX(),this._precalculatedSamples.set(e,t.GetBezierSamples(r,n,a,s))}}}}{const e=self.C3;e.TransitionKeyframe=class extends e.DefendedBase{constructor(e,t){super(),this._transition=e,this._valueX=t[0],this._valueY=t[1],this._startAnchorX=t[2],this._startAnchorY=t[3],this._endAnchorX=t[4],this._endAnchorY=t[5],this._startEnable=t[6],this._endEnable=t[7],this._next=null}Release(){this._transition=null}static Create(t,s){return e.New(e.TransitionKeyframe,t,s)}SetNext(e){this._next=e}GetNext(){return this._next}GetValueX(){return this._valueX}GetValueY(){return this._valueY}GetStartAnchorX(){return this._startAnchorX}GetStartAnchorY(){return this._startAnchorY}GetEndAnchorX(){return this._endAnchorX}GetEndAnchorY(){return this._endAnchorY}GetStartEnable(){return this._startEnable}GetEndEnable(){return this._endEnable}}}{const e=self.C3;e.TransitionManager=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._transitions=[]}Release(){for(const e of this._transitions)e.Release();e.clearArray(this._transitions),this._transitions=null}Create(t){this._transitions.push(e.Transition.Create(t))}}}{const e=self.C3;e.SolStack=class extends e.DefendedBase{constructor(t){super(),this._objectClass=t,this._stack=[],this._stack.push(e.New(e.Sol,this)),this._index=0,this._current=this._stack[0]}Release(){for(const e of this._stack)e.Release();e.clearArray(this._stack),this._objectClass=this._current=null}GetObjectClass(){return this._objectClass}GetCurrentSol(){return this._current}Clear(){this.GetCurrentSol().Clear()}PushClean(){var t=this._stack,s=++this._index;s===t.length?(s=e.New(e.Sol,this),t.push(s),this._current=s):(t=t[s],t.Reset(),this._current=t)}PushCopy(){const t=this._stack,s=++this._index;s===t.length&&t.push(e.New(e.Sol,this));const i=t[s];i.Copy(t[s-1]),this._current=i}Pop(){this._current=this._stack[--this._index]}RemoveInstances(e){const t=this._stack;for(let s=0,i=t.length;s<i;++s)t[s].RemoveInstances(e)}}}{const e=self.C3;e.Sol=class extends e.DefendedBase{constructor(e){super(),this._stack=e,this._objectClass=this._stack.GetObjectClass(),this._eventStack=this._objectClass.GetRuntime().GetEventStack(),this._selectAll=!0,this._instances=[],this._elseInstances=[]}Release(){this.ClearArrays(),this._eventStack=this._objectClass=this._stack=null}ClearArrays(){e.clearArray(this._instances),e.clearArray(this._elseInstances)}GetObjectClass(){return this._objectClass}IsSelectAll(){return this._selectAll}HasAnyInstances(){return this._selectAll?!!this._objectClass.GetInstanceCount():!!this._instances.length}GetInstances(){return this._selectAll?this._objectClass.GetInstances():this._instances}HasAnyElseInstances(){return!!this._elseInstances.length}GetElseInstances(){return this._elseInstances}GetExpressionInstances(){const e=this.GetInstances();return e.length?e:this._elseInstances}Reset(){this._selectAll=!0,e.clearArray(this._elseInstances)}Clear(){this._selectAll=!0}Copy(t){t.IsSelectAll()?this.Reset():(this._selectAll=!1,e.shallowAssignArray(this._instances,t._instances),e.clearArray(this._elseInstances))}_PushInstance(e){this._instances.push(e)}_PushElseInstance(e){this._elseInstances.push(e)}_SetSelectAll(e){this._selectAll=!!e}_GetOwnInstances(){return this._instances}_GetOwnElseInstances(){return this._elseInstances}SetSinglePicked(t){this._selectAll=!1,e.clearArray(this._instances),this._instances.push(t)}SetArrayPicked(t){this._selectAll=!1,e.shallowAssignArray(this._instances,t)}SetSetPicked(t){this._selectAll=!1,e.clearArray(this._instances);for(const e of t)this._instances.push(e)}AddElseInstances(e,t){for(const s of t)e.has(s)||this._elseInstances.push(s)}TransferElseInstancesToOwn(t){for(const e of t)this._instances.push(e);e.arrayRemoveAllInSet(this._elseInstances,t)}PickOne(t){t&&(this._eventStack.GetCurrentStackFrame().GetCurrentEvent().IsOrBlock()?(this.IsSelectAll()&&(e.clearArray(this._instances),e.shallowAssignArray(this._elseInstances,t.GetObjectClass().GetInstances()),this._selectAll=!1),t=this._elseInstances.indexOf(t),-1!==t&&(this._instances.push(this._elseInstances[t]),this._elseInstances.splice(t,1))):this.SetSinglePicked(t))}RemoveInstances(t){e.arrayRemoveAllInSet(this._instances,t),e.arrayRemoveAllInSet(this._elseInstances,t)}}}{const e=self.C3;e.EventStack=class extends e.DefendedBase{constructor(t){super(),this._eventSheetManager=t,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._stack.push(e.New(e.EventStackFrame,this,null)),this._index=0,this._expFuncStack=[]}Release(){for(const e of this._stack)e.Release();e.clearArray(this._stack),e.clearArray(this._expFuncStack),this._runtime=this._eventSheetManager=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrentStackFrame(){return this._stack[this._index]}Push(t){var s=this._stack;const i=++this._index;return i===s.length?(t=e.New(e.EventStackFrame,this,t),s.push(t),t):(s=s[i],s.Reset(t),s)}Pop(){--this._index}PushExpFunc(e){this._expFuncStack.push(e)}PopExpFunc(){this._expFuncStack.pop()}GetCurrentExpFuncStackFrame(){const e=this._expFuncStack;return 0===e.length?null:e.at(-1)}}}{const e=self.C3;e.EventStackFrame=class extends e.DefendedBase{constructor(e,t){super(),this._stack=e,this._runtime=this._stack.GetRuntime(),this._currentEvent=t,this._actIndex=this._cndIndex=0,this._elseBranchRan=this._lastEventTrue=!1,this._expressionObjectClass=null,this._functionReturnValue=this._functionReturnType=0}Release(){this.Reset(null),this._runtime=this._stack=null}Reset(e){this._currentEvent=e,this._actIndex=this._cndIndex=0,this._elseBranchRan=this._lastEventTrue=!1}_Restore(e,t){this._currentEvent=e,this._cndIndex=0,this._actIndex=t}ResetQuick(){this._actIndex=this._cndIndex=0}GetCurrentEvent(){return this._currentEvent}SetCurrentEvent(e){this._currentEvent=e}GetConditionIndex(){return this._cndIndex}SetConditionIndex(e){this._cndIndex=e}GetActionIndex(){return this._actIndex}SetActionIndex(e){this._actIndex=e}SetLastEventTrue(e){this._lastEventTrue=!!e}GetLastEventTrue(){return this._lastEventTrue}SetElseBranchRan(e){this._elseBranchRan=!!e}GetElseBranchRan(){return this._elseBranchRan}SetExpressionObjectClass(e){this._expressionObjectClass=e}GetExpressionObjectClass(){return this._expressionObjectClass}InitCallFunctionExpression(e,t){this._functionReturnType=e,this._functionReturnValue=t}GetFunctionReturnType(){return this._functionReturnType}SetFunctionReturnValue(e){this._functionReturnValue=e}GetFunctionReturnValue(){return this._functionReturnValue}IsSolModifierAfterCnds(){const e=this._currentEvent;return!!e.IsSolWriterAfterCnds()||this._cndIndex<e.GetConditionCount()-1&&!!e.GetSolModifiers().length}}}{const e=self.C3;e.LocalVarStack=class extends e.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1,this._current=null,this._initialValues=[]}Release(){e.clearArray(this._stack),this._runtime=this._eventSheetManager=null}_SetInitialValues(e){this._initialValues=e,e=this._initialValues.slice(0),this._stack.push(e),this._index=0,this._current=e}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrent(){return this._current}Push(){const t=++this._index,s=this._stack;t===s.length?s.push(this._initialValues.slice(0)):e.shallowAssignArray(s[t],this._initialValues),this._current=s[t]}Pop(){this._current=this._stack[--this._index]}}}{const e=self.C3;e.LoopStack=class extends e.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1}Release(){e.clearArray(this._stack),this._runtime=this._eventSheetManager=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}IsInLoop(){return 0<=this._index}GetCurrent(){return this._stack[this._index]}Push(){if(++this._index,this._index===this._stack.length){var t=e.New(e.Loop,this);return this._stack.push(t),t}return t=this._stack[this._index],t.Reset(),t}Pop(){--this._index}FindByName(e){const t=this._stack;for(let s=this._index;0<=s;--s){const i=t[s];if(i.GetName()===e)return i}return null}_GetStack(){return this._stack.slice(0,this._index+1)}}}{const e=self.C3;e.Loop=class extends e.DefendedBase{constructor(e){super(),this._loopStack=e,this._name="",this._index=0,this._isStopped=!1,this._end=NaN}Reset(){this._name="",this._index=0,this._isStopped=!1,this._end=NaN}SetName(e){this._name=e}GetName(){return this._name}SetIndex(e){this._index=e}GetIndex(){return this._index}Stop(){this._isStopped=!0}IsStopped(){return this._isStopped}SetEnd(e){this._end=e}GetEnd(){return this._end}}}{const e=self.C3;e.ArrayStack=class extends e.DefendedBase{constructor(){super(),this._stack=[],this._index=-1}Release(){e.clearArray(this._stack)}GetCurrent(){return this._stack[this._index]}Push(){if(++this._index,this._index===this._stack.length){const e=[];return this._stack.push(e),e}return this._stack[this._index]}Pop(){--this._index}}}{const e=self.C3;function b(e,t){return e.GetIndex()-t.GetIndex()}function a(e,t){for(let s=0,i=e.length;s<i;++s)if(e[s]!==t[s])return!1;return!0}e.EventSheetManager=class extends e.DefendedBase{constructor(t){super(),this._runtime=t,this._allSheets=[],this._sheetsByName=new Map,this._allGroups=[],this._groupsByName=new Map,this._blocksBySid=new Map,this._cndsBySid=new Map,this._actsBySid=new Map,this._allUniqueSolModifiers=new Map,this._eventVarsBySid=new Map,this._nextLocalVarIndex=0,this._allGlobalVars=[],this._allLocalVars=[],this._localVarInitialValues=[],this._functionBlocksByName=new Map,this._eventStack=e.New(e.EventStack,this),this._localVarStack=e.New(e.LocalVarStack,this),this._loopStack=e.New(e.LoopStack,this),this._triggersToPostInit=[],this._queuedTriggers=[],this._queuedDebugTriggers=[],this._blockFlushingDepth=this._executingTriggerDepth=this._runningEventsDepth=0,this._scheduledWaits=[],this._asyncActionPromises=[],self.c3_callFunction=((e,t)=>this._InvokeFunctionFromJS(e,t))}Release(){this.ClearAllScheduledWaits(),this._eventStack.Release(),this._eventStack=null,this._localVarStack.Release(),this._localVarStack=null,e.clearArray(this._queuedTriggers),e.clearArray(this._queuedDebugTriggers),this._runtime=null,e.clearArray(this._allSheets),this._sheetsByName.clear()}Create(t){t=e.New(e.EventSheet,this,t),this._allSheets.push(t),this._sheetsByName.set(t.GetName().toLowerCase(),t)}_AddTriggerToPostInit(e){this._triggersToPostInit.push(e)}_PostInit(){for(const e of this._functionBlocksByName.values())e._PostInit(!1);for(const e of this._allSheets)e._PostInit();for(const e of this._allSheets)e._UpdateDeepIncludes();for(const e of this._triggersToPostInit)e._PostInit(!1);e.clearArray(this._triggersToPostInit),this._localVarStack._SetInitialValues(this._localVarInitialValues)}GetRuntime(){return this._runtime}GetEventSheetByName(e){return this._sheetsByName.get(e.toLowerCase())||null}_RegisterGroup(e){this._allGroups.push(e),this._groupsByName.set(e.GetGroupName(),e)}_RegisterEventBlock(e){this._blocksBySid.set(e.GetSID(),e)}_RegisterCondition(e){this._cndsBySid.set(e.GetSID(),e)}_RegisterAction(e){this._actsBySid.set(e.GetSID(),e)}_RegisterFunctionBlock(e){this._functionBlocksByName.set(e.GetFunctionName().toLowerCase(),e)}_RegisterEventVariable(e){this._eventVarsBySid.set(e.GetSID(),e),e.IsGlobal()?this._allGlobalVars.push(e):this._allLocalVars.push(e)}_DeduplicateSolModifierList(e){2<=e.length&&e.sort(b);let t=this._allUniqueSolModifiers.get(e.length);t||(t=[],this._allUniqueSolModifiers.set(e.length,t));for(let s=0,i=t.length;s<i;++s){const i=t[s];if(a(e,i))return i}return t.push(e),e}_GetNextLocalVarIndex(e){return this._localVarInitialValues.push(e.GetInitialValue()),this._nextLocalVarIndex++}GetEventStack(){return this._eventStack}GetCurrentEventStackFrame(){return this.GetEventStack().GetCurrentStackFrame()}GetCurrentEvent(){return this.GetCurrentEventStackFrame().GetCurrentEvent()}GetCurrentCondition(){const e=this.GetCurrentEventStackFrame();return e.GetCurrentEvent().GetConditionAt(e.GetConditionIndex())}GetCurrentAction(){const e=this.GetCurrentEventStackFrame();return e.GetCurrentEvent().GetActionAt(e.GetActionIndex())}GetLocalVarStack(){return this._localVarStack}GetLoopStack(){return this._loopStack}GetAllLocalVariablesInScope(t){const s=[];for(t=t.GetScopeParent();t;)e.appendArray(s,t._GetAllLocalVariablesInScope()),t=t.GetScopeParent();return s}_GetLocalVariablesScriptInterface(e){const t={};for(const s of this.GetAllLocalVariablesInScope(e))t[s.GetJsPropName()]=s._GetScriptInterfaceDescriptor();return Object.create(Object.prototype,t)}GetEventVariableBySID(e){return this._eventVarsBySid.get(e)||null}GetEventBlockBySID(e){return this._blocksBySid.get(e)||null}GetConditionBySID(e){return this._cndsBySid.get(e)||null}GetActionBySID(e){return this._actsBySid.get(e)||null}GetFunctionBlockByName(e){return this._functionBlocksByName.get(e.toLowerCase())||null}GetAllGlobalVariables(){return this._allGlobalVars}GetAllLocalVariables(){return this._allLocalVars}ResetAllGlobalsToInitialValue(){for(const e of this._allGlobalVars)e.ResetToInitialValue()}GetEventGroupByName(e){return this._groupsByName.get(e.toLowerCase())||null}GetEventGroupBySID(e){return(e=this._blocksBySid.get(e))&&e.IsGroup()?e:null}GetAllGroups(){return this._allGroups}ResetAllGroupsInitialActivation(){for(const e of this._allGroups)e.ResetInitialActivation()}_ResetAllHasRunFlags(){for(const e of this._allSheets)e._ResetHasRunFlag()}RunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(const t of e.runningLayouts())(e=t.GetEventSheet())&&(this._runtime.PushCurrentLayout(t),e.Run(),this._runtime.PopCurrentLayout());this._runningEventsDepth--}async DebugRunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(const t of this._DebugRunEventsGen(e))await this._runtime.DebugBreak(t);this._runningEventsDepth--}*_DebugRunEventsGen(e){for(const t of e.runningLayouts())(e=t.GetEventSheet())&&(this._runtime.PushCurrentLayout(t),yield*e.DebugRun(),this._runtime.PopCurrentLayout())}_Trigger(e,t,s,i){let r=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,s,i);this._executingTriggerDepth++;for(const n of e.runningLayouts())if(e=n.GetEventSheet()){this._runtime.PushCurrentLayout(n);for(const n of e.deepIncludes()){const e=n._Trigger(t,s,i);r=r||e}e=e._Trigger(t,s,i),r=r||e,this._runtime.PopCurrentLayout()}return this._executingTriggerDepth--,r}*_DebugTrigger(e,t,s,i){let r=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,s,i);this._executingTriggerDepth++;for(const n of e.runningLayouts())if(e=n.GetEventSheet()){this._runtime.PushCurrentLayout(n);for(const n of e.deepIncludes()){const e=yield*n._DebugTrigger(t,s,i);r=r||e}e=yield*e._DebugTrigger(t,s,i),r=r||e,this._runtime.PopCurrentLayout()}return this._executingTriggerDepth--,r}QueueTrigger(e,t,s){return this._queuedTriggers.push([e,t,s]),!1}QueueDebugTrigger(e,t,s){let i=null;const r=new Promise(e=>i=e);return this._queuedDebugTriggers.push([e,t,s,i]),r}*_RunQueuedDebugTriggersGen(){if(this._runtime.HitBreakpoint())throw Error("should not be in breakpoint");const e=this._runtime.GetLayoutManager();for(;this._queuedDebugTriggers.length;){const[t,s,i,r]=this._queuedDebugTriggers.shift(),n=yield*this._DebugTrigger(e,t,s,i);r(n)}}async RunQueuedDebugTriggersAsync(){for(const e of this._RunQueuedDebugTriggersGen())await this._runtime.DebugBreak(e)}_FastTrigger(e,t,s,i){let r=!1;var n=e.GetMainRunningLayout();if(e=n.GetEventSheet()){this._executingTriggerDepth++,this._runtime.PushCurrentLayout(n),n=e.deepIncludes();for(let e=0,a=n.length;e<a;++e){const a=n[e]._FastTrigger(t,s,i);r=r||a}return t=e._FastTrigger(t,s,i),r=r||t,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,r}}*_DebugFastTrigger(e,t,s,i){let r=!1;var n=e.GetMainRunningLayout();if(e=n.GetEventSheet()){this._executingTriggerDepth++,this._runtime.PushCurrentLayout(n),n=e.deepIncludes();for(let e=0,a=n.length;e<a;++e){const a=yield*n[e]._DebugFastTrigger(t,s,i);r=r||a}return t=yield*e._DebugFastTrigger(t,s,i),r=r||t,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,r}}GetTriggerDepth(){return this._executingTriggerDepth}IsInTrigger(){return 0<this.GetTriggerDepth()}_IncTriggerDepth(){return++this._executingTriggerDepth}_DecTriggerDepth(){--this._executingTriggerDepth}IsRunningEvents(){return 0<this._runningEventsDepth}IsInEventEngine(){return this.IsRunningEvents()||this.IsInTrigger()}_RunQueuedTriggers(t){for(const[e,s,i]of this._queuedTriggers)this._Trigger(t,e,s,i);e.clearArray(this._queuedTriggers)}BlockFlushingInstances(e){e?this._blockFlushingDepth++:this._blockFlushingDepth--}IsFlushingBlocked(){return 0<this._blockFlushingDepth}ClearSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().Clear()}PushCleanSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().PushClean()}PushCopySol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().PushCopy()}PopSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().Pop()}AddScheduledWait(){const t=e.New(e.ScheduledWait,this);return this._scheduledWaits.push(t),t}scheduledWaits(){return this._scheduledWaits}RunScheduledWaits(){if(this._scheduledWaits.length){var e=this.GetCurrentEventStackFrame(),t=!1;this._runningEventsDepth++;for(let s=0,i=this._scheduledWaits.length;s<i;++s){const i=this._scheduledWaits[s];i._ShouldRun()&&i._Run(e),i.ShouldRelease()&&(t=!0)}t&&this._FilterScheduledWaitsToRelease(),this._runningEventsDepth--}}async DebugRunScheduledWaits(){if(this._scheduledWaits.length){var e=this.GetCurrentEventStackFrame(),t=!1;this._runningEventsDepth++;for(let s=0,i=this._scheduledWaits.length;s<i;++s){const i=this._scheduledWaits[s];i._ShouldRun()&&await i._DebugRun(e),i.ShouldRelease()&&(t=!0)}t&&this._FilterScheduledWaitsToRelease(),this._runningEventsDepth--}}_FilterScheduledWaitsToRelease(){const t=e.arrayFilterOut(this._scheduledWaits,e=>e.ShouldRelease());for(const e of t)e.Release()}ClearAllScheduledWaits(){for(const e of this._scheduledWaits)e.Release();e.clearArray(this._scheduledWaits)}RemoveInstancesFromScheduledWaits(e){for(const t of this._scheduledWaits)t.RemoveInstances(e)}AddAsyncActionPromise(e){this._asyncActionPromises.push(e)}ClearAsyncActionPromises(){e.clearArray(this._asyncActionPromises)}GetPromiseForAllAsyncActions(){const e=Promise.all(this._asyncActionPromises);return this._asyncActionPromises=[],e}_SaveToJson(){return{groups:this._SaveGroupsToJson(),cnds:this._SaveCndsToJson(),acts:this._SaveActsToJson(),vars:this._SaveVarsToJson(),waits:this._SaveScheduledWaitsToJson()}}_LoadFromJson(e){this._LoadGroupsFromJson(e.groups),this._LoadCndsFromJson(e.cnds),this._LoadActsFromJson(e.acts),this._LoadVarsFromJson(e.vars),this._LoadScheduledWaitsFromJson(e.waits)}_SaveGroupsToJson(){const e={};for(const t of this.GetAllGroups())e[t.GetSID().toString()]=t.IsGroupActive();return e}_LoadGroupsFromJson(e){for(const[t,s]of Object.entries(e))e=parseInt(t,10),(e=this.GetEventGroupBySID(e))&&e.SetGroupActive(s)}_SaveCndsToJson(){const e={};for(const[t,s]of this._cndsBySid){const i=s._SaveToJson();i&&(e[t.toString()]=i)}return e}_LoadCndsFromJson(e){const t=new Map;for(const[s,i]of Object.entries(e))t.set(parseInt(s,10),i);for(const[e,s]of this._cndsBySid)s._LoadFromJson(t.get(e)||null)}_SaveActsToJson(){const e={};for(const[t,s]of this._actsBySid){const i=s._SaveToJson();i&&(e[t.toString()]=i)}return e}_LoadActsFromJson(e){const t=new Map;for(const[s,i]of Object.entries(e))t.set(parseInt(s,10),i);for(const[e,s]of this._actsBySid)s._LoadFromJson(t.get(e)||null)}_SaveVarsToJson(){const e={};for(const[t,s]of this._eventVarsBySid)s.IsConstant()||!s.IsGlobal()&&!s.IsStatic()||(e[t.toString()]=s.GetValue());return e}_LoadVarsFromJson(e){for(const[t,s]of Object.entries(e))e=parseInt(t,10),(e=this.GetEventVariableBySID(e))&&e.SetValue(s)}_SaveScheduledWaitsToJson(){return this._scheduledWaits.filter(e=>!e.IsPromise()).map(e=>e._SaveToJson())}_LoadScheduledWaitsFromJson(t){this.ClearAllScheduledWaits();for(const s of t)(t=e.ScheduledWait._CreateFromJson(this,s))&&this._scheduledWaits.push(t)}_GetPerfRecords(){return[...this._runtime.GetLayoutManager().runningLayouts()].map(e=>e.GetEventSheet()).filter(e=>e).map(e=>e._GetPerfRecord())}FindFirstFunctionBlockParent(t){for(;t;)if(t=t.GetScopeParent(),t instanceof e.FunctionBlock)return t;return null}_InvokeFunctionFromJS(e,t){if(Array.isArray(t)||(t=[]),e=this.GetFunctionBlockByName(e.toLowerCase()),!e)return null;if(!e.IsEnabled())return e.GetDefaultReturnValue();var s=e.GetFunctionParameters();if(t.length<s.length){t=t.slice(0);do{t.push(s[t.length].GetInitialValue())}while(t.length<s.length)}return s=e.GetEventBlock(),s.RunAsExpressionFunctionCall(s.GetSolModifiersIncludingParents(),e.GetReturnType(),e.GetDefaultReturnValue(),...t)}}}{const e=self.C3;e.EventSheet=class extends e.DefendedBase{constructor(e,t){super(),this._eventSheetManager=e,this._runtime=e.GetRuntime(),this._name=t[0],this._events=[],this._triggers=new Map,this._fastTriggers=new Map,this._eventsByDisplayNumber=new Map,this._hasRun=!1,this._shallowIncludes=[],this._deepIncludes=[],this._alreadyIncludedSheets=new Set;for(const e of t[1])this._CreateEvent(e,null,this._events);this._perfRecord=this._runtime.IsDebug()?{type:"sheet",name:this._name,totalTimeCounter:0,children:[]}:null}Release(){this._runtime=this._eventSheetManager=null}_CreateEvent(e,t,s){switch(e[0]){case 0:case 3:this._CreateEventBlock(e,t,s);break;case 1:this._CreateEventVariable(e,t,s);break;case 2:this._CreateInclude(e,t,s);break;case 4:this._CreateFunctionBlock(e,t);break;case 5:this._CreateScriptBlock(e,t,s);break;default:throw Error("invalid event type")}}_CreateEventBlock(t,s,i){if(t=e.EventBlock.Create(this,s,t),t.IsOrBlock()){i.push(t),i=t.GetConditions();for(let e=0,s=i.length;e<s;++e)i[e].IsTrigger()&&this._InitTrigger(t,e)}else t.IsTrigger()?this._InitTrigger(t,0):i.push(t)}_CreateFunctionBlock(t,s){t=e.FunctionBlock.Create(this,s,t),this._eventSheetManager._RegisterFunctionBlock(t)}_CreateEventVariable(t,s,i){t=e.EventVariable.Create(this,s,t),i.push(t)}_CreateInclude(t,s,i){t=e.EventInclude.Create(this,s,t),i.push(t)}_CreateScriptBlock(t,s,i){t=e.EventScript.Create(this,s,t),i.push(t)}_InitTrigger(e,t){e.IsOrBlock()||this._eventSheetManager._AddTriggerToPostInit(e);var s=e.GetConditionAt(t),i=s._GetFunc(),r=s.GetObjectClass();if(s.IsFastTrigger()){var n=this._fastTriggers.get(r);n||(n=new Map,this._fastTriggers.set(r,n)),s=s.GetFastTriggerValue().toLowerCase(),r=n.get(i),r||(r=new Map,n.set(i,r)),i=r.get(s),i||(i=[],r.set(s,i)),i.push([e,t])}else n=this._triggers.get(r),n||(n={methodMap:new Map,behaviors:new Map},this._triggers.set(r,n)),(r=s.GetBehaviorType())?(s=n.behaviors.get(r),s||(s=new Map,n.behaviors.set(r,s))):s=n.methodMap,n=s.get(i),n||(n=[],s.set(i,n)),n.push([e,t])}_PostInit(){const t=this._events;for(let s=0,i=t.length;s<i;++s){const r=s<i-1&&t[s+1]instanceof e.EventBlock&&t[s+1].IsElseBlock();t[s]._PostInit(r)}}_AddShallowInclude(e){this._shallowIncludes.push(e)}_UpdateDeepIncludes(){e.clearArray(this._deepIncludes),this._AddDeepIncludes(this),this._alreadyIncludedSheets.clear()}_AddDeepIncludes(e){const t=e._deepIncludes,s=e._alreadyIncludedSheets;for(const i of this._shallowIncludes){const r=i.GetIncludeSheet();i.IsActive()&&e!==r&&!s.has(r)&&(s.add(r),r._AddDeepIncludes(e),t.push(r))}}deepIncludes(){return this._deepIncludes}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetName(){return this._name}_RegisterEventByDisplayNumber(e,t){this._eventsByDisplayNumber.set(t,e)}_GetEventByDisplayNumber(e){return this._eventsByDisplayNumber.get(e)||null}_ResetHasRunFlag(){this._hasRun=!1}Run(){if(!this._hasRun){var e=this._runtime,t=e.IsCPUProfiling(),s=t?performance.now():0;this._hasRun=!0;var i=this.GetEventSheetManager(),r=i.GetCurrentEventStackFrame();for(const t of this._events)t.Run(r),i.ClearSol(t.GetSolModifiers()),i.ClearAsyncActionPromises(),e.FlushPendingInstances();r.Reset(null),t&&(this._perfRecord.totalTimeCounter+=performance.now()-s)}}*DebugRun(){if(!this._hasRun){this._hasRun=!0;var e=this._runtime,t=this.GetEventSheetManager(),s=t.GetCurrentEventStackFrame();for(const i of this._events)yield*i.DebugRun(s),t.ClearSol(i.GetSolModifiers()),t.ClearAsyncActionPromises(),e.FlushPendingInstances();s.Reset(null)}}_Trigger(e,t,s){if(!t)return this._TriggerForClass(e,t,null,null);{const i=t.GetObjectClass();this._TriggerForClass(e,t,i,s);for(const r of i.GetFamilies())this._TriggerForClass(e,t,r,s)}}_TriggerForClass(e,t,s,i){if(s=this._triggers.get(s),!s)return!1;if(i=i?s.behaviors.get(i):s.methodMap,!i)return!1;if(i=i.get(e),!i)return!1;e=!1;for(const[s,r]of i)i=this._ExecuteTrigger(t,s,r),e=e||i;return e}*_DebugTrigger(e,t,s){if(!t)return yield*this._DebugTriggerForClass(e,t,null,null);{const i=t.GetObjectClass();yield*this._DebugTriggerForClass(e,t,i,s);for(const r of i.GetFamilies())yield*this._DebugTriggerForClass(e,t,r,s)}}*_DebugTriggerForClass(e,t,s,i){if(s=this._triggers.get(s),!s)return!1;if(i=i?s.behaviors.get(i):s.methodMap,!i)return!1;if(i=i.get(e),!i)return!1;e=!1;for(const[s,r]of i)i=s.DebugCanRunFast()?this._ExecuteTrigger(t,s,r):yield*this._DebugExecuteTrigger(t,s,r),e=e||i;return e}_FastTrigger(e,t,s){if(t=t.GetObjectClass(),t=this._fastTriggers.get(t),!t)return!1;if(e=t.get(e),!e)return!1;if(s=e.get(s),!s)return!1;e=!1;for(let i=0,r=s.length;i<r;++i)t=s[i],t=this._ExecuteTrigger(null,t[0],t[1]),e=e||t;return e}*_DebugFastTrigger(e,t,s){if(t=t.GetObjectClass(),t=this._fastTriggers.get(t),!t)return!1;if(e=t.get(e),!e)return!1;if(s=e.get(s),!s)return!1;e=!1;for(let r=0,n=s.length;r<n;++r){var i=s[r];t=i[0],i=i[1],t=t.DebugCanRunFast()?this._ExecuteTrigger(null,t,i):yield*this._DebugExecuteTrigger(null,t,i),e=e||t}return e}_ExecuteTrigger(e,t,s){const i=this._runtime,r=this._eventSheetManager,n=r.GetCurrentEvent(),a=r.GetEventStack(),o=r.GetTriggerDepth();let h=!1;n&&r.PushCleanSol(n.GetSolModifiersIncludingParents()),r.PushCleanSol(t.GetSolModifiersIncludingParents());const l=1<o;l&&r.GetLocalVarStack().Push();const c=a.Push(t);if(e&&(t.GetConditions()[s].GetObjectClass().GetCurrentSol().SetSinglePicked(e),e.IsInContainer()&&e.SetSiblingsSinglePicked()),e=!0,t.GetParent()){const s=t.GetTriggerParents();for(let t=0,i=s.length;t<i;++t)if(!s[t].RunPreTrigger(c)){e=!1;break}}return e&&(i.IncrementExecCount(),t.IsOrBlock()?t.RunOrBlockTrigger(c,s):t.Run(c),h=c.GetLastEventTrue()),a.Pop(),l&&r.GetLocalVarStack().Pop(),r.PopSol(t.GetSolModifiersIncludingParents()),n&&r.PopSol(n.GetSolModifiersIncludingParents()),n||1!==o||(r.ClearAsyncActionPromises(),r.IsFlushingBlocked()||i.FlushPendingInstances()),h}*_DebugExecuteTrigger(e,t,s){const i=this._runtime,r=this._eventSheetManager,n=r.GetCurrentEvent(),a=r.GetEventStack(),o=r.GetTriggerDepth();let h=!1;n&&r.PushCleanSol(n.GetSolModifiersIncludingParents()),r.PushCleanSol(t.GetSolModifiersIncludingParents());const l=1<o;l&&r.GetLocalVarStack().Push();const c=a.Push(t);if(e&&(t.GetConditions()[s].GetObjectClass().GetCurrentSol().SetSinglePicked(e),e.IsInContainer()&&e.SetSiblingsSinglePicked()),e=!0,t.GetParent()){const s=t.GetTriggerParents();for(let t=0,i=s.length;t<i;++t)if(!(yield*s[t].DebugRunPreTrigger(c))){e=!1;break}}return e&&(i.IncrementExecCount(),
t.IsOrBlock()?yield*t.DebugRunOrBlockTrigger(c,s):yield*t.DebugRun(c),h=c.GetLastEventTrue()),a.Pop(),l&&r.GetLocalVarStack().Pop(),r.PopSol(t.GetSolModifiersIncludingParents()),n&&r.PopSol(n.GetSolModifiersIncludingParents()),n||1!==o||(r.ClearAsyncActionPromises(),r.IsFlushingBlocked()||i.FlushPendingInstances()),h}_GetPerfRecord(){return this._perfRecord}}}{const e=self.C3,t=[];function a(e,t){return!0}function*c(e,t){return!0}e.EventBlock=class extends e.DefendedBase{constructor(s,i,r){for(var n of(super(),this._eventSheet=s,this._runtime=s.GetRuntime(),this._parent=i,this._scopeParent=null,this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._solModifiers=[],this._solModifiersIncludingParents=[],this._hasElseBlock=this._isTopLevelGroup=this._isSolWriterAfterCnds=this._hasGotSolModifiersIncludingParents=!1,this._isOrBlock=!!r[2],this._isElseBlock=!1,this._triggerParents=null,this._conditions=[],this._actions=[],this._subEvents=[],this._RunActions=a,this._DebugRunActions=c,this._isInitiallyActive=this._isGroup=!1,this._groupName="",this._isGroupActive=!1,this._perfRecord=this._containedIncludes=null,this._sid=r[4],this._displayNumber=r[5],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=this._runtime.IsDebug()?{isBreakpoint:r[3][0],isBreakable:r[3][1],canRunAllConditionsFast:!1,canRunAllActionsFast:!1,canRunAllSubEventsFast:!1,canRunSelfFast:!1}:null,this.GetEventSheetManager()._RegisterEventBlock(this),3===r[0]&&this._InitGroup(r[1]),s=0,r[6]))i=e.Condition.Create(this,n,s++),this._conditions.push(i),this._AddSolModifier(i.GetObjectClass());s=0;for(const t of r[7])n=e.Action.Create(this,t,s++),this._actions.push(n);if(9===r.length){r=r[8];for(const e of r)this._eventSheet._CreateEvent(e,this,this._subEvents)}this._conditions.length&&(this._isElseBlock=null===this._conditions[0].GetObjectClass()&&this._conditions[0]._GetFunc()===e.Plugins.System.Cnds.Else),0===this._conditions.length&&(this._conditions=t),0===this._actions.length&&(this._actions=t),0===this._subEvents.length&&(this._subEvents=t)}static Create(t,s,i){return e.New(e.EventBlock,t,s,i)}_InitGroup(e){this._isGroup=!0,this._isGroupActive=this._isInitiallyActive=!!e[0],this._groupName=e[1].toLowerCase(),this._containedIncludes=[],this.GetEventSheetManager()._RegisterGroup(this),this._runtime.IsDebug()&&(this._perfRecord={type:"group",name:e[1],totalTimeCounter:0,children:[]})}_AddContainedInclude(e){this._containedIncludes.push(e)}_AddContainerSolModifierToList(e,t){for(const s of e.GetContainer().objectTypes())t.includes(s)||t.push(s)}_AddSolModifierToList(e,t){if(e)if(t.includes(e)||t.push(e),e.IsFamily())for(const s of e.GetFamilyMembers())s.IsInContainer()&&this._AddContainerSolModifierToList(s,t);else e.IsInContainer()&&this._AddContainerSolModifierToList(e,t)}_AddSolModifier(e){this._AddSolModifierToList(e,this._solModifiers)}_AddParentSolModifier(e){this._AddSolModifierToList(e,this._solModifiersIncludingParents)}SetAllSolModifiers(){this._solModifiers=this._runtime.GetAllObjectClasses()}_PostInit(t){this._hasElseBlock=!!t,this._IdentifyTopLevelGroup(),this._IdentifyTriggerParents();for(const e of this._conditions)e._PostInit();if(0<this._actions.length){for(var s of(t=!1,this._actions))s._PostInit(),s.HasReturnType()&&(t=!0);t?(this._RunActions=this._RunActions_ReturnValue,this._DebugRunActions=this._DebugRunActions_ReturnValue):(this._RunActions=this._RunActions_Fast,this._DebugRunActions=this._DebugRunActions_Fast)}s=this._subEvents;for(let i=0,r=s.length;i<r;++i)t=i<r-1&&s[i+1]instanceof e.EventBlock&&s[i+1].IsElseBlock(),s[i]._PostInit(t);this._debugData&&this._UpdateCanRunFast(),this._perfRecord&&this._GetPerfRecordParent()._GetPerfRecord().children.push(this._perfRecord)}_GetPerfRecord(){return this._perfRecord}_GetPerfRecordParent(){let e=this.GetParent();for(;e;){if(e.IsGroup())return e;e=e.GetParent()}return this._eventSheet}_UpdateCanRunFast(){const e=this._debugData;e.canRunAllConditionsFast=this._conditions.every(e=>e.DebugCanRunFast()),e.canRunAllActionsFast=this._actions.every(e=>e.DebugCanRunFast()),e.canRunAllSubEventsFast=this._subEvents.every(e=>e.DebugCanRunFast()),e.canRunSelfFast=e.canRunAllConditionsFast&&e.canRunAllActionsFast&&e.canRunAllSubEventsFast}_UpdateCanRunFastRecursive(){let e=this;do{e._UpdateCanRunFast(),e=e.GetParent()}while(e)}_IdentifyTopLevelGroup(){if(this.IsGroup()){var e=this.GetParent();for(this._isTopLevelGroup=!0;e;){if(!e.IsGroup()){this._isTopLevelGroup=!1;break}e=e.GetParent()}}}_IdentifySolModifiersIncludingParents(){var t=this._runtime.GetAllObjectClasses();if(this._solModifiers===t)this._solModifiersIncludingParents=t;else{for(this._solModifiersIncludingParents=e.cloneArray(this._solModifiers),t=this.GetParent();t;){for(var s of t._solModifiers)this._AddParentSolModifier(s);t=t.GetParent()}s=this.GetEventSheetManager(),this._solModifiers=s._DeduplicateSolModifierList(this._solModifiers),this._solModifiersIncludingParents=s._DeduplicateSolModifierList(this._solModifiersIncludingParents)}}_IdentifyTriggerParents(){if(this.HasAnyTriggeredCondition()){this._triggerParents=[];for(var e=this.GetParent();e;)this._triggerParents.push(e),e=e.GetParent();this._triggerParents.reverse()}}SetSolWriterAfterCnds(){this._isSolWriterAfterCnds=!0,this._parent&&this._parent.SetSolWriterAfterCnds()}IsSolWriterAfterCnds(){return this._isSolWriterAfterCnds}GetSolModifiers(){return this._solModifiers}GetSolModifiersIncludingParents(){return this._hasGotSolModifiersIncludingParents||(this._hasGotSolModifiersIncludingParents=!0,this._IdentifySolModifiersIncludingParents()),this._solModifiersIncludingParents}HasSolModifier(e){return this._solModifiers.includes(e)}GetTriggerParents(){return this._triggerParents}GetEventSheet(){return this._eventSheet}GetEventSheetManager(){return this._eventSheet.GetEventSheetManager()}GetRuntime(){return this._runtime}GetParent(){return this._parent}_SetScopeParent(e){this._scopeParent=e}GetScopeParent(){return this._scopeParent||this._parent}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e,this._UpdateCanRunFastRecursive()}IsGroup(){return this._isGroup}IsTopLevelGroup(){return this._isTopLevelGroup}IsElseBlock(){return this._isElseBlock}HasElseBlock(){return this._hasElseBlock}GetGroupName(){return this._groupName}IsGroupActive(){return this._isGroupActive}ResetInitialActivation(){this.SetGroupActive(this._isInitiallyActive)}SetGroupActive(e){if(e=!!e,!this._isGroup)throw Error("not a group");if(this._isGroupActive!==e){this._isGroupActive=e;for(const e of this._containedIncludes)e.UpdateActive();this._containedIncludes.length&&(e=this._runtime.GetCurrentLayout().GetEventSheet())&&e._UpdateDeepIncludes()}}GetSID(){return this._sid}IsOrBlock(){return this._isOrBlock}IsTrigger(){return this._conditions.length&&this._conditions[0].IsTrigger()}IsForFunctionBlock(){return this._scopeParent&&this._scopeParent instanceof e.FunctionBlock}HasAnyTriggeredCondition(){return this.IsForFunctionBlock()||this._conditions.some(e=>e.IsTrigger())}GetConditions(){return this._conditions}GetConditionCount(){return this._conditions.length}GetConditionAt(e){if(e=Math.floor(e),0>e||e>=this._conditions.length)throw new RangeError("invalid condition index");return this._conditions[e]}GetConditionByDebugIndex(e){return this.GetConditionAt(e)}IsFirstConditionOfType(e){let t=e.GetIndex();if(0===t)return!0;for(--t;0<=t;--t)if(this._conditions[t].GetObjectClass()===e.GetObjectClass())return!1;return!0}GetActions(){return this._actions}GetActionCount(){return this._actions.length}GetActionAt(e){if(e=Math.floor(e),0>e||e>=this._actions.length)throw new RangeError("invalid action index");return this._actions[e]}GetActionByDebugIndex(e){e=Math.floor(e);const t=this._actions.find(t=>t.GetDebugIndex()===e);if(!t)throw new RangeError("invalid action debug index");return t}_HasActionIndex(e){return e=Math.floor(e),0<=e&&e<this._actions.length}GetSubEvents(){return this._subEvents}_GetAllLocalVariablesInScope(){return this._subEvents.filter(t=>t instanceof e.EventVariable)}RunPreTrigger(e){e.SetCurrentEvent(this);let t=!1;const s=this._conditions;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(e.SetConditionIndex(i),r.IsLooping())throw Error("trigger cannot be used as sub-event to a loop");if(r.Run())t=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||t}RunOrBlockTrigger(e,t){e.SetCurrentEvent(this),this._conditions[t].Run()&&(this._RunActions(e,0)&&this._RunSubEvents(e),e.SetLastEventTrue(!0))}*DebugRunPreTrigger(e){e.SetCurrentEvent(this);let t=!1;const s=this._conditions;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(e.SetConditionIndex(i),r.IsLooping())throw Error("trigger cannot be used as sub-event to a loop");if(r.DebugCanRunFast()?r.Run():yield*r.DebugRun())t=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||t}*DebugRunOrBlockTrigger(e,t){e.SetCurrentEvent(this),t=this._conditions[t],(t.DebugCanRunFast()?t.Run():yield*t.DebugRun())&&((this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),e.SetLastEventTrue(!0))}Run(e){e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?this._RunOrBlock(e):this._RunAndBlock(e)}*DebugRun(e){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?yield*this._DebugRunOrBlock(e):yield*this._DebugRunAndBlock(e)}_RunOrBlock(e){const t=this._conditions;let s=0===t.length;for(let r=0,n=t.length;r<n;++r){var i=t[r];i.IsTrigger()||(e.SetConditionIndex(r),i=i.Run(),s=s||i)}e.SetLastEventTrue(s),s&&(this._RunActions(e,0)&&this._RunSubEvents(e),this._hasElseBlock&&e.SetElseBranchRan(!0))}*_DebugRunOrBlock(e){const t=this._conditions;let s=0===t.length;for(let r=0,n=t.length;r<n;++r){var i=t[r];i.IsTrigger()||(e.SetConditionIndex(r),i=i.DebugCanRunFast()?i.Run():yield*i.DebugRun(),s=s||i)}e.SetLastEventTrue(s),s&&((this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),this._hasElseBlock&&e.SetElseBranchRan(!0))}_RunAndBlock(e){const t=this._conditions;for(let s=0,i=t.length;s<i;++s){const i=t[s];if(e.SetConditionIndex(s),!i.Run())return void e.SetLastEventTrue(!1)}e.SetLastEventTrue(!0),this._RunActions(e,0)&&this._RunSubEvents(e),e.GetLastEventTrue()&&this._hasElseBlock&&e.SetElseBranchRan(!0)}*_DebugRunAndBlock(e){const t=this._conditions;for(let s=0,i=t.length;s<i;++s){const i=t[s];if(e.SetConditionIndex(s),i.DebugCanRunFast()?!i.Run():!(yield*i.DebugRun()))return void e.SetLastEventTrue(!1)}e.SetLastEventTrue(!0),(this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),e.GetLastEventTrue()&&this._hasElseBlock&&e.SetElseBranchRan(!0)}_RunActions_Fast(e,t){const s=this._actions;for(let i=t,r=s.length;i<r;++i)t=s[i],e.SetActionIndex(i),t.Run();return!0}*_DebugRunActions_Fast(e,t){const s=this._actions;for(let i=t,r=s.length;i<r;++i)t=s[i],e.SetActionIndex(i),t.DebugCanRunFast()?t.Run():yield*t.DebugRun();return!0}_RunActions_ReturnValue(e,t){const s=this.GetEventSheetManager(),i=this._actions;for(let r=t,n=i.length;r<n;++r){t=i[r],e.SetActionIndex(r);const n=t.Run();if(t.CanBailOut()&&!0===n)return!1;t.IsAsync()&&n instanceof Promise&&s.AddAsyncActionPromise(n)}return!0}*_DebugRunActions_ReturnValue(e,t){const s=this.GetEventSheetManager(),i=this._actions;for(let r=t,n=i.length;r<n;++r){let n;if(t=i[r],e.SetActionIndex(r),n=t.DebugCanRunFast()?t.Run():yield*t.DebugRun(),t.CanBailOut()&&!0===n)return!1;t.IsAsync()&&n instanceof Promise&&s.AddAsyncActionPromise(n)}return!0}_ResumeActionsAndSubEvents(e){this._RunActions(e,e.GetActionIndex())&&this._RunSubEvents()}*_DebugResumeActionsAndSubEvents(e){(yield*this._DebugRunActions(e,e.GetActionIndex()))&&(yield*this._DebugRunSubEvents())}_RunSubEvents(){if(this._subEvents.length){var e=this.IsGroup()&&this._runtime.IsCPUProfiling(),t=e?performance.now():0,s=this._eventStack,i=s.Push(this);this._isSolWriterAfterCnds?this._RunSubEvents_SolWriterAfterCnds(i):this._RunSubEvents_Fast(i),s.Pop(),e&&(this._perfRecord.totalTimeCounter+=performance.now()-t)}}_RunSubEvents_SolWriterAfterCnds(e){const t=this._isGroup,s=this._isTopLevelGroup,i=this.GetEventSheetManager(),r=this._subEvents;for(let n=0,a=r.length,o=a-1;n<a;++n){const a=r[n],h=a.GetSolModifiers(),l=!s||!t&&n<o;l&&i.PushCopySol(h),a.Run(e),l?i.PopSol(h):i.ClearSol(h)}}_RunSubEvents_Fast(e){const t=this._subEvents;for(let s=0,i=t.length;s<i;++s)t[s].Run(e)}*_DebugRunSubEvents(){if(this._subEvents.length){var e=this._eventStack,t=e.Push(this);this._isSolWriterAfterCnds?yield*this._DebugRunSubEvents_SolWriterAfterCnds(t):yield*this._DebugRunSubEvents_Fast(t),e.Pop()}}*_DebugRunSubEvents_SolWriterAfterCnds(e){const t=this._isGroup,s=this._isTopLevelGroup,i=this.GetEventSheetManager(),r=this._subEvents;for(let n=0,a=r.length,o=a-1;n<a;++n){const a=r[n],h=a.GetSolModifiers(),l=!s||!t&&n<o;l&&i.PushCopySol(h),yield*a.DebugRun(e),l?i.PopSol(h):i.ClearSol(h)}}*_DebugRunSubEvents_Fast(e){const t=this._subEvents;for(let s=0,i=t.length;s<i;++s)yield*t[s].DebugRun(e)}Retrigger(e,t){this._runtime.IncrementExecCount(),t.ResetQuick();const s=this._conditions;if(!this.IsOrBlock())for(let i=e.GetConditionIndex()+1,r=s.length;i<r;++i)if(e=s[i],t.SetConditionIndex(i),!e.Run())return!1;return this._RunActions(t,0)&&this._RunSubEvents(t),!0}*DebugRetrigger(e,t){this._runtime.IncrementExecCount(),t.ResetQuick();const s=this._conditions;if(!this.IsOrBlock())for(let i=e.GetConditionIndex()+1,r=s.length;i<r;++i)if(e=s[i],t.SetConditionIndex(i),e.DebugCanRunFast()?!e.Run():!(yield*e.DebugRun()))return!1;return(this.DebugCanRunActionsFast()?this._RunActions(t,0):yield*this._DebugRunActions(t,0))&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),!0}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()&&this._debugData.canRunSelfFast}DebugCanRunActionsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllActionsFast}DebugCanRunSubEventsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllSubEventsFast}_CheckParentsOKToRun(e){if(this.GetParent()){const t=this.GetTriggerParents();for(let s=0,i=t.length;s<i;++s)if(!t[s].RunPreTrigger(e))return!1}return!0}*_DebugCheckParentsOKToRun(e){if(this.GetParent()){const t=this.GetTriggerParents();for(let s=0,i=t.length;s<i;++s)if(!(yield*t[s].DebugRunPreTrigger(e)))return!1}return!0}_EvaluateFunctionCallParameters(e,t,s){0<t.length?s?(t=t.map(e=>e.Get(0)),e.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(t)):this._scopeParent.EvaluateFunctionParameters(t):s&&e.GetLocalVarStack().Push()}RunAsFunctionCall(e,t){let s,i;const r=0<e.length;var n=this._runtime;const a=this._eventStack,o=n.GetEventSheetManager(),h=1<o._IncTriggerDepth();return this._EvaluateFunctionCallParameters(o,t,h),r&&o.PushCleanSol(e),t=a.Push(this),this._CheckParentsOKToRun(t)&&(n.IncrementExecCount(),t.SetCurrentEvent(this),(n=this._scopeParent.IsAsync())&&([i,s]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(t),n&&this._scopeParent.MaybeFinishAsyncFunctionCall(i)),a.Pop(),h&&o.GetLocalVarStack().Pop(),r&&o.PopSol(e),o._DecTriggerDepth(),s}*DebugRunAsFunctionCall(e,t){let s,i;(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);const r=0<e.length;var n=this._runtime;const a=this._eventStack,o=n.GetEventSheetManager(),h=1<o._IncTriggerDepth();return this._EvaluateFunctionCallParameters(o,t,h),r&&o.PushCleanSol(e),t=a.Push(this),(yield*this._DebugCheckParentsOKToRun(t))&&(n.IncrementExecCount(),t.SetCurrentEvent(this),(n=this._scopeParent.IsAsync())&&([i,s]=this._scopeParent.StartAsyncFunctionCall()),yield*this._DebugRunAndBlock(t),n&&this._scopeParent.MaybeFinishAsyncFunctionCall(i)),a.Pop(),h&&o.GetLocalVarStack().Pop(),r&&o.PopSol(e),o._DecTriggerDepth(),s}RunAsMappedFunctionCall(e){const t=this.GetSolModifiersIncludingParents(),s=0<t.length,i=this._runtime,r=this._eventStack,n=i.GetEventSheetManager(),a=1<n._IncTriggerDepth();a&&n.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),s&&n.PushCleanSol(t),e=r.Push(this),this._CheckParentsOKToRun(e)&&(i.IncrementExecCount(),e.SetCurrentEvent(this),this._RunAndBlock(e)),r.Pop(),a&&n.GetLocalVarStack().Pop(),s&&n.PopSol(t),n._DecTriggerDepth()}*DebugRunAsMappedFunctionCall(e){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);const t=this.GetSolModifiersIncludingParents(),s=0<t.length,i=this._runtime,r=this._eventStack,n=i.GetEventSheetManager(),a=1<n._IncTriggerDepth();a&&n.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),s&&n.PushCleanSol(t),e=r.Push(this),(yield*this._DebugCheckParentsOKToRun(e))&&(i.IncrementExecCount(),e.SetCurrentEvent(this),yield*this._DebugRunAndBlock(e)),r.Pop(),a&&n.GetLocalVarStack().Pop(),s&&n.PopSol(t),n._DecTriggerDepth()}RunAsExpressionFunctionCall(e,t,s,...i){let r,n;const a=0<e.length,o=this._runtime,h=this._eventStack,l=o.GetEventSheetManager(),c=1<l._IncTriggerDepth();return c&&l.GetLocalVarStack().Push(),0<i.length&&this._scopeParent.SetFunctionParameters(i),a&&l.PushCleanSol(e),i=h.Push(this),i.InitCallFunctionExpression(t,s),h.PushExpFunc(i),o.SetDebuggingEnabled(!1),this._CheckParentsOKToRun(i)&&(o.IncrementExecCount(),i.SetCurrentEvent(this),(t=this._scopeParent.IsAsync())&&([n,r]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(i),t&&this._scopeParent.MaybeFinishAsyncFunctionCall(n)),o.SetDebuggingEnabled(!0),h.Pop(),h.PopExpFunc(),c&&l.GetLocalVarStack().Pop(),a&&l.PopSol(e),l._DecTriggerDepth(),r||i.GetFunctionReturnValue()}}}{const e=self.C3,t=[];let s=!1;e.EventScript=class extends e.DefendedBase{constructor(e,t,s){super();const i=e.GetRuntime(),r=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=r,this._runtime=e.GetRuntime(),this._parent=t,this._func=i.GetObjectReference(s[1]),this._displayNumber=s[2],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=i.IsDebug()?{isBreakpoint:s[3][0],isBreakable:s[3][1]}:null}static Create(t,s,i){return e.New(e.EventScript,t,s,i)}_PostInit(){const e=this._func,t=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this);this._func=e.bind(null,this._runtime.GetIRuntime(),t)}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetEventSheet(){return this._eventSheet}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e}IsElseBlock(){return!1}GetSolModifiers(){return t}GetSolModifiersIncludingParents(){return this._parent?this._parent.GetSolModifiersIncludingParents():t}Run(e){e.SetCurrentEvent(this),this._eventSheetManager.AddAsyncActionPromise(this._RunUserScript())}async _RunUserScript(){try{await this._func()}catch(e){console.error(`Unhandled exception running script %c${this.GetEventSheet().GetName()}, event ${this.GetDisplayNumber()}:`,"font-size: 1.2em; font-weight: bold;",e),self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),s||(console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold"),s=!0)}}*DebugRun(e){e.SetCurrentEvent(this),(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.Run(e)}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()}static HadUserScriptException(){return s}static SetHadUserScriptException(){s=!0}}}{const e=self.C3;e.FunctionBlock=class extends e.DefendedBase{constructor(t,s,i){super(),this._eventSheet=t,this._runtime=t.GetRuntime(),this._parent=s;const r=i[1];this._functionName=r[0],this._returnType=r[1],this._functionParameters=r[2].map(s=>e.EventVariable.Create(t,this,s)),this._isEnabled=r[3],this._innerLocalVariables=[],this._isAsync=r[4],this._nextAsyncId=0,this._currentAsyncId=-1,this._asyncMap=new Map,this._eventBlock=e.EventBlock.Create(t,s,i),this._eventBlock._SetScopeParent(this)}static Create(t,s,i){return e.New(e.FunctionBlock,t,s,i)}_PostInit(){for(const e of this._functionParameters)e._PostInit();this._eventBlock._PostInit(!1)}_GetAllLocalVariablesInScope(){return this._functionParameters}GetFunctionParameters(){return this._functionParameters}GetFunctionParameterCount(){return this._functionParameters.length}_RegisterLocalVariable(e){this._innerLocalVariables.push(e)}_GetAllInnerLocalVariables(){return this._innerLocalVariables}EvaluateFunctionParameters(e){const t=this._functionParameters;for(let s=0,i=t.length;s<i;++s)t[s].SetValue(e[s].Get(0))}SetFunctionParameters(e){const t=this._functionParameters;for(let s=0,i=t.length;s<i;++s)t[s].SetValue(e[s])}CaptureFunctionParameters(){return this._functionParameters.map(e=>e.GetValue())}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetFunctionName(){return this._functionName}GetReturnType(){return this._returnType}IsEnabled(){return this._isEnabled}GetDefaultReturnValue(){switch(this._returnType){case 0:return null;case 2:return"";default:return 0}}GetEventBlock(){return this._eventBlock}IsAsync(){return this._isAsync}StartAsyncFunctionCall(){const e=this._nextAsyncId++;let t;this._currentAsyncId=e;const s=new Promise(e=>t=e);return this._asyncMap.set(e,{resolve:t,pauseCount:0}),[e,s]}MaybeFinishAsyncFunctionCall(e){const t=this._asyncMap.get(e);0===t.pauseCount&&(t.resolve(),this._asyncMap.delete(e)),this._currentAsyncId=-1}PauseCurrentAsyncFunction(){return this._asyncMap.get(this._currentAsyncId).pauseCount++,this._currentAsyncId}ResumeAsyncFunction(e){this._currentAsyncId=e,this._asyncMap.get(e).pauseCount--}}}{const e=self.C3,t=[];e.EventVariable=class extends e.DefendedBase{constructor(t,s,i){super();const r=t.GetEventSheetManager();this._eventSheet=t,this._eventSheetManager=r,this._runtime=t.GetRuntime(),this._parent=s,this._localVarStack=r.GetLocalVarStack(),this._name=i[1],this._type=i[2],this._initialValue=i[3],this._isStatic=!!i[4],this._isConstant=!!i[5],this._isFunctionParameter=s instanceof e.FunctionBlock,this._sid=i[6],this._jsPropName=this._runtime.GetJsPropName(i[8]),this._scriptSetter=(e=>this.SetValue(e)),this._scriptGetter=(()=>this.GetValue()),this._hasSingleValue=!this._parent||this._isStatic||this._isConstant,this._value=this._initialValue,this._localIndex=-1,this.IsBoolean()&&(this._value=this._value?1:0),!this.IsLocal()||this.IsStatic()||this.IsConstant()||(this._localIndex=r._GetNextLocalVarIndex(this)),r._RegisterEventVariable(this)}static Create(t,s,i){return e.New(e.EventVariable,t,s,i)}_PostInit(){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant()&&!this.IsFunctionParameter()){const e=this._eventSheetManager.FindFirstFunctionBlockParent(this);e&&e._RegisterLocalVariable(this)}}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetParent(){return this._parent}GetScopeParent(){return this.GetParent()}IsGlobal(){return!this.GetParent()}IsLocal(){return!this.IsGlobal()}IsFunctionParameter(){return this._isFunctionParameter}IsStatic(){return this._isStatic}IsConstant(){return this._isConstant}IsNumber(){return 0===this._type}IsString(){return 1===this._type}IsBoolean(){return 2===this._type}IsElseBlock(){return!1}GetSID(){return this._sid}GetInitialValue(){return this._initialValue}GetSolModifiers(){return t}Run(e){!this.IsLocal()||this.IsStatic()||this.IsConstant()||this.SetValue(this.GetInitialValue())}DebugCanRunFast(){return!0}*DebugRun(e){this.Run(e)}SetValue(e){this.IsNumber()?"number"!=typeof e&&(e=parseFloat(e)):this.IsString()?"string"!=typeof e&&(e=e.toString()):this.IsBoolean()&&(e=e?1:0),this._hasSingleValue?this._value=e:this._localVarStack.GetCurrent()[this._localIndex]=e}GetValue(){return this._hasSingleValue?this._value:this._localVarStack.GetCurrent()[this._localIndex]}GetTypedValue(){let e=this.GetValue();return this.IsBoolean()&&(e=!!e),e}ResetToInitialValue(){this._value=this._initialValue}_GetScriptInterfaceDescriptor(){return{configurable:!1,enumerable:!0,get:this._scriptGetter,set:this._scriptSetter}}}}{const e=self.C3,t=[];e.EventInclude=class extends e.DefendedBase{constructor(e,t,s){super();const i=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=i,this._runtime=e.GetRuntime(),this._parent=t,this._includeSheet=null,this._includeSheetName=s[1],this._isActive=!0}static Create(t,s,i){return e.New(e.EventInclude,t,s,i)}_PostInit(){this._includeSheet=this._eventSheetManager.GetEventSheetByName(this._includeSheetName),this._eventSheet._AddShallowInclude(this);let t=this.GetParent();for(;t;)t instanceof e.EventBlock&&t.IsGroup()&&t._AddContainedInclude(this),t=t.GetParent();this.UpdateActive(),this._runtime.IsDebug()&&this._eventSheet._GetPerfRecord().children.push(this._includeSheet._GetPerfRecord())}GetParent(){return this._parent}GetSolModifiers(){return t}GetIncludeSheet(){return this._includeSheet}Run(e){e=!!this.GetParent();const t=this._runtime.GetAllObjectClasses();e&&this._eventSheetManager.PushCleanSol(t),this._includeSheet.Run(),e&&this._eventSheetManager.PopSol(t)}*DebugRun(e){e=!!this.GetParent();const t=this._runtime.GetAllObjectClasses();e&&this._eventSheetManager.PushCleanSol(t),yield*this._includeSheet.DebugRun(),e&&this._eventSheetManager.PopSol(t)}DebugCanRunFast(){return!1}IsActive(){return this._isActive}UpdateActive(){let t=this.GetParent();for(;t;){if(t instanceof e.EventBlock&&t.IsGroup()&&!t.IsGroupActive())return void(this._isActive=!1);t=t.GetParent()}this._isActive=!0}}}{const e=self.C3;e.ExpNode=class extends e.DefendedBase{constructor(e){super(),this._owner=e,this._runtime=e.GetRuntime()}_PostInit(){}static CreateNode(o,h){return e.New([n,i,r,a,t,s][h[0]],o,h)}};class t extends e.ExpNode{constructor(t,s){super(t),this._systemPlugin=this._runtime.GetSystemPlugin(),this._func=this._runtime.GetObjectReference(s[1]),this._func!==e.Plugins.System.Exps.random&&this._func!==e.Plugins.System.Exps.choose||this._owner.SetVariesPerInstance()}GetBoundMethod(){return this._systemPlugin._GetBoundACEMethod(this._func,this._systemPlugin)}}class s extends e.ExpNode{constructor(e,t){super(e),this._functionBlock=null,this._functionName=t[1],this._owner.SetVariesPerInstance()}_PostInit(){const e=this._runtime.GetEventSheetManager();this._functionBlock=e.GetFunctionBlockByName(this._functionName),this._functionName=null;const t=this._owner.GetEventBlock(),s=this._functionBlock.GetEventBlock();this._combinedSolModifiers=[...new Set([...t.GetSolModifiersIncludingParents(),...s.GetSolModifiersIncludingParents()])],this._combinedSolModifiers=e._DeduplicateSolModifierList(this._combinedSolModifiers)}GetBoundMethod(){const t=this._functionBlock;if(t.IsEnabled()){const s=t.GetEventBlock();return e.EventBlock.prototype.RunAsExpressionFunctionCall.bind(s,this._combinedSolModifiers,t.GetReturnType(),t.GetDefaultReturnValue())}{const e=t.GetDefaultReturnValue();return()=>e}}}function c(e,t){return e>=t?e%t:(0>e&&(e<=-t&&(e%=t),0>e&&(e+=t)),e)}class i extends e.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._func=this._runtime.GetObjectReference(t[2]),this._returnsString=!!t[3],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}GetBoundMethod(){return this._objectClass.GetPlugin()._GetBoundACEMethod(this._func,this._objectClass.GetSingleGlobalInstance().GetSdkInstance())}ExpObject(...e){const t=this._objectClass,s=t.GetCurrentSol().GetExpressionInstances();var i=s.length;return 0===i?this._returnsString?"":0:(i=c(this._owner.GetSolIndex(),i),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),this._func.apply(s[i].GetSdkInstance(),e))}ExpObject_InstExpr(e,...t){const s=this._objectClass,i=s.GetInstances(),r=i.length;return 0===r?this._returnsString?"":0:(e=c(e,r),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(s),this._func.apply(i[e].GetSdkInstance(),t))}}class r extends e.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._varIndex=t[3],this._returnsString=!!t[2],this._owner._MaybeVaryFor(this._objectClass)}ExpInstVar(){const e=this._objectClass.GetCurrentSol().GetExpressionInstances();var t=e.length;return 0===t?this._returnsString?"":0:(t=c(this._owner.GetSolIndex(),t),e[t]._GetInstanceVariableValueUnchecked(this._varIndex))}ExpInstVar_Family(){var e=this._objectClass,t=e.GetCurrentSol().GetExpressionInstances(),s=t.length;return 0===s?this._returnsString?"":0:(s=c(this._owner.GetSolIndex(),s),t=t[s],e=t.GetObjectClass().GetFamilyInstanceVariableOffset(e.GetFamilyIndex()),t._GetInstanceVariableValueUnchecked(this._varIndex+e))}ExpInstVar_InstExpr(e){const t=this._objectClass;var s=t.GetInstances();const i=s.length;return 0===i?this._returnsString?"":0:(e=c(e,i),s=s[e],e=0,t.IsFamily()&&(e=s.GetObjectClass().GetFamilyInstanceVariableOffset(t.GetFamilyIndex())),s._GetInstanceVariableValueUnchecked(this._varIndex+e))}}class n extends e.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2]),this._func=this._runtime.GetObjectReference(t[3]),this._returnsString=!!t[4],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}ExpBehavior(...e){const t=this._objectClass;var s=t.GetCurrentSol().GetExpressionInstances(),i=s.length;return 0===i?this._returnsString?"":0:(i=c(this._owner.GetSolIndex(),i),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),s=s[i],i=0,t.IsFamily()&&(i=s.GetObjectClass().GetFamilyBehaviorOffset(t.GetFamilyIndex())),this._func.apply(s.GetBehaviorInstances()[this._behaviorIndex+i].GetSdkInstance(),e))}ExpBehavior_InstExpr(e,...t){const s=this._objectClass;var i=s.GetInstances();const r=i.length;return 0===r?this._returnsString?"":0:(e=c(e,r),this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(s),i=i[e],e=0,s.IsFamily()&&(e=i.GetObjectClass().GetFamilyBehaviorOffset(s.GetFamilyIndex())),this._func.apply(i.GetBehaviorInstances()[this._behaviorIndex+e].GetSdkInstance(),t))}}class a extends e.ExpNode{constructor(e,t){super(e),this._eventVar=null,this._eventVarSid=t[1]}_PostInit(){this._eventVar=this._runtime.GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetVar(){return this._eventVar}}}{const e=self.C3;function b(e){if(e=self.C3_ExpressionFuncs[e],!e)throw Error("invalid expression number");return e}e.Parameter=class extends e.DefendedBase{constructor(e,t,s){super(),this._owner=e,this._index=s,this._type=t,this.Get=null,this._isConstant=this._variesPerInstance=!1}static Create(m,f,S){const y=f[0];return e.New([t,s,l,r,a,i,o,t,r,r,c,u,l,d,s,h,n,_,p,g][y],m,y,S,f)}_PostInit(){}SetVariesPerInstance(){this._variesPerInstance=!0}_MaybeVaryFor(e){this._variesPerInstance||!e||e.GetPlugin().IsSingleGlobal()||(this._variesPerInstance=!0)}VariesPerInstance(){return this._variesPerInstance}GetIndex(){return this._index}GetRuntime(){return this._owner.GetRuntime()}GetEventBlock(){return this._owner.GetEventBlock()}IsConstant(){return this._isConstant}};class t extends e.Parameter{constructor(t,s,i,r){super(t,s,i),this._solIndex=0,t=r[1],
this._expressionNumber=t[0],this._numberedNodes=[],this._expressionFunc=null;for(let s=1,i=t.length;s<i;++s)this._numberedNodes.push(e.ExpNode.CreateNode(this,t[s]));this._numberedNodes.length?this.Get=this.GetExpression:(this.Get=b(this._expressionNumber),this._isConstant=!0)}_GetNode(e){if(0>e||e>=this._numberedNodes.length)throw new RangeError("invalid numbered node");return this._numberedNodes[e]}_PostInit(){for(var e of this._numberedNodes)e._PostInit();e=b(this._expressionNumber),this._expressionFunc=this._numberedNodes.length?e(this):e}GetSolIndex(){return this._solIndex}GetExpression(e){return this._solIndex=e,this._expressionFunc()}}class s extends t{constructor(t,s,i,r){super(t,s,i,r),this.Get=this.GetStringExpression,14===s&&(this.GetEventBlock().SetAllSolModifiers(),this._owner instanceof e.Action&&this.GetEventBlock().SetSolWriterAfterCnds())}GetStringExpression(e){return this._solIndex=e,e=this._expressionFunc(),"string"==typeof e?e:""}_GetFastTriggerValue(){return b(this._expressionNumber)()}}class i extends t{constructor(e,t,s,i){super(e,t,s,i),this.Get=this.GetLayer,this._isConstant=!1}GetLayer(e){return this._solIndex=e,e=this._expressionFunc(),this.GetRuntime().GetCurrentLayout().GetLayer(e)}}class r extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._combo=i[1],this.Get=this.GetCombo,this._isConstant=!0}GetCombo(){return this._combo}}class n extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._bool=i[1],this.Get=this.GetBoolean,this._isConstant=!0}GetBoolean(){return this._bool}}class a extends e.Parameter{constructor(t,s,i,r){super(t,s,i),this._objectClass=this.GetRuntime().GetObjectClassByIndex(r[1]),this.Get=this.GetObjectClass,t=this.GetEventBlock(),t._AddSolModifier(this._objectClass),this._owner instanceof e.Action?t.SetSolWriterAfterCnds():t.GetParent()&&t.GetParent().SetSolWriterAfterCnds(),this._isConstant=!0}GetObjectClass(){return this._objectClass}}class o extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._layout=this.GetRuntime().GetLayoutManager().GetLayoutByName(i[1]),this.Get=this.GetLayout,this._isConstant=!0}GetLayout(){return this._layout}}class h extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._timeline=this.GetRuntime().GetTimelineManager().GetTimelineByName(i[1]),this.Get=this.GetTimeline,this._isConstant=!0}GetTimeline(){return this._timeline}}class l extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._fileInfo=i[1],this.Get=this.GetFile,this._isConstant=!0}GetFile(){return this._fileInfo}}class c extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._instVarIndex=i[1],(e=this._owner.GetObjectClass())&&e.IsFamily()?(this.Get=this.GetFamilyInstanceVariable,this.SetVariesPerInstance()):(this.Get=this.GetInstanceVariable,this._isConstant=!0)}GetInstanceVariable(){return this._instVarIndex}GetFamilyInstanceVariable(e){e=e||0;const t=this._owner.GetObjectClass();var s=t.GetCurrentSol();const i=s.GetInstances();if(i.length)e=i[e%i.length].GetObjectClass();else if(s.HasAnyElseInstances())s=s.GetElseInstances(),e=s[e%s.length].GetObjectClass();else{if(!(0<t.GetInstanceCount()))return 0;s=t.GetInstances(),e=s[e%s.length].GetObjectClass()}return this._instVarIndex+e.GetFamilyInstanceVariableOffset(t.GetFamilyIndex())}}class u extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._eventVarSid=i[1],this._eventVar=null,this.Get=this.GetEventVariable,this._isConstant=!0}_PostInit(){this._eventVar=this.GetRuntime().GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetEventVariable(){return this._eventVar}}class _ extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._functionBlockName=i[1],this._functionBlock=null,this.Get=this.GetFunction,this._isConstant=!0}_PostInit(){this._functionBlock=this.GetRuntime().GetEventSheetManager().GetFunctionBlockByName(this._functionBlockName),this._functionBlockName=null}GetFunction(){return this._functionBlock}}class d extends e.Parameter{constructor(t,s,i,r){super(t,s,i),this._subParams=[],this._variadicRet=[],this._isConstant=!0;for(let s=1,i=r.length;s<i;++s)t=e.Parameter.Create(this._owner,r[s],0),this._subParams.push(t),this._variadicRet.push(0),t.IsConstant()||(this._isConstant=!1);this.Get=this.GetVariadic}_PostInit(){for(const e of this._subParams)e._PostInit()}GetVariadic(){const e=this._subParams,t=this._variadicRet;for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0);return t}}class p extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._easeIndex=i[1],this.Get=this.GetEase,this._isConstant=!0}GetEase(){return this._easeIndex}}class g extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._brushIndex=i[1],this.Get=this.GetTilemapBrush,this._isConstant=!0}GetTilemapBrush(){return this._brushIndex}}}{const e=self.C3;function b(e,t){for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0)}const t=[],s=function(){};e.Condition=class extends e.DefendedBase{constructor(i,r,n){if(super(),this._eventBlock=i,this._runtime=i.GetRuntime(),this._index=n,this._func=this._runtime.GetObjectReference(r[1]),this._isTrigger=0<r[3],this._isFastTrigger=2===r[3],this._isLooping=!!r[4],this._isInverted=!!r[5],this._isStatic=!!r[6],this._sid=r[7],this._isInOrBlock=this._eventBlock.IsOrBlock(),this._behaviorType=this._objectClass=null,this._behaviorIndex=-1,this._systemPlugin=null,this.DebugRun=this.Run=s,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._unsavedData=this._savedData=null,this._debugData=this._runtime.IsDebug()?{isBreakpoint:r[8][0],canDebug:r[8][1]}:null,-1===r[0]?this._systemPlugin=this._runtime.GetSystemPlugin():(this._objectClass=this._runtime.GetObjectClassByIndex(r[0]),r[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(r[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(r[2])),this._eventBlock.GetParent()&&this._eventBlock.GetParent().SetSolWriterAfterCnds()),10===r.length){i=r[9];for(let t of i)this._parameters.push(e.Parameter.Create(this,t,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._results=this._parameters=t),this._eventBlock.GetEventSheetManager()._RegisterCondition(this)}static Create(t,s,i){return e.New(e.Condition,t,s,i)}_PostInit(){for(const e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);this._isFastTrigger?(this.Run=this._RunFastTrigger,this.DebugRun=this._DebugRunFastTrigger):this._systemPlugin?(this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this._isStatic?(this.Run=this._RunStatic,this.DebugRun=this._DebugRunStatic):(this.Run=this._RunObject,this.DebugRun=this._DebugRunObject)}_SetSystemRunMethod(){this._SetRunMethodForBoundFunc(this._systemPlugin,this._systemPlugin,this._RunSystem)}_SetSingleGlobalRunMethod(){const e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetRunMethodForBoundFunc(t,s,i){const r=this._func,n=this._isInverted,a=this._parameters;if(0===a.length){const i=t._GetBoundACEMethod(r,s);this.Run=n?function(){return e.xor(i(),n)}:i}else if(1===a.length){const i=a[0];if(!n&&i.IsConstant())this.Run=t._GetBoundACEMethod_1param(r,s,i.Get(0));else{const a=t._GetBoundACEMethod(r,s);this.Run=function(){return e.xor(a(i.Get(0)),n)}}}else if(2===a.length){const i=a[0],o=a[1];if(!n&&i.IsConstant()&&o.IsConstant())this.Run=t._GetBoundACEMethod_2params(r,s,i.Get(0),o.Get(0));else{const a=t._GetBoundACEMethod(r,s);this.Run=function(){return e.xor(a(i.Get(0),o.Get(0)),n)}}}else if(3===a.length){const i=a[0],o=a[1],h=a[2];if(!n&&i.IsConstant()&&o.IsConstant()&&h.IsConstant())this.Run=t._GetBoundACEMethod_3params(r,s,i.Get(0),o.Get(0),h.Get(0));else{const a=t._GetBoundACEMethod(r,s);this.Run=function(){return e.xor(a(i.Get(0),o.Get(0),h.Get(0)),n)}}}else this.Run=i}GetSID(){return this._sid}_GetFunc(){return this._func}GetObjectClass(){return this._objectClass}GetBehaviorType(){return this._behaviorType}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this.GetIndex()}IsTrigger(){return this._isTrigger}IsFastTrigger(){return this._isFastTrigger}IsInverted(){return this._isInverted}IsLooping(){return this._isLooping}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){const t=this._results;return b(this._parameters,t),e.xor(this._func.apply(this._systemPlugin,t),this._isInverted)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var t=this._results;return b(this._parameters,t),t=this._func.apply(this._systemPlugin,t),e.IsIterator(t)&&(t=yield*t),e.xor(t,this._isInverted)}return this.Run()}_RunSingleGlobal(){const t=this._results;b(this._parameters,t);const s=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();return e.xor(this._func.apply(s,t),this._isInverted)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var t=this._results;b(this._parameters,t);const s=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();return t=this._func.apply(s,t),e.IsIterator(t)&&(t=yield*t),e.xor(t,this._isInverted)}return this.Run()}_RunFastTrigger(){return!0}*_DebugRunFastTrigger(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),!0}_RunStatic(){var e=this._results;return b(this._parameters,e),e=this._func.apply(this._behaviorType||this._objectClass,e),this._objectClass.ApplySolToContainer(),e}*_DebugRunStatic(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var t=this._results;return b(this._parameters,t),t=this._func.apply(this._behaviorType||this._objectClass,t),e.IsIterator(t)&&(t=yield*t),this._objectClass.ApplySolToContainer(),t}return this.Run()}_RunObject(){const e=this._parameters,t=this._results,s=this._objectClass.GetCurrentSol();for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()||(t[s]=i.Get(0))}return s.IsSelectAll()?this._RunObject_FirstFilter(s):this._RunObject_NextFilter(s)}*_DebugRunObject(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._RunObject()}_EvaluateVaryingParameters(e){const t=this._parameters,s=this._results;for(let i=0,r=t.length;i<r;++i){const r=t[i];r.VariesPerInstance()&&(s[i]=r.Get(e))}}_RunObject_FirstFilter(t){const s=this._objectClass,i=s.IsFamily(),r=s.GetFamilyIndex(),n=this._behaviorIndex,a=0<=n,o=s.GetInstances(),h=this._anyParamVariesPerInstance,l=this._results,c=this._func,u=this._isInverted,_=this._isInOrBlock&&!this._isTrigger;t.ClearArrays();for(let s=0,p=o.length;s<p;++s){const p=o[s];h&&this._EvaluateVaryingParameters(s);var d=void 0;a?(d=i?p.GetObjectClass().GetFamilyBehaviorOffset(r):0,d=c.apply(p.GetBehaviorInstances()[n+d].GetSdkInstance(),l)):d=c.apply(p.GetSdkInstance(),l),e.xor(d,u)?t._PushInstance(p):_&&t._PushElseInstance(p)}return s.FinishCondition(!0),t._SetSelectAll(!1),s.ApplySolToContainer(),t.HasAnyInstances()}_RunObject_NextFilter(t){const s=this._objectClass;var i=s.IsFamily();const r=s.GetFamilyIndex(),n=s.IsInContainer(),a=this._behaviorIndex,o=0<=a,h=this._anyParamVariesPerInstance,l=this._results,c=this._func,u=this._isInverted,_=this._isInOrBlock&&!this._isTrigger,d=t._GetOwnInstances(),p=t._GetOwnElseInstances(),g=_&&!this._eventBlock.IsFirstConditionOfType(this),m=g?p:d;let f=0,S=!1;for(let t=0,s=m.length;t<s;++t){const s=m[t];h&&this._EvaluateVaryingParameters(t);var y=void 0;o?(y=i?s.GetObjectClass().GetFamilyBehaviorOffset(r):0,y=c.apply(s.GetBehaviorInstances()[a+y].GetSdkInstance(),l)):y=c.apply(s.GetSdkInstance(),l),e.xor(y,u)?(S=!0,g?(d.push(s),n&&s._PushSiblingsToSolInstances()):(m[f]=s,n&&s._SetSiblingsToSolInstancesIndex(f),++f)):g?(m[f]=s,n&&s._SetSiblingsToSolElseInstancesIndex(f),++f):_&&(p.push(s),n&&s._PushSiblingsToSolElseInstances())}return e.truncateArray(m,f),n&&s._TruncateContainerSols(g,f),i=S,g&&!S&&(S=this._OrBlockCheckInstances(d)),s.FinishCondition(i||_),_?S:t.HasAnyInstances()}_OrBlockCheckInstances(t){var s=this._objectClass;const i=s.IsFamily();s=s.GetFamilyIndex();const r=this._anyParamVariesPerInstance,n=this._behaviorIndex,a=0<=n,o=this._results,h=this._func,l=this._isInverted;for(let u=0,_=t.length;u<_;++u){var c=t[u];if(r&&this._EvaluateVaryingParameters(u),a){const e=i?c.GetObjectClass().GetFamilyBehaviorOffset(s):0;c=h.apply(c.GetBehaviorInstances()[n+e].GetSdkInstance(),o)}else c=h.apply(c.GetSdkInstance(),o);if(e.xor(c,l))return!0}return!1}ReevaluateParameter(e,t){return this._parameters[e].Get(t)}GetFastTriggerValue(){const e=this._parameters;if(!e.length)throw Error("no parameters");return e[0]._GetFastTriggerValue()}_SaveToJson(){if(!this._savedData||!this._savedData.size)return null;const e={};for(const[t,s]of this._savedData.entries()){let i=s;"collmemory"===t&&(i=[...s.entries()].map(e=>[e[0].GetUID(),e[1].GetUID(),e[2]])),e[t]=i}return{ex:e}}_LoadFromJson(t){if(this._savedData&&(this._savedData.clear(),this._savedData=null),t){var s=this._runtime,i=t.ex;if(i){t=this.GetSavedDataMap(),t.clear();for(const[r,n]of Object.entries(i))i=n,"collmemory"===r&&(i=e.New(e.PairMap,n.map(e=>[s.GetInstanceByUID(e[0]),s.GetInstanceByUID(e[1]),e[2]]).filter(e=>e[0]&&e[1]))),t.set(r,i)}}}}}{const e=self.C3;function b(e,t){for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0)}const t=[],s=function(){},i=function*(){};e.Action=class extends e.DefendedBase{constructor(i,r,n){super(),this._eventBlock=i,this._runtime=i=i.GetRuntime(),this._index=n,this._sid=4<=r.length?r[3]:-1,this._actionReturnType=5<=r.length?r[4]:0,this._behaviorType=this._objectClass=this._func=null,this._behaviorIndex=-1,this._systemPlugin=null,this._callFunctionName="",this._combinedSolModifiers=this._callEventBlock=null,this.DebugRun=this.Run=s,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._unsavedData=this._savedData=null;const a=(n=-3===r[0])?r[2]:r[5];if(this._debugData=i.IsDebug()||n?{isBreakpoint:a[0],canDebug:a[1],index:a[2]}:null,-1===r[0]?(this._systemPlugin=i.GetSystemPlugin(),this._func=i.GetObjectReference(r[1])):-2===r[0]?this._callFunctionName=r[1]:n?(this._func=i.GetObjectReference(r[1]),this.Run=this.RunUserScript,this.DebugRun=this.DebugRunUserScript,this._actionReturnType=1):(this._func=i.GetObjectReference(r[1]),this._objectClass=i.GetObjectClassByIndex(r[0]),r[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(r[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(r[2]))),7===r.length){r=r[6];for(const t of r)this._parameters.push(e.Parameter.Create(this,t,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._results=this._parameters=t),this._eventBlock.GetEventSheetManager()._RegisterAction(this)}static Create(t,s,i){return e.New(e.Action,t,s,i)}_PostInit(){for(var e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);if(this._systemPlugin)this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem;else if(this._callFunctionName)this._SetCallFunctionRunMethod(),this._callFunctionName="";else if(this.Run===this.RunUserScript){e=this._func;const t=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this._eventBlock);this._func=e.bind(null,this._runtime.GetIRuntime(),t)}else this._behaviorType?this.IsAsync()?(this.Run=this._RunBehavior_Async,this.DebugRun=this._DebugRunBehavior_Async):(this.Run=this._RunBehavior,this.DebugRun=this._DebugRunBehavior):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this.IsAsync()?(this.Run=this._RunObject_Async,this.DebugRun=this._DebugRunObject_Async):this._parameters.length?this._parameters.every(e=>e.VariesPerInstance())?(this.Run=this._RunObject_AllParamsVary,this.DebugRun=this._DebugRunObject_AllParamsVary):this._anyParamVariesPerInstance?(this.Run=this._RunObject_SomeParamsVary,this.DebugRun=this._DebugRunObject_SomeParamsVary):this._parameters.every(e=>e.IsConstant())?(b(this._parameters,this._results),this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst):(this.Run=this._RunObject_ParamsDontVary,this.DebugRun=this._DebugRunObject_ParamsDontVary):(this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst)}_SetSystemRunMethod(){this._SetRunMethodForBoundFunc(this._systemPlugin,this._systemPlugin,this._RunSystem)}_SetSingleGlobalRunMethod(){const e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetCallFunctionRunMethod(){const t=this._eventBlock.GetEventSheetManager(),r=t.GetFunctionBlockByName(this._callFunctionName);r.IsEnabled()?(this._callEventBlock=r.GetEventBlock(),this._combinedSolModifiers=[...new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents()])],this._combinedSolModifiers=t._DeduplicateSolModifierList(this._combinedSolModifiers),this.Run=e.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,this._combinedSolModifiers,this._parameters),this.DebugRun=this._DebugRunCallFunction):(this.Run=s,this.DebugRun=i)}_SetRunMethodForBoundFunc(e,t,s){const i=this._func,r=this._parameters;if(0===r.length)this.Run=e._GetBoundACEMethod(i,t);else if(1===r.length){const s=r[0];if(s.IsConstant())this.Run=e._GetBoundACEMethod_1param(i,t,s.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0))}}}else if(2===r.length){const s=r[0],n=r[1];if(s.IsConstant()&&n.IsConstant())this.Run=e._GetBoundACEMethod_2params(i,t,s.Get(0),n.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0),n.Get(0))}}}else if(3===r.length){const s=r[0],n=r[1],a=r[2];if(s.IsConstant()&&n.IsConstant()&&a.IsConstant())this.Run=e._GetBoundACEMethod_3params(i,t,s.Get(0),n.Get(0),a.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0),n.Get(0),a.Get(0))}}}else this.Run=s}GetSID(){return this._sid}IsAsync(){return 1===this._actionReturnType}CanBailOut(){return 2===this._actionReturnType}HasReturnType(){return 0!==this._actionReturnType}GetObjectClass(){return this._objectClass}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this._debugData.index}GetCombinedSolModifiers(){return this._combinedSolModifiers}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){const e=this._results;return b(this._parameters,e),this._func.apply(this._systemPlugin,e)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;return b(this._parameters,e),yield*this._func.apply(this._systemPlugin,e)}return this.Run()}*_DebugRunCallFunction(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),yield*this._callEventBlock.DebugRunAsFunctionCall(this._combinedSolModifiers,this._parameters)}_RunSingleGlobal(){const e=this._results;return b(this._parameters,e),this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;return b(this._parameters,e),yield*this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)}return this.Run()}_RunObject_ParamsConst(){const e=this._results,t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)this._func.apply(t[s].GetSdkInstance(),e)}*_DebugRunObject_ParamsConst(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results,t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)yield*this._func.apply(t[s].GetSdkInstance(),e)}else this._RunObject_ParamsConst()}_RunObject_ParamsDontVary(){const e=this._results;b(this._parameters,e);const t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)this._func.apply(t[s].GetSdkInstance(),e)}*_DebugRunObject_ParamsDontVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;b(this._parameters,e);const t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)yield*this._func.apply(t[s].GetSdkInstance(),e)}else this._RunObject_ParamsDontVary()}_RunObject_AllParamsVary(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(r);s.apply(n.GetSdkInstance(),t)}}*_DebugRunObject_AllParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(r);yield*s.apply(n.GetSdkInstance(),t)}}else this._RunObject_AllParamsVary()}_RunObject_SomeParamsVary(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=e.length;s<i;++s){var r=e[s];r.VariesPerInstance()||(t[s]=r.Get(0))}for(let n=0,a=i.length;n<a;++n){r=i[n];for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()&&(t[s]=i.Get(n))}s.apply(r.GetSdkInstance(),t)}}*_DebugRunObject_SomeParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._parameters,s=this._results,i=this._func,r=this._objectClass.GetCurrentSol().GetInstances();for(let i=0,r=t.length;i<r;++i){var e=t[i];e.VariesPerInstance()||(s[i]=e.Get(0))}for(let n=0,a=r.length;n<a;++n){e=r[n];for(let e=0,i=t.length;e<i;++e){const i=t[e];i.VariesPerInstance()&&(s[e]=i.Get(n))}yield*i.apply(e.GetSdkInstance(),s)}}else this._RunObject_SomeParamsVary()}_RunBehavior(){var e=this._objectClass;const t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._anyParamVariesPerInstance,n=this._results,a=this._func,o=this._behaviorIndex;e=e.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e){var h=i[e];h.VariesPerInstance()||(n[e]=h.Get(0))}for(let c=0,u=e.length;c<u;++c){if(h=e[c],r)for(let e=0,t=i.length;e<t;++e){var l=i[e];l.VariesPerInstance()&&(n[e]=l.Get(c))}l=t?h.GetObjectClass().GetFamilyBehaviorOffset(s):0,a.apply(h.GetBehaviorInstances()[o+l].GetSdkInstance(),n)}}*_DebugRunBehavior(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._objectClass;const i=e.IsFamily(),r=e.GetFamilyIndex(),n=this._parameters,a=this._anyParamVariesPerInstance,o=this._results,h=this._func,l=this._behaviorIndex;e=e.GetCurrentSol().GetInstances();for(let e=0,s=n.length;e<s;++e){var t=n[e];t.VariesPerInstance()||(o[e]=t.Get(0))}for(let c=0,u=e.length;c<u;++c){if(t=e[c],a)for(let e=0,t=n.length;e<t;++e){var s=n[e];s.VariesPerInstance()&&(o[e]=s.Get(c))}s=i?t.GetObjectClass().GetFamilyBehaviorOffset(r):0,yield*h.apply(t.GetBehaviorInstances()[l+s].GetSdkInstance(),o)}}else this._RunBehavior()}_RunObject_Async(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances(),r=[];for(let n=0,a=i.length;n<a;++n){const a=i[n];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(n);r.push(s.apply(a.GetSdkInstance(),t))}return Promise.all(r)}*_DebugRunObject_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances(),r=[];for(let n=0,a=i.length;n<a;++n){const a=i[n];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(n);r.push(yield*s.apply(a.GetSdkInstance(),t))}return Promise.all(r)}return this._RunObject_Async()}_RunBehavior_Async(){var e=this._objectClass;const t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._results,n=this._func,a=this._behaviorIndex;e=e.GetCurrentSol().GetInstances();const o=[];for(let h=0,l=e.length;h<l;++h){const l=e[h];for(let e=0,t=i.length;e<t;++e)r[e]=i[e].Get(h);const c=t?l.GetObjectClass().GetFamilyBehaviorOffset(s):0;o.push(n.apply(l.GetBehaviorInstances()[a+c].GetSdkInstance(),r))}return Promise.all(o)}*_DebugRunBehavior_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){var e=this._objectClass;const t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._results,n=this._func,a=this._behaviorIndex;e=e.GetCurrentSol().GetInstances();const o=[];for(let h=0,l=e.length;h<l;++h){const l=e[h];for(let e=0,t=i.length;e<t;++e)r[e]=i[e].Get(h);const c=t?l.GetObjectClass().GetFamilyBehaviorOffset(s):0;o.push(yield*n.apply(l.GetBehaviorInstances()[a+c].GetSdkInstance(),r))}return Promise.all(o)}return this._RunBehavior_Async()}async RunUserScript(){try{await this._func()}catch(t){console.error(`Unhandled exception running script %c${this._eventBlock.GetEventSheet().GetName()}, event ${this._eventBlock.GetDisplayNumber()}, action ${this.GetDebugIndex()+1}:`,"font-size: 1.2em; font-weight: bold;",t),self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),e.EventScript.HadUserScriptException()||(console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold"),e.EventScript.SetHadUserScriptException())}}*DebugRunUserScript(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.RunUserScript()}_SaveToJson(){return this._savedData&&this._savedData.size?{ex:e.ToSuperJSON(this._savedData)}:null}_LoadFromJson(t){this._savedData&&(this._savedData.clear(),this._savedData=null),t&&(t=t.ex)&&(this._savedData=e.FromSuperJSON(t))}}}{const e=self.C3,s=new e.Color;function a(t,s){return e.compare(this.GetWorldInfo().GetX(),t,s)}function c(t,s){return e.compare(this.GetWorldInfo().GetY(),t,s)}function d(){const e=this.GetWorldInfo(),t=e.GetLayer();return t.Has3DCamera()?e.IsInViewport3D(t._GetViewFrustum()):e.IsInViewport(t.GetViewport(),e.GetLayout().HasVanishingPointOutsideViewport(),e.GetLayout().IsOrthographicProjection())}function f(){var e=this.GetWorldInfo();const t=e.GetLayout();return e=e.GetBoundingBox(),0>e.getRight()||0>e.getBottom()||e.getLeft()>t.GetWidth()||e.getTop()>t.GetHeight()}function h(t,s,i){const r=this.GetCurrentSol(),n=r.GetInstances();if(!n.length)return!1;let a=n[0];var o=a.GetWorldInfo();let h=a,l=e.distanceSquared(o.GetX(),o.GetY(),s,i);for(let r=1,c=n.length;r<c;++r)a=n[r],o=a.GetWorldInfo(),o=e.distanceSquared(o.GetX(),o.GetY(),s,i),(0===t&&o<l||1===t&&o>l)&&(l=o,h=a);return r.PickOne(h),!0}function g(e){const t=this.GetWorldInfo();t.GetX()!==e&&(t.SetX(e),t.SetBboxChanged())}function k(e){const t=this.GetWorldInfo();t.GetY()!==e&&(t.SetY(e),t.SetBboxChanged())}function m(e,t){const s=this.GetWorldInfo();s.EqualsXY(e,t)||(s.SetXY(e,t),s.SetBboxChanged())}function u(e,t){if(e&&(e=e.GetPairedInstance(this._inst))){var[s,i]=e.GetImagePoint(t);t=this.GetWorldInfo(),t.GetX()===s&&t.GetY()===i||(t.SetXY(s,i),t.SetBboxChanged())}}function v(e){if(0!==e){var t=this.GetWorldInfo();t.OffsetXY(t.GetCosAngle()*e,t.GetSinAngle()*e),t.SetBboxChanged()}}function n(t,s){if(0!==s){var i=this.GetWorldInfo();t=e.toRadians(t),i.OffsetXY(Math.cos(t)*s,Math.sin(t)*s),i.SetBboxChanged()}}function p(){return this.GetWorldInfo().GetX()}function q(){return this.GetWorldInfo().GetY()}function t(){return this._runtime.GetDt(this._inst)}function w(t,s){return e.compare(this.GetWorldInfo().GetWidth(),t,s)}function y(t,s){return e.compare(this.GetWorldInfo().GetHeight(),t,s)}function B(e){const t=this.GetWorldInfo();t.GetWidth()!==e&&(t.SetWidth(e),t.SetBboxChanged())}function D(e){const t=this.GetWorldInfo();t.GetHeight()!==e&&(t.SetHeight(e),t.SetBboxChanged())}function A(e,t){const s=this.GetWorldInfo();s.GetWidth()===e&&s.GetHeight()===t||(s.SetSize(e,t),s.SetBboxChanged())}function E(){return this.GetWorldInfo().GetWidth()}function J(){return this.GetWorldInfo().GetHeight()}function C(){return this.GetWorldInfo().GetBoundingBox().getLeft()}function H(){return this.GetWorldInfo().GetBoundingBox().getTop()}function K(){return this.GetWorldInfo().GetBoundingBox().getRight()}function O(){return this.GetWorldInfo().GetBoundingBox().getBottom()}function S(t,s){return e.angleDiff(this.GetWorldInfo().GetAngle(),e.toRadians(s))<=e.toRadians(t)}function U(t){return e.angleClockwise(this.GetWorldInfo().GetAngle(),e.toRadians(t))}function V(t,s){t=e.toRadians(t),s=e.toRadians(s);const i=this.GetWorldInfo().GetAngle();return e.angleClockwise(s,t)?e.angleClockwise(i,t)&&!e.angleClockwise(i,s):!(!e.angleClockwise(i,t)&&e.angleClockwise(i,s))}function Z(t){const s=this.GetWorldInfo();t=e.clampAngle(e.toRadians(t)),isNaN(t)||s.GetAngle()===t||(s.SetAngle(t),s.SetBboxChanged())}function ma(t){if(!isNaN(t)&&0!==t){var s=this.GetWorldInfo();s.SetAngle(s.GetAngle()+e.toRadians(t)),s.SetBboxChanged()}}function va(t){if(!isNaN(t)&&0!==t){var s=this.GetWorldInfo();s.SetAngle(s.GetAngle()-e.toRadians(t)),s.SetBboxChanged()}}function Na(t,s){const i=this.GetWorldInfo(),r=i.GetAngle();t=e.angleRotate(r,e.toRadians(s),e.toRadians(t)),isNaN(t)||r===t||(i.SetAngle(t),i.SetBboxChanged())}function Ea(t,s,i){const r=this.GetWorldInfo(),n=r.GetAngle();s-=r.GetX(),i-=r.GetY(),t=e.angleRotate(n,Math.atan2(i,s),e.toRadians(t)),isNaN(t)||n===t||(r.SetAngle(t),r.SetBboxChanged())}function Ia(e,t){const s=this.GetWorldInfo(),i=s.GetAngle();e-=s.GetX(),t-=s.GetY(),t=Math.atan2(t,e),isNaN(t)||i===t||(s.SetAngle(t),s.SetBboxChanged())}function Ma(){return e.toDegrees(this.GetWorldInfo().GetAngle())}function Fa(t,s){return e.compare(e.round6dp(100*this.GetWorldInfo().GetOpacity()),t,s)}function ya(){return this.GetWorldInfo().IsVisible()}function na(e){const t=this.GetWorldInfo();e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&(t.SetVisible(e),this._runtime.UpdateRender())}function Va(t){t=e.clamp(t/100,0,1);const s=this.GetWorldInfo();s.GetOpacity()!==t&&(s.SetOpacity(t),this._runtime.UpdateRender())}function xa(e){s.setFromRgbValue(e),e=this.GetWorldInfo(),e.GetUnpremultipliedColor().equalsIgnoringAlpha(s)||(e.SetUnpremultipliedColor(s),this._runtime.UpdateRender())}function Ga(){const t=this.GetWorldInfo().GetUnpremultipliedColor();return e.PackRGBAEx(t.getR(),t.getG(),t.getB(),t.getA())}function bb(){return e.round6dp(100*this.GetWorldInfo().GetOpacity())}function Xa(e){return!!e&&this.GetWorldInfo().GetLayer()===e}function ob(e){const t=this.GetCurrentSol(),s=t.GetInstances();if(!s.length)return!1;let i=s[0];for(let t=1,r=s.length;t<r;++t){
const r=s[t],n=r.GetWorldInfo(),a=i.GetWorldInfo(),o=n.GetLayer().GetIndex(),h=a.GetLayer().GetIndex();0===e?(o>h||o===h&&n.GetZIndex()>a.GetZIndex())&&(i=r):(o<h||o===h&&n.GetZIndex()<a.GetZIndex())&&(i=r)}return t.PickOne(i),!0}function pb(t,s,i){const r=this.GetWorldInfo();return t=0===t?r.GetZElevation():r.GetTotalZElevation(),e.compare(t,s,i)}function cb(){this.GetWorldInfo().ZOrderMoveToTop()}function qb(){this.GetWorldInfo().ZOrderMoveToBottom()}function rb(e){e&&this.GetWorldInfo().ZOrderMoveToLayer(e)}function sb(e,t){e=0===e,t&&(t=t.GetFirstPicked(this.GetInstance()))&&this.GetWorldInfo().ZOrderMoveAdjacentToInstance(t,e)}function tb(e){const t=this.GetWorldInfo();t.GetZElevation()!==e&&(t.SetZElevation(e),this._runtime.UpdateRender())}function ub(){return this.GetWorldInfo().GetLayer().GetIndex()}function vb(){return this.GetWorldInfo().GetLayer().GetName()}function wb(){return this.GetWorldInfo().GetZIndex()}function db(){return this.GetWorldInfo().GetZElevation()}function xb(){return this.GetWorldInfo().GetTotalZElevation()}function yb(e,t){if(t=this.GetObjectClass().GetEffectList().GetEffectTypeByName(t)){t=t.GetIndex(),e=1===e;var s=this.GetWorldInfo().GetInstanceEffectList();s.IsEffectIndexActive(t)!==e&&(s.SetEffectIndexActive(t,e),s.UpdateActiveEffects(),this._runtime.UpdateRender())}}function zb(e,t,i){var r=this.GetObjectClass().GetEffectList().GetEffectTypeByName(e);if(r){e=r.GetIndex();var n=this.GetWorldInfo().GetInstanceEffectList(),a=n.GetEffectParametersForIndex(e);if(t=Math.floor(t),!(0>t||t>=a.length)){if(r=r.GetShaderProgram().GetParameterType(t),"color"===r){if(s.setFromRgbValue(i),t=a[t],s.equalsIgnoringAlpha(t))return;t.copyRgb(s)}else{if("percent"===r&&(i/=100),a[t]===i)return;a[t]=i}n.IsEffectIndexActive(e)&&this._runtime.UpdateRender()}}}const i=e.New(e.Rect),o=[],_=[];let b=!1,N=null,W=!1;const j=new Set;function ib(e,t,s,i){const r=t.GetUID(),n=s.GetUID();r<n?e.Set(t,s,i):e.Set(s,t,i)}function jb(e,t,s){const i=t.GetUID(),r=s.GetUID();i<r?e.Delete(t,s):e.Delete(s,t)}function sa(e,t){e.DeleteEither(t)}function Sa(e,t,s){const i=t.GetUID(),r=s.GetUID();return i<r?e.Get(t,s):e.Get(s,t)}function Ab(t,s,r,n){if(!s)return!1;t=t.GetInstance();const a=0!==r||0!==n,o=t.GetWorldInfo(),h=t.GetRuntime(),l=h.GetCollisionEngine();var c=h.GetCurrentCondition();const u=c.GetEventBlock().IsOrBlock();var d=c.GetObjectClass();c=c.IsInverted();const p=s.GetCurrentSol();d=d!==s,N=s,b=d&&!c,W=!1;let g=0,m=0,f=!1;p.IsSelectAll()?(i.copy(o.GetBoundingBox()),i.offset(r,n),l.GetCollisionCandidates(o.GetLayer(),s,i,_),s=_):u?h.IsCurrentConditionFirst()&&!p._GetOwnElseInstances().length&&p._GetOwnInstances().length?s=p._GetOwnInstances():(s=p._GetOwnElseInstances(),W=!0):s=p._GetOwnInstances(),a&&(g=o.GetX(),m=o.GetY(),o.OffsetXY(r,n),o.SetBboxChanged());for(const e of s)if(l.TestOverlap(t,e)){if(f=!0,c)break;d&&j.add(e)}return a&&(o.SetXY(g,m),o.SetBboxChanged()),e.clearArray(_),f}function Db(t){t=t.GetRuntime().GetCurrentEvent().IsOrBlock();const s=N.GetCurrentSol(),i=s._GetOwnInstances(),r=s._GetOwnElseInstances();s.IsSelectAll()?(s.SetSetPicked(j),t&&(e.clearArray(r),s.AddElseInstances(j,N.GetInstances()))):t?W?s.TransferElseInstancesToOwn(j):(s.AddElseInstances(j,i),s.SetSetPicked(j)):s.SetSetPicked(j),N.ApplySolToContainer()}function Eb(e,t){b&&(t&&Db(e),j.clear(),N=null,b=!1)}function Fb(t){if(this._runtime.IsDebugging())return Gb.call(this,t);if(!t)return!1;var s=this._runtime;const i=s.GetCollisionEngine(),r=s.GetEventSheetManager(),n=r.GetEventStack();var a=r.GetCurrentCondition();const h=a.GetObjectClass();var l=a.GetSavedDataMap(),c=a.GetUnsavedDataMap();a=n.GetCurrentStackFrame();const u=s.GetTickCount(),_=u-1,d=a.GetCurrentEvent(),p=n.Push(d);let g=l.get("collmemory");g||(g=e.New(e.PairMap),l.set("collmemory",g)),c.get("collisionCreatedDestroyCallback")||(c.set("collisionCreatedDestroyCallback",!0),s.Dispatcher().addEventListener("instancedestroy",e=>sa(g,e.instance))),l=h.GetCurrentSol(),s=t.GetCurrentSol(),l=l.GetInstances(),c=null;for(let n=0;n<l.length;++n){const y=l[n];s.IsSelectAll()?(i.GetCollisionCandidates(y.GetWorldInfo().GetLayer(),t,y.GetWorldInfo().GetBoundingBox(),o),c=o,i.AddRegisteredCollisionCandidates(y,t,c)):c=s.GetInstances();for(let s=0;s<c.length;++s){const n=c[s];if(i.TestOverlap(y,n)||i.CheckRegisteredCollision(y,n)){var m=Sa(g,y,n),f=!1,S=-2;"number"==typeof m&&(f=!0,S=m),m=!f||S<_,ib(g,y,n,u),m&&(m=d.GetSolModifiers(),r.PushCopySol(m),S=h.GetCurrentSol(),f=t.GetCurrentSol(),S._SetSelectAll(!1),f._SetSelectAll(!1),h===t?(f=S._GetOwnInstances(),e.clearArray(f),f.push(y),f.push(n),h.ApplySolToContainer()):(S=S._GetOwnInstances(),f=f._GetOwnInstances(),e.clearArray(S),e.clearArray(f),S.push(y),f.push(n),h.ApplySolToContainer(),t.ApplySolToContainer()),d.Retrigger(a,p),r.PopSol(m))}else jb(g,y,n)}e.clearArray(o)}return n.Pop(),!1}function*Gb(t){if(!t)return!1;var s=this._runtime;const i=s.GetCollisionEngine(),r=s.GetEventSheetManager(),n=r.GetEventStack();var a=r.GetCurrentCondition();const h=a.GetObjectClass();var l=a.GetSavedDataMap(),c=a.GetUnsavedDataMap();a=n.GetCurrentStackFrame();const u=s.GetTickCount(),_=u-1,d=a.GetCurrentEvent(),p=n.Push(d);let g=l.get("collmemory");g||(g=e.New(e.PairMap),l.set("collmemory",g)),c.get("collisionCreatedDestroyCallback")||(c.set("collisionCreatedDestroyCallback",!0),s.Dispatcher().addEventListener("instancedestroy",e=>sa(g,e.instance))),l=h.GetCurrentSol(),s=t.GetCurrentSol(),l=l.GetInstances(),c=null;for(let n=0;n<l.length;++n){const y=l[n];s.IsSelectAll()?(i.GetCollisionCandidates(y.GetWorldInfo().GetLayer(),t,y.GetWorldInfo().GetBoundingBox(),o),c=o,i.AddRegisteredCollisionCandidates(y,t,c)):c=s.GetInstances();for(let s=0;s<c.length;++s){const n=c[s];if(i.TestOverlap(y,n)||i.CheckRegisteredCollision(y,n)){var m=Sa(g,y,n),f=!1,S=-2;"number"==typeof m&&(f=!0,S=m),m=!f||S<_,ib(g,y,n,u),m&&(m=d.GetSolModifiers(),r.PushCopySol(m),S=h.GetCurrentSol(),f=t.GetCurrentSol(),S._SetSelectAll(!1),f._SetSelectAll(!1),h===t?(f=S._GetOwnInstances(),e.clearArray(f),f.push(y),f.push(n),h.ApplySolToContainer()):(S=S._GetOwnInstances(),f=f._GetOwnInstances(),e.clearArray(S),e.clearArray(f),S.push(y),f.push(n),h.ApplySolToContainer(),t.ApplySolToContainer()),yield*d.DebugRetrigger(a,p),r.PopSol(m))}else jb(g,y,n)}e.clearArray(o)}return n.Pop(),!1}function Hb(e){return Ab(this,e,0,0)}function kb(e,t,s){return Ab(this,e,t,s)}function lb(){return this.GetWorldInfo().HasParent()}function mb(){return this.GetWorldInfo().HasChildren()}function nb(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol();var r=i.GetInstances();if(0===r.length)return!1;r=new Set(r);const n=new Set;for(let i=0,o=s.length;i<o;++i){var a=s[i];if(1===t)for(const t of a.parents())t.BelongsToObjectClass(e)&&r.has(t)&&n.add(t);else{if(0===t){if(a=a.GetParent(),null===a)continue}else a=a.GetTopParent();a.BelongsToObjectClass(e)&&r.has(a)&&n.add(a)}}return 0!==n.size&&(i.SetSetPicked(n),e.ApplySolToContainer(),!0)}function $a(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol();var r=i.GetInstances();if(i.IsSelectAll()){var n=[...this._runtime.instancesPendingCreateForObjectClass(e)];0<n.length&&(r=r.concat(n))}if(0===r.length)return!1;r=new Set(r),n=new Set;for(let i=0,a=s.length;i<a;++i){const a=s[i];2===t&&!a.HasChildren()&&a.BelongsToObjectClass(e)&&r.has(a)&&n.add(a);for(const s of 0===t?a.children():a.allChildren())2===t&&s.HasChildren()||s.BelongsToObjectClass(e)&&r.has(s)&&n.add(s)}return 0!==n.size&&(i.SetSetPicked(n),e.ApplySolToContainer(),!0)}function l(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol();var r=i.GetInstances();if(i.IsSelectAll()){var n=[...this._runtime.instancesPendingCreateForObjectClass(e)];0<n.length&&(r=r.concat(n))}if(0===r.length)return!1;r=new Set(r),n=[];for(let i=0,a=s.length;i<a;++i){const a=s[i].GetChildAt(t);null!==a&&a.BelongsToObjectClass(e)&&r.has(a)&&n.push(a)}return 0!==n.length&&(i.SetArrayPicked(n),e.ApplySolToContainer(),!0)}function r(t,s){return e.compare(this._inst.GetChildCount(),t,s)}function x(e,t,s,i,r,n,a,o){const h=this._inst,l=this._runtime.GetCurrentAction().GetObjectClass();for(const c of e.allCorrespondingInstances(h,l)){if(!c.GetPlugin().SupportsSceneGraph())break;h.AddChild(c,{transformX:t,transformY:s,transformWidth:i,transformHeight:r,transformAngle:n,transformZElevation:a,destroyWithParent:o})}}function z(e){const t=this._inst,s=this._runtime.GetCurrentAction().GetObjectClass();for(const i of e.allCorrespondingInstances(t,s))t.RemoveChild(i)}function F(){this._inst.HasParent()&&this._inst.GetParent().RemoveChild(this._inst)}function G(){return this._inst.GetChildCount()}function I(e,t){e=Math.floor(e),t=Math.floor(t);const s=this.GetWorldInfo();2>e||2>t||!isFinite(e)||!isFinite(t)?(s.ReleaseMesh(),s.SetBboxChanged()):s.CreateMesh(e,t)}function L(e,t,s,i,r,n,a,o){const h=this.GetWorldInfo();h.SetMeshPoint(e,t,{mode:0===s?"absolute":"relative",x:i,y:r,zElevation:n,u:a,v:o})&&h.SetBboxChanged()}function M(){const e=this.GetWorldInfo();return e.HasMesh()?e.GetSourceMesh().GetHSize():0}function P(){const e=this.GetWorldInfo();return e.HasMesh()?e.GetSourceMesh().GetVSize():0}function R(e){const t=this.GetWorldInfo();e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&t.SetVisible(e)}function T(e,t){this.SetElementCSSStyle(e,t)}function Y(e,t){this.SetElementAttribute(e,""+t)}function X(e){this.RemoveElementAttribute(e)}function fa(){this.FocusElement()}function ha(){this.BlurElement()}function ba(){return this.IsElementFocused()}function qa(e){this._SetEnabled(0!==e)}function ka(){return this._IsEnabled()}function ta(t,s,i){return e.compare(this.GetInstance().GetInstanceVariableValue(t),s,i)}function ua(e){return!!this.GetInstance().GetInstanceVariableValue(e)}function ra(e,t){const s=this.GetCurrentSol(),i=s.GetInstances();if(!i.length)return!1;let r=i[0],n=r,a=r.GetInstanceVariableValue(t);for(let s=1,o=i.length;s<o;++s){r=i[s];const o=r.GetInstanceVariableValue(t);(0===e&&o<a||1===e&&o>a)&&(a=o,n=r)}return s.PickOne(n),!0}function za(e){return this._runtime.GetCurrentCondition().IsInverted()?Ba(this,e):Aa(this,e)}function Aa(e,t){if(t=e.GetRuntime().GetInstanceByUID(t),!t)return!1;const s=e.GetCurrentSol();if(!s.IsSelectAll()&&!s._GetOwnInstances().includes(t))return!1;if(e.IsFamily()){if(t.GetObjectClass().BelongsToFamily(e))return s.PickOne(t),e.ApplySolToContainer(),!0}else if(t.GetObjectClass()===e)return s.PickOne(t),e.ApplySolToContainer(),!0;return!1}function Ba(t,s){const i=t.GetCurrentSol();if(i.IsSelectAll()){i._SetSelectAll(!1),i.ClearArrays();var r=t.GetInstances();for(let e=0,t=r.length;e<t;++e){var n=r[e];n.GetUID()===s?i._PushElseInstance(n):i._PushInstance(n)}return t.ApplySolToContainer(),!!i._GetOwnInstances().length}r=i._GetOwnInstances(),n=0;for(let e=0,t=r.length;e<t;++e){const t=r[e];r[n]=t,t.GetUID()===s?i._PushElseInstance(t):++n}return e.truncateArray(r,n),t.ApplySolToContainer(),!!r.length}function Ca(){this._runtime.DestroyInstance(this._inst)}function Ja(){return!0}function Pa(){return!0}function Qa(e,t){this.GetInstance().SetInstanceVariableValue(e,t)}function Da(e,t){const s=this.GetInstance(),i=s.GetInstanceVariableValue(e);"number"==typeof i&&"number"!=typeof t?t=parseFloat(t):"string"==typeof i&&"string"!=typeof t&&(t=t.toString()),s.SetInstanceVariableValue(e,i+t)}function Bb(e,t){const s=this.GetInstance(),i=s.GetInstanceVariableValue(e);"number"==typeof i&&("number"!=typeof t&&(t=parseFloat(t)),s.SetInstanceVariableValue(e,i-t))}function Cb(e,t){this.GetInstance().SetInstanceVariableValue(e,t?1:0)}function Ib(e){const t=this.GetInstance();t.SetInstanceVariableValue(e,0===t.GetInstanceVariableValue(e)?1:0)}function Jb(e){let t;try{t=JSON.parse(e)}catch(e){return void console.error("Failed to load from JSON string: ",e)}e=this.GetInstance(),e._OnBeforeLoad("state"),e.LoadFromJson(t,"state")}function Kb(){return JSON.stringify(this.GetInstance().SaveToJson("state"))}function Lb(){return this.GetInstance().GetObjectClass().GetName()}function Mb(){const e=this._runtime.GetCurrentEventStackFrame().GetExpressionObjectClass();let t=e.GetInstanceCount();for(const s of this._runtime.instancesPendingCreateForObjectClass(e))++t;return t}function Nb(){return this._runtime.GetCurrentEventStackFrame().GetExpressionObjectClass().GetCurrentSol().GetInstances().length}function Ob(){return this._inst.GetIID()}function Pb(){return this._inst.GetUID()}e.AddCommonACEs=function(e,s){const i=e[1],o=e[4],_=e[5],b=e[6],N=e[7],W=e[8],j=e[10],Q=e[11],$=e[12],ee=e[13],te=e[14],se=e[15],ie=s.Cnds,re=s.Acts,ne=s.Exps;e[3]&&(ie.CompareX=a,ie.CompareY=c,ie.IsOnScreen=d,ie.IsOutsideLayout=f,ie.PickDistance=h,re.SetX=g,re.SetY=k,re.SetPos=m,re.SetPosToObject=u,re.MoveForward=v,re.MoveAtAngle=n,ne.X=p,ne.Y=q,ne.dt=t),o&&(ie.CompareWidth=w,ie.CompareHeight=y,re.SetWidth=B,re.SetHeight=D,re.SetSize=A,ne.Width=E,ne.Height=J,ne.BBoxLeft=C,ne.BBoxTop=H,ne.BBoxRight=K,ne.BBoxBottom=O),_&&(ie.AngleWithin=S,ie.IsClockwiseFrom=U,ie.IsBetweenAngles=V,re.SetAngle=Z,re.RotateClockwise=ma,re.RotateCounterclockwise=va,re.RotateTowardAngle=Na,re.RotateTowardPosition=Ea,re.SetTowardPosition=Ia,ne.Angle=Ma),b&&(ie.IsVisible=ya,ie.CompareOpacity=Fa,re.SetVisible=na,re.SetOpacity=Va,re.SetDefaultColor=xa,ne.Opacity=bb,ne.ColorValue=Ga),N&&(ie.IsOnLayer=Xa,ie.PickTopBottom=ob,ie.CompareZElevation=pb,re.MoveToTop=cb,re.MoveToBottom=qb,re.MoveToLayer=rb,re.ZMoveToObject=sb,re.SetZElevation=tb,ne.LayerNumber=ub,ne.LayerName=vb,ne.ZIndex=wb,ne.ZElevation=db,ne.TotalZElevation=xb),W&&(re.SetEffectEnabled=yb,re.SetEffectParam=zb),ee&&(ie.HasParent=lb,ie.HasChildren=mb,ie.PickParent=nb,ie.PickChildren=$a,ie.PickNthChild=l,ie.CompareChildCount=r,re.AddChild=x,re.RemoveChild=z,re.RemoveFromParent=F,ne.ChildCount=G),te&&(re.SetMeshSize=I,re.SetMeshPoint=L,ne.MeshColumns=M,ne.MeshRows=P),j&&(ie.IsVisible=ya,re.SetVisible=R,re.SetCSSStyle=T,re.SetElemAttribute=Y,re.RemoveElemAttribute=X),Q&&(ie.IsFocused=ba,re.SetFocus=fa,re.SetBlur=ha),$&&(ie.IsEnabled=ka,re.SetEnabled=qa),se&&(ie.OnCollision=Fb,ie.IsOverlapping=Hb,ie.IsOverlappingOffset=kb,s.FinishCollisionCondition=Eb),i||(ie.CompareInstanceVar=ta,ie.IsBoolInstanceVarSet=ua,ie.PickInstVarHiLow=ra,ie.PickByUID=za,re.SetInstanceVar=Qa,re.AddInstanceVar=Da,re.SubInstanceVar=Bb,re.SetBoolInstanceVar=Cb,re.ToggleBoolInstanceVar=Ib,ie.OnCreated=Ja,ie.OnDestroyed=Pa,re.Destroy=Ca,re.LoadFromJsonString||(re.LoadFromJsonString=Jb),ne.AsJSON||(ne.AsJSON=Kb),ne.Count=Mb,ne.PickedCount=Nb,ne.IID=Ob,ne.UID=Pb,ne.ObjectTypeName=Lb)}}{const e=self.C3;e.ScheduledWait=class extends e.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._type="",this._time=-1,this._signalTag="",this._isSignalled=!1,this._event=null,this._actIndex=0,this._solModifiers=[],this._sols=new Map,this._callingFunctionBlock=null,this._asyncId=-1,this._functionInnerLocalVars=this._functionParameters=null,this._shouldRelease=!1}Release(){this._type="",this._time=-1,this._signalTag="",this._functionInnerLocalVars=this._functionParameters=this._callingFunctionBlock=this._event=null,this._asyncId=-1,e.clearArray(this._solModifiers);for(const e of this._sols.values())e.Release();this._sols.clear()}_Init(){var t=this._eventSheetManager,s=t.GetRuntime().GetAllObjectClasses();const i=t.GetCurrentEventStackFrame();this._event=i.GetCurrentEvent(),this._actIndex=i.GetActionIndex()+1,(t=t.FindFirstFunctionBlockParent(this._event))&&(this._callingFunctionBlock=t,this._functionParameters=t.CaptureFunctionParameters(),this._functionInnerLocalVars=t._GetAllInnerLocalVariables().map(e=>e.GetValue()),t.IsAsync()&&(this._asyncId=t.PauseCurrentAsyncFunction()));for(const t of s)s=t.GetCurrentSol(),(!s.IsSelectAll()||this._event.HasSolModifier(t))&&(this._solModifiers.push(t),this._sols.set(t,e.New(e.SolState,s)))}InitTimer(e){this._type="timer",this._Init(),this._time=this._eventSheetManager.GetRuntime().GetGameTime()+e}InitSignal(e){this._type="signal",this._Init(),this._signalTag=e.toLowerCase()}InitPromise(e){this._type="promise",this._Init(),e.then(()=>this.SetSignalled()).catch(e=>{console.warn("[C3 runtime] Promise rejected in 'Wait for previous actions to complete': ",e),this.SetSignalled()})}IsTimer(){return"timer"===this._type}IsSignal(){return"signal"===this._type}IsPromise(){return"promise"===this._type}GetSignalTag(){return this._signalTag}IsSignalled(){return this._isSignalled}SetSignalled(){this._isSignalled=!0}_ShouldRun(){return this.IsTimer()?this._time<=this._eventSheetManager.GetRuntime().GetGameTime():this.IsSignalled()}_RestoreState(e){e._Restore(this._event,this._actIndex);for(const[t,s]of this._sols.entries())e=t.GetCurrentSol(),s._Restore(e);(e=this._callingFunctionBlock)&&(e.SetFunctionParameters(this._functionParameters),e._GetAllInnerLocalVariables().map((e,t)=>e.SetValue(this._functionInnerLocalVars[t])),e.IsAsync()&&e.ResumeAsyncFunction(this._asyncId))}_Run(e){this._RestoreState(e),this._event._ResumeActionsAndSubEvents(e),this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}async _DebugRun(e){this._RestoreState(e);for(const t of this._event._DebugResumeActionsAndSubEvents(e))await this._eventSheetManager.GetRuntime().DebugBreak(t);this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}ShouldRelease(){return this._shouldRelease}RemoveInstances(e){for(const t of this._sols.values())t.RemoveInstances(e)}_SaveToJson(){const e={},t={t:this._time,st:this._signalTag,s:this._isSignalled,ev:this._event.GetSID(),sm:this._solModifiers.map(e=>e.GetSID()),sols:e};this._event._HasActionIndex(this._actIndex)&&(t.act=this._event.GetActionAt(this._actIndex).GetSID());for(const[t,s]of this._sols)e[t.GetSID().toString()]=s._SaveToJson();return t}static _CreateFromJson(t,s){const i=t.GetRuntime();var r=t.GetEventBlockBySID(s.ev);if(!r)return null;let n=0;if(s.hasOwnProperty("act")){var a=t.GetActionBySID(s.act);if(!a)return null;n=a.GetIndex()}for(var o of(a=e.New(e.ScheduledWait,t),a._time=s.t,a._type=-1===a._time?"signal":"timer",a._signalTag=s.st,a._isSignalled=s.s,a._event=r,a._actIndex=n,s.sm))(r=i.GetObjectClassBySID(o))&&a._solModifiers.push(r);for(const[r,n]of Object.entries(s.sols))s=parseInt(r,10),(s=i.GetObjectClassBySID(s))&&(o=e.New(e.SolState,null),o._LoadFromJson(t,n),a._sols.set(s,o));return a}}}{const e=self.C3;e.SolState=class extends e.DefendedBase{constructor(t){super(),this._objectClass=null,this._isSelectAll=!0,this._instances=[],t&&(this._objectClass=t.GetObjectClass(),this._isSelectAll=t.IsSelectAll(),e.shallowAssignArray(this._instances,t._GetOwnInstances()))}Release(){this._objectClass=null,e.clearArray(this._instances)}_Restore(t){t._SetSelectAll(this._isSelectAll),e.shallowAssignArray(t._GetOwnInstances(),this._instances)}RemoveInstances(t){e.arrayRemoveAllInSet(this._instances,t)}_SaveToJson(){return{sa:this._isSelectAll,insts:this._instances.map(e=>e.GetUID())}}_LoadFromJson(t,s){t=t.GetRuntime(),this._isSelectAll=!!s.sa,e.clearArray(this._instances);for(const e of s.insts)(s=t.GetInstanceByUID(e))&&this._instances.push(s)}}}{const e=self.C3;function b(e,t){let s=e.get(t);return s||(s=new Map,e.set(t,s)),s}e.SDKPluginBase=class extends e.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._isSingleGlobal=!!e.isSingleGlobal,this._isWorldType=!!e.isWorld,this._isRotatable=!!e.isRotatable,this._mustPredraw=!!e.mustPredraw,this._hasEffects=!!e.hasEffects,this._supportsSceneGraph=!!e.supportsSceneGraph,this._supportsMesh=!!e.supportsMesh,this._singleGlobalObjectClass=null,this._boundACEMethodCache=new Map,this._boundACEMethodCache_1param=new Map,this._boundACEMethodCache_2params=new Map,this._boundACEMethodCache_3params=new Map}Release(){this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}IsSingleGlobal(){return this._isSingleGlobal}IsWorldType(){return this._isWorldType}IsRotatable(){return this._isRotatable}MustPreDraw(){return this._mustPredraw}HasEffects(){return this._hasEffects}SupportsSceneGraph(){return this._supportsSceneGraph}SupportsMesh(){return this._supportsMesh}_GetBoundACEMethod(e,t){if(!t)throw Error("missing 'this' binding");let s=this._boundACEMethodCache.get(e);return s||(s=e.bind(t),this._boundACEMethodCache.set(e,s),s)}_GetBoundACEMethod_1param(e,t,s){if(!t)throw Error("missing 'this' binding");const i=b(this._boundACEMethodCache_1param,e);let r=i.get(s);return r||(r=e.bind(t,s),i.set(s,r),r)}_GetBoundACEMethod_2params(e,t,s,i){if(!t)throw Error("missing 'this' binding");var r=b(this._boundACEMethodCache_2params,e);r=b(r,s);let n=r.get(i);return n||(n=e.bind(t,s,i),r.set(i,n),n)}_GetBoundACEMethod_3params(e,t,s,i,r){if(!t)throw Error("missing 'this' binding");var n=b(this._boundACEMethodCache_3params,e);n=b(n,s),n=b(n,i);let a=n.get(r);return a||(a=e.bind(t,s,i,r),n.set(r,a),a)}_SetSingleGlobalObjectClass(e){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");this._singleGlobalObjectClass=e}GetSingleGlobalObjectClass(){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");return this._singleGlobalObjectClass}GetSingleGlobalInstance(){if(!this.IsSingleGlobal())throw Error("must be single-global plugin");return this._singleGlobalObjectClass.GetSingleGlobalInstance()}}}{const e=self.C3;e.SDKDOMPluginBase=class extends e.SDKPluginBase{constructor(e,t){super(e),this._domComponentId=t,this._nextElementId=0,this._instMap=new Map,this.AddElementMessageHandler("elem-focused",e=>e._OnElemFocused()),this.AddElementMessageHandler("elem-blurred",e=>{e&&e._OnElemBlurred()})}Release(){super.Release()}_AddElement(e){const t=this._nextElementId++;return this._instMap.set(t,e),t}_RemoveElement(e){this._instMap.delete(e)}AddElementMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,e=>{const s=this._instMap.get(e.elementId);t(s,e)})}}}{const e=self.C3;e.SDKTypeBase=class extends e.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}Release(){this._plugin=this._runtime=this._objectClass=null}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetImageInfo(){return this._objectClass.GetImageInfo()}FinishCondition(e){}LoadTextures(e){}ReleaseTextures(){}OnDynamicTextureLoadComplete(){}PreloadTexturesWithInstances(e){}LoadTilemapData(){}GetScriptInterfaceClass(){return null}}}{const e=self.C3;e.SDKInstanceBase=class extends e.DefendedBase{constructor(e,t){super(),this._inst=e,this._domComponentId=t,this._runtime=e.GetRuntime(),this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._tick2Func=this._tickFunc=null,this._isTicking2=this._isTicking=!1,this._disposables=null,this._wasReleased=!1}Release(){this._wasReleased=!0,this._StopTicking(),this._StopTicking2(),this._tick2Func=this._tickFunc=null,this._disposables&&(this._disposables.Release(),this._disposables=null),this._sdkType=this._objectClass=this._runtime=this._inst=null}WasReleased(){return this._wasReleased}GetInstance(){return this._inst}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetPlugin(){return this._sdkType.GetPlugin()}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._inst.GetInterfaceClass()}Trigger(e){return this._runtime.Trigger(e,this._inst,null)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,null)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,null)}FastTrigger(e,t){return this._runtime.FastTrigger(e,this._inst,t)}DebugFastTrigger(e,t){return this._runtime.DebugFastTrigger(e,this._inst,t)}ScheduleTriggers(e){return this._runtime.ScheduleTriggers(e)}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}AddDOMMessageHandlers(e){for(const[t,s]of e)this.AddDOMMessageHandler(t,s)}PostToDOM(e,t){this._runtime.PostComponentMessageToDOM(this._domComponentId,e,t)}PostToDOMAsync(e,t){return this._runtime.PostComponentMessageToDOMAsync(this._domComponentId,e,t)}_PostToDOMMaybeSync(e,t){if(!this._runtime.IsInWorker())return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this._domComponentId,handler:e,data:t,responseId:null});this.PostToDOM(e,t)}Tick(){}Tick2(){}_StartTicking(){this._isTicking||(this._tickFunc||(this._tickFunc=(()=>this.Tick())),this._runtime.Dispatcher().addEventListener("tick",this._tickFunc),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime.Dispatcher().removeEventListener("tick",this._tickFunc),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._tick2Func||(this._tick2Func=(()=>this.Tick2())),this._runtime.Dispatcher().addEventListener("tick2",this._tick2Func),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime.Dispatcher().removeEventListener("tick2",this._tick2Func),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}GetDebuggerProperties(){return[]}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t){if(0!==t){var s=this.GetPropertyValueByIndex(e);if("number"!=typeof s)throw Error("expected number");this.SetPropertyValueByIndex(e,s+t)}}SetPropertyColorOffsetValueByIndex(e,t,s,i){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(t,s,i){const r=this.GetScriptInterface();t=e.New(e.Event,t,s),t.instance=r,i&&Object.assign(t,i),r.dispatchEvent(t)}}}{const e=self.C3;e.SDKWorldInstanceBase=class extends e.SDKInstanceBase{constructor(e,t){super(e,t),this._worldInfo=e.GetWorldInfo(),this._webglcontextrestored_handler=this._webglcontextlost_handler=null}Release(){if(this._webglcontextlost_handler){const e=this._runtime.Dispatcher();e.removeEventListener("webglcontextlost",this._webglcontextlost_handler),e.removeEventListener("webglcontextrestored",this._webglcontextrestored_handler),this._webglcontextrestored_handler=this._webglcontextlost_handler=null}this._worldInfo=null,super.Release()}HandleWebGLContextLoss(){if(!this._webglcontextlost_handler){this._webglcontextlost_handler=(()=>this.OnWebGLContextLost()),this._webglcontextrestored_handler=(()=>this.OnWebGLContextRestored());var e=this._runtime.Dispatcher();e.addEventListener("webglcontextlost",this._webglcontextlost_handler),e.addEventListener("webglcontextrestored",this._webglcontextrestored_handler)}}OnWebGLContextLost(){}OnWebGLContextRestored(){}GetWorldInfo(){return this._worldInfo}IsOriginalSizeKnown(){return!1}GetOriginalWidth(){if(!this.IsOriginalSizeKnown())throw Error("original size not known");const e=this.GetCurrentImageInfo();if(e)return e.GetWidth()}GetOriginalHeight(){if(!this.IsOriginalSizeKnown())throw Error("original size not known");const e=this.GetCurrentImageInfo();if(e)return e.GetHeight()}GetCurrentImageInfo(){return null}GetCurrentSurfaceSize(){var e=this.GetCurrentImageInfo();return e&&(e=e.GetTexture())?[e.GetWidth(),e.GetHeight()]:[100,100]}GetCurrentTexRect(){const e=this.GetCurrentImageInfo();return e?e.GetTexRect():null}GetCurrentTexQuad(){const e=this.GetCurrentImageInfo();return e?e.GetTexQuad():null}IsCurrentTexRotated(){const e=this.GetCurrentImageInfo();return!!e&&e.IsRotated()}GetImagePoint(e){return e=this._inst.GetWorldInfo(),[e.GetX(),e.GetY()]}LoadTilemapData(e,t,s){}TestPointOverlapTile(e,t){}RendersToOwnZPlane(){return!0}}}{const e=self.C3,t=e.New(e.Rect);e.SDKDOMInstanceBase=class extends e.SDKWorldInstanceBase{constructor(t,s){super(t,s),this._elementId=this.GetPlugin()._AddElement(this),this._isElementShowing=!0,this._autoFontSize=this._elemHasFocus=!1,this._lastRect=e.New(e.Rect,0,0,-1,-1),t=this._runtime.GetCanvasManager(),this._lastWindowWidth=t.GetLastWidth(),this._lastWindowHeight=t.GetLastHeight(),this._isPendingUpdateState=!1,this._StartTicking()}Release(){this.GetPlugin()._RemoveElement(this._elementId),this.PostToDOMElement("destroy"),this._elementId=-1,super.Release()}_GetElementInDOMMode(){if(this._runtime.IsInWorker())throw Error("not valid in worker mode");return this._PostToDOMElementMaybeSync("get-element")}PostToDOMElement(e,t){t||(t={}),t.elementId=this._elementId,this.PostToDOM(e,t)}_PostToDOMElementMaybeSync(e,t){return t||(t={}),t.elementId=this._elementId,this._PostToDOMMaybeSync(e,t)}PostToDOMElementAsync(e,t){return t||(t={}),t.elementId=this._elementId,this.PostToDOMAsync(e,t)}CreateElement(e){e||(e={});const t=this.GetWorldInfo().IsVisible();e.elementId=this._elementId,e.isVisible=t,Object.assign(e,this.GetElementState()),this._isElementShowing=!!e.isVisible,this._PostToDOMMaybeSync("create",e),this._UpdatePosition(!0)}SetElementVisible(e){e=!!e,this._isElementShowing!==e&&(this._isElementShowing=e,this.PostToDOMElement("set-visible",{isVisible:e}))}Tick(){this._UpdatePosition(!1)}_ShouldPreserveElement(){const t=this._runtime.GetCanvasManager().GetFullscreenMode();return"Android"===e.Platform.OS&&("scale-inner"===t||"scale-outer"===t||"crop"===t)}_UpdatePosition(e){var s=this.GetWorldInfo();const i=s.GetLayer();var r=s.GetX(),n=s.GetY();let[a,o]=i.LayerToCanvasCss(r,n),[h,l]=i.LayerToCanvasCss(r+s.GetWidth(),n+s.GetHeight());r=this._runtime.GetCanvasManager(),n=r.GetCssWidth();const c=r.GetCssHeight();if(s.IsVisible()&&i.IsVisible()){if(!this._ShouldPreserveElement()){if(0>=h||0>=l||a>=n||o>=c)return void this.SetElementVisible(!1);1>a&&(a=1),1>o&&(o=1),h>=n&&(h=n-1),l>=c&&(l=c-1)}t.set(a,o,h,l),s=r.GetLastWidth(),n=r.GetLastHeight(),!e&&t.equals(this._lastRect)&&this._lastWindowWidth===s&&this._lastWindowHeight===n?this.SetElementVisible(!0):(this._lastRect.copy(t),this._lastWindowWidth=s,this._lastWindowHeight=n,this.SetElementVisible(!0),e=null,this._autoFontSize&&(e=i.GetDisplayScale()-.2),this.PostToDOMElement("update-position",{left:Math.round(this._lastRect.getLeft())+r.GetCanvasClientX(),top:Math.round(this._lastRect.getTop())+r.GetCanvasClientY(),width:Math.round(this._lastRect.width()),height:Math.round(this._lastRect.height()),fontSize:e}))}else this.SetElementVisible(!1)}FocusElement(){this._PostToDOMElementMaybeSync("focus",{focus:!0})}BlurElement(){this._PostToDOMElementMaybeSync("focus",{focus:!1})}_OnElemFocused(){this._elemHasFocus=!0}_OnElemBlurred(){this._elemHasFocus=!1}IsElementFocused(){return this._elemHasFocus}SetElementCSSStyle(t,s){this.PostToDOMElement("set-css-style",{prop:e.CSSToCamelCase(t),val:s})}SetElementAttribute(e,t){this.PostToDOMElement("set-attribute",{name:e,val:t})}RemoveElementAttribute(e){this.PostToDOMElement("remove-attribute",{name:e})}UpdateElementState(){this._isPendingUpdateState||(this._isPendingUpdateState=!0,Promise.resolve().then(()=>{this._isPendingUpdateState=!1,this.PostToDOMElement("update-state",this.GetElementState())}))}GetElementState(){}GetElementId(){return this._elementId}}}{const e=self.C3,t=self.IBehavior;e.SDKBehaviorBase=class extends e.DefendedBase{constructor(t){super(),this._runtime=t.runtime,this._myObjectClasses=e.New(e.ArraySet),this._myInstances=e.New(e.ArraySet),this._iBehavior=null,this._scriptInterfaceClass=t.scriptInterfaceClass||null}Release(){this._myInstances.Release(),this._myObjectClasses.Release(),this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}_AddObjectClass(e){this._myObjectClasses.Add(e)}GetObjectClasses(){return this._myObjectClasses.GetArray()}_AddInstance(e){this._myInstances.Add(e)}_RemoveInstance(e){this._myInstances.Delete(e)}GetInstances(){return this._myInstances.GetArray()}GetIBehavior(){if(null===this._iBehavior){const e=this._scriptInterfaceClass;if(e){
if(this._iBehavior=new e(this),!(this._iBehavior instanceof t))throw new TypeError("script interface class must derive from IBehavior")}else this._iBehavior=new t(this)}return this._iBehavior}}}{const e=self.C3;e.SDKBehaviorTypeBase=class extends e.DefendedBase{constructor(e){super(),this._runtime=e.GetRuntime(),this._behaviorType=e,this._objectClass=e.GetObjectClass(),this._behavior=e.GetBehavior(),this._behavior._AddObjectClass(this._objectClass)}Release(){this._behavior=this._objectClass=this._behaviorType=this._runtime=null}GetBehaviorType(){return this._behaviorType}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetBehavior(){return this._behavior}}}{const e=self.C3;e.SDKBehaviorInstanceBase=class extends e.DefendedBase{constructor(e,t){super(),this._behInst=e,this._domComponentId=t,this._inst=e.GetObjectInstance(),this._runtime=e.GetRuntime(),this._behaviorType=e.GetBehaviorType(),this._sdkType=this._behaviorType.GetSdkType(),this._isPostTicking=this._isTicking2=this._isTicking=!1,this._disposables=null}Release(){this._StopTicking(),this._StopTicking2(),this._StopPostTicking(),this._disposables&&(this._disposables.Release(),this._disposables=null),this._sdkType=this._behaviorType=this._runtime=this._inst=this._behInst=null}GetBehavior(){return this._behaviorType.GetBehavior()}GetBehaviorInstance(){return this._behInst}GetObjectInstance(){return this._inst}GetObjectClass(){return this._inst.GetObjectClass()}GetWorldInfo(){return this._inst.GetWorldInfo()}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._behInst.GetScriptInterface()}Trigger(e){return this._runtime.Trigger(e,this._inst,this._behaviorType)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,this._behaviorType)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,this._behaviorType)}PostCreate(){}Tick(){}Tick2(){}PostTick(){}_StartTicking(){this._isTicking||(this._runtime._AddBehInstToTick(this),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime._RemoveBehInstToTick(this),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._runtime._AddBehInstToTick2(this),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime._RemoveBehInstToTick2(this),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}_StartPostTicking(){this._isPostTicking||(this._runtime._AddBehInstToPostTick(this),this._isPostTicking=!0)}_StopPostTicking(){this._isPostTicking&&(this._runtime._RemoveBehInstToPostTick(this),this._isPostTicking=!1)}IsPostTicking(){return this._isPostTicking}GetDebuggerProperties(){return[]}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}OnSpriteFrameChanged(e,t){}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t){if(0!==t){var s=this.GetPropertyValueByIndex(e);if("number"!=typeof s)throw Error("expected number");this.SetPropertyValueByIndex(e,s+t)}}SetPropertyColorOffsetValueByIndex(e,t,s,i){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(t,s,i){const r=this.GetScriptInterface();t=e.New(e.Event,t,s),t.behaviorInstance=r,t.instance=r.instance,i&&Object.assign(t,i),r.dispatchEvent(t)}}}{const e=self.C3;e.Plugins={},e.Behaviors={},e.PluginManager=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._allPlugins=[],this._pluginsByCtor=new Map,this._systemPlugin=null,this._allBehaviors=[],this._behaviorsByCtor=new Map,this._jumpthruBehavior=this._solidBehavior=null}CreatePlugin(t){const s=this._runtime.GetObjectReference(t[0]);if(!s)throw Error("missing plugin");e.AddCommonACEs(t,s),t=e.New(s,{runtime:this._runtime,isSingleGlobal:t[1],isWorld:t[2],isRotatable:t[5],hasEffects:t[8],mustPredraw:t[9],supportsSceneGraph:t[13],supportsMesh:t[14]}),t.OnCreate(),this._allPlugins.push(t),this._pluginsByCtor.set(s,t)}CreateSystemPlugin(){this._systemPlugin=e.New(e.Plugins.System,{runtime:this._runtime,isSingleGlobal:!0}),this._systemPlugin.OnCreate()}CreateBehavior(t){if(t=this._runtime.GetObjectReference(t[1]),!t)throw Error("missing behavior");const s=e.New(t,{runtime:this._runtime});s.OnCreate(),this._allBehaviors.push(s),this._behaviorsByCtor.set(t,s),!this._solidBehavior&&e.Behaviors.solid&&s instanceof e.Behaviors.solid?this._solidBehavior=s:!this._jumpthruBehavior&&e.Behaviors.jumpthru&&s instanceof e.Behaviors.jumpthru&&(this._jumpthruBehavior=s)}GetPluginByConstructorFunction(e){return this._pluginsByCtor.get(e)||null}HasBehaviorByConstructorFunction(e){return this._behaviorsByCtor.has(e)}GetBehaviorByConstructorFunction(e){return this._behaviorsByCtor.get(e)||null}GetSystemPlugin(){return this._systemPlugin}GetSolidBehavior(){return this._solidBehavior}GetJumpthruBehavior(){return this._jumpthruBehavior}}}{const e=self.C3,t=new Set;e.ImageInfo=class extends e.DefendedBase{constructor(){super(),this._url="",this._height=this._width=this._offsetY=this._offsetX=this._size=0,this._hasMetaData=this._isRotated=!1,this._imageAsset=null,this._textureState="",this._rcTex=e.New(e.Rect),this._quadTex=e.New(e.Quad),t.add(this)}Release(){this.ReleaseTexture(),this._imageAsset=null,t.delete(this)}static OnWebGLContextLost(){for(const e of t)e._textureState="",e._rcTex.set(0,0,0,0),e._quadTex.setFromRect(e._rcTex)}LoadData(e){this._url=e[0],this._size=e[1],this._offsetX=e[2],this._offsetY=e[3],this._width=e[4],this._height=e[5],this._isRotated=e[6],this._hasMetaData=!0}LoadDynamicAsset(t,s){if(this._imageAsset)throw Error("already loaded asset");this._url=s;const i={};return e.IsAbsoluteURL(s)&&(i.loadPolicy="remote"),this.LoadAsset(t,i),this._imageAsset.Load()}ReplaceWith(e){if(e===this)throw Error("cannot replace with self");this.ReleaseTexture(),this._url=e._url,this._size=e._size,this._offsetX=e._offsetX,this._offsetY=e._offsetY,this._width=e._width,this._height=e._height,this._isRotated=e._isRotated,this._hasMetaData=e._hasMetaData,this._imageAsset=e._imageAsset,this._textureState=e._textureState,this._rcTex=e._rcTex,this._quadTex=e._quadTex}GetURL(){return this._url}GetSize(){return this._size}GetOffsetX(){return this._offsetX}GetOffsetY(){return this._offsetY}IsRotated(){return this._isRotated}GetWidth(){return this._width}GetHeight(){return this._height}GetSheetWidth(){return this._imageAsset.GetWidth()}GetSheetHeight(){return this._imageAsset.GetHeight()}LoadAsset(e,t){if(this._imageAsset)throw Error("already got asset");t=Object.assign({},t,{url:this.GetURL(),size:this.GetSize()}),this._imageAsset=e.LoadImage(t)}IsLoaded(){return this._imageAsset&&this._imageAsset.IsLoaded()}async LoadStaticTexture(e,t){if(!this._imageAsset)throw Error("no asset");if(this._textureState)throw Error("already loaded texture");return this._textureState="loading",e=await this._imageAsset.LoadStaticTexture(e,t),e?(this._textureState="loaded",this._hasMetaData||(this._width=e.GetWidth(),this._height=e.GetHeight(),this._hasMetaData=!0),this._rcTex.set(this._offsetX,this._offsetY,this._offsetX+(this._isRotated?this._height:this._width),this._offsetY+(this._isRotated?this._width:this._height)),this._rcTex.divide(e.GetWidth(),e.GetHeight()),this._quadTex.setFromRect(this._rcTex),this._isRotated&&this._quadTex.rotatePointsAnticlockwise(),e):(this._textureState="",null)}ReleaseTexture(){this._textureState&&(this._imageAsset&&this._imageAsset.ReleaseTexture(),this._textureState="",this._rcTex.set(0,0,0,0),this._quadTex.setFromRect(this._rcTex))}GetTexture(){return this._imageAsset?this._imageAsset.GetTexture():null}GetTexRect(){return this._rcTex}GetTexQuad(){return this._quadTex}async ExtractImageToCanvas(){const t=await this._imageAsset.LoadToDrawable(),s=e.CreateCanvas(this._width,this._height);return s.getContext("2d").drawImage(t,this._offsetX,this._offsetY,this._width,this._height,0,0,this._width,this._height),s}}}{const e=self.C3;e.AnimationInfo=class extends e.DefendedBase{constructor(t){super(),this._name=t[0],this._speed=t[1],this._isLooping=!!t[2],this._repeatCount=t[3],this._repeatTo=t[4],this._isPingPong=!!t[5],this._sid=t[6],this._frames=t[7].map(t=>e.New(e.AnimationFrameInfo,t))}Release(){for(const e of this._frames)e.Release();e.clearArray(this._frames)}LoadAllAssets(e){for(const t of this._frames)t.GetImageInfo().LoadAsset(e)}LoadAllTextures(e,t){return Promise.all(this._frames.map(s=>s.GetImageInfo().LoadStaticTexture(e,t)))}ReleaseAllTextures(){for(const e of this._frames)e.GetImageInfo().ReleaseTexture()}GetName(){return this._name}GetSID(){return this._sid}GetFrameCount(){return this._frames.length}GetFrames(){return this._frames}GetFrameAt(e){if(e=Math.floor(e),0>e||e>=this._frames.length)throw new RangeError("invalid frame");return this._frames[e]}GetSpeed(){return this._speed}IsLooping(){return this._isLooping}GetRepeatCount(){return this._repeatCount}GetRepeatTo(){return this._repeatTo}IsPingPong(){return this._isPingPong}}}{const e=self.C3;e.AnimationFrameInfo=class extends e.DefendedBase{constructor(t){super(),this._imageInfo=e.New(e.ImageInfo),this._imageInfo.LoadData(t),this._duration=t[7],this._origin=e.New(e.Vector2,t[8],t[9]),this._imagePoints=t[10].map(t=>e.New(e.ImagePoint,this,t)),this._imagePointsByName=new Map;for(const e of this._imagePoints)this._imagePointsByName.set(e.GetName().toLowerCase(),e);this._collisionPoly=null,t=t[11],6<=t.length&&(this._collisionPoly=e.New(e.CollisionPoly,t))}Release(){this._collisionPoly&&(this._collisionPoly.Release(),this._collisionPoly=null),this._imageInfo.Release(),this._imageInfo=null}GetImageInfo(){return this._imageInfo}GetDuration(){return this._duration}GetOriginX(){return this._origin.getX()}GetOriginY(){return this._origin.getY()}GetCollisionPoly(){return this._collisionPoly}GetImagePointByName(e){return this._imagePointsByName.get(e.toLowerCase())||null}GetImagePointByIndex(e){return e=Math.floor(e),0>e||e>=this._imagePoints.length?null:this._imagePoints[e]}GetImagePointCount(){return this._imagePoints.length}}}{const e=self.C3;e.ImagePoint=class extends e.DefendedBase{constructor(t,s){super(),this._afi=t,this._name=s[0],this._pos=e.New(e.Vector2,s[1],s[2])}Release(){}GetName(){return this._name}GetX(){return this._pos.getX()}GetY(){return this._pos.getY()}GetVec2(){return this._pos}}}{const e=self.C3,t=self.C3Debugger,s=self.IObjectClass;e.ObjectClass=class extends e.DefendedBase{constructor(t,i,r){super();const n=t.GetObjectReference(r[1]);if(this._runtime=t,this._plugin=t.GetPluginManager().GetPluginByConstructorFunction(n),this._sdkType=null,this._instSdkCtor=n.Instance,this._index=i,this._sid=r[11],this._name=r[0],this._jsPropName=this._runtime.GetJsPropName(r[14]),this._isGlobal=!!r[9],this._isFamily=!!r[2],this._isOnLoaderLayout=!!r[10],this._instVars=r[3].map(e=>({sid:e[0],type:e[1],name:e[2],jsPropName:t.GetJsPropName(e[3])})),this._behaviorsCount=r[4],this._effectsCount=r[5],this._isWorldType=this._plugin.IsWorldType(),this._effectList=null,this._collisionGrid=e.New(e.SparseGrid,t.GetOriginalViewportWidth(),t.GetOriginalViewportHeight()),this._anyCollisionCellChanged=!0,this._anyInstanceParallaxed=!1,this._familyMembersSet=this._familyMembers=null,this._familyIndex=-1,this._familyEffectMap=this._familyBehaviorMap=this._familyInstVarMap=this._familiesSet=this._families=null,this._isInContainer=!1,this._container=null,this._behaviorTypes=r[8].map(t=>e.BehaviorType.Create(this,t)),this._behaviorTypesIncludingInherited=[],this._behaviorsByName=new Map,this._behaviorNameToIndex=new Map,this._usedBehaviorCtors=new Set,this._solStack=e.New(e.SolStack,this),this._defaultInstanceData=null,this._defaultLayerIndex=0,this._isContained=!1,this._animationsBySid=this._animationsByName=this._animations=this._imageInfo=this._container=null,this._textureRefCount=0,this._savedData=new Map,this._unsavedData=new Map,this._instances=[],this._iidsStale=!0,this._plugin.HasEffects()&&(this._effectList=e.New(e.EffectList,this,r[12])),r[6]&&(this._imageInfo=e.New(e.ImageInfo),this._imageInfo.LoadData(r[6])),r[7]){this._animations=r[7].map(t=>e.New(e.AnimationInfo,t)),this._animationsByName=new Map,this._animationsBySid=new Map;for(const e of this._animations)this._animationsByName.set(e.GetName().toLowerCase(),e),this._animationsBySid.set(e.GetSID(),e)}if(this._isFamily?(this._familyMembers=[],this._familyMembersSet=new Set,this._familyIndex=this._runtime._GetNextFamilyIndex()):(this._families=[],this._familiesSet=new Set,this._familyInstVarMap=[],this._familyBehaviorMap=[],this._familyEffectMap=[]),this._sdkType=e.New(n.Type,this,r[15]),this._instanceUserScriptClass=this._iObjectClass=null,this._userScriptDispatcher=e.New(e.Event.Dispatcher),i=this._sdkType.GetScriptInterfaceClass()){if(this._iObjectClass=new i(this),!(this._iObjectClass instanceof s))throw new TypeError("script interface class must derive from IObjectClass")}else this._iObjectClass=new s(this);r[13]&&(i=r[13])&&this._sdkType.LoadTilemapData(i[0],i[1],i[2]),this._runtime.UsesLoaderLayout()&&!this._isFamily&&!this._isOnLoaderLayout&&this._isWorldType||this.OnCreate(),this._plugin.IsSingleGlobal()&&(this._plugin._SetSingleGlobalObjectClass(this),this._CreateSingleGlobalInstance(r))}static Create(t,s,i){return e.New(e.ObjectClass,t,s,i)}Release(){if(this._imageInfo&&(this._imageInfo.Release(),this._imageInfo=null),this._animations){for(const e of this._animations)e.Release();e.clearArray(this._animations),this._animationsByName.clear(),this._animationsBySid.clear()}this._solStack.Release(),this._solStack=null,this._savedData.clear(),this._unsavedData.clear(),this._runtime=this._container=null}_LoadFamily(e){for(let t=1,s=e.length;t<s;++t){const s=this._runtime.GetObjectClassByIndex(e[t]);this._familyMembers.push(s),this._familyMembersSet.add(s),s._families.push(this),s._familiesSet.add(this)}}_SetContainer(e){this._isInContainer=!0,this._container=e}IsInContainer(){return this._isInContainer}GetContainer(){return this._container}_OnAfterCreate(){var t=0;if(!this._isFamily)for(var s of this._families)for(var i of s.GetBehaviorTypes()){const e=i.GetName().toLowerCase();this._behaviorsByName.set(e,i),this._behaviorNameToIndex.set(e,t),this._behaviorTypesIncludingInherited.push(i),++t}for(var r of this.GetBehaviorTypes())s=r.GetName().toLowerCase(),this._behaviorsByName.set(s,r),this._behaviorNameToIndex.set(s,t),this._behaviorTypesIncludingInherited.push(r),++t;for(var n of this._behaviorTypesIncludingInherited)this._usedBehaviorCtors.add(n.GetBehavior().constructor);if(!this._isFamily&&this._families.length){t=this._runtime.GetFamilyCount(),e.extendArray(this._familyInstVarMap,t,0),e.extendArray(this._familyBehaviorMap,t,0),e.extendArray(this._familyEffectMap,t,0),t=[],s=n=r=0;for(const e of this._families)if(i=e.GetFamilyIndex(),this._familyInstVarMap[i]=r,r+=e.GetInstanceVariablesCount(),this._familyBehaviorMap[i]=n,n+=e.GetBehaviorTypesCount(),this._familyEffectMap[i]=s,s+=e.GetEffectTypesCount(),(i=e.GetEffectList())&&this._effectList)for(const e of i.GetAllEffectTypes())t.push(e.Clone(this._effectList));this._effectList&&this._effectList.PrependEffectTypes(t)}}_CreateSingleGlobalInstance(t){const s=this._runtime._GetNewUID(),i=e.New(e.Instance,{runtime:this._runtime,objectType:this,uid:s});i._CreateSdkInstance(t[16],[]),this._runtime._MapInstanceByUID(s,i),this._instances.push(i)}GetSdkType(){return this._sdkType}IsOnLoaderLayout(){return this._isOnLoaderLayout}OnCreate(){this._isFamily||this._sdkType.OnCreate()}HasLoadedTextures(){return 0<this._textureRefCount}LoadTextures(e){return this._isFamily?Promise.resolve():(this._textureRefCount++,1===this._textureRefCount&&this._sdkType.LoadTextures(e)||Promise.resolve())}ReleaseTextures(){if(!this._isFamily){if(this._textureRefCount--,0>this._textureRefCount)throw Error("released textures too many times");0===this._textureRefCount&&this._sdkType.ReleaseTextures()}}OnDynamicTextureLoadComplete(){if(this._isFamily)throw Error("not applicable to family");this._sdkType.OnDynamicTextureLoadComplete()}PreloadTexturesWithInstances(e){return this._isFamily?Promise.resolve():this._sdkType.PreloadTexturesWithInstances(e)}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetIndex(){return this._index}GetSID(){return this._sid}IsFamily(){return this._isFamily}IsGlobal(){return this._isGlobal}IsWorldType(){return this._isWorldType}GetFamilyIndex(){return this._familyIndex}GetBehaviorTypes(){return this._behaviorTypes}GetBehaviorTypesCount(){return this._behaviorsCount}UsesBehaviorByCtor(e){return e&&this._usedBehaviorCtors.has(e)}GetInstanceVariablesCount(){return this._instVars.length}GetInstanceVariableSIDs(){return this._instVars.map(e=>e.sid)}GetInstanceVariableIndexBySID(e){return this._instVars.findIndex(t=>t.sid===e)}GetInstanceVariableIndexByName(e){return this._instVars.findIndex(t=>t.name===e)}_GetAllInstanceVariableNames(){return this._instVars.map(e=>e.name)}_GetAllInstanceVariableJsPropNames(){return this._instVars.map(e=>e.jsPropName)}GetInstanceVariableType(e){if(e=Math.floor(e),0>e||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].type}GetInstanceVariableName(e){if(e=Math.floor(e),0>e||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].name}GetEffectTypesCount(){return this._effectsCount}GetBehaviorTypesIncludingInherited(){return this._behaviorTypesIncludingInherited}GetBehaviorTypeByName(e){return this._behaviorsByName.get(e.toLowerCase())||null}GetBehaviorIndexByName(e){return e=this._behaviorNameToIndex.get(e.toLowerCase()),void 0===e?-1:e}GetEffectList(){return this._effectList}HasEffects(){return this._plugin.HasEffects()}UsesEffects(){return this._effectList&&this._effectList.HasAnyEffectType()}GetSolStack(){return this._solStack}GetCurrentSol(){return this._solStack.GetCurrentSol()}GetImageInfo(){return this._imageInfo}SetDefaultInstanceData(e){this._defaultInstanceData=e}GetDefaultInstanceData(){return this._defaultInstanceData}_SetDefaultLayerIndex(e){this._defaultLayerIndex=e}GetDefaultLayerIndex(){return this._defaultLayerIndex}GetAnimations(){return this._animations}GetAnimationCount(){return this._animations.length}GetFamilies(){return this._families}BelongsToFamily(e){return this._familiesSet.has(e)}GetFamilyMembers(){return this._familyMembers}FamilyHasMember(e){return this._familyMembersSet.has(e)}GetFamilyBehaviorOffset(e){return this._familyBehaviorMap[e]}GetFamilyInstanceVariableOffset(e){return this._familyInstVarMap[e]}GetAnimationByName(e){if(!this._animations)throw Error("no animations");return this._animationsByName.get(e.toLowerCase())||null}GetAnimationBySID(e){if(!this._animations)throw Error("no animations");return this._animationsBySid.get(e)||null}GetFirstAnimationFrame(){if(!this._animations)throw Error("no animations");return this._animations[0].GetFrameAt(0)}GetDefaultInstanceSize(){if(this._animations){const e=this.GetFirstAnimationFrame().GetImageInfo();return[e.GetWidth(),e.GetHeight()]}return this._imageInfo?[this._imageInfo.GetWidth(),this._imageInfo.GetHeight()]:[100,100]}GetSingleGlobalInstance(){if(!this._plugin.IsSingleGlobal())throw Error("not a single-global plugin");return this._instances[0]}GetInstances(){return this._instances}*instances(){yield*this._instances}*instancesIncludingPendingCreate(){yield*this._instances;for(const e of this._runtime._GetInstancesPendingCreate())e.GetObjectClass()===this&&(yield e)}GetInstanceCount(){return this._instances.length}_AddInstance(e){this._instances.push(e)}_SetIIDsStale(){this._iidsStale=!0}_UpdateIIDs(){if(this._iidsStale&&!this._isFamily){var e=this._instances,t=0;for(let s=e.length;t<s;++t)e[t]._SetIID(t);e=this._runtime._GetInstancesPendingCreate();for(const s of e)s.GetObjectClass()===this&&s._SetIID(t++);this._iidsStale=!1}}GetInstanceByIID(e){var t=this._instances;if(e<t.length)return t[e];e-=t.length,t=this._runtime._GetInstancesPendingCreate();for(const s of t)if(s.GetObjectClass()===this){if(0===e)return s;--e}return null}GetFirstPicked(e){if(e&&e.IsInContainer()&&e.GetObjectClass()!==this)for(const t of e.siblings())if(t.GetObjectClass()===this)return t;return e=this.GetCurrentSol().GetInstances(),e.length?e[0]:null}GetPairedInstance(e){const t=this.GetCurrentSol().GetInstances();return 0<t.length?t[e.GetIID()%t.length]:null}*allCorrespondingInstances(e,t){const s=this.GetCurrentSol().GetInstances();var i=s.length;const r=t.GetCurrentSol(),n=t.GetCurrentSol().GetInstances(),a=n.length;var o=e.GetIID();!t.IsFamily()&&r.IsSelectAll()||(o=n.indexOf(e)),e=Math.ceil(i/a),i%=a,0===i||o<i?(o*=e,i=e):(o=i*e+(o-i)*(e-1),i=e-1);for(let e=o,t=o+i;e<t;++e)yield s[e]}FinishCondition(e){this._sdkType.FinishCondition(e)}ApplySolToContainer(){if(this._isInContainer&&!this._isFamily){this._UpdateIIDs();var t=this.GetCurrentSol(),s=t._GetOwnInstances(),i=t.IsSelectAll(),r=this._runtime.GetCurrentEventStackFrame();r=r&&r.GetCurrentEvent()&&r.GetCurrentEvent().IsOrBlock();for(const o of this._container.objectTypes())if(o!==this){o._UpdateIIDs();var n=o.GetCurrentSol();if(n._SetSelectAll(i),!i){var a=n._GetOwnInstances();e.clearArray(a);for(const e of s)a.push(o.GetInstanceByIID(e.GetIID()));if(r){a=t._GetOwnElseInstances(),n=n._GetOwnElseInstances(),e.clearArray(n);for(const e of a)n.push(o.GetInstanceByIID(e.GetIID()))}}}}}_TruncateContainerSols(t,s){for(const i of this.GetContainer().objectTypes()){const r=i.GetCurrentSol();t?e.truncateArray(r._GetOwnElseInstances(),s):e.truncateArray(r._GetOwnInstances(),s)}}_GetCollisionCellGrid(){return this._collisionGrid}_SetAnyCollisionCellChanged(e){this._anyCollisionCellChanged=!!e}_SetAnyInstanceParallaxed(e){this._anyInstanceParallaxed=!!e}IsAnyInstanceParallaxed(){return this._anyInstanceParallaxed}_UpdateAllCollisionCells(){if(this._anyCollisionCellChanged&&this._isWorldType){for(const e of this._instances)e.GetWorldInfo()._UpdateCollisionCell();for(const e of this._runtime._GetInstancesPendingCreate())e.GetObjectClass()===this&&e.GetWorldInfo()._UpdateCollisionCell();this._anyCollisionCellChanged=!1}}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}HasSolidBehavior(){return this.UsesBehaviorByCtor(e.Behaviors.solid)}HasNoSaveBehavior(){return this.UsesBehaviorByCtor(e.Behaviors.NoSave)}HasPersistBehavior(){return this.UsesBehaviorByCtor(e.Behaviors.Persist)}_SaveToJson(){const t={instances:this._instances.map(e=>e.SaveToJson())};return this._savedData&&this._savedData.size&&(t.ex=e.ToSuperJSON(this._savedData)),t}_LoadFromJson(t){this._savedData&&(this._savedData.clear(),this._savedData=null);var s=t.ex;s&&(this._savedData=e.FromSuperJSON(s)),s=this._instances,t=t.instances;for(let e=0,i=Math.min(s.length,t.length);e<i;++e)s[e].LoadFromJson(t[e]);for(let e=t.length,i=s.length;e<i;++e)this._runtime.DestroyInstance(s[e]);for(let e=s.length,i=t.length;e<i;++e){s=t[e];let i=null;this.IsWorldType()&&(i=this._runtime.GetMainRunningLayout().GetLayerBySID(s.w.l),!i)||this._runtime.CreateInstanceFromData(this._defaultInstanceData||this,i,!1,0,0,!0).LoadFromJson(s)}this._SetIIDsStale()}GetIObjectClass(){return this._iObjectClass}UserScriptDispatcher(){return this._userScriptDispatcher}_GetUserScriptInstanceClass(){return this._instanceUserScriptClass}_SetUserScriptInstanceClass(e){this._instanceUserScriptClass=e}DispatchUserScriptEvent(e){var s=this._runtime;(s=s.IsDebug()&&!s.GetEventSheetManager().IsInEventEngine())&&t.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),s&&t.AddScriptTime()}}}{const e=self.C3;e.Container=class extends e.DefendedBase{constructor(e,t){super(),this._runtime=e,this._objectTypes=t;for(const e of this._objectTypes)e._SetContainer(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetObjectTypes(){return this._objectTypes}objectTypes(){return this._objectTypes}HasAnyWorldType(){return this._objectTypes.some(e=>e.IsWorldType())}}}{const e=self.C3,t=self.C3Debugger,s=self.IInstance,i=[];let r=0;const n=new WeakMap,a=new WeakMap;e.Instance=class extends e.DefendedBase{constructor(t){super(),this._runtime=t.runtime,this._objectType=t.objectType,this._iScriptInterface=this._sdkInst=this._worldInfo=null,this._iid=0,this._uid=t.uid,this._puid=r++,this._flags=0,this._behaviorInstances=this._instVarValues=i;var s=this._objectType.GetBehaviorTypesIncludingInherited();if(0<s.length&&(this._behaviorInstances=s.map((t,s)=>e.New(e.BehaviorInstance,{runtime:this._runtime,behaviorType:t,instance:this,index:s}))),this._siblings=this._objectType.IsInContainer()?[]:null,this._timeScale=-1,this._dispatcher=null,s=this.GetPlugin(),s.MustPreDraw()&&(this._flags|=4),s.IsWorldType())if(this._worldInfo=e.New(e.WorldInfo,this,t.layer),t.worldData)this._worldInfo.Init(t.worldData);else{this._worldInfo.InitNoData();const[e,t]=this._objectType.GetDefaultInstanceSize();this._worldInfo.SetSize(e,t),this.GetObjectClass().UsesEffects()&&this._worldInfo.GetInstanceEffectList().LoadDefaultEffectParameters()}t.instVarData?this._LoadInstanceVariableData(t.instVarData):this._LoadDefaultInstanceVariables()}Release(){if(this._iScriptInterface&&(this._iScriptInterface._Release(),this._iScriptInterface=null),0<this._behaviorInstances.length){for(var t of this._behaviorInstances)t.Release();e.clearArray(this._behaviorInstances)}this._sdkInst.Release(),this._sdkInst=null,(t=n.get(this))&&(t.clear(),n.delete(this)),(t=a.get(this))&&(t.clear(),a.delete(this)),this._siblings&&e.clearArray(this._siblings),this._dispatcher&&(this._dispatcher.Release(),this._dispatcher=null),this._objectType=this._runtime=null,0<this._instVarValues.length&&e.clearArray(this._instVarValues),this._worldInfo&&(this._worldInfo.Release(),this._worldInfo=null)}_LoadInstanceVariableData(t){0<t.length&&(this._instVarValues=[],e.shallowAssignArray(this._instVarValues,t))}_LoadDefaultInstanceVariables(){const e=this._objectType.GetInstanceVariablesCount();if(0!==e){this._instVarValues=[];var t=[0,0,""];for(let s=0;s<e;++s)this._instVarValues.push(t[this._objectType.GetInstanceVariableType(s)])}}_CreateSdkInstance(t,s){if(this._sdkInst)throw Error("already got sdk instance");for(let e=0,t=this._behaviorInstances.length;e<t;++e)this._behaviorInstances[e]._CreateSdkInstance(s?s[e]:null);if(this._sdkInst=e.New(this._objectType.GetInstanceSdkCtor(),this,t),!(this._sdkInst instanceof e.SDKInstanceBase))throw Error("sdk type must derive from SDKInstanceBase");for(let e=0,t=this._behaviorInstances.length;e<t;++e)this._behaviorInstances[e].PostCreate();this._objectType._GetUserScriptInstanceClass()&&this._InitUserScriptInterface()}GetSdkInstance(){return this._sdkInst}GetWorldInfo(){return this._worldInfo}GetRuntime(){return this._runtime}GetTimeScale(){return this._timeScale}GetActiveTimeScale(){const e=this._timeScale;return-1===e?this.GetRuntime().GetTimeScale():e}SetTimeScale(e){e=+e,(0>e||!isFinite(e))&&(e=0),this._timeScale=e}RestoreTimeScale(){this._timeScale=-1}Dispatcher(){return this._dispatcher||(this._dispatcher=e.New(e.Event.Dispatcher)),this._dispatcher}Draw(e){this._sdkInst.Draw(e)}OnCreate(e){this._sdkInst.OnCreate(e)}_SetHasTilemap(){this._flags|=2}HasTilemap(){return 0!=(2&this._flags)}_MarkDestroyed(){this._flags|=1}IsDestroyed(){return 0!=(1&this._flags)}MustPreDraw(){return 0!=(4&this._flags)}SetMustMitigateZFighting(){this._flags|=32}MustMitigateZFighting(){return 0!=(32&this._flags)}_IsSolidEnabled(){return 0!=(8&this._flags)}_SetSolidEnabled(e){this._flags=e?8|this._flags:-9&this._flags}_IsJumpthruEnabled(){return 0!=(16&this._flags)}_SetJumpthruEnabled(e){this._flags=e?16|this._flags:-17&this._flags}SetFlag(e,t){e<<=16,this._flags=t?this._flags|e:this._flags&~e}GetFlag(e){return 0!=(this._flags&e<<16)}GetCurrentImageInfo(){return this._sdkInst.GetCurrentImageInfo()}GetCurrentSurfaceSize(){return this._sdkInst.GetCurrentSurfaceSize()}GetCurrentTexRect(){return this._sdkInst.GetCurrentTexRect()}GetCurrentTexQuad(){return this._sdkInst.GetCurrentTexQuad()}IsCurrentTexRotated(){return this._sdkInst.IsCurrentTexRotated()}GetImagePoint(e){return this._sdkInst.GetImagePoint(e)}GetObjectClass(){return this._objectType}RendersToOwnZPlane(){return this._sdkInst.RendersToOwnZPlane()}BelongsToObjectClass(e){return e.IsFamily()?e.FamilyHasMember(this.GetObjectClass()):this.GetObjectClass()===e}VerifySupportsSceneGraph(){if(!this.GetPlugin().SupportsSceneGraph())throw Error("object does not support scene graph")}HasParent(){return null!==this.GetParent()}GetParent(){var e=this.GetWorldInfo();return e&&(e=e.GetParent())?e.GetInstance():null}GetTopParent(){var e=this.GetWorldInfo();return e&&(e=e.GetTopParent())?e.GetInstance():null}*parents(){const e=this.GetWorldInfo();if(e)for(const t of e.parents())yield t.GetInstance()}HasChildren(){const e=this.GetWorldInfo();return!!e&&e.HasChildren()}GetChildren(){const e=this.GetWorldInfo();return e?e.GetChildren().map(e=>e.GetInstance()):[]}*children(){const e=this.GetWorldInfo();if(e)for(const t of e.children())yield t.GetInstance()}*allChildren(){const e=this.GetWorldInfo();if(e)for(const t of e.allChildren())yield t.GetInstance()}GetChildCount(){const e=this.GetWorldInfo();return e?e.GetChildCount():0}GetChildAt(e){const t=this.GetWorldInfo();return t&&(e=t.GetChildAt(e))?e.GetInstance():null}AddChild(e,t){this.VerifySupportsSceneGraph(),e.VerifySupportsSceneGraph(),this.GetWorldInfo().AddChild(e.GetWorldInfo(),t||{})}RemoveChild(e){const t=this.GetWorldInfo();t&&t.RemoveChild(e.GetWorldInfo())}GetDestroyWithParent(){const e=this.GetWorldInfo();return!!e&&e.GetDestroyWithParent()}SetupInitialSceneGraphConnections(){var e=this.GetWorldInfo();if(e&&(e=e.GetSceneGraphChildrenExportData()))for(const t of e)if(e=this._runtime.GetInstanceByUID(t[2])){const s=t[3];this.AddChild(e,{transformX:!!(s>>0&1),transformY:!!(s>>1&1),transformWidth:!!(s>>2&1),transformHeight:!!(s>>3&1),transformAngle:!!(s>>4&1),destroyWithParent:!!(s>>5&1),transformZElevation:!!(s>>6&1)})}}IsInContainer(){return null!==this._siblings}_AddSibling(e){this._siblings.push(e)}GetSiblings(){return this._siblings}HasSibling(e){return!!this.GetSibling(e)}GetSibling(e){const t=this.siblings();if(null===t||0===t.length)return!1;for(const s of t)if(s.GetObjectClass()===e)return s;return null}siblings(){return this._siblings}SetSiblingsSinglePicked(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol().SetSinglePicked(e)}_PushSiblingsToSolInstances(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushInstance(e)}_SetSiblingsToSolInstancesIndex(e){for(const t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnInstances()[e]=t}_PushSiblingsToSolElseInstances(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushElseInstance(e)}_SetSiblingsToSolElseInstancesIndex(e){for(const t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnElseInstances()[e]=t}GetPlugin(){return this._objectType.GetPlugin()}_SetIID(e){this._iid=e}GetIID(){return this._objectType._UpdateIIDs(),this._iid}GetUID(){return this._uid}GetPUID(){return this._puid}GetBehaviorInstances(){return this._behaviorInstances}GetBehaviorInstanceFromCtor(e){if(!e)return null;for(const t of this._behaviorInstances)if(t.GetBehavior()instanceof e)return t;return null}GetBehaviorSdkInstanceFromCtor(e){return e&&(e=this.GetBehaviorInstanceFromCtor(e))?e.GetSdkInstance():null}GetBehaviorIndexBySID(e){const t=this._behaviorInstances;for(let s=0,i=t.length;s<i;++s)if(t[s].GetBehaviorType().GetSID()===e)return s;return-1}GetAllInstanceVariableValues(){return this._instVarValues}_GetAllInstanceVariableNames(){
return this._objectType._GetAllInstanceVariableNames()}GetInstanceVariableCount(){return this._instVarValues.length}GetInstanceVariableValue(e){e|=0;const t=this._instVarValues;if(0>e||e>=t.length)throw new RangeError("invalid instance variable");return t[e]}_GetInstanceVariableValueUnchecked(e){return this._instVarValues[e]}_GetInstanceVariableTypedValue(e){const t=this._instVarValues[e];return 0===this._objectType.GetInstanceVariableType(e)?!!t:t}SetInstanceVariableValue(e,t){e|=0;const s=this._instVarValues;if(0>e||e>=s.length)throw new RangeError("invalid instance variable");switch(this._objectType.GetInstanceVariableType(e)){case 0:s[e]=t?1:0;break;case 1:s[e]="number"==typeof t?t:parseFloat(t);break;case 2:s[e]="string"==typeof t?t:t.toString();break;default:throw Error("unknown instance variable type")}}SetInstanceVariableOffset(e,t){if(0!==t){e|=0;var s=this._instVarValues;if(0>e||e>=s.length)throw new RangeError("invalid instance variable");var i=s[e];if("number"!=typeof i){if("boolean"==typeof i)throw Error("can not set offset of boolean variable");if("string"==typeof i)throw Error("can not set offset of string variable");throw Error("unknown instance variable type")}s[e]="number"==typeof t?s[e]+t:s[e]+parseFloat(t)}}GetSavedDataMap(){let e=n.get(this);return e||(e=new Map,n.set(this,e),e)}GetUnsavedDataMap(){let e=a.get(this);return e||(e=new Map,a.set(this,e),e)}_HasAnyCreateDestroyHandler(e){const t=this.GetObjectClass();if(t.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;for(const s of t.GetFamilies())if(s.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;return!!this._runtime.UserScriptDispatcher().HasAnyHandlerFor(e)}_TriggerOnCreatedOnSelfAndRelated(){const e=new Set;e.add(this);const t=this.GetWorldInfo();if(t&&t.HasChildren())for(const t of this.allChildren())if(e.add(t),t.IsInContainer())for(const s of t.siblings())e.add(s);if(this.IsInContainer())for(const t of this.siblings())e.add(t);for(const t of e.values())t._TriggerOnCreated()}_TriggerOnCreated(){if(this._HasAnyCreateDestroyHandler("instancecreate")){const t=this.GetObjectClass(),s=new e.Event("instancecreate");s.instance=this.GetInterfaceClass(),t.DispatchUserScriptEvent(s);for(const e of t.GetFamilies())e.DispatchUserScriptEvent(s);this._runtime.DispatchUserScriptEvent(s)}this._runtime.Trigger(this.GetPlugin().constructor.Cnds.OnCreated,this,null)}_TriggerOnDestroyed(){this._runtime.Trigger(this.GetPlugin().constructor.Cnds.OnDestroyed,this,null)}_FireDestroyedScriptEvents(t){if(this._iScriptInterface){var s=new e.Event("destroy");s.isEndingLayout=t,this.DispatchUserScriptEvent(s)}if(this._HasAnyCreateDestroyHandler("instancedestroy")){s=this.GetObjectClass();var i=new e.Event("instancedestroy");i.instance=this.GetInterfaceClass(),i.isEndingLayout=t,s.DispatchUserScriptEvent(i);for(const e of s.GetFamilies())e.DispatchUserScriptEvent(i);this._runtime.DispatchUserScriptEvent(i)}}_GetDebuggerProperties(){return this._sdkInst.GetDebuggerProperties()}SaveToJson(t="full"){const s={};if("full"===t?s.uid=this.GetUID():s.c3=!0,"visual-state"!==t){var i=n.get(this);if(i&&i.size&&(s.ex=e.ToSuperJSON(i)),-1!==this.GetTimeScale()&&(s.mts=this.GetTimeScale()),0<this._objectType.GetInstanceVariablesCount()){i={};var r=this._objectType.GetInstanceVariableSIDs();for(let e=0,t=this._instVarValues.length;e<t;++e)i[r[e].toString()]=this._instVarValues[e];s.ivs=i}if(this._behaviorInstances.length){i={};for(const e of this._behaviorInstances)(r=e.SaveToJson())&&(i[e.GetBehaviorType().GetSID().toString()]=r);s.behs=i}}return this._worldInfo&&(s.w=this._worldInfo._SaveToJson(t)),(t=this._sdkInst.SaveToJson())&&(s.data=t),s}_OnBeforeLoad(e="full"){this._worldInfo&&this._worldInfo._OnBeforeLoad(e)}LoadFromJson(t,s="full"){if("full"===s)this._uid=t.uid;else if(!t.c3)return;if("visual-state"!==s){var i=n.get(this);if(i&&(i.clear(),n.delete(this)),(i=t.ex)&&(i=e.FromSuperJSON(i),n.set(this,i)),this._timeScale=t.hasOwnProperty("mts")?t.mts:-1,i=t.ivs)for(const[e,t]of Object.entries(i))if(i=parseInt(e,10),i=this._objectType.GetInstanceVariableIndexBySID(i),!(0>i||i>=this._instVarValues.length)){var r=t;null===r&&(r=NaN),this._instVarValues[i]=r}}if(this.GetPlugin().IsWorldType()){i=t.w;var a=i.l;this._worldInfo.GetLayer().GetSID()!==a&&(r=this._worldInfo.GetLayer(),(a=r.GetLayout().GetLayerBySID(a))?(this._worldInfo._SetLayer(a),r._RemoveInstance(this,!0),a._AddInstance(this,!0),a.SetZIndicesChanged(),this._worldInfo.SetBboxChanged()):"full"===s&&this._runtime.DestroyInstance(this)),this._worldInfo._LoadFromJson(i,s)}if("visual-state"!==s&&(s=t.behs))for(const[e,t]of Object.entries(s))s=parseInt(e,10),s=this.GetBehaviorIndexBySID(s),0>s||s>=this._behaviorInstances.length||this._behaviorInstances[s].LoadFromJson(t);(t=t.data)&&this._sdkInst.LoadFromJson(t)}GetInterfaceClass(){return this._iScriptInterface||this._InitUserScriptInterface()}_InitUserScriptInterface(){var e=this._worldInfo?self.IWorldInstance:s;const t=this._sdkInst.GetScriptInterfaceClass(),i=this._objectType._GetUserScriptInstanceClass(),r=i||t||e;if(s._Init(this),this._iScriptInterface=new r,s._Init(null),t&&!(this._iScriptInterface instanceof e))throw new TypeError(`script interface class '${t.name}' does not extend the right base class '${e.name}'`);if(i&&(e=t||e,!(this._iScriptInterface instanceof e)))throw new TypeError(`setInstanceClass(): class '${i.name}' does not extend the right base class '${e.name}'`);return this._iScriptInterface}_GetInstVarsScriptDescriptor(t){if(0!==this._instVarValues.length){var s={},i=this._objectType._GetAllInstanceVariableJsPropNames();for(let t=0,r=i.length;t<r;++t)s[i[t]]={configurable:!1,enumerable:!0,get:e.Instance.prototype._GetInstanceVariableTypedValue.bind(this,t),set:e.Instance.prototype.SetInstanceVariableValue.bind(this,t)};s=Object.create(Object.prototype,s),t.instVars={value:s,writable:!1}}}_GetBehaviorsScriptDescriptor(e){var t=this._behaviorInstances;if(0!==t.length){var s={};for(const e of t)s[e.GetBehaviorType().GetJsPropName()]={value:e.GetScriptInterface(),writable:!1};t=Object.create(Object.prototype,s),e.behaviors={value:t,writable:!1}}}DispatchUserScriptEvent(e){e.instance=this.GetInterfaceClass();var s=this._runtime;(s=s.IsDebug()&&!s.GetEventSheetManager().IsInEventEngine())&&t.StartMeasuringScriptTime(),this.GetInterfaceClass().dispatchEvent(e),s&&t.AddScriptTime()}}}{const e=self.C3;e.SceneGraphInfo=class extends e.DefendedBase{constructor(e){super(),this._owner=e,this._parent=null,this._children=[],this._startWidth=e.GetWidth(),this._startHeight=e.GetHeight(),this._startScaleY=this._startScaleX=1,this._parentStartAngle=0}Release(){this._parent=null,e.clearArray(this._children)}SetParent(e){this._parentStartAngle=(this._parent=e)?e.GetAngle():0}GetParent(){return this._parent}HasChildren(){return 0<this._children.length}GetChildren(){return this._children}GetStartScaleX(){return this._startScaleX}SetStartScaleX(e){this._startScaleX=e}GetStartScaleY(){return this._startScaleY}SetStartScaleY(e){this._startScaleY=e}_GetStartWidth(){return this._startWidth}_GetStartHeight(){return this._startHeight}GetParentScaleX(){return this._owner.GetTransformWithParentWidth()?this._parent.GetWidth()/this._parent._GetSceneGraphInfo()._GetStartWidth():1}GetParentScaleY(){return this._owner.GetTransformWithParentHeight()?this._parent.GetHeight()/this._parent._GetSceneGraphInfo()._GetStartHeight():1}GetParentStartAngle(){return this._parentStartAngle}_SaveToJson(){return{sw:this._startWidth,sh:this._startHeight,sx:this._startScaleX,sy:this._startScaleY,psa:this._parentStartAngle,c:this._children.map(e=>{let t="";return e.GetTransformWithParentX()&&(t+="x"),e.GetTransformWithParentY()&&(t+="y"),e.GetTransformWithParentWidth()&&(t+="w"),e.GetTransformWithParentHeight()&&(t+="h"),e.GetTransformWithParentAngle()&&(t+="a"),e.GetTransformWithParentZElevation()&&(t+="z"),e.GetDestroyWithParent()&&(t+="d"),{uid:e.GetInstance().GetUID(),f:t}})}}_LoadFromJson(e){this._startWidth=e.sw,this._startHeight=e.sh,this._startScaleX=e.sx,this._startScaleY=e.sy,this._parentStartAngle=e.psa}_OnAfterLoad(e){const t=this._owner,s=t.GetRuntime();for(const i of e.c){e=s.GetInstanceByUID(i.uid).GetWorldInfo();const r=i.f,n={};n.transformX=r.includes("x"),n.transformY=r.includes("y"),n.transformWidth=r.includes("w"),n.transformHeight=r.includes("h"),n.transformAngle=r.includes("a"),n.transformZElevation=r.includes("z"),n.destroyWithParent=r.includes("d"),t.AddChild(e,n)}}}}{const e=self.C3,t=e.New(e.Rect),s=e.New(e.Quad),i=e.New(e.Event,"bboxchange",!1),r=e.New(e.Color,0,0,0,0),n=e.New(e.CollisionPoly),a=e.New(e.Color,1,1,1,1),o=e.New(e.Rect,0,0,-1,-1),h=e.New(e.Rect,0,0,-1,-1),l=new Set(["absolute","relative"]),c=[];let u=!0;const _=new WeakMap,d=new WeakMap;e.WorldInfo=class extends e.DefendedBase{constructor(t,s){super(),this._inst=t,this._objectClass=t.GetObjectClass(),this._runtime=t.GetRuntime(),this._layer=s,this._zIndex=-1,this._flags=196635,this._objectClass.GetPlugin().IsRotatable()&&(this._flags|=128),this._oy=this._ox=this._cosA=this._sinA=this._a=this._depth=this._h=this._w=this._zElevation=this._y=this._x=NaN,this._boundingBox=e.New(e.Rect),this._boundingQuad=e.New(e.Quad),this._collisionCells=h,this._renderCells=o,this._solidFilterTags=this._transformedPolyInfo=this._sourceCollisionPoly=null,this._colorPremultiplied=this._color=a,this._instanceEffectList=this._stateGroup=null,this._inst.GetObjectClass().UsesEffects()&&(this._instanceEffectList=e.New(e.InstanceEffectList,this._inst,this)),this._meshInfo=this._sceneGraphInfo=null}_MarkDestroyed(){this._flags|=256}Release(){if(this._stateGroup&&(this._runtime.GetRenderer().ReleaseStateGroup(this._stateGroup),this._stateGroup=null),this._sourceCollisionPoly=null,this._transformedPolyInfo&&(this._transformedPolyInfo.poly.Release(),this._transformedPolyInfo=null),this._solidFilterTags&&(this._solidFilterTags.clear(),this._solidFilterTags=null),this.ReleaseMesh(),this.HasParent()&&this.GetParent().RemoveChild(this),this.HasChildren()){const e=[...this.GetChildren()];for(const t of e)this.RemoveChild(t)}this._ReleaseSceneGraphInfo(),this._layer=this._runtime=this._objectClass=this._inst=null}Init(e){if(u=!1,this.SetXY(e[0],e[1]),this.SetZElevation(e[2]),this.SetSize(e[3],e[4]),this._depth=0,this.IsRotatable()?this.SetAngle(e[6]):this._a=0,r.setFromJSON(e[7]),this._SetColor(r),this.SetOriginX(e[8]),this.SetOriginY(e[9]),this.SetBlendMode(e[10]),this._instanceEffectList&&this._instanceEffectList._LoadEffectParameters(e[12]),e[14]&&_.set(this,{childrenData:e[14][1],zIndexData:e[14][2]}),e[15]){var t=e[15];this.CreateMesh(t[0],t[1]),e=this.GetSourceMesh(),t=t[2];for(let s=0,i=t.length;s<i;++s){const i=t[s];for(let t=0,r=i.length;t<r;++t){const r=i[t],n=e.GetMeshPointAt(t,s);n.SetX(r[0]),n.SetY(r[1]),n.SetZElevation(r[2]),n.SetU(r[3]),n.SetV(r[4])}}}u=!0,this._UpdateRendererStateGroup()}InitNoData(){this._sinA=this._a=this._depth=this._h=this._w=this._zElevation=this._y=this._x=0,this._cosA=1,this._oy=this._ox=0,this._UpdateRendererStateGroup()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetInstance(){return this._inst}_GetParentOffsetAngle(){return this.GetTransformWithParentAngle()?this.GetParent().GetAngle()-this._sceneGraphInfo.GetParentStartAngle():0}SetX(e){if(e=+e,this.GetTransformWithParentX()){const t=this._sceneGraphInfo;e-=this.GetX();const s=-this._GetParentOffsetAngle();0===s?this._x+=e/t.GetParentScaleX():(this._x+=Math.cos(s)*e/t.GetParentScaleX(),this.GetTransformWithParentY()&&(this._y+=Math.sin(s)*e/t.GetParentScaleY()))}else this._x=e}OffsetX(e){e=+e,this.GetTransformWithParentX()?this.SetX(this.GetX()+e):this._x+=e}GetX(){if(this.GetTransformWithParentX()){let e=this._x;const t=this._sceneGraphInfo,s=this.GetParent(),i=this._GetParentOffsetAngle();return 0===i?e*=t.GetParentScaleX():(e=e*t.GetParentScaleX()*Math.cos(i),this.GetTransformWithParentY()&&(e-=this._y*t.GetParentScaleY()*Math.sin(i))),s.GetX()+e}return this._x}SetY(e){if(e=+e,this.GetTransformWithParentY()){const t=this._sceneGraphInfo;e-=this.GetY();const s=-this._GetParentOffsetAngle();0===s?this._y+=e/t.GetParentScaleY():(this.GetTransformWithParentX()&&(this._x-=Math.sin(s)*e/t.GetParentScaleX()),this._y+=Math.cos(s)*e/t.GetParentScaleY())}else this._y=e}OffsetY(e){e=+e,this.GetTransformWithParentY()?this.SetY(this.GetY()+e):this._y+=e}GetY(){if(this.GetTransformWithParentY()){let e=this._y;const t=this._sceneGraphInfo,s=this.GetParent(),i=this._GetParentOffsetAngle();return 0===i?e*=t.GetParentScaleY():(e=e*t.GetParentScaleY()*Math.cos(i),this.GetTransformWithParentX()&&(e+=this._x*t.GetParentScaleX()*Math.sin(i))),s.GetY()+e}return this._y}SetXY(e,t){if(e=+e,t=+t,this.GetTransformWithParentXOrY()){const i=this.GetTransformWithParentX(),r=this.GetTransformWithParentY(),n=this._sceneGraphInfo,a=e-this.GetX(),o=t-this.GetY();var s=-this._GetParentOffsetAngle();if(0===s)this._x=i?this._x+a/n.GetParentScaleX():e,this._y=r?this._y+o/n.GetParentScaleY():t;else{const h=Math.sin(s);s=Math.cos(s),this._x=i?r?this._x+(s*a-h*o)/n.GetParentScaleX():this._x+s*a/n.GetParentScaleX():e,this._y=r?i?this._y+(h*a+s*o)/n.GetParentScaleY():this._y+s*o/n.GetParentScaleY():t}}else this._x=e,this._y=t}OffsetXY(e,t){e=+e,t=+t,this.GetTransformWithParentXOrY()?this.SetXY(this.GetX()+e,this.GetY()+t):(this._x+=e,this._y+=t)}EqualsXY(e,t){return this.GetX()===e&&this.GetY()===t}SetZElevation(e){e=+e,this.GetTransformWithParentZElevation()&&(e-=this.GetParent().GetZElevation()),this._zElevation!==e&&(this._zElevation=e,this._UpdateZElevation(),e=this.GetLayer(),0!==this._zElevation&&e._SetAnyInstanceZElevated(),e.SetZIndicesChanged())}_UpdateZElevation(){if(this._UpdateRendererStateGroup(),this.HasChildren()){const e=this.GetChildren();for(let t=0,s=e.length;t<s;t++){const s=e[t];s.GetTransformWithParentZElevation()&&s._UpdateZElevation()}}}OffsetZElevation(e){this.SetZElevation(this.GetZElevation()+e)}GetZElevation(){return this.GetTransformWithParentZElevation()?this.GetParent().GetZElevation()+this._zElevation:this._zElevation}GetTotalZElevation(){return this.GetLayer().GetZElevation()+this.GetZElevation()}SetWidth(e){if(e=+e,this.GetTransformWithParentWidth()){const t=this.GetWidth();this._w=0===t?1e-6:e/t*this._w}else this._w=e}OffsetWidth(e){e=+e,this.GetTransformWithParentWidth()?this.SetWidth(this.GetWidth()+e):this._w+=e}GetWidth(){return this.GetTransformWithParentWidth()?this.GetParent().GetWidth()*this._w:this._w}SetHeight(e){if(e=+e,this.GetTransformWithParentHeight()){const t=this.GetHeight();this._h=0===t?1e-6:e/t*this._h}else this._h=e}OffsetHeight(e){e=+e,this.GetTransformWithParentHeight()?this.SetHeight(this.GetHeight()+e):this._h+=e}GetHeight(){return this.GetTransformWithParentHeight()?this.GetParent().GetHeight()*this._h:this._h}SetSize(e,t){if(e=+e,t=+t,this.GetTransformWithParentWidth()){const t=this.GetWidth();this._w=0===t?1e-6:e/t*this._w}else this._w=e;this.GetTransformWithParentHeight()?(e=this.GetHeight(),this._h=0===e?1e-6:t/e*this._h):this._h=t}GetDepth(){return this._depth}SetDepth(e){if(0>e)throw new RangeError("invalid depth");this._depth=e}GetSceneGraphScale(){if(this.HasParent()){const e=this._sceneGraphInfo;return Math.min(e.GetParentScaleX(),e.GetParentScaleY())}return 1}IsRotatable(){return 0!=(128&this._flags)}SetAngle(t){t=+t,this.IsRotatable()&&(this.GetTransformWithParentAngle()&&(t-=this.GetParent().GetAngle()),t=e.clampAngle(t),this._a!==t&&(this._a=t,this._MarkSinCosAngleChanged()))}OffsetAngle(t){t=+t,0!==t&&this.IsRotatable()&&(this._a=e.clampAngle(this._a+t),this._MarkSinCosAngleChanged())}_MarkSinCosAngleChanged(){if(this._flags|=262144,this.HasChildren()){const e=this.GetChildren();for(let t=0,s=e.length;t<s;t++)e[t]._MarkSinCosAngleChanged()}}GetAngle(){return this.GetTransformWithParentAngle()?e.clampAngle(this.GetParent().GetAngle()+this._a):this._a}_MaybeUpdateSinCosAngle(){const e=this._flags;if(0!=(262144&e)){var t=this.GetAngle();this._sinA=Math.sin(t),this._cosA=Math.cos(t),this._flags=-262145&e}}GetSinAngle(){return this._MaybeUpdateSinCosAngle(),this._sinA}GetCosAngle(){return this._MaybeUpdateSinCosAngle(),this._cosA}SetOriginX(e){this._ox=+e}OffsetOriginX(e){this._ox+=+e}GetOriginX(){return this._ox}SetOriginY(e){this._oy=+e}OffsetOriginY(e){this._oy+=+e}GetOriginY(){return this._oy}_SetColor(t){this._color.equals(t)||(this._color===a?(this._color=e.New(e.Color,t),this._colorPremultiplied=e.New(e.Color,t),this._colorPremultiplied.premultiply()):t.equalsRgba(1,1,1,1)?this._colorPremultiplied=this._color=a:(this._color.set(t),this._colorPremultiplied.set(t),this._colorPremultiplied.premultiply()),this._UpdateRendererStateGroup())}SetOpacity(t){t=e.clamp(+t,0,1),this._color.a!==t&&(r.copyRgb(this._color),r.a=t,this._SetColor(r))}OffsetOpacity(e){this.SetOpacity(this.GetOpacity()+e)}GetOpacity(){return this._color.a}SetUnpremultipliedColor(e){this._color.equalsIgnoringAlpha(e)||(r.copyRgb(e),r.a=this._color.a,this._SetColor(r))}SetUnpremultipliedColorRGB(e,t,s){r.setRgb(e,t,s),this.SetUnpremultipliedColor(r)}OffsetUnpremultipliedColorRGB(e,t,s){0===e&&0===t&&0===s||(r.copyRgb(this._color),r.r+=e,r.g+=t,r.b+=s,this.SetUnpremultipliedColor(r))}GetUnpremultipliedColor(){return this._color}GetPremultipliedColor(){return this._colorPremultiplied}GetDestroyWithParent(){return 0!=(512&this._flags)}SetDestroyWithParent(e){this._SetFlag(512,e)}GetTransformWithParentX(){return 0!=(1024&this._flags)}SetTransformWithParentX(e){this._SetFlag(1024,e)}GetTransformWithParentY(){return 0!=(2048&this._flags)}GetTransformWithParentXOrY(){return 0!=(3072&this._flags)}SetTransformWithParentY(e){this._SetFlag(2048,e)}GetTransformWithParentWidth(){return 0!=(4096&this._flags)}SetTransformWithParentWidth(e){this._SetFlag(4096,e)}GetTransformWithParentHeight(){return 0!=(8192&this._flags)}SetTransformWithParentHeight(e){this._SetFlag(8192,e)}GetTransformWithParentAngle(){return 0!=(16384&this._flags)}SetTransformWithParentAngle(e){this._SetFlag(16384,e)}GetTransformWithParentZElevation(){return 0!=(32768&this._flags)}SetTransformWithParentZElevation(e){this._SetFlag(32768,e)}_ClearAllSceneGraphFlags(){this._flags&=-65025}AddChild(e,t){if(e!==this&&!e.HasParent()&&!this._HasChildRecursive(e)&&!this._HasAnyParent(e)){var s=e.GetX(),i=e.GetY(),r=e.GetWidth(),n=e.GetHeight(),a=e.GetAngle(),o=e.GetZElevation();e._SetParent(this),e.SetTransformWithParentX(t.transformX),e.SetTransformWithParentY(t.transformY),e.SetTransformWithParentWidth(t.transformWidth),e.SetTransformWithParentHeight(t.transformHeight),e.SetTransformWithParentAngle(t.transformAngle),e.SetTransformWithParentZElevation(t.transformZElevation),e.SetDestroyWithParent(t.destroyWithParent),t.transformX&&(e._x=s-this.GetX(),t.transformWidth&&(e._x/=this.GetWidth()/this._sceneGraphInfo._GetStartWidth())),t.transformY&&(e._y=i-this.GetY(),t.transformHeight&&(e._y/=this.GetHeight()/this._sceneGraphInfo._GetStartHeight())),t.transformWidth&&(e._w=r/this.GetWidth(),e._sceneGraphInfo.SetStartScaleX(e._w)),t.transformHeight&&(e._h=n/this.GetHeight(),e._sceneGraphInfo.SetStartScaleY(e._h)),t.transformAngle&&(e._a=a-this.GetAngle()),t.transformZElevation&&(e._zElevation=o-this.GetZElevation()),this._AddChildToSceneGraphInfo(e),this.SetBboxChanged()}}RemoveChild(e){if(e.GetParent()===this){var t=e.GetX(),s=e.GetY(),i=e.GetWidth(),r=e.GetHeight(),n=e.GetAngle(),a=e.GetZElevation();e._SetParent(null),e._ClearAllSceneGraphFlags(),e.SetXY(t,s),e.SetSize(i,r),e.SetAngle(n),e.SetZElevation(a),this._RemoveChildFromSceneGraphInfo(e),this.SetBboxChanged()}}_ResetAllSceneGraphState(){for(var e of this.children())this.RemoveChild(e);(e=this.GetParent())&&e.RemoveChild(this),this._ClearAllSceneGraphFlags()}HasParent(){return null!==this.GetParent()}GetParent(){const e=this._sceneGraphInfo;return null!==e?e.GetParent():null}GetTopParent(){let e=this;for(;e.HasParent();)e=e.GetParent();return e}*parents(){let e=this.GetParent();for(;e;)yield e,e=e.GetParent()}HasChild(e){return this.GetChildren().includes(e)}HasChildren(){const e=this._sceneGraphInfo;return null!==e&&e.HasChildren()}GetChildren(){const e=this._sceneGraphInfo;return null!==e?e.GetChildren():c}children(){return this.GetChildren()}*allChildren(){for(const e of this.children())yield e,yield*e.allChildren()}GetChildCount(){return this.GetChildren().length}GetChildAt(e){const t=this.GetChildren();return e=Math.floor(+e),0>e||e>=t.length?null:t[e]}_CreateSceneGraphInfo(t){this._sceneGraphInfo||(this._sceneGraphInfo=e.New(e.SceneGraphInfo,this)),t&&this._sceneGraphInfo.SetParent(t)}_GetSceneGraphInfo(){return this._sceneGraphInfo}_ReleaseSceneGraphInfo(){this._sceneGraphInfo&&(this._sceneGraphInfo.Release(),this._sceneGraphInfo=null)}_SetParent(e){e?(e._CreateSceneGraphInfo(null),this._CreateSceneGraphInfo(e)):(this._sceneGraphInfo&&this._sceneGraphInfo.SetParent(null),this.HasChildren()||this._ReleaseSceneGraphInfo())}_HasAnyParent(e){if(!this.HasParent())return!1;const t=this.GetParent();return t===e||t._HasAnyParent(e)}_HasChildRecursive(e){if(this.HasChild(e))return!0;for(const t of this.GetChildren())if(t._HasChildRecursive(e))return!0;return!1}_AddChildToSceneGraphInfo(e){this._sceneGraphInfo.GetChildren().push(e)}_RemoveChildFromSceneGraphInfo(e){const t=this._sceneGraphInfo.GetChildren(),s=t.indexOf(e);-1!==s&&t.splice(s,1),0!==t.length||this.HasParent()||this._ReleaseSceneGraphInfo(),e.HasChildren()||e._ReleaseSceneGraphInfo()}GetSceneGraphChildrenExportData(){const e=_.get(this);return e?e.childrenData:null}GetSceneGraphZIndexExportData(){const e=_.get(this);return e?e.zIndexData:NaN}GetSceneGraphZIndex(){return d.get(this)||NaN}SetSceneGraphZIndex(e){d.set(this,e)}SetUsePointsShaderProgram(){this._SetFlag(524288,!0),this._UpdateRendererStateGroup()}_UpdateRendererStateGroup(){if(u){var e=this._runtime.GetRenderer();this._stateGroup&&e.ReleaseStateGroup(this._stateGroup);var t=0!=(524288&this._flags)?e.GetPointsRenderingProgram()||"<point>":e.GetTextureFillShaderProgram()||"<default>";this._stateGroup=e.AcquireStateGroup(t,this.GetBlendMode(),this._colorPremultiplied,this.GetZElevation())}}GetRendererStateGroup(){return this._stateGroup}HasDefaultColor(){return this._color===a}SetBlendMode(e){if(e|=0,0>e||31<e)throw new RangeError("invalid blend mode");this.GetBlendMode()!==e&&(this._flags=-2080374785&this._flags|e<<26,this._UpdateRendererStateGroup())}GetBlendMode(){return(2080374784&this._flags)>>26}_SetLayer(e){this._layer=e,0!==this.GetZElevation()&&this._layer._SetAnyInstanceZElevated()}GetLayer(){return this._layer}GetLayout(){return this.GetLayer().GetLayout()}_SetZIndex(e){this._zIndex=0|e}GetZIndex(){return this._layer._UpdateZIndices(),this._zIndex}_GetLastCachedZIndex(){return this._zIndex}_SetFlag(e,t){this._flags=t?this._flags|e:this._flags&~e}IsVisible(){return 0!=(1&this._flags)}SetVisible(e){this._SetFlag(1,e)}IsCollisionEnabled(){return 0!=(8&this._flags)}SetCollisionEnabled(e){e=!!e,this.IsCollisionEnabled()!==e&&(this._SetFlag(8,e),e?this.SetBboxChanged():this._RemoveFromCollisionCells())}SetSolidCollisionFilter(e,t){if(this._SetFlag(32,e),this._solidFilterTags&&this._solidFilterTags.clear(),t.trim()){this._solidFilterTags||(this._solidFilterTags=new Set);for(const e of t.split(" "))e&&this._solidFilterTags.add(e.toLowerCase())}else this._solidFilterTags=null}IsSolidCollisionAllowed(e){const t=0!=(32&this._flags),s=this._solidFilterTags;if(!e||!s)return!t;for(const i of s)if(e.has(i))return t;return!t}SetBboxChanged(){if(this._flags|=65554,this._objectClass._SetAnyCollisionCellChanged(!0),this._runtime.UpdateRender(),this._layer.UsesRenderCells()&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags&=-3,this._UpdateRenderCell()),0!=(4&this._flags)&&this._inst.Dispatcher().dispatchEvent(i),null!==this._sceneGraphInfo){const e=this._sceneGraphInfo.GetChildren();for(let t=0,s=e.length;t<s;++t)e[t].SetBboxChanged()}}CalculateBbox(e,t,s){const i=this.GetX(),r=this.GetY(),n=this.GetWidth(),a=this.GetHeight(),o=this.GetAngle();e.setWH(i-this._ox*n,r-this._oy*a,n,a),s&&this.HasMesh()&&this._ExpandBboxForMesh(e),0===o?t.setFromRect(e):(e.offset(-i,-r),t.setFromRotatedRectPrecalc(e,this.GetSinAngle(),this.GetCosAngle()),t.offset(i,r),t.getBoundingBox(e)),e.normalize()}_UpdateBbox(){const e=this._flags;0!=(2&e)&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags=-3&e)}GetBoundingBox(){return this._UpdateBbox(),this._boundingBox}GetBoundingQuad(){return this._UpdateBbox(),this._boundingQuad}PixelRoundQuad(e){var t=this.GetX(),i=this.GetY();return t=Math.round(t)-t,i=Math.round(i)-i,0===t&&0===i?e:(s.copy(e),s.offset(t,i),s)}OverwriteBoundingBox(e){this._boundingBox.copy(e),this._boundingQuad.setFromRect(this._boundingBox),this._flags&=-3,this._UpdateCollisionCell(),this._UpdateRenderCell()}SetBboxChangeEventEnabled(e){this._SetFlag(4,e)}IsBboxChangeEventEnabled(){return 0!=(4&this._flags)}IsInViewport(e,t,s){return t&&0!==this.GetDepth()?this.IsInViewport3D(this.GetLayer()._GetViewFrustum()):0===this.GetZElevation()||s?e.intersectsRect(this.GetBoundingBox()):this._IsInViewport_ZElevated()}_IsInViewport_ZElevated(){const e=this.GetLayer(),s=this.GetTotalZElevation();return!(s>=e.GetCameraZ())&&(e.GetViewportForZ(s,t),t.intersectsRect(this.GetBoundingBox()))}IsInViewport3D(e){var t=this.GetBoundingBox();const s=t.getLeft(),i=t.getRight(),r=t.getTop();t=t.getBottom();const n=this.GetTotalZElevation(),a=n+this.GetDepth();return e.ContainsAABB(s,r,n,i,t,a)}_SetDrawBackFaceOnly(e){this._SetFlag(1048576,e)}_SetDrawNonBackFacesOnly(e){this._SetFlag(2097152,e)}IsDrawBackFaceOnly(){return 0!=(1048576&this._flags)}IsDrawNonBackFacesOnly(){return 0!=(2097152&this._flags)}SetSourceCollisionPoly(e){this._sourceCollisionPoly=e,this._DiscardTransformedCollisionPoly(),this.HasMesh()&&(this._meshInfo.meshPoly=null)}GetSourceCollisionPoly(){return this._sourceCollisionPoly}HasOwnCollisionPoly(){return null!==this._sourceCollisionPoly||this.HasMesh()}GetTransformedCollisionPoly(){return this._GetCustomTransformedCollisionPolyPrecalc(this.GetWidth(),this.GetHeight(),this.GetAngle(),this.GetSinAngle(),this.GetCosAngle())}GetCustomTransformedCollisionPoly(e,t,s){let i=0,r=1;return 0!==s&&(i=Math.sin(s),r=Math.cos(s)),this._GetCustomTransformedCollisionPolyPrecalc(e,t,s,i,r)}_GetCustomTransformedCollisionPolyPrecalc(t,s,i,r,a){let o=this._transformedPolyInfo;null===o&&(this._transformedPolyInfo=o={poly:e.New(e.CollisionPoly),width:NaN,height:NaN,angle:NaN});const h=o.poly;if(o.width===t&&o.height===s&&o.angle===i)return h;const l=this._sourceCollisionPoly;if(this.HasMesh()){const e=this.GetOriginX(),i=this.GetOriginY(),o=this.GetSourceMesh();let c=this._meshInfo.meshPoly;c||(l?(n.copy(l),n.offset(e,i)):n.setDefaultPoints(),c=o.InsertPolyMeshVertices(n),this._meshInfo.meshPoly=c),o.TransformCollisionPoly(c,h),h.offset(-e,-i),h.transformPrecalc(t,s,r,a)}else l?(h.copy(l),h.transformPrecalc(t,s,r,a)):h.setFromQuad(this.GetBoundingQuad(),-this.GetX(),-this.GetY());return o.width=t,o.height=s,o.angle=i,h}_DiscardTransformedCollisionPoly(){this.SetPhysicsBodyChanged(!0);const e=this._transformedPolyInfo;null!==e&&(e.width=NaN)}CreateMesh(t,s){if(t=Math.floor(t),s=Math.floor(s),!this.GetInstance().GetPlugin().SupportsMesh())throw Error("object does not support mesh");this.ReleaseMesh(),this._meshInfo={sourceMesh:e.New(e.Gfx.Mesh,t,s),transformedMesh:e.New(e.Gfx.Mesh,t,s),meshPoly:null}}HasMesh(){return null!==this._meshInfo}GetSourceMesh(){if(!this.HasMesh())throw Error("no mesh");return this._meshInfo.sourceMesh}GetTransformedMesh(){if(!this.HasMesh())throw Error("no mesh");return this._meshInfo.transformedMesh}SetMeshChanged(e){this._SetFlag(65536,e)}IsMeshChanged(){return 0!=(65536&this._flags)}SetPhysicsBodyChanged(e){this._SetFlag(131072,e)}IsPhysicsBodyChanged(){return 0!=(131072&this._flags)}_ExpandBboxForMesh(e){const t=this._meshInfo.sourceMesh,s=Math.min(t.GetMinX(),0),i=Math.min(t.GetMinY(),0),r=Math.max(t.GetMaxX(),1),n=Math.max(t.GetMaxY(),1),a=e.width(),o=e.height();e.offsetLeft(s*a),e.offsetTop(i*o),e.offsetRight((r-1)*a),e.offsetBottom((n-1)*o),this._depth=t.GetMaxZ()}ReleaseMesh(){this._meshInfo&&(this._meshInfo.sourceMesh.Release(),this._meshInfo.transformedMesh.Release(),this._meshInfo=null,this._DiscardTransformedCollisionPoly())}SetMeshPoint(t,s,i){t=Math.floor(t),s=Math.floor(s);var r=i.mode||"absolute";if(!l.has(r))throw Error("invalid mode");r="relative"===r;let n=i.x,a=i.y;const o=i.zElevation;let h="number"==typeof i.u?i.u:r?0:-1;if(i="number"==typeof i.v?i.v:r?0:-1,!this.HasMesh())return!1;const c=this.GetSourceMesh(),u=c.GetMeshPointAt(t,s);if(null===u)return!1;let _=!1;return"number"==typeof o&&u.GetZElevation()!==o&&(u.SetZElevation(o),_=!0),r&&(n+=t/(c.GetHSize()-1),a+=s/(c.GetVSize()-1)),-1!==h||r?(r&&(h+=t/(c.GetHSize()-1)),h=e.clamp(h,0,1)):h=u.GetU(),-1!==i||r?(r&&(i+=s/(c.GetVSize()-1)),i=e.clamp(i,0,1)):i=u.GetV(),u.GetX()===n&&u.GetY()===a&&u.GetU()===h&&u.GetV()===i?_:(u.SetX(n),u.SetY(a),u.SetU(h),u.SetV(i),this._DiscardTransformedCollisionPoly(),!0)}HasTilemap(){return this._inst.HasTilemap()}ContainsPoint(e,t){return!(!this.GetBoundingBox().containsPoint(e,t)||!this.GetBoundingQuad().containsPoint(e,t))&&(this.HasTilemap()?this._inst.GetSdkInstance().TestPointOverlapTile(e,t):!this.HasOwnCollisionPoly()||this.GetTransformedCollisionPoly().containsPoint(e-this.GetX(),t-this.GetY()))}_IsCollisionCellChanged(){return 0!=(16&this._flags)}_UpdateCollisionCell(){if(this._IsCollisionCellChanged()&&this.IsCollisionEnabled()&&0==(256&this._flags)){var s=this.GetBoundingBox(),i=this._objectClass._GetCollisionCellGrid(),r=this._collisionCells;t.set(i.XToCell(s.getLeft()),i.YToCell(s.getTop()),i.XToCell(s.getRight()),i.YToCell(s.getBottom())),r.equals(t)||(s=this._inst,r===h?(i.Update(s,null,t),this._collisionCells=e.New(e.Rect,t)):(i.Update(s,r,t),r.copy(t)),this._flags&=-17)}}_RemoveFromCollisionCells(){const e=this._collisionCells;e!==h&&(this._objectClass._GetCollisionCellGrid().Update(this._inst,e,null),this._collisionCells=h)}_UpdateRenderCell(){const s=this.GetLayer();if(s.UsesRenderCells()&&0==(256&this._flags)){var i=s.GetRenderGrid(),r=this.GetBoundingBox(),n=this._renderCells;t.set(i.XToCell(r.getLeft()),i.YToCell(r.getTop()),i.XToCell(r.getRight()),i.YToCell(r.getBottom())),n.equals(t)||(r=this._inst,n===o?(i.Update(r,null,t),this._renderCells=e.New(e.Rect,t)):(i.Update(r,n,t),n.copy(t)),s.SetRenderListStale())}}_RemoveFromRenderCells(){const e=this._renderCells;e!==o&&(this.GetLayer().GetRenderGrid().Update(this._inst,e,null),this._renderCells=o)}GetRenderCellRange(){return this._renderCells}ZOrderMoveToTop(){const e=this._inst,t=this._layer,s=t._GetInstances();s.length&&s.at(-1)===e||(t._RemoveInstance(e,!1),t._AddInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToBottom(){const e=this._inst,t=this._layer,s=t._GetInstances();s.length&&s[0]===e||(t._RemoveInstance(e,!1),t._PrependInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToLayer(e){const t=this._inst,s=this._layer;if(s.GetLayout()!==e.GetLayout())throw Error("layer from different layout");e!==s&&(s._RemoveInstance(t,!0),this._SetLayer(e),e._AddInstance(t,!0),this._runtime.UpdateRender())}ZOrderMoveAdjacentToInstance(e,t){const s=this._inst;let i=!1;const r=this._layer;if(e.GetUID()!==s.GetUID()){var n=e.GetWorldInfo();if(!n)throw Error("expected world instance");n=n.GetLayer(),r.GetIndex()!==n.GetIndex()&&(r._RemoveInstance(s,!0),this._SetLayer(n),n._AddInstance(s,!0),i=!0),e=n.MoveInstanceAdjacent(s,e,!!t),(i||e)&&this._runtime.UpdateRender()}}GetInstanceEffectList(){return this._instanceEffectList}_SetHasAnyActiveEffect(e){this._SetFlag(64,e)}HasAnyActiveEffect(){return 0!=(64&this._flags)}_SaveToJson(e){const t={x:this.GetX(),y:this.GetY(),w:this.GetWidth(),h:this.GetHeight(),l:this.GetLayer().GetSID(),zi:this.GetZIndex()};0!==this.GetZElevation()&&(t.ze=this.GetZElevation()),0!==this.GetAngle()&&(t.a=this.GetAngle()),
this.HasDefaultColor()||(t.c=this._color.toJSON()),.5!==this.GetOriginX()&&(t.oX=this.GetOriginX()),.5!==this.GetOriginY()&&(t.oY=this.GetOriginY()),0!==this.GetBlendMode()&&(t.bm=this.GetBlendMode()),this.IsVisible()||(t.v=this.IsVisible()),this.IsCollisionEnabled()||(t.ce=this.IsCollisionEnabled()),this.IsBboxChangeEventEnabled()&&(t.be=this.IsBboxChangeEventEnabled()),this._instanceEffectList&&(t.fx=this._instanceEffectList._SaveToJson());const s=0!=(32&this._flags);return s&&(t.sfi=s),this._solidFilterTags&&(t.sft=[...this._solidFilterTags].join(" ")),this._sceneGraphInfo&&"visual-state"!==e&&(t.sgi=this._sceneGraphInfo._SaveToJson()),this.HasMesh()&&(t.mesh=this.GetSourceMesh().SaveToJson()),t}_OnBeforeLoad(e){"visual-state"!==e&&this._ResetAllSceneGraphState()}_LoadFromJson(e,t){if(u=!1,this.SetX(e.x),this.SetY(e.y),this.SetWidth(e.w),this.SetHeight(e.h),this._SetZIndex(e.zi),this.SetZElevation(e.hasOwnProperty("ze")?e.ze:0),this.SetAngle(e.hasOwnProperty("a")?e.a:0),e.hasOwnProperty("c")?r.setFromJSON(e.c):e.hasOwnProperty("o")?(r.copyRgb(this._color),r.a=e.o):r.setRgba(1,1,1,1),this._SetColor(r),this.SetOriginX(e.hasOwnProperty("oX")?e.oX:.5),this.SetOriginY(e.hasOwnProperty("oY")?e.oY:.5),this.SetBlendMode(e.hasOwnProperty("bm")?e.bm:0),this.SetVisible(!e.hasOwnProperty("v")||e.v),this.SetCollisionEnabled(!e.hasOwnProperty("ce")||e.ce),this.SetBboxChangeEventEnabled(!!e.hasOwnProperty("be")&&e.be),this.SetSolidCollisionFilter(!!e.hasOwnProperty("sfi")&&e.sfi,e.hasOwnProperty("sft")?e.sft:""),this._instanceEffectList&&e.hasOwnProperty("fx")&&this._instanceEffectList._LoadFromJson(e.fx),e.hasOwnProperty("sgi")&&"visual-state"!==t){this._CreateSceneGraphInfo(null);const t=this._sceneGraphInfo,s=e.sgi;t._LoadFromJson(s);const i=this.GetRuntime().Dispatcher(),r=()=>{i.removeEventListener("afterload",r),0==(256&this._flags)&&t._OnAfterLoad(s)};i.addEventListener("afterload",r)}e.hasOwnProperty("mesh")?(e=e.mesh,this.CreateMesh(e.cols,e.rows),this.GetSourceMesh().LoadFromJson(e)):this.ReleaseMesh(),this.SetBboxChanged(),u=!0,this._UpdateRendererStateGroup()}}}{const e=self.C3;e.BehaviorType=class extends e.DefendedBase{constructor(t,s){super();const i=t.GetRuntime(),r=i.GetPluginManager(),n=i.GetObjectReference(s[1]);r.HasBehaviorByConstructorFunction(n)||r.CreateBehavior(s),this._runtime=i,this._objectClass=t,this._behavior=r.GetBehaviorByConstructorFunction(n),this._sdkType=null,this._instSdkCtor=n.Instance,this._sid=s[2],this._name=s[0],this._jsPropName=this._runtime.GetJsPropName(s[3]),this._sdkType=e.New(n.Type,this),this.OnCreate()}static Create(t,s){return e.New(e.BehaviorType,t,s)}Release(){this._behavior=this._runtime=null,this._sdkType.Release(),this._instSdkCtor=this._sdkType=null}GetSdkType(){return this._sdkType}OnCreate(){this._sdkType.OnCreate()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetBehavior(){return this._behavior}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetSID(){return this._sid}GetJsPropName(){return this._jsPropName}}}{const e=self.C3,t=self.IBehaviorInstance;e.BehaviorInstance=class extends e.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._behaviorType=e.behaviorType,this._behavior=this._behaviorType.GetBehavior(),this._inst=e.instance,this._index=e.index,this._iScriptInterface=this._sdkInst=null,this._behavior._AddInstance(this._inst)}Release(){this._iScriptInterface&&(this._iScriptInterface._Release(),this._iScriptInterface=null),this._behavior._RemoveInstance(this._inst),this._sdkInst.Release(),this._inst=this._behavior=this._behaviorType=this._runtime=this._iScriptInterface=this._sdkInst=null}_CreateSdkInstance(t){if(this._sdkInst)throw Error("already got sdk instance");this._sdkInst=e.New(this._behaviorType.GetInstanceSdkCtor(),this,t),this._InitScriptInterface()}GetSdkInstance(){return this._sdkInst}GetObjectInstance(){return this._inst}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetBehavior(){return this._behavior}_GetIndex(){return this._index}PostCreate(){this._sdkInst.PostCreate()}OnSpriteFrameChanged(e,t){this._sdkInst.OnSpriteFrameChanged(e,t)}_GetDebuggerProperties(){return this._sdkInst.GetDebuggerProperties()}SaveToJson(){return this._sdkInst.SaveToJson()}LoadFromJson(e){return this._sdkInst.LoadFromJson(e)}static SortByTickSequence(e,t){var s=e.GetObjectInstance(),i=t.GetObjectInstance();const r=s.GetObjectClass().GetIndex(),n=i.GetObjectClass().GetIndex();return r!==n?r-n:(s=s.GetPUID(),i=i.GetPUID(),s!==i?s-i:e.GetBehaviorInstance()._GetIndex()-t.GetBehaviorInstance()._GetIndex())}_InitScriptInterface(){const e=this._sdkInst.GetScriptInterfaceClass(),s=e||t;if(t._Init(this),this._iScriptInterface=new s,t._Init(null),e&&!(this._iScriptInterface instanceof t))throw new TypeError(`script interface class '${e.name}' does not extend the right base class '${t.name}'`)}GetScriptInterface(){return this._iScriptInterface}}}{const e=self.C3;e.EffectList=class extends e.DefendedBase{constructor(t,s){super(),this._owner=t,this._allEffectTypes=[],this._activeEffectTypes=[],this._effectTypesByName=new Map,this._effectParams=[],this._preservesOpaqueness=!0;for(const i of s)t=e.New(e.EffectType,this,i,this._allEffectTypes.length),this._allEffectTypes.push(t),this._effectTypesByName.set(t.GetName().toLowerCase(),t),3<=i.length&&this._effectParams.push(this._LoadSingleEffectParameters(i[2]));this.GetRuntime()._AddEffectList(this)}Release(){e.clearArray(this._allEffectTypes),e.clearArray(this._activeEffectTypes),this._effectTypesByName.clear(),e.clearArray(this._effectParams),this._owner=null}PrependEffectTypes(e){if(e.length){this._allEffectTypes=e.concat(this._allEffectTypes);for(const t of e)this._effectTypesByName.set(t.GetName().toLowerCase(),t);for(let e=0,t=this._allEffectTypes.length;e<t;++e)this._allEffectTypes[e]._SetIndex(e)}}_LoadSingleEffectParameters(t){t=t.slice(0);for(let s=0,i=t.length;s<i;++s){const i=t[s];if(Array.isArray(i)){const r=e.New(e.Color);r.setFromJSON(i),t[s]=r}}return t}GetOwner(){return this._owner}GetRuntime(){return this._owner.GetRuntime()}UpdateActiveEffects(){e.clearArray(this._activeEffectTypes);let t=!0;for(const e of this._allEffectTypes)e.IsActive()&&(this._activeEffectTypes.push(e),e.GetShaderProgram().PreservesOpaqueness()||(t=!1));this._preservesOpaqueness=t}GetAllEffectTypes(){return this._allEffectTypes}HasAnyEffectType(){return 0<this._allEffectTypes.length}GetEffectTypeByName(e){return this._effectTypesByName.get(e.toLowerCase())||null}GetEffectTypeByIndex(e){if(e=Math.floor(+e),0>e||e>=this._allEffectTypes.length)throw new RangeError("invalid effect type index");return this._allEffectTypes[e]}IsEffectIndexActive(e){return this.GetEffectTypeByIndex(e).IsActive()}SetEffectIndexActive(e,t){this.GetEffectTypeByIndex(e).SetActive(t)}GetActiveEffectTypes(){return this._activeEffectTypes}HasAnyActiveEffect(){return 0<this._activeEffectTypes.length}PreservesOpaqueness(){return this._preservesOpaqueness}GetEffectParametersForIndex(e){return this._effectParams[e]}static SaveFxParamToJson(t){return t&&t instanceof e.Color?{t:"color",v:t.toJSON()}:t}static LoadFxParamFromJson(t){if("object"==typeof t){if("color"===t.t){const s=e.New(e.Color);return s.setFromJSON(t.v),s}throw Error("invalid effect parameter type")}return t}static SaveFxParamsToJson(t){return t.map(e.EffectList.SaveFxParamToJson)}static LoadFxParamsFromJson(t){return t.map(e.EffectList.LoadFxParamFromJson)}SaveToJson(){return this._allEffectTypes.map(t=>({name:t.GetName(),active:t.IsActive(),params:e.EffectList.SaveFxParamsToJson(this._effectParams[t.GetIndex()])}))}LoadFromJson(t){for(const s of t)(t=this.GetEffectTypeByName(s.name))&&(t.SetActive(s.active),this._effectParams[t.GetIndex()]=e.EffectList.LoadFxParamsFromJson(s.params));this.UpdateActiveEffects()}}}{const e=self.C3;e.EffectType=class extends e.DefendedBase{constructor(e,t,s){super(),this._effectList=e,this._id=t[0],this._name=t[1],this._index=s,this._shaderProgram=null,this._isActive=!0}Release(){this._shaderProgram=this._effectList=null}Clone(t){return t=e.New(e.EffectType,t,[this._id,this._name],-1),t._shaderProgram=this._shaderProgram,t._isActive=this._isActive,t}_InitRenderer(e){if(e=e.GetShaderProgramByName(this._id),!e)throw Error("failed to find shader program '"+this._id+"'");this._shaderProgram=e}GetEffectList(){return this._effectList}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}GetOwner(){return this._effectList.GetOwner()}GetRuntime(){return this._effectList.GetRuntime()}SetActive(e){this._isActive=!!e}IsActive(){return this._isActive}GetShaderProgram(){return this._shaderProgram}GetDefaultParameterValues(){const t=[];for(let s=0,i=this._shaderProgram.GetParameterCount();s<i;++s){const i=this._shaderProgram.GetParameterType(s);if("float"===i||"percent"===i)t.push(0);else{if("color"!==i)throw new TypeError("unknown effect parameter type");t.push(e.New(e.Color,1,1,1,1))}}return t}}}{const e=self.C3;e.InstanceEffectList=class extends e.DefendedBase{constructor(t,s){super(),this._inst=t,this._wi=s,this._effectList=t.GetObjectClass().GetEffectList(),this._wasDefaultColor=this._needsRebuildSteps=!0,this._wasTexRotated=this._wasRotatedOrNegativeSize=this._was3D=!1,this._effectChain=e.New(e.Gfx.EffectChain,t.GetRuntime().GetCanvasManager().GetEffectChainManager(),{drawContent:(e,t)=>{t=t.GetContentObject();const s=t.GetWorldInfo();e.SetColor(s.GetPremultipliedColor()),e.SetCurrentZ(s.GetTotalZElevation()),t.Draw(e),e.SetCurrentZ(0)},getSourceTextureInfo:e=>{const t=e.GetCurrentTexRect(),[s,i]=e.GetCurrentSurfaceSize();return{srcTexRect:t,srcWidth:s,srcHeight:i}},getShaderParameters:e=>this.GetEffectParametersForIndex(e)}),this._activeEffectFlags=[],this._activeEffectTypes=[],this._preservesOpaqueness=!0,this._effectParams=[];for(const e of this._effectList.GetAllEffectTypes())this._activeEffectFlags.push(!0);this.UpdateActiveEffects()}Release(){this._effectChain.Release(),this._effectChain=null,e.clearArray(this._activeEffectFlags),e.clearArray(this._activeEffectTypes),e.clearArray(this._effectParams),this._effectList=this._inst=null}_LoadEffectParameters(e){for(const t of e)this._effectParams.push(this._LoadSingleEffectParameters(t))}_LoadSingleEffectParameters(t){t=t.slice(0);for(let s=0,i=t.length;s<i;++s){const i=t[s];if(Array.isArray(i)){const r=e.New(e.Color);r.setFromJSON(i),t[s]=r}}return t}LoadDefaultEffectParameters(){for(const e of this._effectList.GetAllEffectTypes())this._effectParams.push(e.GetDefaultParameterValues())}GetOwner(){return this._owner}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}GetRuntime(){return this._inst.GetRuntime()}UpdateActiveEffects(){e.clearArray(this._activeEffectTypes);const t=this._wi,s=this._effectList.GetAllEffectTypes(),i=this._activeEffectTypes,r=this._activeEffectFlags;let n=!0;for(let e=0,t=s.length;e<t;++e)if(r[e]){const t=s[e];i.push(t),t.GetShaderProgram().PreservesOpaqueness()||(n=!1)}this._preservesOpaqueness=n,t._SetHasAnyActiveEffect(!!i.length),this._needsRebuildSteps=!0}_MaybeRebuildEffectChainSteps(){const e=this._inst;var t=this._wi;const s=t.HasDefaultColor(),i=0<t.GetDepth();t=0!==t.GetAngle()||0>t.GetWidth()||0>t.GetHeight();const r=e.IsCurrentTexRotated();(this._needsRebuildSteps||s!==this._wasDefaultColor||i!==this._was3D||t!==this._wasRotatedOrNegativeSize||r!==this._wasTexRotated)&&(this._effectChain.BuildSteps(this._activeEffectTypes.map(e=>e.GetShaderProgram()),{indexMap:this._activeEffectTypes.map(e=>e.GetIndex()),forcePreDraw:!s||e.MustPreDraw(),is3D:i,isSourceTextureRotated:r,isRotatedOrNegativeSizeInstance:t}),this._needsRebuildSteps=!1,this._wasDefaultColor=s,this._was3D=i,this._wasRotatedOrNegativeSize=t,this._wasTexRotated=r)}GetActiveEffectTypes(){return this._activeEffectTypes}GetEffectParametersForIndex(e){return this._effectParams[e]}PreservesOpaqueness(){return this._preservesOpaqueness}HasAnyActiveBackgroundBlendingEffect(){return this._activeEffectTypes.some(e=>e.GetShaderProgram().BlendsBackground())}IsEffectIndexActive(e){return this._activeEffectFlags[e]}SetEffectIndexActive(e,t){this._activeEffectFlags[e]=!!t}GetAllEffectTypes(){return this._effectList.GetAllEffectTypes()}_SaveToJson(){return this._effectList.GetAllEffectTypes().map(t=>({name:t.GetName(),active:this._activeEffectFlags[t.GetIndex()],params:e.EffectList.SaveFxParamsToJson(this._effectParams[t.GetIndex()])}))}_LoadFromJson(t){for(const s of t)(t=this._effectList.GetEffectTypeByName(s.name))&&(this._activeEffectFlags[t.GetIndex()]=s.active,this._effectParams[t.GetIndex()]=e.EffectList.LoadFxParamsFromJson(s.params));this.UpdateActiveEffects()}}}{const e=self.C3,t=[],s=[],i=[],r=e.New(e.CollisionPoly),n=e.New(e.CollisionPoly),a=e.New(e.Quad),o=e.New(e.Rect),h=e.New(e.Rect);let l=null,c=null,u=null;e.CollisionEngine=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._registeredCollisions=[],this._polyCheckSec=this._polyCheckCount=this._collisionCheckSec=this._collisionCheckCount=0}Release(){this._runtime=null}_Update1sStats(){this._collisionCheckSec=this._collisionCheckCount,this._collisionCheckCount=0,this._polyCheckSec=this._polyCheckCount,this._polyCheckCount=0}Get1secCollisionChecks(){return this._collisionCheckSec}Get1secPolyChecks(){return this._polyCheckSec}RegisterCollision(e,t){const s=e.GetWorldInfo(),i=t.GetWorldInfo();s&&i&&s.IsCollisionEnabled()&&i.IsCollisionEnabled()&&this._registeredCollisions.push([e,t])}AddRegisteredCollisionCandidates(e,t,s){for(const[i,r]of this._registeredCollisions){let n;if(e===i)n=r;else{if(e!==r)continue;n=i}n.BelongsToObjectClass(t)&&(s.includes(n)||s.push(n))}}CheckRegisteredCollision(e,t){if(!this._registeredCollisions.length)return!1;for(const[s,i]of this._registeredCollisions)if(e===s&&t===i||e===i&&t===s)return!0;return!1}ClearRegisteredCollisions(){e.clearArray(this._registeredCollisions)}TestOverlap(e,t){if(!e||!t||e===t)return!1;if(e=e.GetWorldInfo(),t=t.GetWorldInfo(),!e.IsCollisionEnabled()||!t.IsCollisionEnabled())return!1;this._collisionCheckCount++;const s=e.GetLayer(),i=t.GetLayer();return s.IsTransformCompatibleWith(i)?this._TestOverlap_SameLayers(e,t):this._TestOverlap_DifferentLayers(e,t)}_TestOverlap_SameLayers(e,t){if(!e.GetBoundingBox().intersectsRect(t.GetBoundingBox()))return!1;if(this._polyCheckCount++,!e.GetBoundingQuad().intersectsQuad(t.GetBoundingQuad())||e.HasTilemap()&&t.HasTilemap())return!1;if(e.HasTilemap())return this.TestTilemapOverlap(e,t);if(t.HasTilemap())return this.TestTilemapOverlap(t,e);if(!e.HasOwnCollisionPoly()&&!t.HasOwnCollisionPoly())return!0;const s=e.GetTransformedCollisionPoly(),i=t.GetTransformedCollisionPoly();return s.intersectsPoly(i,t.GetX()-e.GetX(),t.GetY()-e.GetY())}_TestOverlap_DifferentLayers(e,t){var s=e.HasTilemap(),i=t.HasTilemap();if(s&&!i)return this.TestTilemapOverlapDifferentLayers(e,t);if(i&&!s)return this.TestTilemapOverlapDifferentLayers(t,e);if(i||s)return!1;i=e.GetLayer(),s=t.GetLayer(),r.copy(e.GetTransformedCollisionPoly()),n.copy(t.GetTransformedCollisionPoly());var a=r.pointsArr();for(let t=0,s=a.length;t<s;t+=2){const s=t+1,r=a[s],[n,o]=i.LayerToCanvasCss(a[t]+e.GetX(),r+e.GetY());a[t]=n,a[s]=o}e=n.pointsArr();for(let r=0,n=e.length;r<n;r+=2){i=r+1,a=e[i];const[n,o]=s.LayerToCanvasCss(e[r]+t.GetX(),a+t.GetY());e[r]=n,e[i]=o}return r.setBboxChanged(),n.setBboxChanged(),this._polyCheckCount++,r.intersectsPoly(n,0,0)}TestTilemapOverlapDifferentLayers(t,s){var i=t.GetLayer(),r=s.GetLayer();l||(l=e.New(e.CollisionPoly)),c||(c=e.New(e.Rect)),u||(u=e.New(e.Quad));var n=s.GetX(),a=s.GetY();const[o,h]=r.LayerToCanvasCss(n,a),[_,d]=i.CanvasCssToLayer(o,h);if(i=_-n,a=d-a,c.copy(s.GetBoundingBox()),c.offset(i,a),!t.GetBoundingBox().intersectsRect(c))return!1;if(u.copy(s.GetBoundingQuad()),u.offset(i,a),this._polyCheckCount++,!t.GetBoundingQuad().intersectsQuad(u))return!1;l.copy(s.GetTransformedCollisionPoly()),r=l.pointsArr();for(let e=0,t=r.length;e<t;e+=2)n=e+1,r[e]+=i,r[n]+=a;return l.setBboxChanged(),this.TestTilemapOverlap(t,s,_,d,l,c,u)}TestTilemapOverlap(t,i,n,o,h,l,c){l=void 0!==l?l:i.GetBoundingBox();const u=t.GetX(),_=t.GetY();var d=t.GetInstance().GetSdkInstance();n=void 0!==n?n:i.GetX(),o=void 0!==o?o:i.GetY(),t=i.HasOwnCollisionPoly(),c=void 0!==c?c:i.GetBoundingQuad(),d.GetCollisionRectCandidates(l,s);for(let m=0,f=s.length;m<f;++m){var p=s[m];if(d=p.GetRect(),this._collisionCheckCount++,l.intersectsRectOffset(d,u,_)&&(a.setFromRect(d),a.offset(u,_),a.intersectsQuad(c)))if(t){var g=void 0!==h?h:i.GetTransformedCollisionPoly();if(p=p.GetPoly()){if(this._polyCheckCount++,p.intersectsPoly(g,n-(u+d.getLeft()),o-(_+d.getTop())))return e.clearArray(s),!0}else if(r.setFromQuad(a,0,0),r.intersectsPoly(g,n,o))return e.clearArray(s),!0}else{if(!(g=p.GetPoly()))return e.clearArray(s),!0;if(r.setFromQuad(c,0,0),g.intersectsPoly(r,-(u+d.getLeft()),-(_+d.getTop())))return e.clearArray(s),!0}}return e.clearArray(s),!1}TestAndSelectCanvasPointOverlap(t,s,i,r){const n=t.GetCurrentSol();var a=this._runtime.GetCurrentEvent();if(!a)throw Error("cannot call outside event");if(a=a.IsOrBlock(),n.IsSelectAll())for(var o of(r||(n._SetSelectAll(!1),e.clearArray(n._GetOwnInstances())),t.GetInstances())){var h=o.GetWorldInfo(),l=h.GetLayer();const[e,t]=l.CanvasCssToLayer(s,i,h.GetTotalZElevation());if(h.ContainsPoint(e,t)){if(r)return!1;n._PushInstance(o)}else a&&n._PushElseInstance(o)}else{h=!1,a?this._runtime.IsCurrentConditionFirst()&&!n._GetOwnElseInstances().length&&n._GetOwnInstances().length?o=n._GetOwnInstances():(o=n._GetOwnElseInstances(),h=!0):o=n._GetOwnInstances(),l=0;for(let e=0,t=o.length;e<t;++e){const t=o[e],c=t.GetWorldInfo(),u=c.GetLayer(),[_,d]=u.CanvasCssToLayer(s,i,c.GetTotalZElevation());if(c.ContainsPoint(_,d)){if(r)return!1;h?n._PushInstance(t):o[l++]=t}else h?o[l++]=t:a&&n._PushElseInstance(t)}r||(o.length=l)}return t.ApplySolToContainer(),!!r||n.HasAnyInstances()}GetCollisionCandidates(t,s,i,r){if(t=!!t&&(1!==t.GetParallaxX()||1!==t.GetParallaxY()),s.IsFamily())for(const n of s.GetFamilyMembers())t||n.IsAnyInstanceParallaxed()?e.appendArray(r,n.GetInstances()):(n._UpdateAllCollisionCells(),n._GetCollisionCellGrid().QueryRange(i,r));else t||s.IsAnyInstanceParallaxed()?e.appendArray(r,s.GetInstances()):(s._UpdateAllCollisionCells(),s._GetCollisionCellGrid().QueryRange(i,r))}GetObjectClassesCollisionCandidates(e,t,s,i){for(const r of t)this.GetCollisionCandidates(e,r,s,i)}GetSolidCollisionCandidates(e,t,s){const i=this._runtime.GetSolidBehavior();i&&this.GetObjectClassesCollisionCandidates(e,i.GetObjectClasses(),t,s)}GetJumpthruCollisionCandidates(e,t,s){const i=this._runtime.GetJumpthruBehavior();i&&this.GetObjectClassesCollisionCandidates(e,i.GetObjectClasses(),t,s)}IsSolidCollisionAllowed(e,t){return e._IsSolidEnabled()&&(!t||t.GetWorldInfo().IsSolidCollisionAllowed(e.GetSavedDataMap().get("solidTags")))}TestOverlapSolid(s){const i=s.GetWorldInfo();this.GetSolidCollisionCandidates(i.GetLayer(),i.GetBoundingBox(),t);for(const i of t)if(this.IsSolidCollisionAllowed(i,s)&&this.TestOverlap(s,i))return e.clearArray(t),i;return e.clearArray(t),null}TestRectOverlapSolid(s,i){this.GetSolidCollisionCandidates(null,s,t);for(const r of t)if(this.IsSolidCollisionAllowed(r,i)&&this.TestRectOverlap(s,r))return e.clearArray(t),r;return e.clearArray(t),null}TestOverlapJumpthru(s,r){let n=null;r&&(n=i,e.clearArray(n));const a=s.GetWorldInfo();this.GetJumpthruCollisionCandidates(a.GetLayer(),a.GetBoundingBox(),t);for(const i of t)if(i._IsJumpthruEnabled()&&this.TestOverlap(s,i)){if(!r)return e.clearArray(t),i;n.push(i)}return e.clearArray(t),n}PushOut(e,t,s,i,r){i=i||50;const n=e.GetWorldInfo(),a=n.GetX(),o=n.GetY();for(let h=0;h<i;++h)if(n.SetXY(a+t*h,o+s*h),n.SetBboxChanged(),!this.TestOverlap(e,r))return!0;return n.SetXY(a,o),n.SetBboxChanged(),!1}PushOutSolid(e,t,s,i,r,n){i=i||50;const a=e.GetWorldInfo(),o=a.GetX(),h=a.GetY();let l=null,c=null;for(let u=0;u<i;++u)if(a.SetXY(o+t*u,h+s*u),a.SetBboxChanged(),!this.TestOverlap(e,l))if(l=this.TestOverlapSolid(e))c=l;else if(r&&(l=n?this.TestOverlap(e,n)?n:null:this.TestOverlapJumpthru(e))&&(c=l),!l)return c&&this.PushInFractional(e,t,s,c,16,!0),!0;return a.SetXY(o,h),a.SetBboxChanged(),!1}PushOutSolidAxis(e,t,s,i){i=i||50;const r=e.GetWorldInfo(),n=r.GetX(),a=r.GetY();let o=null,h=null;for(let l=0;l<i;++l)for(let i=0;2>i;++i){const c=2*i-1;if(r.SetXY(n+t*l*c,a+s*l*c),r.SetBboxChanged(),!this.TestOverlap(e,o)){if(!(o=this.TestOverlapSolid(e)))return h&&this.PushInFractional(e,t*c,s*c,h,16,!0),!0;h=o}}return r.SetXY(n,a),r.SetBboxChanged(),!1}PushInFractional(e,t,s,i,r,n){let a=2,o=!1;var h=!1;const l=e.GetWorldInfo();let c=l.GetX(),u=l.GetY();for(;a<=r;)h=1/a,a*=2,l.OffsetXY(t*h*(o?1:-1),s*h*(o?1:-1)),l.SetBboxChanged(),this.TestOverlap(e,i)||n&&this.TestOverlapSolid(e)?h=o=!0:(h=o=!1,c=l.GetX(),u=l.GetY());h&&(l.SetXY(c,u),l.SetBboxChanged())}PushOutSolidNearest(e,t=100){let s=0;const i=e.GetWorldInfo(),r=i.GetX(),n=i.GetY();let a=0,o=this.TestOverlapSolid(e);if(!o)return!0;for(;s<=t;){let t=0,h=0;switch(a){case 0:t=0,h=-1,s++;break;case 1:t=1,h=-1;break;case 2:t=1,h=0;break;case 3:h=t=1;break;case 4:t=0,h=1;break;case 5:t=-1,h=1;break;case 6:t=-1,h=0;break;case 7:h=t=-1}if(a=(a+1)%8,i.SetXY(Math.floor(r+t*s),Math.floor(n+h*s)),i.SetBboxChanged(),!this.TestOverlap(e,o)&&(o=this.TestOverlapSolid(e),!o))return!0}return i.SetXY(r,n),i.SetBboxChanged(),!1}CalculateBounceAngle(t,s,i,r){const n=t.GetWorldInfo(),a=n.GetX(),o=n.GetY(),h=Math.max(10,e.distanceTo(s,i,a,o));var l=e.angleTo(s,i,a,o),c=r||this.TestOverlapSolid(t);if(!c)return e.clampAngle(l+Math.PI);let u=c;var _=0,d=0;const p=e.toRadians(5);let g;for(g=1;36>g;++g){const e=l-g*p;if(n.SetXY(s+Math.cos(e)*h,i+Math.sin(e)*h),n.SetBboxChanged(),!this.TestOverlap(t,u)&&(u=r?null:this.TestOverlapSolid(t),!u)){_=e;break}}for(36===g&&(_=e.clampAngle(l+Math.PI)),u=c,g=1;36>g;++g)if(c=l+g*p,n.SetXY(s+Math.cos(c)*h,i+Math.sin(c)*h),n.SetBboxChanged(),!this.TestOverlap(t,u)&&(u=r?null:this.TestOverlapSolid(t),!u)){d=c;break}return 36===g&&(d=e.clampAngle(l+Math.PI)),n.SetXY(a,o),n.SetBboxChanged(),d===_?d:(t=e.angleDiff(d,_)/2,t=e.angleClockwise(d,_)?e.clampAngle(_+t+Math.PI):e.clampAngle(d+t),_=Math.cos(l),l=Math.sin(l),d=Math.cos(t),t=Math.sin(t),s=_*d+l*t,e.angleTo(0,0,_-2*s*d,l-2*s*t))}TestSegmentOverlap(e,t,s,i,r){if(!r)return!1;const n=r.GetWorldInfo();return!!n.IsCollisionEnabled()&&(this._collisionCheckCount++,o.set(Math.min(e,s),Math.min(t,i),Math.max(e,s),Math.max(t,i)),!!n.GetBoundingBox().intersectsRect(o)&&(r.HasTilemap()?this._TestSegmentOverlapTilemap(e,t,s,i,r,n):(this._polyCheckCount++,!!n.GetBoundingQuad().intersectsSegment(e,t,s,i)&&(!n.HasOwnCollisionPoly()||n.GetTransformedCollisionPoly().intersectsSegment(n.GetX(),n.GetY(),e,t,s,i)))))}_TestSegmentOverlapTilemap(t,i,r,n,l,c){const u=c.GetX();c=c.GetY(),l=l.GetSdkInstance(),h.set(t,i,r,n),h.normalize(),l.GetCollisionRectCandidates(h,s);for(let h=0,d=s.length;h<d;++h){var _=s[h];if(l=_.GetRect(),this._collisionCheckCount++,o.intersectsRectOffset(l,u,c)&&(a.setFromRect(l),a.offset(u,c),a.intersectsSegment(t,i,r,n))){if(!(_=_.GetPoly()))return e.clearArray(s),!0;if(this._polyCheckCount++,_.intersectsSegment(u+l.getLeft(),c+l.getTop(),t,i,r,n))return e.clearArray(s),!0}}return e.clearArray(s),!1}TestRectOverlap(e,t){if(!t)return!1;const s=t.GetWorldInfo();return!!s.IsCollisionEnabled()&&(this._collisionCheckCount++,!!s.GetBoundingBox().intersectsRect(e)&&(t.HasTilemap()?this._TestRectOverlapTilemap(e,t,s):(this._polyCheckCount++,a.setFromRect(e),!!s.GetBoundingQuad().intersectsQuad(a)&&(!s.HasOwnCollisionPoly()||(r.setFromRect(e,s.GetX(),s.GetY()),e=s.GetTransformedCollisionPoly(),r.intersectsPoly(e,0,0))))))}_TestRectOverlapTilemap(t,i,n){const a=n.GetX();n=n.GetY(),i.GetSdkInstance().GetCollisionRectCandidates(t,s);for(let h=0,l=s.length;h<l;++h){var o=s[h];if(i=o.GetRect(),this._collisionCheckCount++,t.intersectsRectOffset(i,a,n)){if(!(o=o.GetPoly()))return e.clearArray(s),!0;if(this._polyCheckCount++,r.setFromRect(t,0,0),o.intersectsPoly(r,-(a+i.getLeft()),-(n+i.getTop())))return e.clearArray(s),!0}}return e.clearArray(s),!1}TestRayIntersectsInstance(e,t){if(e){var s=e.GetWorldInfo();s.IsCollisionEnabled()&&(this._collisionCheckCount++,s.GetBoundingBox().intersectsRect(t.rect)&&(e.HasTilemap()?this._TestRayIntersectsTilemap(e,s,t):(this._polyCheckCount++,s.HasOwnCollisionPoly()?t.TestInstancePoly(e,s.GetX(),s.GetY(),s.GetTransformedCollisionPoly()):t.TestInstanceQuad(e,s.GetBoundingQuad()))))}}_TestRayIntersectsTilemap(t,i,r){const n=i.GetX(),a=i.GetY();t.GetSdkInstance().GetCollisionRectCandidates(r.rect,s);for(let e=0,h=s.length;e<h;e++){var o=s[e];const h=o.GetRect();this._collisionCheckCount++,r.rect.intersectsRectOffset(h,n,a)&&(o=o.GetPoly(),this._polyCheckCount++,o?r.TestInstancePoly(t,n+h.getLeft(),a+h.getTop(),o):r.TestInstanceRect(t,i.GetX(),i.GetY(),h))}e.clearArray(s)}}}{const e=self.C3;e.SparseGrid=class extends e.DefendedBase{constructor(t,s){super(),this._cellWidth=t,this._cellHeight=s,this._cells=e.New(e.PairMap)}Release(){this._cells.Release(),this._cells=null}GetCell(t,s,i){let r=this._cells.Get(t,s);return r||(i?(r=e.New(e.GridCell,this,t,s),this._cells.Set(t,s,r),r):null)}XToCell(e){return e=Math.floor(e/this._cellWidth),isFinite(e)?e:0}YToCell(e){return e=Math.floor(e/this._cellHeight),isFinite(e)?e:0}Update(e,t,s){if(t)for(let i=t.getLeft(),r=t.getRight();i<=r;++i)for(let r=t.getTop(),n=t.getBottom();r<=n;++r){if(s&&s.containsPoint(i,r))continue;const t=this.GetCell(i,r,!1);t&&(t.Remove(e),t.IsEmpty()&&this._cells.Delete(i,r))}if(s)for(let i=s.getLeft(),r=s.getRight();i<=r;++i)for(let r=s.getTop(),n=s.getBottom();r<=n;++r)t&&t.containsPoint(i,r)||this.GetCell(i,r,!0).Insert(e)}QueryRange(e,t){let s=this.XToCell(e.getLeft());const i=this.YToCell(e.getTop()),r=this.XToCell(e.getRight());if(e=this.YToCell(e.getBottom()),isFinite(r)&&isFinite(e))for(;s<=r;++s)for(let r=i;r<=e;++r){const e=this.GetCell(s,r,!1);e&&e.Dump(t)}}}}{const e=self.C3;e.GridCell=class extends e.DefendedBase{constructor(t,s,i){super(),this._grid=t,this._x=s,this._y=i,this._instances=e.New(e.ArraySet)}Release(){this._instances.Release(),this._grid=this._instances=null}IsEmpty(){return this._instances.IsEmpty()}Insert(e){this._instances.Add(e)}Remove(e){this._instances.Delete(e)}Dump(t){e.appendArray(t,this._instances.GetArray())}}}{const e=self.C3;e.Ray=class{constructor(){this.dy=this.dx=this.y2=this.x2=this.y1=this.x1=0,this.rect=new e.Rect,this.hitFraction=2,this.hitUid=null,this.distance=this.hitY=this.hitX=this.hitNormalDy=this.hitNormalDx=this.hitNormal=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0}DidCollide(){return 1.000001>this.hitFraction}Set(e,t,s,i){return this.x1=e,this.y1=t,this.x2=s,this.y2=i,this.dx=s-e,this.dy=i-t,this.rect.set(e,t,s,i),this.rect.normalize(),this.hitFraction=2,this.hitUid=null,this.distance=this.hitY=this.hitX=this.hitNormalDy=this.hitNormalDx=this.hitNormal=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0,this}Complete(){if(!1!==this.DidCollide()){var t=this.dx*this.hitFraction,s=this.dy*this.hitFraction,i=Math.sqrt(t*t+s*s);t/=i,s/=i,this.distance=i-1e-6,this.hitX=this.x1+t*this.distance,this.hitY=this.y1+s*this.distance,this.hitNormal=Math.atan2(this.hitNormalDy,this.hitNormalDx)+Math.PI/2,this.normalX=Math.cos(this.hitNormal),this.normalY=Math.sin(this.hitNormal),i=t*this.normalX+s*this.normalY,this.reflectionX=t-2*this.normalX*i,this.reflectionY=s-2*this.normalY*i,0<i&&(this.hitNormal=e.clampAngle(this.hitNormal+Math.PI),this.normalX=-this.normalX,this.normalY=-this.normalY)}}TestInstanceSegment(t,s,i,r,n){const a=e.rayIntersect(this.x1,this.y1,this.x2,this.y2,s,i,r,n);0<=a&&a<this.hitFraction&&(this.hitFraction=a,this.hitUid=t.GetUID(),this.hitNormalDx=s-r,this.hitNormalDy=i-n)}TestInstanceRect(e,t,s,i){const r=t+i.getLeft();t+=i.getRight();const n=s+i.getTop();s+=i.getBottom(),this.TestInstanceSegment(e,r,n,t,n),this.TestInstanceSegment(e,t,n,t,s),this.TestInstanceSegment(e,t,s,r,s),this.TestInstanceSegment(e,r,s,r,n)}TestInstanceQuad(e,t){const s=t.getTlx(),i=t.getTly(),r=t.getTrx(),n=t.getTry(),a=t.getBrx(),o=t.getBry(),h=t.getBlx();t=t.getBly(),this.TestInstanceSegment(e,s,i,r,n),this.TestInstanceSegment(e,r,n,a,o),this.TestInstanceSegment(e,a,o,h,t),this.TestInstanceSegment(e,h,t,s,i)}TestInstancePoly(e,t,s,i){i=i.pointsArr();for(let r=0,n=i.length;r<n;r+=2){const a=(r+2)%n;this.TestInstanceSegment(e,i[r]+t,i[r+1]+s,i[a]+t,i[a+1]+s)}}}}{const e=self.C3,t=new Set("off crop scale-inner scale-outer letterbox-scale letterbox-integer-scale".split(" ")),s=new Set(["high","low"]),i=self.glMatrix.mat4,r=i.create(),n=e.New(e.Quad),a=e.New(e.Rect);e.CanvasManager=class extends e.DefendedBase{constructor(t){super(),this._runtime=t,this._canvas=null,this._isWebGPUEnabled=!1,this._webgpuRenderer=this._webglRenderer=null,this._gpuPreference="high-performance",this._canvasCssOffsetY=this._canvasCssOffsetX=this._canvasDeviceHeight=this._canvasDeviceWidth=this._canvasCssHeight=this._canvasCssWidth=this._windowInnerHeight=this._windowInnerWidth=0,this._enableMipmaps=!0,this._drawHeight=this._drawWidth=this._textureAnisotropy=0,this._documentFullscreenMode=this._fullscreenMode="letterbox-scale",this._deviceTransformOffY=this._deviceTransformOffX=0,this._defaultProjectionMatrix=i.create(),this._fullscreenScalingQuality=this._wantFullscreenScalingQuality="high",this._isDocumentFullscreen=!1,this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets=new Set,this._shaderData=self.C3_Shaders,this._effectChainManager=e.New(e.Gfx.EffectChainManager,{getDrawSize:()=>[this.GetDrawWidth(),this.GetDrawHeight()],getRenderTarget:()=>this.GetEffectCompositorRenderTarget(),releaseRenderTarget:e=>this.ReleaseEffectCompositorRenderTarget(e),getTime:()=>this.GetRuntime().GetGameTime(),redraw:()=>this.GetRuntime().UpdateRender()}),this._gpuTimeEndFrame=this._gpuTimeStartFrame=0,this._gpuLastUtilisation=NaN,this._gpuFrameTimingsBuffer=null,this._layersGpuProfile=new Map,this._gpuCurUtilisation=NaN,this._webgpuFrameTimings=new Map,this._snapshotFormat="",this._snapshotQuality=1,this._snapshotArea=e.New(e.Rect),this._snapshotUrl="",this._snapshotResolve=this._snapshotPromise=null,this._loaderStartTime=this._isPastingToDrawingCanvas=0,this._rafId=-1,this._loadingProgress=0,this._loadingprogress_handler=(e=>this._loadingProgress=e.progress),this._percentText=null,this._splashTextures={logo:null,powered:null,website:null},this._splashFadeOutStartTime=this._splashFadeInFinishTime=this._splashFrameNumber=0,this._splashState="fade-in",this._splashDoneResolve=null,this._splashDonePromise=new Promise(e=>this._splashDoneResolve=e)}_SetGPUPowerPreference(e){this._gpuPreference=e}_SetWebGPUEnabled(e){this._isWebGPUEnabled=!!e}async CreateCanvas(e){this._canvas=e.canvas,this._runtime.AddDOMComponentMessageHandler("runtime","window-resize",e=>this._OnWindowResize(e)),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenchange",e=>this._OnFullscreenChange(e)),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenerror",e=>this._OnFullscreenError(e)),this._canvas.addEventListener("webglcontextlost",e=>this._OnWebGLContextLost(e)),this._canvas.addEventListener("webglcontextrestored",e=>this._OnWebGLContextRestored(e)),this._isDocumentFullscreen=!!e.isFullscreen;var t=navigator.gpu&&this._isWebGPUEnabled;let s=!1;if(t)try{await this._InitWebGPUContext(!0)}catch(e){this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!0)}catch(e){this._webglRenderer=null}if(this.GetRenderer()||(s=!0),!this.GetRenderer()&&t)try{await this._InitWebGPUContext(!1)}catch(e){this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!1)}catch(e){this._webglRenderer=null}if(t=this.GetRenderer(),
!t)throw Error("failed to acquire a renderer - check WebGL or WebGPU is supported");t.SetHasMajorPerformanceCaveat(s),this.SetSize(e.windowInnerWidth,e.windowInnerHeight,!0),this._webgpuRenderer?await this._InitWebGPU():this._webglRenderer&&await this._InitWebGL(),t.SetMipmapsEnabled(this._enableMipmaps),t.SupportsGPUProfiling()&&(this._gpuLastUtilisation=0);for(const e of this._runtime._GetAllEffectLists()){for(const s of e.GetAllEffectTypes())s._InitRenderer(t);e.UpdateActiveEffects()}}async _InitWebGPUContext(t){t={powerPreference:this._gpuPreference,depth:this._runtime.Uses3DFeatures(),failIfMajorPerformanceCaveat:t,canSampleBackbuffer:this._runtime.UsesAnyBackgroundBlending(),canSampleDepth:this._runtime.UsesAnyDepthSampling()},this._webgpuRenderer=e.New(e.Gfx.WebGPURenderer),await this._webgpuRenderer.Create(this._canvas,t)}async _InitWebGLContext(t){t={powerPreference:this._gpuPreference,enableGpuProfiling:!0,depth:this._runtime.Uses3DFeatures(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),failIfMajorPerformanceCaveat:t},"Android"===e.Platform.OS&&"Chromium"===e.Platform.BrowserEngine&&75>e.Platform.BrowserVersionNumber&&(console.warn("[Construct 3] Disabling WebGL 2 because this device appears to be affected by crbug.com/934823. Install software updates to avoid this."),t.maxWebGLVersion=1),"standard"===this._runtime.GetCompositingMode()?t.alpha=!0:(t.alpha=!1,t.lowLatency=!0),this._webglRenderer=e.New(e.Gfx.WebGLRenderer,this._canvas,t),await this._webglRenderer.InitState()}async _InitWebGPU(){if(this._shaderData){const t=[];for(const[s,i]of Object.entries(this._shaderData)){i.src=i.wgsl;const r=e.Gfx.WebGPUShaderProgram.GetDefaultVertexShaderSource();t.push(this._webgpuRenderer.CreateShaderProgram(i,r,s))}await Promise.all(t)}}async _InitWebGL(){if(this._shaderData){const t=[];for(const[s,i]of Object.entries(this._shaderData)){i.src=i.glsl;const r=e.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource();t.push(this._webglRenderer.CreateShaderProgram(i,r,s))}await Promise.all(t),this._webglRenderer.ResetLastProgram(),this._webglRenderer.SetTextureFillMode()}this._webglRenderer.SupportsGPUProfiling()&&(this._gpuFrameTimingsBuffer=e.New(e.Gfx.WebGLQueryResultBuffer,this._webglRenderer))}Release(){this._canvas=this._webglRenderer=this._runtime=null}_OnWindowResize(e){const t=this._runtime,s=e.devicePixelRatio;t.IsInWorker()&&(self.devicePixelRatio=s),t._SetDevicePixelRatio(s),this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight),t.UpdateRender(),t.IsDebug()&&(t.HitBreakpoint()||self.C3Debugger.IsDebuggerPaused())&&t.Render()}_OnFullscreenChange(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}_OnFullscreenError(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}SetSize(t,s,i=!1){if(t=Math.floor(t),s=Math.floor(s),0>=t||0>=s)throw Error("invalid size");if(this._windowInnerWidth!==t||this._windowInnerHeight!==s||i){for(var r of(this._windowInnerWidth=t,this._windowInnerHeight=s,i=this.GetCurrentFullscreenMode(),"letterbox-scale"===i?this._CalculateLetterboxScale(t,s):"letterbox-integer-scale"===i?this._CalculateLetterboxIntegerScale(t,s):"off"===i?this._CalculateFixedSizeCanvas(t,s):this._CalculateFullsizeCanvas(t,s),this._UpdateFullscreenScalingQuality(i),this._canvas.width=this._canvasDeviceWidth,this._canvas.height=this._canvasDeviceHeight,this._runtime.PostComponentMessageToDOM("canvas","update-size",{marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight}),t=this.GetRenderer(),t.SetSize(this._canvasDeviceWidth,this._canvasDeviceHeight,!0),this._availableAdditionalRenderTargets))t.DeleteRenderTarget(r);e.clearArray(this._availableAdditionalRenderTargets),t.CalculatePerspectiveMatrix(this._defaultProjectionMatrix,this.GetDrawWidth()/this.GetDrawHeight()),r=this._runtime.GetLayoutManager(),r.SetAllLayerProjectionChanged(),r.SetAllLayerMVChanged()}}GetDefaultProjectionMatrix(){return this._defaultProjectionMatrix}_CalculateLetterboxScale(e,t){const s=this._runtime.GetDevicePixelRatio(),i=this._runtime.GetOriginalViewportWidth(),r=this._runtime.GetOriginalViewportHeight(),n=i/r;e/t>n?(this._canvasCssWidth=Math.round(t*n),this._canvasCssHeight=t,this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=0):(this._canvasCssWidth=e,this._canvasCssHeight=Math.round(e/n),this._canvasCssOffsetX=0,this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)),this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this._runtime.SetViewportSize(i,r)}_CalculateLetterboxIntegerScale(e,t){const s=this._runtime.GetDevicePixelRatio();1!==s&&(e+=1,t+=1);const i=this._runtime.GetOriginalViewportWidth(),r=this._runtime.GetOriginalViewportHeight();var n=i/r;n=e/t>n?t*n*s/i:e/n*s/r,1<n?n=Math.floor(n):1>n&&(n=1/Math.ceil(1/n)),this._canvasDeviceWidth=Math.round(i*n),this._canvasDeviceHeight=Math.round(r*n),this._canvasCssWidth=this._canvasDeviceWidth/s,this._canvasCssHeight=this._canvasDeviceHeight/s,this._canvasCssOffsetX=Math.max(Math.floor((e-this._canvasCssWidth)/2),0),this._canvasCssOffsetY=Math.max(Math.floor((t-this._canvasCssHeight)/2),0),this._runtime.SetViewportSize(i,r)}_CalculateFullsizeCanvas(e,t){const s=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=e,this._canvasCssHeight=t,this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this._canvasCssOffsetY=this._canvasCssOffsetX=0,e=this.GetDisplayScale(),this._runtime.SetViewportSize(this._canvasCssWidth/e,this._canvasCssHeight/e)}_CalculateFixedSizeCanvas(e,t){const s=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=this._runtime.GetViewportWidth(),this._canvasCssHeight=this._runtime.GetViewportHeight(),this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this.IsDocumentFullscreen()?(this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)):this._canvasCssOffsetY=this._canvasCssOffsetX=0,this._runtime.SetViewportSize(this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight())}_UpdateFullscreenScalingQuality(e){if("high"===this._wantFullscreenScalingQuality)this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high";else{let s;if("off"===this.GetCurrentFullscreenMode()){var t=this._runtime.GetViewportWidth();s=this._runtime.GetViewportHeight()}else t=this._runtime.GetOriginalViewportWidth(),s=this._runtime.GetOriginalViewportHeight();this._canvasDeviceWidth<t&&this._canvasDeviceHeight<s?(this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high"):(this._drawWidth=t,this._drawHeight=s,this._fullscreenScalingQuality="low","scale-inner"===e?(e=t/s,t=this._windowInnerWidth/this._windowInnerHeight,t<e?this._drawWidth=this._drawHeight*t:t>e&&(this._drawHeight=this._drawWidth/t)):"scale-outer"===e&&(e=t/s,t=this._windowInnerWidth/this._windowInnerHeight,t>e?this._drawWidth=this._drawHeight*t:t<e&&(this._drawHeight=this._drawWidth/t)))}}GetRuntime(){return this._runtime}GetEffectChainManager(){return this._effectChainManager}IsDocumentFullscreen(){return this._isDocumentFullscreen}SetFullscreenMode(e){if(!t.has(e))throw Error("invalid fullscreen mode");this._fullscreenMode=e,e=this._runtime.GetLayoutManager(),e.SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged()}GetFullscreenMode(){return this._fullscreenMode}SetDocumentFullscreenMode(e){if(!t.has(e))throw Error("invalid fullscreen mode");this._documentFullscreenMode=e,e=this._runtime.GetLayoutManager(),e.SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged()}GetDocumentFullscreenMode(){return this._documentFullscreenMode}GetCurrentFullscreenMode(){return this.IsDocumentFullscreen()?this.GetDocumentFullscreenMode():this.GetFullscreenMode()}SetFullscreenScalingQuality(e){if(!s.has(e))throw Error("invalid fullscreen scaling quality");this._wantFullscreenScalingQuality=e,this._runtime.GetLayoutManager().SetAllLayerProjectionChanged()}GetSetFullscreenScalingQuality(){return this._wantFullscreenScalingQuality}GetCurrentFullscreenScalingQuality(){return this._fullscreenScalingQuality}static _FullscreenModeNumberToString(e){switch(e){case 0:return"off";case 1:return"crop";case 2:return"scale-inner";case 3:return"scale-outer";case 4:return"letterbox-scale";case 5:return"letterbox-integer-scale";default:throw Error("invalid fullscreen mode")}}GetLastWidth(){return this._windowInnerWidth}GetLastHeight(){return this._windowInnerHeight}GetDrawWidth(){return this._drawWidth}GetDrawHeight(){return this._drawHeight}SetMipmapsEnabled(e){this._enableMipmaps=!!e}_SetTextureAnisotropy(e){this._textureAnisotropy=e}GetTextureAnisotropy(){return this._textureAnisotropy}IsRendererContextLost(){return this.GetRenderer().IsContextLost()}_OnWebGLContextLost(e){console.log("[Construct 3] WebGL context lost"),e.preventDefault(),this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._webglRenderer.OnContextLost(),this._runtime._OnWebGLContextLost()}async _OnWebGLContextRestored(e){await this._webglRenderer.OnContextRestored(),await this._LoadWebGLShaderPrograms();for(const e of this._runtime._GetAllEffectLists())for(const t of e.GetAllEffectTypes())t._InitRenderer(this._webglRenderer);await this._runtime._OnWebGLContextRestored(),console.log("[Construct 3] WebGL context restored")}GetWebGLRenderer(){return this._webglRenderer}GetWebGPURenderer(){return this._webgpuRenderer}GetRenderer(){return this._webgpuRenderer||this._webglRenderer}GetRenderScale(){return"low"===this._fullscreenScalingQuality?1/this._runtime.GetDevicePixelRatio():this.GetDisplayScale()}GetDisplayScale(){const e=this.GetCurrentFullscreenMode();if("off"===e||"crop"===e)return 1;const t=this._runtime.GetOriginalViewportWidth(),s=this._runtime.GetOriginalViewportHeight(),i=t/s,r=this._canvasDeviceWidth/this._canvasDeviceHeight;return"scale-inner"!==e&&r>i||"scale-inner"===e&&r<i?this._canvasCssHeight/s:this._canvasCssWidth/t}GetEffectLayerScaleParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this.GetDisplayScale()}GetEffectDevicePixelRatioParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this._runtime.GetDevicePixelRatio()}SetDeviceTransformOffset(e,t){this._deviceTransformOffX=e,this._deviceTransformOffY=t}SetDeviceTransform(e,t,s,i=!0){t=t||this._drawWidth,s=s||this._drawHeight;const n=t/2+this._deviceTransformOffX,a=s/2+this._deviceTransformOffY;i&&(i=this.GetDefaultProjectionMatrix(),t===this._drawWidth&&s===this._drawHeight||(e.CalculatePerspectiveMatrix(r,t/s),i=r),e.SetProjectionMatrix(i)),t=e.CalculateLookAtModelView2(n,a,e.GetDefaultCameraZ()*this._runtime.GetDevicePixelRatio(),n,a,0,s||this._drawHeight),e.SetModelViewMatrix(t)}SetCssTransform(e,t=!0){const s=this._canvasCssWidth/2,i=this._canvasCssHeight/2;t&&e.SetProjectionMatrix(this.GetDefaultProjectionMatrix()),t=e.CalculateLookAtModelView2(s,i,e.GetDefaultCameraZ(),s,i,0),e.SetModelViewMatrix(t)}GetDeviceWidth(){return this._canvasDeviceWidth}GetDeviceHeight(){return this._canvasDeviceHeight}GetCssWidth(){return this._canvasCssWidth}GetCssHeight(){return this._canvasCssHeight}GetCanvasClientX(){return this._canvasCssOffsetX}GetCanvasClientY(){return this._canvasCssOffsetY}GetAdditionalRenderTarget(e){e.depth=this._runtime.Uses3DFeatures();const t=this._availableAdditionalRenderTargets,s=t.findIndex(t=>t.IsCompatibleWithOptions(e));let i;return-1!==s?(i=t[s],t.splice(s,1)):i=this.GetRenderer().CreateRenderTarget(e),this._usedAdditionalRenderTargets.add(i),i}ReleaseAdditionalRenderTarget(e){if(!this._usedAdditionalRenderTargets.has(e))throw Error("render target not in use");this._usedAdditionalRenderTargets.delete(e),this._availableAdditionalRenderTargets.push(e)}GetEffectCompositorRenderTarget(){const e={sampling:this._runtime.GetSampling()};return"low"===this.GetCurrentFullscreenScalingQuality()&&(e.width=this.GetDrawWidth(),e.height=this.GetDrawHeight()),this.GetAdditionalRenderTarget(e)}ReleaseEffectCompositorRenderTarget(e){this.ReleaseAdditionalRenderTarget(e)}*activeLayersGpuProfiles(){for(const e of this._runtime.GetLayoutManager().runningLayouts())for(const t of e.GetLayers()){const e=this._layersGpuProfile.get(t);e&&(yield e)}}GetLayerTimingsBuffer(t){if(!this.GetRenderer().SupportsGPUProfiling())return null;let s=this._layersGpuProfile.get(t);return s||(s={name:t.GetName(),timingsBuffer:e.New(e.Gfx.WebGLQueryResultBuffer,this._webglRenderer),curUtilisation:0,lastUtilisation:0},this._layersGpuProfile.set(t,s)),s.timingsBuffer}_Update1sFrameRange(){const e=this.GetRenderer();if(e.SupportsGPUProfiling()&&0===this._gpuTimeEndFrame){this._gpuTimeEndFrame=e.GetFrameNumber(),this._gpuCurUtilisation=NaN;for(const e of this.activeLayersGpuProfiles())e.curUtilisation=NaN}}_UpdateTick(){this._webglRenderer&&this._webglRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGL(),this._webgpuRenderer&&this._webgpuRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGPU()}_UpdateTick_WebGL(){if(isNaN(this._gpuCurUtilisation)&&(this._gpuCurUtilisation=this._gpuFrameTimingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),!isNaN(this._gpuCurUtilisation))){if(this._runtime.IsDebug())for(const e of this.activeLayersGpuProfiles())if(e.curUtilisation=e.timingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),isNaN(e.curUtilisation))return;if(this._gpuFrameTimingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),this._gpuLastUtilisation=Math.min(this._gpuCurUtilisation,1),this._runtime.IsDebug()){for(const e of this.activeLayersGpuProfiles())e.timingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),e.lastUtilisation=Math.min(e.curUtilisation,1);self.C3Debugger.UpdateGPUProfile(this._gpuLastUtilisation,[...this.activeLayersGpuProfiles()])}this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}GetGPUFrameTimingsBuffer(){return this._gpuFrameTimingsBuffer}_UpdateTick_WebGPU(){if(0!==this._gpuTimeEndFrame){for(var t=this._gpuTimeStartFrame;t<this._gpuTimeEndFrame;++t){var s=this._webgpuFrameTimings.get(t);if(s&&!s.HasResult())return}s=this._runtime.GetMainRunningLayout(),t=e.MakeFilledArray(s.GetLayerCount()+1,0);for(var i=this._gpuTimeStartFrame;i<this._gpuTimeEndFrame;++i){var r=this._webgpuFrameTimings.get(i);if(r){r=r.GetResult();for(let e=0,s=Math.min(t.length,r.length/2);e<s;++e){const s=r[2*e],i=r[2*e+1];t[e]=0===Number(s)||0===Number(i)?NaN:t[e]+Number(i-s)/1e9}}}if(this._gpuLastUtilisation=e.clamp(t[0],0,1),this._runtime.IsDebug()){i=[],s=s.GetLayers();for(let r=0,n=Math.min(s.length,t.length-1);r<n;++r)i.push({name:s[r].GetName(),lastUtilisation:e.clamp(t[r+1],0,1)});self.C3Debugger.UpdateGPUProfile(this._gpuLastUtilisation,i)}for(t=this._gpuTimeStartFrame;t<this._gpuTimeEndFrame;++t)this._webgpuFrameTimings.delete(t);this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}_AddWebGPUFrameTiming(e){this._webgpuFrameTimings.set(this._webgpuRenderer.GetFrameNumber(),e)}GetGPUUtilisation(){return this._gpuLastUtilisation}SnapshotCanvas(e,t,s,i,r,n){return this._snapshotFormat=e,this._snapshotQuality=t,this._snapshotArea.setWH(s,i,r,n),this._snapshotPromise?this._snapshotPromise:this._snapshotPromise=new Promise(e=>{this._snapshotResolve=e})}_MaybeTakeSnapshot(){if(this._snapshotFormat){var t=this._canvas,s=this._snapshotArea,i=e.clamp(Math.floor(s.getLeft()),0,t.width),r=e.clamp(Math.floor(s.getTop()),0,t.height),n=s.width();n=0===n?t.width-i:e.clamp(Math.floor(n),0,t.width-i),s=s.height(),s=0===s?t.height-r:e.clamp(Math.floor(s),0,t.height-r),(0!==i||0!==r||n!==t.width||s!==t.height)&&0<n&&0<s&&(t=e.CreateCanvas(n,s),t.getContext("2d").drawImage(this._canvas,i,r,n,s,0,0,n,s)),e.CanvasToBlob(t,this._snapshotFormat,this._snapshotQuality).then(e=>{this._snapshotUrl=URL.createObjectURL(e),this._snapshotPromise=null,this._snapshotResolve(this._snapshotUrl)}),this._snapshotFormat="",this._snapshotQuality=1}}GetCanvasSnapshotUrl(){return this._snapshotUrl}SetIsPastingToDrawingCanvas(e){e?this._isPastingToDrawingCanvas++:this._isPastingToDrawingCanvas--}IsPastingToDrawingCanvas(){return 0<this._isPastingToDrawingCanvas}InitLoadingScreen(t){this._webglRenderer&&(2===t?(this._percentText=e.New(e.Gfx.RendererText,this.GetRenderer()),this._percentText.SetIsAsync(!1),this._percentText.SetFontName("Arial"),this._percentText.SetFontSize(16),this._percentText.SetHorizontalAlignment("center"),this._percentText.SetVerticalAlignment("center"),this._percentText.SetSize(300,200)):0===t?(t=this._runtime.GetLoadingLogoAsset())&&t.LoadStaticTexture(this._webglRenderer).catch(e=>console.warn("[C3 runtime] Failed to create texture for loading logo: ",e)):4===t&&(this._LoadSvgSplashImage("splash-images/splash-logo.svg").then(e=>{"done"===this._splashState?this._webglRenderer.DeleteTexture(e):this._splashTextures.logo=e}).catch(e=>console.warn("Failed to load splash image: ",e)),this._LoadBitmapSplashImage("splash-images/splash-poweredby-512.png").then(e=>{"done"===this._splashState?this._webglRenderer.DeleteTexture(e):this._splashTextures.powered=e}).catch(e=>console.warn("Failed to load splash image: ",e)),this._LoadBitmapSplashImage("splash-images/splash-website-512.png").then(e=>{"done"===this._splashState?this._webglRenderer.DeleteTexture(e):this._splashTextures.website=e}).catch(e=>console.warn("Failed to load splash image: ",e))))}async _LoadSvgSplashImage(t){return t=new URL(t,this._runtime.GetBaseURL()).toString(),t=await e.FetchBlob(t),t=await this._runtime.RasterSvgImage(t,2048,2048),await this._webglRenderer.CreateStaticTextureAsync(t,{mipMapQuality:"high"})}async _LoadBitmapSplashImage(t){return t=new URL(t,this._runtime.GetBaseURL()).toString(),t=await e.FetchBlob(t),await this._webglRenderer.CreateStaticTextureAsync(t,{mipMapQuality:"high"})}HideCordovaSplashScreen(){this._runtime.PostComponentMessageToDOM("runtime","hide-cordova-splash")}StartLoadingScreen(){this._loaderStartTime=Date.now(),this._runtime.Dispatcher().addEventListener("loadingprogress",this._loadingprogress_handler),this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen()),3!==this._runtime.GetLoaderStyle()&&this.HideCordovaSplashScreen()}async EndLoadingScreen(){if(this._webglRenderer){this._loadingProgress=1;var e=this._runtime.GetLoaderStyle();4===e&&await this._splashDonePromise,this._splashDonePromise=this._splashDoneResolve=null,-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1),this._runtime.Dispatcher().removeEventListener("loadingprogress",this._loadingprogress_handler),this._loadingprogress_handler=null,this._percentText&&(this._percentText.Release(),this._percentText=null),this._runtime.ReleaseLoadingLogoAsset(),this._webglRenderer.Start(),this._splashTextures.logo&&(this._webglRenderer.DeleteTexture(this._splashTextures.logo),this._splashTextures.logo=null),this._splashTextures.powered&&(this._webglRenderer.DeleteTexture(this._splashTextures.powered),this._splashTextures.powered=null),this._splashTextures.website&&(this._webglRenderer.DeleteTexture(this._splashTextures.website),this._splashTextures.website=null),this._webglRenderer.ClearRgba(0,0,0,0),this._webglRenderer.Finish(),this._splashState="done",this._gpuTimeStartFrame=this._webglRenderer.GetFrameNumber(),3===e&&this.HideCordovaSplashScreen()}}_DrawLoadingScreen(){if(-1!==this._rafId){var t=this._webglRenderer;if(t){t.Start(),this._rafId=-1;var s=this._runtime.GetAssetManager().HasHadErrorLoading(),i=this._runtime.GetLoaderStyle();if(3!==i&&(this.SetCssTransform(t),t.ClearRgba(0,0,0,0),t.ResetColor(),t.SetTextureFillMode(),t.SetTexture(null)),0===i)this._DrawProgressBarAndLogoLoadingScreen(s);else if(1===i)this._DrawProgressBarLoadingScreen(s,120,0);else if(2===i)this._DrawPercentTextLoadingScreen(s);else if(3===i)e.noop();else{if(4!==i)throw Error("invalid loader style");this._DrawSplashLoadingScreen(s)}t.Finish(),this._rafId=requestAnimationFrame(()=>this._DrawLoadingScreen())}}}_DrawPercentTextLoadingScreen(e){e?this._percentText.SetColorRgb(1,0,0):this._percentText.SetColorRgb(.6,.6,.6),this._percentText.SetText(Math.round(100*this._loadingProgress)+"%"),e=this._canvasCssWidth/2;const t=this._canvasCssHeight/2;n.setRect(e-150,t-100,e+150,t+100),this._webglRenderer.SetTexture(this._percentText.GetTexture()),this._webglRenderer.Quad3(n,this._percentText.GetTexRect())}_DrawProgressBarLoadingScreen(e,t,s){const i=this._webglRenderer;i.SetColorFillMode(),e?i.SetColorRgba(1,0,0,1):i.SetColorRgba(.118,.565,1,1),e=this._canvasCssWidth/2;const r=this._canvasCssHeight/2,n=t/2;a.setWH(e-n,r-4+s,Math.floor(t*this._loadingProgress),8),i.Rect(a),a.setWH(e-n,r-4+s,t,8),a.offset(-.5,-.5),a.inflate(.5,.5),i.SetColorRgba(0,0,0,1),i.LineRect2(a),a.inflate(1,1),i.SetColorRgba(1,1,1,1),i.LineRect2(a)}_DrawProgressBarAndLogoLoadingScreen(e){var t=this._runtime.GetLoadingLogoAsset();if(t)if(t=t.GetTexture()){var s=t.GetWidth(),i=t.GetHeight(),r=this._canvasCssWidth/2,a=this._canvasCssHeight/2,o=s/2;i/=2,n.setRect(r-o,a-i,r+o,a+i),this._webglRenderer.SetTexture(t),this._webglRenderer.Quad(n),this._DrawProgressBarLoadingScreen(e,s,i+16)}else this._DrawProgressBarLoadingScreen(e,120,0);else this._DrawProgressBarLoadingScreen(e,120,0)}_DrawSplashLoadingScreen(t){const s=this._webglRenderer,i=this._splashTextures.logo,r=this._splashTextures.powered,n=this._splashTextures.website,o=Date.now();0===this._splashFrameNumber&&(this._loaderStartTime=o);const h=this._runtime.IsPreview()||this._runtime.IsFBInstantAvailable()&&!this._runtime.IsCordova(),l=h?0:200,c=h?0:3e3;let u=1;"fade-in"===this._splashState?u=Math.min((o-this._loaderStartTime)/300,1):"fade-out"===this._splashState&&(u=Math.max(1-(o-this._splashFadeOutStartTime)/300,0)),s.SetColorFillMode(),s.SetColorRgba(.231*u,.251*u,.271*u,u),a.set(0,0,this._canvasCssWidth,this._canvasCssHeight),s.Rect(a);const _=Math.ceil(this._canvasCssWidth),d=Math.ceil(this._canvasCssHeight);let p;256<this._canvasCssHeight?(s.SetColorRgba(.302*u,.334*u,.365*u,u),p=Math.max(.005*d,2),a.setWH(0,.8*d-p/2,_,p),s.Rect(a),t?s.SetColorRgba(u,0,0,u):s.SetColorRgba(.161*u,.953*u,.816*u,u),t=_*this._loadingProgress,a.setWH(.5*_-t/2,.8*d-p/2,t,p),s.Rect(a),s.SetColorRgba(u,u,u,u),s.SetTextureFillMode(),r&&(t=1.5*e.clamp(.22*d,105,.6*_),p=t/8,a.setWH(.5*_-t/2,.2*d-p/2,t,p),s.SetTexture(r),s.Rect(a)),i&&(p=t=Math.min(.395*d,.95*_),a.setWH(.5*_-t/2,.485*d-p/2,t,p),s.SetTexture(i),s.Rect(a)),n&&(t=1.5*e.clamp(.22*d,105,.6*_),p=t/8,a.setWH(.5*_-t/2,.868*d-p/2,t,p),s.SetTexture(n),s.Rect(a))):(s.SetColorRgba(.302*u,.334*u,.365*u,u),p=Math.max(.005*d,2),a.setWH(0,.85*d-p/2,_,p),s.Rect(a),t?s.SetColorRgba(u,0,0,u):s.SetColorRgba(.161*u,.953*u,.816*u,u),t=_*this._loadingProgress,a.setWH(.5*_-t/2,.85*d-p/2,t,p),s.Rect(a),s.SetColorRgba(u,u,u,u),s.SetTextureFillMode(),i&&(p=t=.55*d,a.setWH(.5*_-t/2,.45*d-p/2,t,p),s.SetTexture(i),s.Rect(a))),this._splashFrameNumber++,"fade-in"===this._splashState&&300<=o-this._loaderStartTime&&2<=this._splashFrameNumber&&(this._splashState="wait",this._splashFadeInFinishTime=o),"wait"===this._splashState&&o-this._splashFadeInFinishTime>=c&&1<=this._loadingProgress&&(this._splashState="fade-out",this._splashFadeOutStartTime=o),("fade-out"===this._splashState&&o-this._splashFadeOutStartTime>=300+l||h&&1<=this._loadingProgress&&500>o-this._loaderStartTime)&&this._splashDoneResolve()}}}{const e=self.C3,t=self.C3Debugger,s={messagePort:null,baseUrl:"",headless:!1,hasDom:!0,isInWorker:!1,useAudio:!0,projectData:"",exportType:""};let i=!0;e.Runtime=class extends e.DefendedBase{constructor(t){t=Object.assign({},s,t),super(),this._messagePort=t.messagePort,this._baseUrl=t.baseUrl,this._isHeadless=!!t.headless,this._hasDom=!!t.hasDom,this._isInWorker=!!t.isInWorker,i=t.ife,this._useAudio=!!t.useAudio,this._exportType=t.exportType,this._isiOSCordova=!!t.isiOSCordova,this._isiOSWebView=!!t.isiOSWebView,this._isFBInstantAvailable=!!t.isFBInstantAvailable,this._opusWasmScriptUrl=t.opusWasmScriptUrl,this._opusWasmBinaryUrl=t.opusWasmBinaryUrl,this._isDebugging=this._breakpointsEnabled=this._isDebug=!("preview"!==this._exportType||!t.isDebug),this._debuggingDisabled=0,this._additionalLoadPromises=[],this._additionalCreatePromises=[],this._isUsingCreatePromises=!1,this._appId=this._projectUniqueId=this._projectVersion=this._projectName="",this._originalViewportHeight=this._originalViewportWidth=0,this._devicePixelRatio=self.devicePixelRatio,this._loaderStyle=this._viewportHeight=this._viewportWidth=this._parallaxYorigin=this._parallaxXorigin=0,this._usesLoaderLayout=!1,this._isLoading=!0,this._usesAnyDepthSampling=this._usesAnyBackgroundBlending=!1,this._loadingLogoAsset=null,this._assetManager=e.New(e.AssetManager,this,t),this._layoutManager=e.New(e.LayoutManager,this),this._eventSheetManager=e.New(e.EventSheetManager,this),this._pluginManager=e.New(e.PluginManager,this),this._collisionEngine=e.New(e.CollisionEngine,this),this._timelineManager=e.New(e.TimelineManager,this),this._transitionManager=e.New(e.TransitionManager,this),this._allObjectClasses=[],this._objectClassesByName=new Map,this._objectClassesBySid=new Map,this._familyCount=0,this._allContainers=[],this._allEffectLists=[],this._currentLayoutStack=[],this._instancesPendingCreate=[],this._instancesPendingDestroy=new Map,this._isFlushingPendingInstances=this._hasPendingInstances=!1,this._nextUid=this._objectCount=0,this._instancesByUid=new Map,this._instancesToReleaseAtEndOfTick=new Set,this._instancesToReleaseAffectedObjectClasses=new Set,this._objectReferenceTable=[],this._jsPropNameTable=[],this._canvasManager=null,this._uses3dFeatures=!1,this._framerateMode="vsync",this._compositingMode="standard",this._sampling="trilinear",this._isPixelRoundingEnabled=!1,this._needRender=!0,this._isPausedOnBlur=this._pauseOnBlur=!1,this._tickCallbacks={normal:e=>{this._ruafId=this._rafId=-1,this.Tick(e)},tickOnly:e=>{this._ruafId=-1,this.Tick(e,!1,"skip-render")},renderOnly:()=>{this._rafId=-1,this.Render()}},this._ruafId=this._rafId=-1,this._execCount=this._tickCountNoSave=this._tickCount=0,this._hasStartedTicking=this._isInTick=this._hasStarted=!1,this._isLayoutFirstTick=!0,this._suspendCount=0,this._scheduleTriggersThrottle=new e.PromiseThrottle(1),this._randomNumberCallback=(()=>Math.random()),this._dt=this._dt1=this._lastTickTime=this._startTime=0,this._timeScale=1,this._minimumFramerate=30,this._gameTime=e.New(e.KahanSum),this._gameTimeRaw=e.New(e.KahanSum),this._wallTime=e.New(e.KahanSum),this._fpsFrameCount=-1,this._mainThreadTime=this._mainThreadTimeCounter=this._fps=this._fpsLastTime=0,this._isLoadingState=!1,this._loadFromSlotName=this._saveToSlotName="",this._loadFromJson=null,this._lastSaveJson="",this._savegamesStorage=this._projectStorage=null,this._dispatcher=e.New(e.Event.Dispatcher),this._domEventHandlers=new Map,this._pendingResponsePromises=new Map,this._nextDomResponseId=0,this._isReadyToHandleEvents=this._didRequestDeviceMotionEvent=this._didRequestDeviceOrientationEvent=!1,this._waitingToHandleEvents=[],this._eventObjects={pretick:e.New(e.Event,"pretick",!1),tick:e.New(e.Event,"tick",!1),tick2:e.New(e.Event,"tick2",!1),instancedestroy:e.New(e.Event,"instancedestroy",!1),beforelayoutchange:e.New(e.Event,"beforelayoutchange",!1),layoutchange:e.New(e.Event,"layoutchange",!1)},this._eventObjects.instancedestroy.instance=null,this._userScriptDispatcher=e.New(e.Event.Dispatcher),this._userScriptEventObjects=null,this._behInstsToTick=e.New(e.RedBlackSet,e.BehaviorInstance.SortByTickSequence),this._behInstsToPostTick=e.New(e.RedBlackSet,e.BehaviorInstance.SortByTickSequence),this._behInstsToTick2=e.New(e.RedBlackSet,e.BehaviorInstance.SortByTickSequence),this._jobScheduler=e.New(e.JobSchedulerRuntime,this,t.jobScheduler),t.canvas&&(this._canvasManager=e.New(e.CanvasManager,this)),this._messagePort.onmessage=(e=>this._OnMessageFromDOM(e.data)),this.AddDOMComponentMessageHandler("runtime","visibilitychange",e=>this._OnVisibilityChange(e)),this.AddDOMComponentMessageHandler("runtime","opus-decode",e=>this._WasmDecodeWebMOpus(e.arrayBuffer)),this.AddDOMComponentMessageHandler("runtime","get-remote-preview-status-info",()=>this._GetRemotePreviewStatusInfo()),this.AddDOMComponentMessageHandler("runtime","js-invoke-function",e=>this._InvokeFunctionFromJS(e)),this.AddDOMComponentMessageHandler("runtime","go-to-last-error-script",self.goToLastErrorScript),this._dispatcher.addEventListener("window-blur",e=>this._OnWindowBlur(e)),this._dispatcher.addEventListener("window-focus",()=>this._OnWindowFocus()),this._timelineManager.AddRuntimeListeners(),this._iRuntime=null,this._interfaceMap=new WeakMap,this._commonScriptInterfaces={keyboard:null,mouse:null,touch:null}}static Create(t){return e.New(e.Runtime,t)}Release(){e.clearArray(this._allObjectClasses),this._objectClassesByName.clear(),this._objectClassesBySid.clear(),this._layoutManager.Release(),this._layoutManager=null,this._eventSheetManager.Release(),this._eventSheetManager=null,this._pluginManager.Release(),this._pluginManager=null,this._assetManager.Release(),this._assetManager=null,this._collisionEngine.Release(),this._collisionEngine=null,this._timelineManager.Release(),this._timelineManager=null,this._transitionManager.Release(),this._transitionManager=null,this._canvasManager&&(this._canvasManager.Release(),this._canvasManager=null),this._dispatcher.Release(),this._tickEvent=this._dispatcher=null}_OnMessageFromDOM(e){const t=e.type;if("event"===t)this._OnEventFromDOM(e);else{if("result"!==t)throw Error(`unknown message '${t}'`);this._OnResultFromDOM(e)}}_OnEventFromDOM(t){if(this._isReadyToHandleEvents){var s=t.component,i=t.handler,r=t.data,n=t.dispatchOpts,a=!(!n||!n.dispatchRuntimeEvent);n=!(!n||!n.dispatchUserScriptEvent);var o=t.responseId;if("runtime"===s&&(a&&(t=new e.Event(i),t.data=r,this._dispatcher.dispatchEventAndWaitAsyncSequential(t)),n)){t=new e.Event(i,!0);for(const[e,s]of Object.entries(r))t[e]=s;this.DispatchUserScriptEvent(t)}if(t=this._domEventHandlers.get(s))if(t=t.get(i)){a=null;try{a=t(r)}catch(e){return console.error(`Exception in '${s}' handler '${i}':`,e),void(null!==o&&this._PostResultToDOM(o,!1,""+e))}null!==o&&(a&&a.then?a.then(e=>this._PostResultToDOM(o,!0,e)).catch(e=>{console.error(`Rejection from '${s}' handler '${i}':`,e),this._PostResultToDOM(o,!1,""+e)}):this._PostResultToDOM(o,!0,a))}else a||n||console.warn(`[Runtime] No DOM handler '${i}' for component '${s}'`);else a||n||console.warn(`[Runtime] No DOM event handlers for component '${s}'`)}else this._waitingToHandleEvents.push(t)}_PostResultToDOM(e,t,s){this._messagePort.postMessage({type:"result",responseId:e,isOk:t,result:s})}_OnResultFromDOM(e){const t=e.responseId,s=e.isOk;e=e.result;const i=this._pendingResponsePromises.get(t);s?i.resolve(e):i.reject(e),this._pendingResponsePromises.delete(t)}AddDOMComponentMessageHandler(e,t,s){let i=this._domEventHandlers.get(e);if(i||(i=new Map,this._domEventHandlers.set(e,i)),i.has(t))throw Error(`[Runtime] Component '${e}' already has handler '${t}'`);i.set(t,s)}PostComponentMessageToDOM(e,t,s){this._messagePort.postMessage({type:"event",component:e,handler:t,data:s,responseId:null})}PostComponentMessageToDOMAsync(e,t,s){const i=this._nextDomResponseId++,r=new Promise((e,t)=>{this._pendingResponsePromises.set(i,{resolve:e,reject:t})});return this._messagePort.postMessage({type:"event",component:e,handler:t,data:s,responseId:i}),r}PostToDebugger(e){if(!this.IsDebug())throw Error("not in debug mode");this.PostComponentMessageToDOM("runtime","post-to-debugger",e)}async Init(s){
this.IsDebug()?await t.Init(this):self.C3Debugger&&self.C3Debugger.InitPreview(this);var[i]=await Promise.all([this._assetManager.FetchJson("data.json"),this._MaybeLoadOpusDecoder(),this._jobScheduler.Init()]);this._LoadDataJson(i),await this._InitialiseCanvas(s),this.IsPreview()||console.info("Made with Construct 3, the game and app creator :: https://www.construct.net"),this.GetWebGLRenderer()?(i=this.GetWebGLRenderer(),console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with WebGL ${i.GetWebGLVersionNumber()} [${i.GetUnmaskedRenderer()}] (${i.IsDesynchronized()?"desynchronized":"standard"} compositing)`)):this.GetWebGPURenderer()&&console.info(`[C3 runtime] Hosted in ${this.IsInWorker()?"worker":"DOM"}, rendering with experimental WebGPU`),this.GetRenderer().HasMajorPerformanceCaveat()&&console.warn("[C3 runtime] The renderer indicates a major performance caveat. Software rendering may be in use. This can result in significantly degraded performance."),this._isReadyToHandleEvents=!0;for(const e of this._waitingToHandleEvents)this._OnEventFromDOM(e);e.clearArray(this._waitingToHandleEvents),this._canvasManager&&this._canvasManager.StartLoadingScreen();for(const e of s.runOnStartupFunctions)this._additionalLoadPromises.push(this._RunOnStartupFunction(e));if(await Promise.all([this._assetManager.WaitForAllToLoad(),...this._additionalLoadPromises]),e.clearArray(this._additionalLoadPromises),!this._assetManager.HasHadErrorLoading())return this._canvasManager&&await this._canvasManager.EndLoadingScreen(),await this._dispatcher.dispatchEventAndWaitAsync(new e.Event("beforeruntimestart")),await this.Start(),this._messagePort.postMessage({type:"runtime-ready"}),this;this._canvasManager&&this._canvasManager.HideCordovaSplashScreen()}async _RunOnStartupFunction(e){try{await e(this._iRuntime)}catch(e){console.error("[C3 runtime] Error in runOnStartup function: ",e)}}_LoadDataJson(t){t=t.project,this._projectName=t[0],this._projectVersion=t[16],this._projectUniqueId=t[31],this._appId=t[38];const s=t[39]||"loading-logo.png";this._isPixelRoundingEnabled=!!t[9],this._originalViewportWidth=this._viewportWidth=t[10],this._originalViewportHeight=this._viewportHeight=t[11],this._parallaxXorigin=this._originalViewportWidth/2,this._parallaxYorigin=this._originalViewportHeight/2,this._compositingMode=t[36],this._framerateMode=t[37],"low-latency"===this._compositingMode&&this.IsAndroidWebView()&&77>=e.Platform.BrowserVersionNumber&&(console.warn("[C3 runtime] Desynchronized (low-latency) compositing is enabled, but is disabled in the Android WebView <=77 due to crbug.com/1008842. Reverting to synchronized (standard) compositing."),this._compositingMode="standard"),this._uses3dFeatures=!!t[40],this._sampling=t[14],this._usesAnyBackgroundBlending=t[15],this._usesAnyDepthSampling=t[17],this._usesLoaderLayout=!!t[18],this._loaderStyle=t[19],this._nextUid=t[21],this._pauseOnBlur=t[22];const i=this._assetManager;if(i._SetAudioFiles(t[7],t[25]),i._SetMediaSubfolder(t[8]),i._SetFontsSubfolder(t[32]),i._SetIconsSubfolder(t[28]),i._SetWebFonts(t[29]),0===this._loaderStyle){let e="";this.IsPreview()?i._HasLocalUrlBlob(s)&&(e=i.GetLocalUrlAsBlobUrl(s)):e=i.GetIconsSubfolder()+s,e&&(this._loadingLogoAsset=i.LoadImage({url:e}))}for(var r of(this._canvasManager&&(this._canvasManager.SetFullscreenMode(e.CanvasManager._FullscreenModeNumberToString(t[12])),this._canvasManager.SetFullscreenScalingQuality(t[23]?"high":"low"),this._canvasManager.SetMipmapsEnabled(0!==t[24]),this._canvasManager._SetGPUPowerPreference(t[34]),this._canvasManager._SetTextureAnisotropy(t[41]),this._canvasManager._SetWebGPUEnabled(t[13])),this._pluginManager.CreateSystemPlugin(),this._objectReferenceTable=self.C3_GetObjectRefTable(),t[2]))this._pluginManager.CreatePlugin(r);for(var n of(this._objectReferenceTable=self.C3_GetObjectRefTable(),this._LoadJsPropNameTable(),t[3]))r=e.ObjectClass.Create(this,this._allObjectClasses.length,n),this._allObjectClasses.push(r),this._objectClassesByName.set(r.GetName().toLowerCase(),r),this._objectClassesBySid.set(r.GetSID(),r);for(const e of t[4])this._allObjectClasses[e[0]]._LoadFamily(e);for(var a of t[27])n=a.map(e=>this._allObjectClasses[e]),this._allContainers.push(e.New(e.Container,this,n));for(const e of this._allObjectClasses)e._OnAfterCreate();for(const e of t[5])this._layoutManager.Create(e);for(var o of((a=t[1])&&(a=this._layoutManager.GetLayoutByName(a))&&this._layoutManager.SetFirstLayout(a),t[33]))this._timelineManager.Create(o);for(const e of t[35])this._transitionManager.Create(e);this._InitScriptInterfaces();for(const e of t[6])this._eventSheetManager.Create(e);this._eventSheetManager._PostInit(),this._InitGlobalVariableScriptInterface(),e.clearArray(this._objectReferenceTable),this.FlushPendingInstances(),o="any",t=t[20],1===t?o="portrait":2===t&&(o="landscape"),this.PostComponentMessageToDOM("runtime","set-target-orientation",{targetOrientation:o})}GetLoaderStyle(){return this._loaderStyle}IsFBInstantAvailable(){return this._isFBInstantAvailable}IsLoading(){return this._isLoading}AddLoadPromise(e){this._additionalLoadPromises.push(e)}SetUsingCreatePromises(e){this._isUsingCreatePromises=!!e}AddCreatePromise(e){this._isUsingCreatePromises&&this._additionalCreatePromises.push(e)}GetCreatePromises(){return this._additionalCreatePromises}_GetNextFamilyIndex(){return this._familyCount++}GetFamilyCount(){return this._familyCount}_AddEffectList(e){this._allEffectLists.push(e)}_GetAllEffectLists(){return this._allEffectLists}async _InitialiseCanvas(e){this._canvasManager&&(await this._canvasManager.CreateCanvas(e),this._canvasManager.InitLoadingScreen(this._loaderStyle))}async _MaybeLoadOpusDecoder(){if(!this._assetManager.IsAudioFormatSupported("audio/webm; codecs=opus")){var e=null;try{e=this.IsiOSCordova()&&this._assetManager.IsFileProtocol()?await this._assetManager.CordovaFetchLocalFileAsArrayBuffer(this._opusWasmBinaryUrl):await this._assetManager.FetchArrayBuffer(this._opusWasmBinaryUrl)}catch(e){return void console.info("Failed to fetch Opus decoder WASM; assuming project has no Opus audio.",e)}e?this.AddJobWorkerBuffer(e,"opus-decoder-wasm"):this.AddJobWorkerBlob(null,"opus-decoder-wasm"),await this.AddJobWorkerScripts([this._opusWasmScriptUrl])}}async _WasmDecodeWebMOpus(e){return await this.AddJob("OpusDecode",{arrayBuffer:e},[e])}async Start(){if(this._hasStarted=!0,this._startTime=Date.now(),this._usesLoaderLayout){for(var e of this._allObjectClasses)e.IsFamily()||e.IsOnLoaderLayout()||!e.IsWorldType()||e.OnCreate();this._assetManager.WaitForAllToLoad().then(()=>{this._isLoading=!1,this._OnLoadFinished()})}else this._isLoading=!1;this._assetManager.SetInitialLoadFinished(),this.IsDebug()&&t.RuntimeInit(i);for(const e of this._layoutManager.GetAllLayouts())e._CreateGlobalNonWorlds();e=this._layoutManager.GetFirstLayout(),await e._Load(null,this.GetRenderer()),await e._StartRunning(!0),this._fpsLastTime=performance.now(),this._usesLoaderLayout||this._OnLoadFinished(),(await this.PostComponentMessageToDOMAsync("runtime","before-start-ticking")).isSuspended?this._suspendCount++:this.Tick()}_OnLoadFinished(){this.Trigger(e.Plugins.System.Cnds.OnLoadFinished,null,null),this.PostComponentMessageToDOM("runtime","register-sw")}GetObjectReference(e){e=Math.floor(e);const t=this._objectReferenceTable;if(0>e||e>=t.length)throw Error("invalid object reference");return t[e]}_LoadJsPropNameTable(){for(const t of self.C3_JsPropNameTable){const s=e.first(Object.keys(t));this._jsPropNameTable.push(s)}}GetJsPropName(e){e=Math.floor(e);const t=this._jsPropNameTable;if(0>e||e>=t.length)throw Error("invalid prop reference");return t[e]}HasDOM(){return this._hasDom}IsHeadless(){return this._isHeadless}IsInWorker(){return this._isInWorker}GetBaseURL(){return this._baseUrl}GetEventSheetManager(){return this._eventSheetManager}GetEventStack(){return this._eventSheetManager.GetEventStack()}GetCurrentEventStackFrame(){return this._eventSheetManager.GetCurrentEventStackFrame()}GetCurrentEvent(){return this._eventSheetManager.GetCurrentEvent()}GetCurrentCondition(){return this._eventSheetManager.GetCurrentCondition()}IsCurrentConditionFirst(){return 0===this.GetCurrentEventStackFrame().GetConditionIndex()}GetCurrentAction(){return this._eventSheetManager.GetCurrentAction()}GetPluginManager(){return this._pluginManager}GetSystemPlugin(){return this._pluginManager.GetSystemPlugin()}GetObjectClassByIndex(e){if(e=Math.floor(e),0>e||e>=this._allObjectClasses.length)throw new RangeError("invalid index");return this._allObjectClasses[e]}GetObjectClassByName(e){return this._objectClassesByName.get(e.toLowerCase())||null}GetObjectClassBySID(e){return this._objectClassesBySid.get(e)||null}GetSingleGlobalObjectClassByCtor(e){return(e=this._pluginManager.GetPluginByConstructorFunction(e))?e.GetSingleGlobalObjectClass():null}GetAllObjectClasses(){return this._allObjectClasses}*allInstances(){for(const e of this._allObjectClasses)e.IsFamily()||(yield*e.instances())}Dispatcher(){return this._dispatcher}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.runtime=this.GetIRuntime();const s=this.IsDebug()&&!this._eventSheetManager.IsInEventEngine();s&&t.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),s&&t.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.runtime=this.GetIRuntime(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}GetOriginalViewportWidth(){return this._originalViewportWidth}GetOriginalViewportHeight(){return this._originalViewportHeight}SetOriginalViewportSize(e,t){this._originalViewportWidth===e&&this._originalViewportHeight===t||(this._originalViewportWidth=e,this._originalViewportHeight=t,e=this.GetLayoutManager(),e.SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged())}GetViewportWidth(){return this._viewportWidth}GetViewportHeight(){return this._viewportHeight}SetViewportSize(e,t){this._viewportWidth===e&&this._viewportHeight===t||(this._viewportWidth=e,this._viewportHeight=t,e=this.GetLayoutManager(),e.SetAllLayerProjectionChanged(),e.SetAllLayerMVChanged())}_SetDevicePixelRatio(e){this._devicePixelRatio=e}GetDevicePixelRatio(){return this._devicePixelRatio}GetParallaxXOrigin(){return this._parallaxXorigin}GetParallaxYOrigin(){return this._parallaxYorigin}GetCanvasManager(){return this._canvasManager}GetDrawWidth(){return this._canvasManager?this._canvasManager.GetDrawWidth():this._viewportWidth}GetDrawHeight(){return this._canvasManager?this._canvasManager.GetDrawHeight():this._viewportHeight}GetRenderScale(){return this._canvasManager?this._canvasManager.GetRenderScale():1}GetDisplayScale(){return this._canvasManager?this._canvasManager.GetDisplayScale():1}GetEffectLayerScaleParam(){return this._canvasManager?this._canvasManager.GetEffectLayerScaleParam():1}GetEffectDevicePixelRatioParam(){return this._canvasManager?this._canvasManager.GetEffectDevicePixelRatioParam():1}GetCanvasClientX(){return this._canvasManager?this._canvasManager.GetCanvasClientX():0}GetCanvasClientY(){return this._canvasManager?this._canvasManager.GetCanvasClientY():0}GetCanvasCssWidth(){return this._canvasManager?this._canvasManager.GetCssWidth():0}GetCanvasCssHeight(){return this._canvasManager?this._canvasManager.GetCssHeight():0}GetFullscreenMode(){return this._canvasManager?this._canvasManager.GetFullscreenMode():"off"}GetAdditionalRenderTarget(e){return this._canvasManager?this._canvasManager.GetAdditionalRenderTarget(e):null}ReleaseAdditionalRenderTarget(e){this._canvasManager&&this._canvasManager.ReleaseAdditionalRenderTarget(e)}UsesAnyBackgroundBlending(){return this._usesAnyBackgroundBlending}UsesAnyDepthSampling(){return this._usesAnyDepthSampling}GetGPUUtilisation(){return this._canvasManager?this._canvasManager.GetGPUUtilisation():NaN}IsLinearSampling(){return"nearest"!==this.GetSampling()}GetFramerateMode(){return this._framerateMode}GetCompositingMode(){return this._compositingMode}GetSampling(){return this._sampling}UsesLoaderLayout(){return this._usesLoaderLayout}GetLoadingLogoAsset(){return this._loadingLogoAsset}ReleaseLoadingLogoAsset(){this._loadingLogoAsset&&(this._loadingLogoAsset.Release(),this._loadingLogoAsset=null)}GetLayoutManager(){return this._layoutManager}GetMainRunningLayout(){return this._layoutManager.GetMainRunningLayout()}GetTimelineManager(){return this._timelineManager}GetTransitionManager(){return this._transitionManager}GetAssetManager(){return this._assetManager}LoadImage(e){return this._assetManager.LoadImage(e)}CreateInstance(e,t,s,i,r){return this.CreateInstanceFromData(e,t,!1,s,i,!1,r,void 0,r)}CreateInstanceFromData(s,i,r,n,a,o,h,l,c){var u=null;let _=null;if(s instanceof e.ObjectClass){if(_=s,_.IsFamily()){s=_.GetFamilyMembers();var d=Math.floor(this.Random()*s.length);_=s[d]}u=_.GetDefaultInstanceData()}else u=s,_=this.GetObjectClassByIndex(u[1]);var p=_.GetPlugin().IsWorldType();if(this._isLoading&&p&&!_.IsOnLoaderLayout())return null;const g=i;p||(i=null);var m=r&&!o&&u&&!this._instancesByUid.has(u[2])?u[2]:this._nextUid++;d=u?u[0]:null,s=e.New(e.Instance,{runtime:this,objectType:_,layer:i,worldData:d,instVarData:u?u[3]:null,uid:m}),this._instancesByUid.set(m,s),m=null,p&&(m=s.GetWorldInfo(),void 0!==n&&void 0!==a&&(m.SetX(n),m.SetY(a)),_._SetAnyCollisionCellChanged(!0)),i&&(c||i._AddInstance(s,!0),1===i.GetParallaxX()&&1===i.GetParallaxY()||_._SetAnyInstanceParallaxed(!0),i.GetLayout().MaybeLoadTexturesFor(_)),this._objectCount++;let f=!0;if(l){var S=l.GetObjectClass();S.IsInContainer()&&_.IsInContainer()&&(l=_.GetContainer(),S=S.GetContainer(),l===S&&(f=!1))}if(_.IsInContainer()&&!r&&!o&&f){for(var y of _.GetContainer().objectTypes())y!==_&&(l=this.CreateInstanceFromData(y,g,!1,m?m.GetX():n,m?m.GetY():a,!0,!1,void 0,c),s._AddSibling(l));for(var G of s.siblings()){G._AddSibling(s);for(const e of s.siblings())G!==e&&G._AddSibling(e)}}if(p&&!r&&h&&this._CreateChildInstancesFromData(s,d,m,i,n,a,c),_.IsInContainer()&&!r&&!o&&h)for(const e of s.siblings())(r=e.GetWorldInfo())&&(y=e.GetPlugin(),G=e.GetObjectClass().GetDefaultInstanceData()[0],y.IsWorldType()?this._CreateChildInstancesFromData(e,G,r,i,r.GetX(),r.GetY(),c):this._CreateChildInstancesFromData(e,G,r,i,void 0,void 0,c));return!o&&h&&(void 0===n&&(n=d[0]),void 0===a&&(a=d[1]),i=m.GetTopParent(),n=n-m.GetX()+i.GetX(),a=a-m.GetY()+i.GetY(),i.SetXY(n,a)),_._SetIIDsStale(),a=u?e.cloneArray(u[5]):null,u=u?u[4].map(t=>e.cloneArray(t)):null,(p=p&&d&&d[13])&&s._SetHasTilemap(),s._CreateSdkInstance(a,u),p&&(d=d[13],s.GetSdkInstance().LoadTilemapData(d[2],d[0],d[1])),this._instancesPendingCreate.push(s),this._hasPendingInstances=!0,this.IsDebug()&&t.InstanceCreated(s),s}_CreateChildInstancesFromData(e,t,s,i,r,n,a){var o=s.GetSceneGraphZIndexExportData(),h=s.GetSceneGraphChildrenExportData();if(e.GetWorldInfo().SetSceneGraphZIndex(o),h){void 0===r&&(r=t[0]),void 0===n&&(n=t[1]),o=new Set,s=t[0],t=t[1];for(const d of h){var l=d[1],c=d[2];h=d[3];var u=!!d[4];const p=d[5];c=this._layoutManager.GetLayoutBySID(d[0]).GetLayer(l).GetInitialInstanceData(c),l=this.GetObjectClassByIndex(c[1]);var _=e.HasSibling(l);const g=o.has(l);_&&!g&&u?(u=e.GetSibling(l),_=r+c[0][0]-s,c=n+c[0][1]-t,u.GetWorldInfo().SetXY(_,c),u.GetWorldInfo().SetSceneGraphZIndex(p),e.AddChild(u,{transformX:!!(h>>0&1),transformY:!!(h>>1&1),transformWidth:!!(h>>2&1),transformHeight:!!(h>>3&1),transformAngle:!!(h>>4&1),destroyWithParent:!!(h>>5&1),transformZElevation:!!(h>>6&1)}),o.add(l)):(l=this.CreateInstanceFromData(c,i,!1,r+c[0][0]-s,n+c[0][1]-t,!1,!0,e,a),l.GetWorldInfo().SetSceneGraphZIndex(p),e.AddChild(l,{transformX:!!(h>>0&1),transformY:!!(h>>1&1),transformWidth:!!(h>>2&1),transformHeight:!!(h>>3&1),transformAngle:!!(h>>4&1),destroyWithParent:!!(h>>5&1),transformZElevation:!!(h>>6&1)}))}}}DestroyInstance(e){if(!this._instancesToReleaseAtEndOfTick.has(e)){var s=e.GetObjectClass(),i=this._instancesPendingDestroy.get(s);if(i){if(i.has(e))return;i.add(e)}else i=new Set,i.add(e),this._instancesPendingDestroy.set(s,i);if(this.IsDebug()&&t.InstanceDestroyed(e),e._MarkDestroyed(),this._hasPendingInstances=!0,e.IsInContainer())for(const t of e.siblings())this.DestroyInstance(t);for(const t of e.children())t.GetDestroyWithParent()&&this.DestroyInstance(t);this._layoutManager.IsEndingLayout()||this._isLoadingState||(s=this.GetEventSheetManager(),s.BlockFlushingInstances(!0),e._TriggerOnDestroyed(),s.BlockFlushingInstances(!1)),e._FireDestroyedScriptEvents(this._layoutManager.IsEndingLayout())}}FlushPendingInstances(){this._hasPendingInstances&&(this._isFlushingPendingInstances=!0,this._FlushInstancesPendingCreate(),this._FlushInstancesPendingDestroy(),this._hasPendingInstances=this._isFlushingPendingInstances=!1,this.UpdateRender())}_FlushInstancesPendingCreate(){for(const e of this._instancesPendingCreate){const t=e.GetObjectClass();t._AddInstance(e);for(const s of t.GetFamilies())s._AddInstance(e),s._SetIIDsStale()}e.clearArray(this._instancesPendingCreate)}_FlushInstancesPendingDestroy(){this._dispatcher.SetDelayRemoveEventsEnabled(!0);for(const[e,t]of this._instancesPendingDestroy.entries())this._FlushInstancesPendingDestroyForObjectClass(e,t),t.clear();this._instancesPendingDestroy.clear(),this._dispatcher.SetDelayRemoveEventsEnabled(!1)}_FlushInstancesPendingDestroyForObjectClass(t,s){for(const e of s){var i=this._eventObjects.instancedestroy;i.instance=e,this._dispatcher.dispatchEvent(i),this._instancesByUid.delete(e.GetUID()),(i=e.GetWorldInfo())&&(i._RemoveFromCollisionCells(),i._RemoveFromRenderCells(),i._MarkDestroyed()),this._instancesToReleaseAtEndOfTick.add(e),this._objectCount--}e.arrayRemoveAllInSet(t.GetInstances(),s),t._SetIIDsStale(),this._instancesToReleaseAffectedObjectClasses.add(t),0===t.GetInstances().length&&t._SetAnyInstanceParallaxed(!1);for(const i of t.GetFamilies())e.arrayRemoveAllInSet(i.GetInstances(),s),i._SetIIDsStale(),this._instancesToReleaseAffectedObjectClasses.add(i);if(t.GetPlugin().IsWorldType()){t=new Set([...s].map(e=>e.GetWorldInfo().GetLayer()));for(const e of t)e._RemoveAllInstancesInSet(s)}}_GetInstancesPendingCreate(){return this._instancesPendingCreate}*instancesPendingCreateForObjectClass(e){for(const t of this._GetInstancesPendingCreate())e.IsFamily()?t.GetObjectClass().BelongsToFamily(e)&&(yield t):t.GetObjectClass()===e&&(yield t)}_GetNewUID(){return this._nextUid++}_MapInstanceByUID(e,t){this._instancesByUid.set(e,t)}_OnWebGLContextLost(){for(var t of(this._dispatcher.dispatchEvent(e.New(e.Event,"webglcontextlost")),this.SetSuspended(!0),this._allObjectClasses))!t.IsFamily()&&t.HasLoadedTextures()&&t.ReleaseTextures();(t=this.GetMainRunningLayout())&&t._OnWebGLContextLost(),e.ImageInfo.OnWebGLContextLost(),e.ImageAsset.OnWebGLContextLost()}async _OnWebGLContextRestored(){await this.GetMainRunningLayout()._Load(null,this.GetWebGLRenderer()),this._dispatcher.dispatchEvent(e.New(e.Event,"webglcontextrestored")),this.SetSuspended(!1),this.UpdateRender()}_OnVisibilityChange(e){this.SetSuspended(e.hidden)}_OnWindowBlur(t){this.IsPreview()&&this._pauseOnBlur&&!e.Platform.IsMobile&&!t.data.parentHasFocus&&(this.SetSuspended(!0),this._isPausedOnBlur=!0)}_OnWindowFocus(){this._isPausedOnBlur&&(this.SetSuspended(!1),this._isPausedOnBlur=!1)}_RequestAnimationFrame(){const t=this._tickCallbacks;"vsync"===this._framerateMode?-1===this._rafId&&(this._rafId=self.requestAnimationFrame(t.normal)):"unlimited-tick"===this._framerateMode?(-1===this._ruafId&&(this._ruafId=e.RequestUnlimitedAnimationFrame(t.tickOnly)),-1===this._rafId&&(this._rafId=self.requestAnimationFrame(t.renderOnly))):-1===this._ruafId&&(this._ruafId=e.RequestUnlimitedAnimationFrame(t.normal))}_CancelAnimationFrame(){-1!==this._rafId&&(self.cancelAnimationFrame(this._rafId),this._rafId=-1),-1!==this._ruafId&&(e.CancelUnlimitedAnimationFrame(this._ruafId),this._ruafId=-1)}IsSuspended(){return 0<this._suspendCount}SetSuspended(t){var s=this.IsSuspended();this._suspendCount+=t?1:-1,0>this._suspendCount&&(this._suspendCount=0),t=this.IsSuspended(),!s&&t?(console.log("[Construct 3] Suspending"),this._CancelAnimationFrame(),this._dispatcher.dispatchEvent(e.New(e.Event,"suspend")),this.Trigger(e.Plugins.System.Cnds.OnSuspend,null,null)):s&&!t&&(console.log("[Construct 3] Resuming"),this._fpsLastTime=this._lastTickTime=s=performance.now(),this._mainThreadTimeCounter=this._mainThreadTime=this._fps=this._fpsFrameCount=0,this._dispatcher.dispatchEvent(e.New(e.Event,"resume")),this.Trigger(e.Plugins.System.Cnds.OnResume,null,null),this.HitBreakpoint()||this.Tick(s))}_AddBehInstToTick(e){this._behInstsToTick.Add(e)}_AddBehInstToPostTick(e){this._behInstsToPostTick.Add(e)}_AddBehInstToTick2(e){this._behInstsToTick2.Add(e)}_RemoveBehInstToTick(e){this._behInstsToTick.Remove(e)}_RemoveBehInstToPostTick(e){this._behInstsToPostTick.Remove(e)}_RemoveBehInstToTick2(e){this._behInstsToTick2.Remove(e)}_BehaviorTick(){this._behInstsToTick.SetQueueingEnabled(!0);for(const e of this._behInstsToTick)e.Tick();this._behInstsToTick.SetQueueingEnabled(!1)}_BehaviorPostTick(){this._behInstsToPostTick.SetQueueingEnabled(!0);for(const e of this._behInstsToPostTick)e.PostTick();this._behInstsToPostTick.SetQueueingEnabled(!1)}_BehaviorTick2(){this._behInstsToTick2.SetQueueingEnabled(!0);for(const e of this._behInstsToTick2)e.Tick2();this._behInstsToTick2.SetQueueingEnabled(!1)}*_DebugBehaviorTick(){this._behInstsToTick.SetQueueingEnabled(!0);for(const t of this._behInstsToTick){const s=t.Tick();e.IsIterator(s)&&(yield*s)}this._behInstsToTick.SetQueueingEnabled(!1)}*_DebugBehaviorPostTick(){this._behInstsToPostTick.SetQueueingEnabled(!0);for(const t of this._behInstsToPostTick){const s=t.PostTick();e.IsIterator(s)&&(yield*s)}this._behInstsToPostTick.SetQueueingEnabled(!1)}*_DebugBehaviorTick2(){this._behInstsToTick2.SetQueueingEnabled(!0);for(const t of this._behInstsToTick2){const s=t.Tick2();e.IsIterator(s)&&(yield*s)}this._behInstsToTick2.SetQueueingEnabled(!1)}async Tick(e,t,s){this._hasStartedTicking=!0;const i="background-wake"===s;s="background-wake"!==s&&"skip-render"!==s,this._hasStarted&&(!this.IsSuspended()||t||i)&&(t=performance.now(),this._isInTick=!0,this._MeasureDt(e||0),e=this.Step_BeforePreTick(),this.IsDebugging()&&await e,e=this._dispatcher.dispatchEventAndWait_AsyncOptional(this._eventObjects.pretick),e instanceof Promise&&await e,e=this.Step_AfterPreTick(),this.IsDebugging()&&await e,this._NeedsHandleSaveOrLoad()&&await this._HandleSaveOrLoad(),this.GetLayoutManager().IsPendingChangeMainLayout()&&await this._MaybeChangeLayout(),e=this.Step_RunEventsEtc(),this.IsDebugging()&&await e,s&&this.Render(),this.IsSuspended()||i||this._RequestAnimationFrame(),this._tickCount++,this._tickCountNoSave++,this._execCount++,this._isInTick=!1,this._mainThreadTimeCounter+=performance.now()-t)}async Step_BeforePreTick(){const e=this._eventSheetManager,s=this.IsDebug();this.FlushPendingInstances(),e.BlockFlushingInstances(!0),this.PushCurrentLayout(this.GetMainRunningLayout()),s&&t.StartMeasuringTime(),this.IsDebugging()?await e.DebugRunScheduledWaits():e.RunScheduledWaits(),s&&t.AddEventsTime(),this.PopCurrentLayout(),e.BlockFlushingInstances(!1),this.FlushPendingInstances(),e.BlockFlushingInstances(!0)}async Step_AfterPreTick(){const e=this.IsDebug(),s=this.IsDebugging(),i=this._dispatcher,r=this._eventObjects,n=this._userScriptEventObjects;e&&t.StartMeasuringTime(),s?await this.DebugIterateAndBreak(this._DebugBehaviorTick()):this._BehaviorTick(),s?await this.DebugIterateAndBreak(this._DebugBehaviorPostTick()):this._BehaviorPostTick(),e&&t.AddBehaviorTickTime(),e&&t.StartMeasuringTime(),s?await this.DebugFireGeneratorEventAndBreak(r.tick):i.dispatchEvent(r.tick),e&&t.AddPluginTickTime(),this._eventSheetManager.BlockFlushingInstances(!1),this.DispatchUserScriptEvent(n.tick)}async Step_RunEventsEtc(){const e=this._eventSheetManager,s=this._dispatcher,i=this._eventObjects,r=this.IsDebug(),n=this.IsDebugging();r&&t.StartMeasuringTime(),n?await e.DebugRunEvents(this._layoutManager):e.RunEvents(this._layoutManager),r&&t.AddEventsTime(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleaseInstancesAtEndOfTick(),this._isLayoutFirstTick=!1,e.BlockFlushingInstances(!0),r&&t.StartMeasuringTime(),n?await this.DebugIterateAndBreak(this._DebugBehaviorTick2()):this._BehaviorTick2(),r&&t.AddBehaviorTickTime(),r&&t.StartMeasuringTime(),n?await this.DebugFireGeneratorEventAndBreak(i.tick2):s.dispatchEvent(i.tick2),r&&t.AddPluginTickTime(),e.BlockFlushingInstances(!1),n&&await e.RunQueuedDebugTriggersAsync()}_ReleaseInstancesAtEndOfTick(){if(0!==this._instancesToReleaseAtEndOfTick.size){var e=this._dispatcher;e.SetDelayRemoveEventsEnabled(!0);for(const e of this._instancesToReleaseAffectedObjectClasses)e.GetSolStack().RemoveInstances(this._instancesToReleaseAtEndOfTick);this._instancesToReleaseAffectedObjectClasses.clear(),this._eventSheetManager.RemoveInstancesFromScheduledWaits(this._instancesToReleaseAtEndOfTick);for(const e of this._instancesToReleaseAtEndOfTick)e.Release();this._instancesToReleaseAtEndOfTick.clear(),e.SetDelayRemoveEventsEnabled(!1)}}async _MaybeChangeLayout(){const e=this.GetLayoutManager();let t=0;for(;e.IsPendingChangeMainLayout()&&10>t++;)await this._DoChangeLayout(e.GetPendingChangeMainLayout())}_MeasureDt(e){let s=0;0!==this._lastTickTime&&(s=Math.max(e-this._lastTickTime,0)/1e3,.5<s&&(s=0),this._dt1=Math.min(s,1/this._minimumFramerate)),this._lastTickTime=e,this._dt=this._dt1*this._timeScale,this._gameTime.Add(this._dt),this._gameTimeRaw.Add(s*this._timeScale),this._wallTime.Add(this._dt1),this._canvasManager&&this._canvasManager._UpdateTick(),1e3<=e-this._fpsLastTime&&(this._fpsLastTime+=1e3,1e3<=e-this._fpsLastTime&&(this._fpsLastTime=e),this._fps=this._fpsFrameCount,this._fpsFrameCount=0,this._mainThreadTime=Math.min(this._mainThreadTimeCounter/1e3,1),this._mainThreadTimeCounter=0,this._canvasManager&&this._canvasManager._Update1sFrameRange(),this._collisionEngine._Update1sStats(),this.IsDebug()&&t.Update1sPerfStats()),this._fpsFrameCount++}async _DoChangeLayout(t){const s=this._dispatcher,i=this.GetLayoutManager().GetMainRunningLayout();await i._StopRunning(),i._Unload(t,this.GetRenderer()),i===t&&this._eventSheetManager.ClearAllScheduledWaits(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleaseInstancesAtEndOfTick(),s.dispatchEvent(this._eventObjects.beforelayoutchange),e.Asyncify.SetHighThroughputMode(!0),await t._Load(i,this.GetRenderer()),e.Asyncify.SetHighThroughputMode(!1),await t._StartRunning(!1),s.dispatchEvent(this._eventObjects.layoutchange),this.UpdateRender(),this._isLayoutFirstTick=!0,this.FlushPendingInstances()}UpdateRender(){this._needRender=!0}GetWebGLRenderer(){return this._canvasManager?this._canvasManager.GetWebGLRenderer():null}GetWebGPURenderer(){return this._canvasManager?this._canvasManager.GetWebGPURenderer():null}GetRenderer(){return this._canvasManager?this._canvasManager.GetRenderer():null}Render(){const e=this._canvasManager;if(e&&!e.IsRendererContextLost()){var s=this.GetRenderer(),i=s.SupportsGPUProfiling(),r=i&&s.IsWebGL();if(i=i&&s.IsWebGPU(),r&&s.CheckForQueryResults(),this._needRender){var n=this._layoutManager.GetMainRunningLayout();s.Start();var a=this.IsDebug();a&&t.StartMeasuringTime(),this._needRender=!1;var o=null;r&&(o=e.GetGPUFrameTimingsBuffer().AddTimeElapsedQuery(),s.StartQuery(o)),r=null,i&&(r=s.StartFrameTiming(2*(1+n.GetLayerCount())),s.WriteTimestamp(0)),this.Uses3DFeatures()&&"low"===e.GetCurrentFullscreenScalingQuality()?s.SetFixedSizeDepthBuffer(e.GetDrawWidth(),e.GetDrawHeight()):s.SetAutoSizeDepthBuffer(),this._Render(this.GetRenderer(),n),o&&s.EndQuery(o),i&&(s.WriteTimestamp(1),this._canvasManager._AddWebGPUFrameTiming(r)),s.Finish(),a&&(t.AddDrawCallsTime(),t.UpdateInspectHighlight()),e&&e._MaybeTakeSnapshot()}else s.IncrementFrameNumber()}}_Render(e,t){e.SetTextureFillMode(),e.SetAlphaBlend(),e.SetColorRgba(1,1,1,1),e.SetRenderTarget(null),e.SetTexture(null),e.SetDepthEnabled(this.Uses3DFeatures()),t.Draw(e)}Trigger(e,s,i){if(!this._hasStarted)return!1;var r=!this._isInTick&&!this._eventSheetManager.IsInTrigger();let n=0;r&&(n=performance.now());const a=this.IsDebug();return a&&this.SetDebuggingEnabled(!1),e=this._eventSheetManager._Trigger(this._layoutManager,e,s,i),r&&(r=performance.now()-n,this._mainThreadTimeCounter+=r,a&&t.AddTriggersTime(r)),a&&this.SetDebuggingEnabled(!0),e}DebugTrigger(e,t,s){if(!this.IsDebug())return this.Trigger(e,t,s);if(this.HitBreakpoint())throw Error("called DebugTrigger() while stopped on breakpoint");if(!this._isInTick&&!this._eventSheetManager.IsInTrigger())throw Error("called DebugTrigger() outside of event code - use TriggerAsync() instead");return this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,s)}async TriggerAsync(e,t,s){if(!this.IsDebugging())return this.Trigger(e,t,s);if(!this._hasStarted)return!1;if(this.HitBreakpoint())return this._eventSheetManager.QueueDebugTrigger(e,t,s);if(!this.GetMainRunningLayout())return this._eventSheetManager.QueueTrigger(e,t,s);const i=performance.now();for(e=this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,s),t=e.next();!t.done;)await this.DebugBreak(t.value),t=e.next();return this.IsSuspended()||this._eventSheetManager.IsInTrigger()||(await this._eventSheetManager.RunQueuedDebugTriggersAsync(),this._hasStartedTicking&&!this._isInTick&&this._RequestAnimationFrame()),this._mainThreadTimeCounter+=performance.now()-i,t.value}FastTrigger(e,t,s){const i=this.IsDebug();return i&&this.SetDebuggingEnabled(!1),e=this._eventSheetManager._FastTrigger(this._layoutManager,e,t,s),i&&this.SetDebuggingEnabled(!0),e}DebugFastTrigger(e,t,s){return this._eventSheetManager._DebugFastTrigger(this._layoutManager,e,t,s)}ScheduleTriggers(e){return this._scheduleTriggersThrottle.Add(e)}PushCurrentLayout(e){this._currentLayoutStack.push(e)}PopCurrentLayout(){if(!this._currentLayoutStack.length)throw Error("layout stack empty");this._currentLayoutStack.pop()}GetCurrentLayout(){return this._currentLayoutStack.length?this._currentLayoutStack.at(-1):this.GetMainRunningLayout()}GetDt(e){return e&&-1!==e.GetTimeScale()?this._dt1*e.GetTimeScale():this._dt}_GetDtFast(){return this._dt}GetDt1(){return this._dt1}GetTimeScale(){return this._timeScale}SetTimeScale(e){(isNaN(e)||0>e)&&(e=0),this._timeScale=e}SetMinimumFramerate(t){this._minimumFramerate=e.clamp(t,1,120)}GetMinimumFramerate(){return this._minimumFramerate}GetFPS(){return this._fps}GetMainThreadTime(){return this._mainThreadTime}GetStartTime(){return this._startTime}GetGameTime(){return this._gameTime.Get()}GetGameTimeRaw(){return this._gameTimeRaw.Get()}GetWallTime(){return this._wallTime.Get()}GetTickCount(){return this._tickCount}GetTickCountNoSave(){return this._tickCountNoSave}IncrementExecCount(){++this._execCount}GetExecCount(){return this._execCount}GetObjectCount(){return this._objectCount}GetProjectName(){return this._projectName}GetProjectVersion(){return this._projectVersion}GetProjectUniqueId(){return this._projectUniqueId}GetAppId(){return this._appId}GetInstanceByUID(e){if(this._isLoadingState)throw Error("cannot call while loading state - wait until afterload event");return this._instancesByUid.get(e)||null}_RefreshUidMap(){this._instancesByUid.clear();for(const e of this._allObjectClasses)if(!e.IsFamily())for(const t of e.GetInstances())this._instancesByUid.set(t.GetUID(),t)}IsPreview(){return"preview"===this._exportType}IsDebug(){return this._isDebug}GetExportType(){return this._exportType}IsCordova(){return"cordova"===this._exportType}IsAndroidWebView(){return"Android"===e.Platform.OS&&("cordova"===this._exportType||"playable-ad"===this._exportType||"instant-games"===this._exportType)}IsiOSCordova(){return this._isiOSCordova}IsiOSWebView(){return this._isiOSWebView}GetCollisionEngine(){return this._collisionEngine}GetSolidBehavior(){return this._pluginManager.GetSolidBehavior()}GetJumpthruBehavior(){return this._pluginManager.GetJumpthruBehavior()}Uses3DFeatures(){
return this._uses3dFeatures}GetZScaleFactor(){const e=this.GetRenderer();return this.GetViewportHeight()/2/Math.tan(e.GetFovY()/2)/e.GetDefaultCameraZ()}IsLayoutFirstTick(){return this._isLayoutFirstTick}SetPixelRoundingEnabled(e){e=!!e,this._isPixelRoundingEnabled!==e&&(this._isPixelRoundingEnabled=e,this.GetLayoutManager().SetAllLayerMVChanged(),this.UpdateRender())}IsPixelRoundingEnabled(){return this._isPixelRoundingEnabled}SaveToSlot(e){this._saveToSlotName=e}LoadFromSlot(e){this._loadFromSlotName=e}LoadFromJsonString(e){this._loadFromJson=e}GetLastSaveJsonString(){return this._lastSaveJson}_NeedsHandleSaveOrLoad(){return!(!this._saveToSlotName&&!this._loadFromSlotName&&null===this._loadFromJson)}async _HandleSaveOrLoad(){if(this._saveToSlotName&&(this.FlushPendingInstances(),await this._DoSaveToSlot(this._saveToSlotName),this._ClearSaveOrLoad()),this._loadFromSlotName&&(await this._DoLoadFromSlot(this._loadFromSlotName),this._ClearSaveOrLoad(),this.IsDebug()&&t.StepIfPausedInDebugger()),null!==this._loadFromJson){this.FlushPendingInstances();try{await this._DoLoadFromJsonString(this._loadFromJson),this._lastSaveJson=this._loadFromJson,await this.TriggerAsync(e.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(t){console.error("[Construct 3] Failed to load state from JSON string: ",t),await this.TriggerAsync(e.Plugins.System.Cnds.OnLoadFailed,null)}this._ClearSaveOrLoad()}}_ClearSaveOrLoad(){this._loadFromSlotName=this._saveToSlotName="",this._loadFromJson=null}_GetProjectStorage(){return this._projectStorage||(this._projectStorage=localforage.createInstance({name:"c3-localstorage-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._projectStorage}_GetSavegamesStorage(){return this._savegamesStorage||(this._savegamesStorage=localforage.createInstance({name:"c3-savegames-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._savegamesStorage}async _DoSaveToSlot(t){const s=await this._SaveToJsonString();try{await this._GetSavegamesStorage().setItem(t,s),console.log("[Construct 3] Saved state to storage ("+s.length+" chars)"),this._lastSaveJson=s,await this.TriggerAsync(e.Plugins.System.Cnds.OnSaveComplete,null),this._lastSaveJson=""}catch(t){console.error("[Construct 3] Failed to save state to storage: ",t),await this.TriggerAsync(e.Plugins.System.Cnds.OnSaveFailed,null)}}async _DoLoadFromSlot(t){try{const s=await this._GetSavegamesStorage().getItem(t);if(!s)throw Error("empty slot");console.log("[Construct 3] Loaded state from storage ("+s.length+" chars)"),await this._DoLoadFromJsonString(s),this._lastSaveJson=s,await this.TriggerAsync(e.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(t){console.error("[Construct 3] Failed to load state from storage: ",t),await this.TriggerAsync(e.Plugins.System.Cnds.OnLoadFailed,null)}}async _SaveToJsonString(){const e={c3save:!0,version:1,rt:{time:this.GetGameTime(),timeRaw:this.GetGameTimeRaw(),walltime:this.GetWallTime(),timescale:this.GetTimeScale(),tickcount:this.GetTickCount(),execcount:this.GetExecCount(),next_uid:this._nextUid,running_layout:this.GetMainRunningLayout().GetSID(),start_time_offset:Date.now()-this._startTime},types:{},layouts:{},events:this._eventSheetManager._SaveToJson(),timelines:this._timelineManager._SaveToJson(),user_script_data:null};for(var t of this._allObjectClasses)t.IsFamily()||t.HasNoSaveBehavior()||(e.types[t.GetSID().toString()]=t._SaveToJson());for(const t of this._layoutManager.GetAllLayouts())e.layouts[t.GetSID().toString()]=t._SaveToJson();return t=this._CreateUserScriptEvent("save"),t.saveData=null,await this.DispatchUserScriptEventAsyncWait(t),e.user_script_data=t.saveData,JSON.stringify(e)}IsLoadingState(){return this._isLoadingState}async _DoLoadFromJsonString(t){var s=this.GetLayoutManager();if(t=JSON.parse(t),t.c2save)throw Error("C2 saves are incompatible with C3 runtime");if(!t.c3save)throw Error("not valid C3 save data");if(1<t.version)throw Error("C3 save data from future version");for(var i of(this._dispatcher.dispatchEvent(e.New(e.Event,"beforeload")),this.allInstances()))i._OnBeforeLoad();this._isLoadingState=!0,i=t.rt,this._gameTime.Set(i.time),i.hasOwnProperty("timeRaw")&&this._gameTimeRaw.Set(i.timeRaw),this._wallTime.Set(i.walltime),this._timeScale=i.timescale,this._tickCount=i.tickcount,this._execCount=i.execcount,this._startTime=Date.now()-i.start_time_offset;var r=i.running_layout;if(r!==this.GetMainRunningLayout().GetSID()){if(!(r=s.GetLayoutBySID(r)))return;await this._DoChangeLayout(r)}for(const[e,s]of Object.entries(t.types))r=parseInt(e,10),r=this.GetObjectClassBySID(r),!r||r.IsFamily()||r.HasNoSaveBehavior()||r._LoadFromJson(s);this.FlushPendingInstances(),this._RefreshUidMap(),this._isLoadingState=!1,this._nextUid=i.next_uid;for(const[e,r]of Object.entries(t.layouts))i=parseInt(e,10),(i=s.GetLayoutBySID(i))&&i._LoadFromJson(r);this._eventSheetManager._LoadFromJson(t.events);for(const e of this._allObjectClasses)if(!e.IsFamily()&&e.IsInContainer())for(const t of e.GetInstances()){i=t.GetIID();for(const s of e.GetContainer().objectTypes())if(s!==e){if(r=s.GetInstances(),0>i||i>=r.length)throw Error("missing sibling instance");t._AddSibling(r[i])}}this._timelineManager._LoadFromJson(t.timelines),s.SetAllLayerProjectionChanged(),s.SetAllLayerMVChanged(),this._dispatcher.dispatchEvent(e.New(e.Event,"afterload")),s=this._CreateUserScriptEvent("load"),s.saveData=t.user_script_data,await this.DispatchUserScriptEventAsyncWait(s),this.UpdateRender()}async AddJobWorkerScripts(e){e=(await Promise.all(e.map(e=>this._assetManager.FetchBlob(e)))).map(e=>URL.createObjectURL(e)),this._jobScheduler.ImportScriptsToJobWorkers(e)}AddJobWorkerBlob(e,t){this._jobScheduler.SendBlobToJobWorkers(e,t)}AddJobWorkerBuffer(e,t){this._jobScheduler.SendBufferToJobWorkers(e,t)}AddJob(e,t,s){return this._jobScheduler.AddJob(e,t,s)}BroadcastJob(e,t,s){return this._jobScheduler.BroadcastJob(e,t,s)}InvokeDownload(e,t){this.PostComponentMessageToDOM("runtime","invoke-download",{url:e,filename:t})}async RasterSvgImage(e,t,s,i,r,n){return i=i||t,r=r||s,this.IsInWorker()?(await this.PostComponentMessageToDOMAsync("runtime","raster-svg-image",{blob:e,imageWidth:t,imageHeight:s,surfaceWidth:i,surfaceHeight:r,imageBitmapOpts:n})).imageBitmap:(e=await self.C3_RasterSvgImageBlob(e,t,s,i,r),n?await self.createImageBitmap(e,n):e)}async GetSvgImageSize(e){return this.IsInWorker()?await this.PostComponentMessageToDOMAsync("runtime","get-svg-image-size",{blob:e}):await self.C3_GetSvgImageSize(e)}RequestDeviceOrientationEvent(){this._didRequestDeviceOrientationEvent||(this._didRequestDeviceOrientationEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-orientation"))}RequestDeviceMotionEvent(){this._didRequestDeviceMotionEvent||(this._didRequestDeviceMotionEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-motion"))}Random(){return this._randomNumberCallback()}SetRandomNumberGeneratorCallback(e){this._randomNumberCallback=e}_GetRemotePreviewStatusInfo(){const e=this.GetWebGLRenderer();return{fps:this.GetFPS(),cpu:this.GetMainThreadTime(),gpu:this.GetGPUUtilisation(),layout:this.GetMainRunningLayout()?this.GetMainRunningLayout().GetName():"",renderer:e?e.GetUnmaskedRenderer():"<unavailable>"}}HitBreakpoint(){return!!this.IsDebug()&&t.HitBreakpoint()}DebugBreak(e){return this.IsDebugging()?t.DebugBreak(e):Promise.resolve()}DebugBreakNext(){return!!this.IsDebugging()&&t.BreakNext()}SetDebugBreakpointsEnabled(e){this._breakpointsEnabled=!!e,this._UpdateDebuggingFlag()}AreDebugBreakpointsEnabled(){return this._breakpointsEnabled}IsDebugging(){return this._isDebugging}SetDebuggingEnabled(e){e?this._debuggingDisabled--:this._debuggingDisabled++,this._UpdateDebuggingFlag()}_UpdateDebuggingFlag(){this._isDebugging=this.IsDebug()&&this._breakpointsEnabled&&0===this._debuggingDisabled}IsCPUProfiling(){return this.IsDebug()&&t.IsCPUProfiling()}IsGPUProfiling(){return this.IsDebug()&&this.GetRenderer().SupportsGPUProfiling()&&t.IsGPUProfiling()}async DebugIterateAndBreak(e){if(e)for(const t of e)await this.DebugBreak(t)}DebugFireGeneratorEventAndBreak(e){return this.DebugIterateAndBreak(this._dispatcher.dispatchGeneratorEvent(e))}_InvokeFunctionFromJS(e){return this._eventSheetManager._InvokeFunctionFromJS(e.name,e.params)}GetIRuntime(){return this._iRuntime}_CreateUserScriptEvent(t){return t=e.New(e.Event,t,!1),t.runtime=this._iRuntime,t}_InitScriptInterfaces(){var e={};for(const t of this._allObjectClasses)e[t.GetJsPropName()]={value:t.GetIObjectClass(),enumerable:!0,writable:!1};e=Object.create(Object.prototype,e),this._iRuntime=new self.IRuntime(this,e),this._userScriptEventObjects={tick:this._CreateUserScriptEvent("tick")}}_InitGlobalVariableScriptInterface(){const e={};for(const t of this.GetEventSheetManager().GetAllGlobalVariables())e[t.GetJsPropName()]=t._GetScriptInterfaceDescriptor();this._iRuntime._InitGlobalVars(e)}_GetCommonScriptInterfaces(){return this._commonScriptInterfaces}_MapScriptInterface(e,t){this._interfaceMap.set(e,t)}_UnwrapScriptInterface(e){return this._interfaceMap.get(e)}_UnwrapIObjectClass(t){if(!(t instanceof self.IObjectClass))throw new TypeError("expected IObjectClass");if(t=this._UnwrapScriptInterface(t),!(t&&t instanceof e.ObjectClass))throw Error("invalid IObjectClass");return t}_UnwrapIWorldInstance(t){if(!(t instanceof self.IWorldInstance))throw new TypeError("expected IWorldInstance");if(t=this._UnwrapScriptInterface(t),!(t&&t instanceof e.Instance))throw Error("invalid IInstance");return t}},self.C3_CreateRuntime=e.Runtime.Create,self.C3_InitRuntime=((e,t)=>e.Init(t))}{const e=self.C3;e.JobSchedulerRuntime=class extends e.DefendedBase{constructor(e,t){super(),this._runtime=e,this._jobPromises=new Map,this._nextJobId=0,this._inputPort=t.inputPort,t.outputPort.onmessage=(e=>this._OnJobWorkerMessage(e)),this._maxNumWorkers=t.maxNumWorkers,this._jobWorkerCount=1,this._hadErrorCreatingWorker=this._isCreatingWorker=!1}async Init(){}ImportScriptsToJobWorkers(e){this._inputPort.postMessage({type:"_import_scripts",scripts:e})}SendBlobToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_blob",blob:e,id:t})}SendBufferToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_buffer",buffer:e,id:t},[e])}AddJob(e,t,s,i,r){s||(s=[]);const n=this._nextJobId++;return e={type:e,isBroadcast:!1,jobId:n,params:t,transferables:s},t=new Promise((e,t)=>{this._jobPromises.set(n,{resolve:e,progress:i,reject:t,cancelled:!1})}),r&&r.SetAction(()=>this._CancelJob(n)),this._inputPort.postMessage(e,s),this._MaybeCreateExtraWorker(),t}BroadcastJob(e,t,s){s||(s=[]);const i=this._nextJobId++;this._inputPort.postMessage({type:e,isBroadcast:!0,jobId:i,params:t,transferables:s},s)}_CancelJob(e){const t=this._jobPromises.get(e);t&&(t.cancelled=!0,t.resolve=null,t.progress=null,t.reject=null,this._inputPort.postMessage({type:"_cancel",jobId:e}))}_OnJobWorkerMessage(e){e=e.data;const t=e.type,s=e.jobId;switch(t){case"result":this._OnJobResult(s,e.result);break;case"progress":this._OnJobProgress(s,e.progress);break;case"error":this._OnJobError(s,e.error);break;case"ready":this._OnJobWorkerReady();break;default:throw Error(`unknown message from worker '${t}'`)}}_OnJobResult(e,t){const s=this._jobPromises.get(e);if(!s)throw Error("invalid job ID");s.cancelled||s.resolve(t),this._jobPromises.delete(e)}_OnJobProgress(e,t){if(e=this._jobPromises.get(e),!e)throw Error("invalid job ID");!e.cancelled&&e.progress&&e.progress(t)}_OnJobError(e,t){const s=this._jobPromises.get(e);if(!s)throw Error("invalid job ID");s.cancelled||s.reject(t),this._jobPromises.delete(e)}_OnJobWorkerReady(){this._isCreatingWorker&&(this._isCreatingWorker=!1,this._jobWorkerCount++,this._jobWorkerCount<this._maxNumWorkers?this._MaybeCreateExtraWorker():this._inputPort.postMessage({type:"_no_more_workers"}))}async _MaybeCreateExtraWorker(){if(!(this._jobWorkerCount>=this._maxNumWorkers||this._isCreatingWorker||this._hadErrorCreatingWorker||this._jobPromises.size<=this._jobWorkerCount))try{this._isCreatingWorker=!0,(await this._runtime.PostComponentMessageToDOMAsync("runtime","create-job-worker")).outputPort.onmessage=(e=>this._OnJobWorkerMessage(e))}catch(e){this._hadErrorCreatingWorker=!0,this._isCreatingWorker=!1,console.error(`[Construct 3] Failed to create job worker; stopping creating any more (created ${this._jobWorkerCount} so far)`,e)}}}}self.C3_Shaders={},self.C3_Shaders.alphaclamp={glsl:"precision mediump float;\nvarying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform lowp float alphathreshold;\nuniform lowp float lowerclamp;\nuniform lowp float upperclamp;\nvoid main(void)\n{\nlowp vec4 front = texture2D(samplerFront, vTex);\nlowp float a = front.a;\nlowp vec4 unpremultiplied = front / a;\na = (a < alphathreshold ? lowerclamp : upperclamp);\nfront *= a;\nfront.a = a;\ngl_FragColor = front;\n}",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\n[[block]] struct ShaderParams {\nalphathreshold : f32;\nlowerclamp : f32;\nupperclamp : f32;\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\n[[stage(fragment)]]\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar front : vec4<f32> = c3_unpremultiply(textureSample(textureFront, samplerFront, input.fragUV));\nfront.a = select(shaderParams.upperclamp, shaderParams.lowerclamp, front.a < shaderParams.alphathreshold);\nvar output : FragmentOutput;\noutput.color = vec4<f32>(front.rgb * front.a, front.a);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!0,animated:!1,parameters:[["alphathreshold",0,"percent"],["lowerclamp",0,"percent"],["upperclamp",0,"percent"]]},self.C3_Shaders.warpobject={glsl:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nvarying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform mediump vec2 srcStart;\nuniform mediump vec2 srcEnd;\nuniform mediump vec2 srcOriginStart;\nuniform mediump vec2 srcOriginEnd;\nuniform highmedp float seconds;\nuniform mediump vec2 pixelSize;\nuniform mediump float devicePixelRatio;\nuniform mediump float layerScale;\nuniform mediump float freqX;\nuniform mediump float freqY;\nuniform mediump float ampX;\nuniform mediump float ampY;\nuniform mediump float speedX;\nuniform mediump float speedY;\nvoid main(void)\n{\nmediump float _2pi = 2.0 * 3.14159265359;\nmediump vec2 srcOriginSize = srcOriginEnd - srcOriginStart;\nmediump vec2 n = ((vTex - srcOriginStart) / srcOriginSize);\nmediump vec2 p = vTex;\np.x += cos(n.y * _2pi * freqY + seconds * speedY * _2pi) * ampY * pixelSize.x * devicePixelRatio * layerScale;\np.y += sin(n.x * _2pi * freqX + seconds * speedX * _2pi) * ampX * pixelSize.y * devicePixelRatio * layerScale;\np = clamp(p, min(srcStart, srcEnd), max(srcStart, srcEnd));\ngl_FragColor = texture2D(samplerFront, p);\n}",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\n[[block]] struct ShaderParams {\nfreqX : f32;\nfreqY : f32;\nampX : f32;\nampY : f32;\nspeedX : f32;\nspeedY : f32;\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3PARAMS_STRUCT%%\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\nlet pi2 : f32 = 6.283185307179586;\n[[stage(fragment)]]\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar pixelSize : vec2<f32> = c3_getPixelSize(textureFront);\nvar n : vec2<f32> = c3_srcOriginToNorm(input.fragUV);\nvar p : vec2<f32> = input.fragUV + vec2<f32>(\ncos(n.y * pi2 * shaderParams.freqY + c3Params.seconds * shaderParams.speedY * pi2) * shaderParams.ampY * pixelSize.x * c3Params.devicePixelRatio * c3Params.layerScale,\nsin(n.x * pi2 * shaderParams.freqX + c3Params.seconds * shaderParams.speedX * pi2) * shaderParams.ampX * pixelSize.y * c3Params.devicePixelRatio * c3Params.layerScale\n);\np = c3_clampToSrc(p);\nvar output : FragmentOutput;\noutput.color = textureSample(textureFront, samplerFront, p);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:30,extendBoxVertical:30,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!1,animated:!0,parameters:[["freqX",0,"float"],["freqY",0,"float"],["ampX",0,"float"],["ampY",0,"float"],["speedX",0,"float"],["speedY",0,"float"]]},self.C3_Shaders.warpripple={glsl:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nvarying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform mediump vec2 srcOriginStart;\nuniform mediump vec2 srcOriginEnd;\nuniform highmedp float seconds;\nuniform mediump vec2 pixelSize;\nuniform mediump float freq;\nuniform mediump float amp;\nuniform mediump float speed;\nconst mediump float PI = 3.1415926;\nvoid main(void)\n{\nmediump vec2 srcOriginSize = srcOriginEnd - srcOriginStart;\nmediump vec2 tex = (vTex - srcOriginStart) / srcOriginSize;\ntex = tex * 2.0 - 1.0;\nmediump float d = length(tex);\nmediump float a = atan(tex.y, tex.x);\nd += sin((d * 2.0 * PI) * freq / (pixelSize.x * 750.0) + (seconds * speed)) * amp * (pixelSize.x * 750.0);\ntex.x = cos(a) * d;\ntex.y = sin(a) * d;\ntex = (tex + 1.0) / 2.0;\ntex = clamp(tex, 0.0, 1.0);\ntex = tex * srcOriginSize + srcOriginStart;\ngl_FragColor = texture2D(samplerFront, tex);\n}",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\n[[block]] struct ShaderParams {\nfreq : f32;\namp : f32;\nspeed : f32;\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3PARAMS_STRUCT%%\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\nlet pi : f32 = 3.1415926;\n[[stage(fragment)]]\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar pixelSize : vec2<f32> = c3_getPixelSize(textureFront);\nvar tex = c3_srcOriginToNorm(input.fragUV);\ntex = tex * 2.0 - 1.0;\nvar d : f32 = length(tex);\nvar a = atan2(tex.y, tex.x);\nd = d + sin((d * 2.0 * pi) * shaderParams.freq / (pixelSize.x * 750.0) + (c3Params.seconds * shaderParams.speed)) * shaderParams.amp * (pixelSize.x * 750.0);\ntex.x = cos(a) * d;\ntex.y = sin(a) * d;\ntex = (tex + 1.0) / 2.0;\ntex = c3_clamp2(tex, 0.0, 1.0);\ntex = c3_normToSrcOrigin(tex);\nvar output : FragmentOutput;\noutput.color = textureSample(textureFront, samplerFront, tex);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:50,extendBoxVertical:50,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!1,animated:!0,parameters:[["freq",0,"float"],["amp",0,"percent"],["speed",0,"float"]]},self.C3_Shaders.warpobjectmask={glsl:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nvarying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform mediump vec2 srcStart;\nuniform mediump vec2 srcEnd;\nuniform mediump vec2 srcOriginStart;\nuniform mediump vec2 srcOriginEnd;\nuniform lowp sampler2D samplerBack;\nuniform mediump vec2 destStart;\nuniform mediump vec2 destEnd;\nuniform highmedp float seconds;\nuniform mediump vec2 pixelSize;\nuniform mediump float devicePixelRatio;\nuniform mediump float layerScale;\nuniform mediump float freqX;\nuniform mediump float freqY;\nuniform mediump float ampX;\nuniform mediump float ampY;\nuniform mediump float speedX;\nuniform mediump float speedY;\nvoid main(void)\n{\nmediump float _2pi = 2.0 * 3.14159265359;\nlowp float fronta = texture2D(samplerFront, vTex).a;\nmediump vec2 srcSize = srcEnd - srcStart;\nmediump vec2 tex = ((vTex - srcStart) / srcSize);\nmediump vec2 srcOriginSize = srcOriginEnd - srcOriginStart;\nmediump vec2 n = ((vTex - srcOriginStart) / srcOriginSize);\nmediump vec2 p = mix(destStart, destEnd, tex);\np.x += cos(n.y * _2pi * freqY + seconds * speedY * _2pi) * ampY * pixelSize.x * devicePixelRatio * layerScale * fronta;\np.y += sin(n.x * _2pi * freqX + seconds * speedX * _2pi) * ampX * pixelSize.y * devicePixelRatio * layerScale * fronta;\np = clamp(p, min(destStart, destEnd), max(destStart, destEnd));\ngl_FragColor = texture2D(samplerBack, p);\n}",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\n%%SAMPLERBACK_BINDING%% var samplerBack : sampler;\n%%TEXTUREBACK_BINDING%% var textureBack : texture_2d<f32>;\n[[block]] struct ShaderParams {\nfreqX : f32;\nfreqY : f32;\nampX : f32;\nampY : f32;\nspeedX : f32;\nspeedY : f32;\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3PARAMS_STRUCT%%\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\nlet pi2 : f32 = 6.283185307179586;\n[[stage(fragment)]]\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar pixelSize : vec2<f32> = c3_getPixelSize(textureFront);\nvar fronta : f32 = textureSample(textureFront, samplerFront, input.fragUV).a;\nvar n : vec2<f32> = c3_srcOriginToNorm(input.fragUV);\nvar p : vec2<f32> = c3_getBackUV(input.fragUV) + vec2<f32>(\ncos(n.y * pi2 * shaderParams.freqY + c3Params.seconds * shaderParams.speedY * pi2) * shaderParams.ampY * pixelSize.x * c3Params.devicePixelRatio * c3Params.layerScale * fronta,\nsin(n.x * pi2 * shaderParams.freqX + c3Params.seconds * shaderParams.speedX * pi2) * shaderParams.ampX * pixelSize.y * c3Params.devicePixelRatio * c3Params.layerScale * fronta\n);\np = c3_clampToDest(p);\nvar output : FragmentOutput;\noutput.color = textureSample(textureBack, samplerBack, p);\nreturn output;\n}",blendsBackground:!0,usesDepth:!1,extendBoxHorizontal:30,extendBoxVertical:30,crossSampling:!0,mustPreDraw:!1,preservesOpaqueness:!1,animated:!0,parameters:[["freqX",0,"float"],["freqY",0,"float"],["ampX",0,"float"],["ampY",0,"float"],["speedX",0,"float"],["speedY",0,"float"]]},self.C3_Shaders["simple-skend"]={glsl:"uniform lowp float Skend;\nuniform lowp float Power;\nvarying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform mediump vec2 srcStart;\nuniform mediump vec2 srcEnd;\nuniform mediump vec2 srcOriginStart;\nuniform mediump vec2 srcOriginEnd;\nuniform mediump vec2 layoutStart;\nuniform mediump vec2 layoutEnd;\nuniform lowp sampler2D samplerBack;\nuniform mediump vec2 destStart;\nuniform mediump vec2 destEnd;\nuniform mediump float seconds;\nuniform mediump vec2 pixelSize;\nuniform mediump float layerScale;\nuniform mediump float layerAngle;\nvoid main(void)\n{\nmediump vec2 tex = vTex;\nmediump vec2 layoutSize = abs(vec2(layoutEnd.x-layoutStart.x,(layoutEnd.y-layoutStart.y)));\nmediump vec2 texelSize = abs(srcOriginEnd-srcOriginStart)/layoutSize;\nmediump vec2 n = (vTex - srcOriginStart) / (srcOriginEnd - srcOriginStart);\ntex.x -= (texelSize.x*Skend)*pow((1.-n.y),Power);\ntex = clamp(tex, srcOriginStart, srcOriginEnd);\ngl_FragColor = texture2D(samplerFront,tex);\n}",wgsl:"",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!1,animated:!1,parameters:[["Skend",0,"float"],["Power",0,"float"]]},self.C3_Shaders.blurvertical={glsl:"varying mediump vec2 vTex;\nuniform mediump sampler2D samplerFront;\nuniform mediump vec2 pixelSize;\nuniform mediump float intensity;\nvoid main(void)\n{\nmediump vec4 sum = vec4(0.0);\nmediump float pixelHeight = pixelSize.y;\nmediump float halfPixelHeight = pixelHeight / 2.0;\nsum += texture2D(samplerFront, vTex - vec2(0.0, pixelHeight * 7.0 + halfPixelHeight)) * 0.06;\nsum += texture2D(samplerFront, vTex - vec2(0.0, pixelHeight * 5.0 + halfPixelHeight)) * 0.10;\nsum += texture2D(samplerFront, vTex - vec2(0.0, pixelHeight * 3.0 + halfPixelHeight)) * 0.13;\nsum += texture2D(samplerFront, vTex - vec2(0.0, pixelHeight * 1.0 + halfPixelHeight)) * 0.16;\nmediump vec4 front = texture2D(samplerFront, vTex);\nsum += front * 0.10;\nsum += texture2D(samplerFront, vTex + vec2(0.0, pixelHeight * 1.0 + halfPixelHeight)) * 0.16;\nsum += texture2D(samplerFront, vTex + vec2(0.0, pixelHeight * 3.0 + halfPixelHeight)) * 0.13;\nsum += texture2D(samplerFront, vTex + vec2(0.0, pixelHeight * 5.0 + halfPixelHeight)) * 0.10;\nsum += texture2D(samplerFront, vTex + vec2(0.0, pixelHeight * 7.0 + halfPixelHeight)) * 0.06;\ngl_FragColor = mix(front, sum, intensity);\n}",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\n[[block]] struct ShaderParams {\nintensity : f32;\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\n[[stage(fragment)]]\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar pixelHeight : f32 = c3_getPixelSize(textureFront).y;\nvar front : vec4<f32> = textureSample(textureFront, samplerFront, input.fragUV);\nvar sum : vec4<f32> =\ntextureSample(textureFront, samplerFront, input.fragUV - vec2<f32>(0.0, pixelHeight * 7.5)) * 0.06 +\ntextureSample(textureFront, samplerFront, input.fragUV - vec2<f32>(0.0, pixelHeight * 5.5)) * 0.10 +\ntextureSample(textureFront, samplerFront, input.fragUV - vec2<f32>(0.0, pixelHeight * 3.5)) * 0.13 +\ntextureSample(textureFront, samplerFront, input.fragUV - vec2<f32>(0.0, pixelHeight * 1.5)) * 0.16 +\nfront * 0.10 +\ntextureSample(textureFront, samplerFront, input.fragUV + vec2<f32>(0.0, pixelHeight * 1.5)) * 0.16 +\ntextureSample(textureFront, samplerFront, input.fragUV + vec2<f32>(0.0, pixelHeight * 3.5)) * 0.13 +\ntextureSample(textureFront, samplerFront, input.fragUV + vec2<f32>(0.0, pixelHeight * 5.5)) * 0.10 +\ntextureSample(textureFront, samplerFront, input.fragUV + vec2<f32>(0.0, pixelHeight * 7.5)) * 0.06;\nvar output : FragmentOutput;\noutput.color = mix(front, sum, shaderParams.intensity);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:8,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!1,animated:!1,parameters:[["intensity",0,"percent"]]},self.C3_Shaders.vignette={glsl:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform mediump vec2 srcStart;\nuniform mediump vec2 srcEnd;\nuniform mediump float vignetteStart;\nuniform mediump float vignetteEnd;\nvoid main(void)\n{\nlowp vec4 front = texture2D(samplerFront, vTex);\nlowp float a = front.a;\nif (a != 0.0)\nfront.rgb /= a;\nmediump vec2 tex = (vTex - srcStart) / (srcEnd - srcStart);\nlowp float d = distance(tex, vec2(0.5, 0.5));\nfront.rgb *= smoothstep(vignetteEnd, vignetteStart, d);\nfront.rgb *= a;\ngl_FragColor = front;\n}",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\n[[block]] struct ShaderParams {\nvignetteStart : f32;\nvignetteEnd : f32;\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3PARAMS_STRUCT%%\n%%C3_UTILITY_FUNCTIONS%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\nlet center : vec2<f32> = vec2<f32>(0.5);\n[[stage(fragment)]]\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar front : vec4<f32> = c3_unpremultiply(textureSample(textureFront, samplerFront, input.fragUV));\nvar rgb : vec3<f32> = front.rgb;\nvar tex : vec2<f32> = c3_srcToNorm(input.fragUV);\nvar d : f32 = distance(tex, center);\nrgb = rgb * smoothStep(shaderParams.vignetteEnd, shaderParams.vignetteStart, d);\nvar output : FragmentOutput;\noutput.color = vec4<f32>(rgb * front.a, front.a);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!0,animated:!1,parameters:[["vignetteStart",0,"percent"],["vignetteEnd",0,"percent"]]};{const e=self.C3;let t=null,s="",i="",r=[],n="",a="",o="";const h=e.New(e.ArrayStack);function m(e,t){return e=e[1],t=t[1],"number"==typeof e&&"number"==typeof t?e-t:(e=""+e,t=""+t,e<t?-1:e>t?1:0)}e.Plugins.System=class extends e.SDKPluginBase{constructor(e){super(e),this._loopStack=this._runtime.GetEventSheetManager().GetLoopStack(),this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._imagesLoadingComplete=this._imagesLoadingTotal=0,this._functionMaps=new Map}Release(){super.Release()}UpdateRender(){this._runtime.UpdateRender()}Trigger(e){this._runtime.Trigger(e,null,null)}GetRegex(e,r){return t&&e===s&&r===i||(t=new RegExp(e,r),s=e,i=r),t.lastIndex=0,t}GetRegexMatches(e,t,s){if(e===n&&t===a&&s===o)return r;const i=this.GetRegex(t,s);return r=e.match(i),n=e,a=t,o=s,r}async _LoadTexturesForObjectClasses(t,s){if(s.length){this._imagesLoadingTotal+=s.length;var i=[];for(const e of s)i.push(t.MaybeLoadTexturesFor(e));await e.PromiseAllWithProgress(i,()=>{this._imagesLoadingComplete++}),this._imagesLoadingComplete++,this._imagesLoadingComplete===this._imagesLoadingTotal&&(this._runtime.Trigger(e.Plugins.System.Cnds.OnImageLoadingComplete,null,null),this._imagesLoadingTotal=this._imagesLoadingComplete=0)}}_UnloadTexturesForObjectClasses(e,t){for(const s of t)0===s.GetInstanceCount()&&e.MaybeUnloadTexturesFor(s)}_GetForEachStack(){return h}_Repeat(e){var t=this._runtime.GetEventSheetManager();const s=t.GetEventStack(),i=s.GetCurrentStackFrame(),r=i.GetCurrentEvent(),n=r.GetSolModifiers();var a=i.IsSolModifierAfterCnds();const o=s.Push(r),h=t.GetLoopStack(),l=h.Push();if(l.SetEnd(e),a)for(a=0;a<e&&!l.IsStopped();++a)t.PushCopySol(n),l.SetIndex(a),r.Retrigger(i,o),t.PopSol(n);else for(t=0;t<e&&!l.IsStopped();++t)l.SetIndex(t),r.Retrigger(i,o);return s.Pop(),h.Pop(),!1}*_DebugRepeat(e){var t=this._runtime.GetEventSheetManager();const s=t.GetEventStack(),i=s.GetCurrentStackFrame(),r=i.GetCurrentEvent(),n=r.GetSolModifiers();var a=i.IsSolModifierAfterCnds();const o=s.Push(r),h=t.GetLoopStack(),l=h.Push();if(l.SetEnd(e),a)for(a=0;a<e&&!l.IsStopped();++a)t.PushCopySol(n),l.SetIndex(a),yield*r.DebugRetrigger(i,o),t.PopSol(n);else for(t=0;t<e&&!l.IsStopped();++t)l.SetIndex(t),yield*r.DebugRetrigger(i,o);return s.Pop(),h.Pop(),!1}_While(){var e=this._runtime.GetEventSheetManager();const t=e.GetEventStack(),s=t.GetCurrentStackFrame(),i=s.GetCurrentEvent(),r=i.GetSolModifiers();var n=s.IsSolModifierAfterCnds();const a=t.Push(i),o=e.GetLoopStack(),h=o.Push();if(n)for(n=0;!h.IsStopped();++n)e.PushCopySol(r),h.SetIndex(n),i.Retrigger(s,a)||h.Stop(),e.PopSol(r);else for(e=0;!h.IsStopped();++e)h.SetIndex(e),i.Retrigger(s,a)||h.Stop();return t.Pop(),o.Pop(),!1}*_DebugWhile(){var e=this._runtime.GetEventSheetManager();const t=e.GetEventStack(),s=t.GetCurrentStackFrame(),i=s.GetCurrentEvent(),r=i.GetSolModifiers();var n=s.IsSolModifierAfterCnds();const a=t.Push(i),o=e.GetLoopStack(),h=o.Push();if(n)for(n=0;!h.IsStopped();++n)e.PushCopySol(r),h.SetIndex(n),(yield*i.DebugRetrigger(s,a))||h.Stop(),e.PopSol(r);else for(e=0;!h.IsStopped();++e)h.SetIndex(e),(yield*i.DebugRetrigger(s,a))||h.Stop();return t.Pop(),o.Pop(),!1}_For(e,t,s){var i=this._runtime.GetEventSheetManager();const r=i.GetEventStack(),n=r.GetCurrentStackFrame(),a=n.GetCurrentEvent(),o=a.GetSolModifiers(),h=n.IsSolModifierAfterCnds(),l=r.Push(a),c=i.GetLoopStack(),u=c.Push();if(u.SetName(e),u.SetEnd(s),s<t)if(h)for(e=t;e>=s&&!u.IsStopped();--e)i.PushCopySol(o),u.SetIndex(e),a.Retrigger(n,l),i.PopSol(o);else for(i=t;i>=s&&!u.IsStopped();--i)u.SetIndex(i),a.Retrigger(n,l);else if(h)for(e=t;e<=s&&!u.IsStopped();++e)i.PushCopySol(o),u.SetIndex(e),a.Retrigger(n,l),i.PopSol(o);else for(i=t;i<=s&&!u.IsStopped();++i)u.SetIndex(i),a.Retrigger(n,l);return r.Pop(),c.Pop(),!1}*_DebugFor(e,t,s){var i=this._runtime.GetEventSheetManager();const r=i.GetEventStack(),n=r.GetCurrentStackFrame(),a=n.GetCurrentEvent(),o=a.GetSolModifiers(),h=n.IsSolModifierAfterCnds(),l=r.Push(a),c=i.GetLoopStack(),u=c.Push();if(u.SetName(e),u.SetEnd(s),s<t)if(h)for(e=t;e>=s&&!u.IsStopped();--e)i.PushCopySol(o),u.SetIndex(e),yield*a.DebugRetrigger(n,l),i.PopSol(o);else for(i=t;i>=s&&!u.IsStopped();--i)u.SetIndex(i),
yield*a.DebugRetrigger(n,l);else if(h)for(e=t;e<=s&&!u.IsStopped();++e)i.PushCopySol(o),u.SetIndex(e),yield*a.DebugRetrigger(n,l),i.PopSol(o);else for(i=t;i<=s&&!u.IsStopped();++i)u.SetIndex(i),yield*a.DebugRetrigger(n,l);return r.Pop(),c.Pop(),!1}_ForEach(t){var s=this._runtime.GetEventSheetManager();const i=s.GetEventStack(),r=i.GetCurrentStackFrame(),n=r.GetCurrentEvent(),a=n.GetSolModifiers();var o=r.IsSolModifierAfterCnds();const l=i.Push(n),c=s.GetLoopStack(),u=c.Push(),_=t.IsInContainer(),d=t.GetCurrentSol(),p=h.Push();if(e.shallowAssignArray(p,d.GetInstances()),u.SetEnd(p.length),o)for(let e=0,i=p.length;e<i&&!u.IsStopped();++e)s.PushCopySol(a),o=p[e],t.GetCurrentSol().SetSinglePicked(o),_&&o.SetSiblingsSinglePicked(),u.SetIndex(e),n.Retrigger(r,l),s.PopSol(a);else{d._SetSelectAll(!1),t=d._GetOwnInstances(),e.clearArray(t),t.push(null);for(let e=0,i=p.length;e<i&&!u.IsStopped();++e)s=p[e],t[0]=s,_&&s.SetSiblingsSinglePicked(),u.SetIndex(e),n.Retrigger(r,l)}return i.Pop(),c.Pop(),e.clearArray(p),h.Pop(),!1}*_DebugForEach(t){var s=this._runtime.GetEventSheetManager();const i=s.GetEventStack(),r=i.GetCurrentStackFrame(),n=r.GetCurrentEvent(),a=n.GetSolModifiers();var o=r.IsSolModifierAfterCnds();const l=i.Push(n),c=s.GetLoopStack(),u=c.Push(),_=t.IsInContainer(),d=t.GetCurrentSol(),p=h.Push();if(e.shallowAssignArray(p,d.GetInstances()),u.SetEnd(p.length),o)for(let e=0,i=p.length;e<i&&!u.IsStopped();++e)s.PushCopySol(a),o=p[e],t.GetCurrentSol().SetSinglePicked(o),_&&o.SetSiblingsSinglePicked(),u.SetIndex(e),yield*n.DebugRetrigger(r,l),s.PopSol(a);else{d._SetSelectAll(!1),t=d._GetOwnInstances(),e.clearArray(t),t.push(null);for(let e=0,i=p.length;e<i&&!u.IsStopped();++e)s=p[e],t[0]=s,_&&s.SetSiblingsSinglePicked(),u.SetIndex(e),yield*n.DebugRetrigger(r,l)}return i.Pop(),c.Pop(),e.clearArray(p),h.Pop(),!1}_ForEachOrdered(t,s){var i=this._runtime.GetEventSheetManager();const r=i.GetEventStack(),n=i.GetCurrentCondition(),a=r.GetCurrentStackFrame(),o=a.GetCurrentEvent(),l=o.GetSolModifiers(),c=a.IsSolModifierAfterCnds(),u=r.Push(o),_=i.GetLoopStack(),d=_.Push(),p=t.IsInContainer(),g=t.GetCurrentSol(),f=h.Push();e.clearArray(f);const S=g.GetInstances();d.SetEnd(S.length);for(let e=0,t=S.length;e<t;++e)f.push([S[e],n.ReevaluateParameter(1,e)]);if(f.sort(m),1===s&&f.reverse(),c)for(let e=0,r=f.length;e<r&&!d.IsStopped();++e)i.PushCopySol(l),s=f[e][0],t.GetCurrentSol().SetSinglePicked(s),p&&s.SetSiblingsSinglePicked(),d.SetIndex(e),o.Retrigger(a,u),i.PopSol(l);else{g._SetSelectAll(!1),t=g._GetOwnInstances(),e.clearArray(t),t.push(null);for(let e=0,s=f.length;e<s&&!d.IsStopped();++e)i=f[e][0],t[0]=i,p&&i.SetSiblingsSinglePicked(),d.SetIndex(e),o.Retrigger(a,u)}return r.Pop(),_.Pop(),e.clearArray(f),h.Pop(),!1}*_DebugForEachOrdered(t,s){var i=this._runtime.GetEventSheetManager();const r=i.GetEventStack(),n=i.GetCurrentCondition(),a=r.GetCurrentStackFrame(),o=a.GetCurrentEvent(),l=o.GetSolModifiers(),c=a.IsSolModifierAfterCnds(),u=r.Push(o),_=i.GetLoopStack(),d=_.Push(),p=t.IsInContainer(),g=t.GetCurrentSol(),f=h.Push();e.clearArray(f);const S=g.GetInstances();d.SetEnd(S.length);for(let e=0,t=S.length;e<t;++e)f.push([S[e],n.ReevaluateParameter(1,e)]);if(f.sort(m),1===s&&f.reverse(),c)for(let e=0,r=f.length;e<r&&!d.IsStopped();++e)i.PushCopySol(l),s=f[e][0],t.GetCurrentSol().SetSinglePicked(s),p&&s.SetSiblingsSinglePicked(),d.SetIndex(e),yield*o.DebugRetrigger(a,u),i.PopSol(l);else{g._SetSelectAll(!1),t=g._GetOwnInstances(),e.clearArray(t),t.push(null);for(let e=0,s=f.length;e<s&&!d.IsStopped();++e)i=f[e][0],t[0]=i,p&&i.SetSiblingsSinglePicked(),d.SetIndex(e),yield*o.DebugRetrigger(a,u)}return r.Pop(),_.Pop(),e.clearArray(f),h.Pop(),!1}_GetFunctionMap(e,t){let s=this._functionMaps.get(e);return s||(t?(s={defaultFunc:null,strMap:new Map},this._functionMaps.set(e,s),s):null)}_DoCallMappedFunction(e,t,s,i,r){t.GetEventBlock().RunAsMappedFunctionCall(s),i&&e.PopSol(r)}*_DebugDoCallMappedFunction(e,t,s,i,r){yield*t.GetEventBlock().DebugRunAsMappedFunctionCall(s),i&&e.PopSol(r)}}}{const e=self.C3;e.Plugins.System.Type=class extends e.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}OnCreate(){}Release(){this._plugin=this._runtime=this._objectClass=null}}}{const e=self.C3;e.Plugins.System.Instance=class extends e.DefendedBase{constructor(e,t){super(),this._inst=e,this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._runtime=this._inst.GetRuntime()}Release(){this._runtime=this._sdkType=this._objectClass=this._inst=null}}}{const e=self.C3,t=[];e.Plugins.System.Cnds={EveryTick:()=>!0,OnLayoutStart:()=>!0,OnLayoutEnd:()=>!0,OnSuspend:()=>!0,OnResume:()=>!0,IsSuspended(){return this._runtime.IsSuspended()},Else(){const e=this._runtime.GetCurrentEventStackFrame();return!e.GetElseBranchRan()&&!e.GetLastEventTrue()},TriggerOnce(){const e=this._runtime.GetCurrentCondition().GetSavedDataMap();let t=e.get("TriggerOnce_lastTick");void 0===t&&(t=-1,e.set("TriggerOnce_lastTick",-1));const s=this._runtime.GetTickCount();return e.set("TriggerOnce_lastTick",s),this._runtime.IsLayoutFirstTick()||t!==s-1},Every(e){const t=this._runtime.GetCurrentCondition().GetSavedDataMap(),s=t.get("Every_lastTime")||0,i=this._runtime.GetGameTime();t.has("Every_seconds")||t.set("Every_seconds",e);const r=t.get("Every_seconds");return i>=s+r?(t.set("Every_lastTime",s+r),i>=t.get("Every_lastTime")+.04&&t.set("Every_lastTime",i),t.set("Every_seconds",e),!0):(i<s-.1&&t.set("Every_lastTime",i),!1)},IsGroupActive(e){return(e=this._runtime.GetEventSheetManager().GetEventGroupByName(e))&&e.IsGroupActive()},IsPreview(){return this._runtime.IsPreview()},IsMobile:()=>e.Platform.IsMobile,OnLoadFinished:()=>!0,OnCanvasSnapshot:()=>!0,EffectsSupported:()=>!0,OnSaveComplete:()=>!0,OnSaveFailed:()=>!0,OnLoadComplete:()=>!0,OnLoadFailed:()=>!0,ObjectUIDExists(e){return!!this._runtime.GetInstanceByUID(e)},IsOnPlatform(t){switch(t){case 0:return"browser"===e.Platform.Context;case 1:return"iOS"===e.Platform.OS;case 2:return"Android"===e.Platform.OS;case 8:return"cordova"===e.Platform.Context;case 9:return"scirra-arcade"===this._runtime.GetExportType();case 10:return"nwjs"===e.Platform.Context;case 13:return"windows-uwp"===this._runtime.GetExportType();default:return!1}},RegexTest(e,t,s){return this.GetRegex(t,s).test(e)},Compare:(t,s,i)=>e.compare(t,s,i),CompareBetween:(e,t,s)=>e>=t&&e<=s,CompareVar:(t,s,i)=>e.compare(t.GetValue(),s,i),CompareBoolVar:e=>!!e.GetValue(),CompareTime(t,s){const i=this._runtime.GetGameTime();return 0===t?(t=this._runtime.GetCurrentCondition().GetSavedDataMap(),!t.get("CompareTime_executed")&&i>=s&&(t.set("CompareTime_executed",!0),!0)):e.compare(i,t,s)},IsNaN:e=>isNaN(e),AngleWithin:(t,s,i)=>e.angleDiff(e.toRadians(t),e.toRadians(i))<=e.toRadians(s),IsClockwiseFrom:(t,s)=>e.angleClockwise(e.toRadians(t),e.toRadians(s)),IsBetweenAngles:(t,s,i)=>(t=e.toRadians(t),s=e.toRadians(s),i=e.toRadians(i),e.angleClockwise(i,s)?e.angleClockwise(t,s)&&!e.angleClockwise(t,i):!(!e.angleClockwise(t,s)&&e.angleClockwise(t,i))),IsValueType:(e,t)=>"number"==typeof e?0===t:1===t,EvaluateExpression:e=>!!e,PickByComparison(t,s,i,r){if(!t)return!1;const n=this._GetForEachStack(),a=n.Push(),o=t.GetCurrentSol();e.shallowAssignArray(a,o.GetInstances()),o.IsSelectAll()&&e.clearArray(o._GetOwnElseInstances());const h=this._runtime.GetCurrentCondition();let l=0;for(let t=0,n=a.length;t<n;++t){const n=a[t];a[l]=n,s=h.ReevaluateParameter(1,t),r=h.ReevaluateParameter(3,t),e.compare(s,i,r)?++l:o._PushElseInstance(n)}return e.truncateArray(a,l),o.SetArrayPicked(a),s=!!a.length,e.clearArray(a),n.Pop(),t.ApplySolToContainer(),s},PickByEvaluate(t,s){if(!t)return!1;const i=this._GetForEachStack(),r=i.Push(),n=t.GetCurrentSol();e.shallowAssignArray(r,n.GetInstances()),n.IsSelectAll()&&e.clearArray(n._GetOwnElseInstances());const a=this._runtime.GetCurrentCondition();let o=0;for(let e=0,t=r.length;e<t;++e){const t=r[e];r[o]=t,(s=a.ReevaluateParameter(1,e))?++o:n._PushElseInstance(t)}return e.truncateArray(r,o),n.SetArrayPicked(r),s=!!r.length,e.clearArray(r),i.Pop(),t.ApplySolToContainer(),s},PickNth(e,t){if(!e)return!1;const s=e.GetCurrentSol(),i=s.GetInstances();return t=Math.floor(t),!(t>=i.length)&&(s.PickOne(i[t]),e.ApplySolToContainer(),!0)},PickRandom(e){if(!e)return!1;const t=e.GetCurrentSol(),s=t.GetInstances(),i=Math.floor(this._runtime.Random()*s.length);return!(i>=s.length)&&(t.PickOne(s[i]),e.ApplySolToContainer(),!0)},PickAll:e=>!(!e||!e.GetInstanceCount())&&(e.GetCurrentSol()._SetSelectAll(!0),e.ApplySolToContainer(),!0),PickOverlappingPoint(s,i,r){if(!s)return!1;const n=s.GetCurrentSol();var a=n.GetInstances();const o=this._runtime.GetCurrentEvent().IsOrBlock(),h=this._runtime.GetCurrentCondition().IsInverted();n.IsSelectAll()?(e.shallowAssignArray(t,a),n.ClearArrays(),n._SetSelectAll(!1)):o?(e.shallowAssignArray(t,n._GetOwnElseInstances()),e.clearArray(n._GetOwnElseInstances())):(e.shallowAssignArray(t,n._GetOwnInstances()),e.clearArray(n._GetOwnInstances()));for(let s=0,o=t.length;s<o;++s)a=t[s],e.xor(a.GetWorldInfo().ContainsPoint(i,r),h)?n._PushInstance(a):n._PushElseInstance(a);return s.ApplySolToContainer(),e.xor(!!n._GetOwnInstances().length,h)},PickLastCreated(e){if(!e)return!1;var t=e.IsFamily();let s=null;const i=this._runtime._GetInstancesPendingCreate();for(let r=i.length-1;0<=r;--r){const n=i[r];if(t){if(n.GetObjectClass().BelongsToFamily(e)){s=n;break}}else if(n.GetObjectClass()===e){s=n;break}}return s||(t=e.GetInstances(),t.length&&(s=t.at(-1))),!!s&&(e.GetCurrentSol().PickOne(s),e.ApplySolToContainer(),!0)},Repeat(e){return this._runtime.IsDebugging()?this._DebugRepeat(e):this._Repeat(e)},While(){return this._runtime.IsDebugging()?this._DebugWhile():this._While()},For(e,t,s){return this._runtime.IsDebugging()?this._DebugFor(e,t,s):this._For(e,t,s)},ForEach(e){return this._runtime.IsDebugging()?this._DebugForEach(e):this._ForEach(e)},ForEachOrdered(e,t,s){return this._runtime.IsDebugging()?this._DebugForEachOrdered(e,s):this._ForEachOrdered(e,s)},LayerVisible:e=>!!e&&e.IsVisible(),LayerEmpty:e=>!!e&&!e.GetInstanceCount(),LayerCmpOpacity:(t,s,i)=>!!t&&e.compare(100*t.GetOpacity(),s,i),OnImageLoadingComplete:()=>!0,IsLoadingImages(){return 0<this._imagesLoadingTotal}}}{const e=self.C3;function b(e,t){const s=e[0]-t[0];return 0!==s?s:e[1]-t[1]}function a(e,t){return e[1]-t[1]}const t=[],s=[],i=e.New(e.Rect),r=e.New(e.Color);e.Plugins.System.Acts={SetVar(e,t){e.SetValue(t)},AddVar(e,t){e.IsNumber()&&"number"!=typeof t&&(t=parseFloat(t)),e.SetValue(e.GetValue()+t)},SubVar(e,t){e.IsNumber()&&e.SetValue(e.GetValue()-t)},SetBoolVar(e,t){e.SetValue(!!t)},ToggleBoolVar(e){e.SetValue(!e.GetValue())},ResetGlobals(){this._runtime.GetEventSheetManager().ResetAllGlobalsToInitialValue()},CreateObject(e,t,s,i,r){e&&t&&(s=this._runtime.CreateInstance(e,t,s,i,r))&&(r&&t.SortAndAddInstancesByZIndex(s),t=this._runtime.GetEventSheetManager(),t.BlockFlushingInstances(!0),s._TriggerOnCreatedOnSelfAndRelated(),t.BlockFlushingInstances(!1),e.GetCurrentSol().SetSinglePicked(s),s.IsInContainer()&&s.SetSiblingsSinglePicked())},CreateObjectByName(t,s,i,r,n){t&&s&&(t=this._runtime.GetObjectClassByName(t))&&e.Plugins.System.Acts.CreateObject.call(this,t,s,i,r,n)},RecreateInitialObjects(e,t,s,r,n,a,o,h,l,c){if(e){var u=this._runtime.GetCurrentLayout();if(a&&(u=this._runtime.GetLayoutManager().GetLayoutByName(a),!u))return;if(a=null,("number"!=typeof o||0<=o)&&(a=u.GetLayer(o),!a))return;i.set(t,s,r,n),t=u.RecreateInitialObjects(e,i,a,h,l,c),e.GetCurrentSol().SetArrayPicked(t),e.ApplySolToContainer()}},StopLoop(){const e=this._loopStack;e.IsInLoop()&&e.GetCurrent().Stop()},SetGroupActive(e,t){(e=this._runtime.GetEventSheetManager().GetEventGroupByName(e))&&(0===t?e.SetGroupActive(!1):1===t?e.SetGroupActive(!0):e.SetGroupActive(!e.IsGroupActive()))},SetTimescale(e){this._runtime.SetTimeScale(e)},SetObjectTimescale(e,t){if(0>t&&(t=0),e){e=e.GetCurrentSol().GetInstances();for(const s of e)s.SetTimeScale(t)}},RestoreObjectTimescale(e){if(e){e=e.GetCurrentSol().GetInstances();for(const t of e)t.RestoreTimeScale()}},Wait(e){if(!(0>e))return this._runtime.GetEventSheetManager().AddScheduledWait().InitTimer(e),!0},WaitForSignal(e){return this._runtime.GetEventSheetManager().AddScheduledWait().InitSignal(e),!0},WaitForPreviousActions(){const e=this._runtime.GetEventSheetManager();return e.AddScheduledWait().InitPromise(e.GetPromiseForAllAsyncActions()),!0},Signal(e){e=e.toLowerCase();for(const t of this._runtime.GetEventSheetManager().scheduledWaits())t.IsSignal()&&t.GetSignalTag()===e&&t.SetSignalled()},async SnapshotCanvas(t,s,i,r,n,a){const o=this._runtime.GetCanvasManager();o&&(this.UpdateRender(),await o.SnapshotCanvas(0===t?"image/png":"image/jpeg",s/100,i,r,n,a),await this._runtime.TriggerAsync(e.Plugins.System.Cnds.OnCanvasSnapshot,null))},SetCanvasSize(e,t){if(!(0>=e||0>=t)){this._runtime.SetViewportSize(e,t);var s=this._runtime.GetCurrentLayout();s.BoundScrolling();for(const e of s.GetLayers())e.UpdateViewport();(s=this._runtime.GetCanvasManager())&&("off"!==s.GetCurrentFullscreenMode()&&this._runtime.SetOriginalViewportSize(e,t),s.SetSize(s.GetLastWidth(),s.GetLastHeight(),!0),this._runtime.UpdateRender())}},SetFullscreenQuality(e){const t=this._runtime.GetCanvasManager();t&&"off"!==t.GetCurrentFullscreenMode()&&(t.SetFullscreenScalingQuality(0!==e?"high":"low"),t.SetSize(t.GetLastWidth(),t.GetLastHeight(),!0))},SaveState(e){this._runtime.SaveToSlot(e)},LoadState(e){this._runtime.LoadFromSlot(e)},LoadStateJSON(e){this._runtime.LoadFromJsonString(e)},SetHalfFramerateMode(e){},ResetPersisted(){for(const e of this._runtime.GetLayoutManager().GetAllLayouts())e.ResetPersistData()},SetPixelRounding(e){this._runtime.SetPixelRoundingEnabled(0!==e)},SetMinimumFramerate(e){this._runtime.SetMinimumFramerate(e)},SortZOrderByInstVar(i,r){if(i){var n=i.GetCurrentSol().GetInstances(),o=this._runtime.GetCurrentLayout(),h=i.IsFamily();i=i.GetFamilyIndex();for(let e=0,a=n.length;e<a;++e){var l=n[e];const a=l.GetWorldInfo();if(!a)continue;let o;o=h?l.GetInstanceVariableValue(r+l.GetObjectClass().GetFamilyInstanceVariableOffset(i)):l.GetInstanceVariableValue(r),t.push([a.GetLayer().GetIndex(),a.GetZIndex()]),s.push([l,o])}if(t.length){t.sort(b),s.sort(a),r=!1;for(let e=0,a=t.length;e<a;++e)n=s[e][0],h=o.GetLayerByIndex(t[e][0]),i=t[e][1],l=h._GetInstances(),l[i]!==n&&(l[i]=n,n.GetWorldInfo()._SetLayer(h),h.SetZIndicesChanged(),r=!0);r&&this._runtime.UpdateRender(),e.clearArray(t),e.clearArray(s)}}},GoToLayout(e){if(!this._runtime.IsLoading()){var t=this._runtime.GetLayoutManager();t.IsPendingChangeMainLayout()||t.ChangeMainLayout(e)}},GoToLayoutByName(e){if(!this._runtime.IsLoading()){var t=this._runtime.GetLayoutManager();t.IsPendingChangeMainLayout()||(e=t.GetLayoutByName(e))&&t.ChangeMainLayout(e)}},NextPrevLayout(e){if(!this._runtime.IsLoading()){var t=this._runtime.GetLayoutManager();if(!t.IsPendingChangeMainLayout()){var s=t.GetAllLayouts(),i=s.indexOf(t.GetMainRunningLayout());e&&0===i||(e||i!==s.length-1)&&t.ChangeMainLayout(s[i+(e?-1:1)])}}},RestartLayout(){if(!this._runtime.IsLoading()){var e=this._runtime.GetLayoutManager();e.IsPendingChangeMainLayout()||(e.ChangeMainLayout(e.GetMainRunningLayout()),this._runtime.GetEventSheetManager().ResetAllGroupsInitialActivation())}},SetLayerVisible(e,t){e&&e.SetVisible(t)},SetLayerOpacity(e,t){e&&e.SetOpacity(t/100)},SetLayerScale(e,t){e&&e.SetOwnScale(t)},SetLayerScaleRate(e,t){e&&e.SetScaleRate(t)},SetLayerAngle(t,s){t&&t.SetAngle(e.toRadians(+s))},SetLayerScroll(e,t,s){e&&(e.SetOwnScrollPositionEnabled(!0),e.SetScrollX(t),e.SetScrollY(s))},RestoreLayerScroll(e){e&&e.SetOwnScrollPositionEnabled(!1)},SetLayerParallax(e,t,s){e&&e.SetParallax(t/100,s/100)},SetLayerZElevation(e,t){e&&e.SetZElevation(+t)},SetLayerBackground(e,t){e&&(r.setFromRgbValue(t),r.clamp(),e=e.GetBackgroundColor(),e.equalsIgnoringAlpha(r)||(e.copyRgb(r),this.UpdateRender()))},SetLayerTransparent(e,t){e&&e.SetTransparent(t)},SetLayerBlendMode(e,t){e&&e.SetBlendMode(t)},SetLayerEffectEnabled(e,t,s){e&&(s=e.GetEffectList().GetEffectTypeByName(s))&&(t=1===t,s.IsActive()!==t&&(s.SetActive(t),e.UpdateActiveEffects(),this._runtime.UpdateRender()))},SetLayerEffectParam(e,t,s,i){if(e&&(e=e.GetEffectList(),t=e.GetEffectTypeByName(t))){var n=t.GetIndex();if(e=e.GetEffectParametersForIndex(n),s=Math.floor(s),!(0>s||s>=e.length)){if(n=t.GetShaderProgram().GetParameterType(s),"color"===n){if(r.setFromRgbValue(i),s=e[s],r.equalsIgnoringAlpha(s))return;s.copyRgb(r)}else{if("percent"===n&&(i/=100),e[s]===i)return;e[s]=i}t.IsActive()&&this._runtime.UpdateRender()}}},SetLayerForceOwnTexture(e,t){e&&e.SetForceOwnTexture(t)},SetLayoutScale(e){this._runtime.GetCurrentLayout().SetScale(+e)},SetLayoutAngle(t){this._runtime.GetCurrentLayout().SetAngle(e.toRadians(+t))},SetLayoutEffectEnabled(e,t){const s=this._runtime.GetCurrentLayout();(t=s.GetEffectList().GetEffectTypeByName(t))&&(e=1===e,t.IsActive()!==e&&(t.SetActive(e),s.UpdateActiveEffects(),this._runtime.UpdateRender()))},SetLayoutEffectParam(e,t,s){var i=this._runtime.GetCurrentLayout().GetEffectList();if(e=i.GetEffectTypeByName(e)){var n=e.GetIndex();if(i=i.GetEffectParametersForIndex(n),t=Math.floor(t),!(0>t||t>=i.length)){if(n=e.GetShaderProgram().GetParameterType(t),"color"===n){if(r.setFromRgbValue(s),t=i[t],r.equalsIgnoringAlpha(t))return;t.copyRgb(r)}else{if("percent"===n&&(s/=100),i[t]===s)return;i[t]=s}e.IsActive()&&this._runtime.UpdateRender()}}},SetLayoutVanishingPoint(e,t){this._runtime.GetCurrentLayout().SetVanishingPointXY(e/100,t/100)},SetLayoutProjection(e){const t=this._runtime.GetCurrentLayout();0===e?t.SetPerspectiveProjection():t.SetOrthographicProjection()},ScrollX(e){this._runtime.GetCurrentLayout().SetScrollX(e)},ScrollY(e){this._runtime.GetCurrentLayout().SetScrollY(e)},Scroll(e,t){const s=this._runtime.GetCurrentLayout();s.SetScrollX(e),s.SetScrollY(t)},ScrollToObject(e){if(e&&(e=e.GetFirstPicked())&&(e=e.GetWorldInfo())){var t=this._runtime.GetCurrentLayout();t.SetScrollX(e.GetX()),t.SetScrollY(e.GetY())}},async LoadObjectTextures(e){const t=this._runtime.GetMainRunningLayout();t&&e&&!this._runtime.IsLoading()&&(e=e.IsFamily()?e.GetFamilyMembers():[e],await this._LoadTexturesForObjectClasses(t,e))},async LoadObjectTexturesByName(t){await e.Plugins.System.Acts.LoadObjectTextures.call(this,this._runtime.GetObjectClassByName(t))},UnloadObjectTextures(e){const t=this._runtime.GetMainRunningLayout();t&&e&&(e=e.IsFamily()?e.GetFamilyMembers():[e],this._UnloadTexturesForObjectClasses(t,e))},UnloadObjectTexturesByName(t){e.Plugins.System.Acts.UnloadObjectTextures.call(this,this._runtime.GetObjectClassByName(t))},UnloadUnusedTextures(){const e=this._runtime.GetMainRunningLayout();if(e){var t=e._GetTextureLoadedObjectTypes();this._UnloadTexturesForObjectClasses(e,t)}},async LoadLayoutTextures(e){const t=this._runtime.GetMainRunningLayout();e&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,e._GetInitialObjectClasses())},async LoadLayoutTexturesByName(e){const t=this._runtime.GetMainRunningLayout();(e=this._runtime.GetLayoutManager().GetLayoutByName(e))&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,e._GetInitialObjectClasses())},SetFunctionReturnValue(e){const t=this._eventStack.GetCurrentExpFuncStackFrame();if(t)switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:t.SetFunctionReturnValue(e)}},MapFunction(t,s,i){var r=this._GetFunctionMap(t.toLowerCase(),!0);const n=r.strMap,a=s.toLowerCase();if(n.has(a)&&console.warn(`[Construct 3] Function map '${t}' string '${s}' already in map; overwriting entry`),r=e.first(n.values())||r.defaultFunc){r=0!==r.GetReturnType();const e=0!==i.GetReturnType();if(r!==e)return void console.error(`[Construct 3] Function map '${t}' string '${s}' function return type not compatible with other functions in the map; entry ignored`)}n.set(a,i)},MapFunctionDefault(t,s){const i=this._GetFunctionMap(t.toLowerCase(),!0);i.defaultFunc&&console.warn(`[Construct 3] Function map '${t}' already has a default; overwriting entry`);var r=e.first(i.strMap.values())||i.defaultFunc;if(r){r=0!==r.GetReturnType();const e=0!==s.GetReturnType();if(r!==e)return void console.error(`[Construct 3] Function map '${t}' default: function return type not compatible with other functions in the map; entry ignored`)}i.defaultFunc=s},CallMappedFunction(e,t,s){s=Math.floor(s);var i=this._GetFunctionMap(e.toLowerCase(),!1);if(i){var r=i.strMap.get(t.toLowerCase());if(!r){if(!i.defaultFunc)return void console.warn(`[Construct 3] Call mapped function: no function associated with map '${e}' string '${t}'; call ignored (consider setting a default)`);r=i.defaultFunc,s=0}if(r.IsEnabled()){if(0===r.GetReturnType()){e=this._runtime,t=e.GetEventSheetManager();var n=t.GetCurrentEvent();i=n.GetSolModifiersIncludingParents();var a=0<i.length;a&&t.PushCleanSol(i);var o=[];if(n=t.FindFirstFunctionBlockParent(n)){n=n.GetFunctionParameters();for(let e=s,t=n.length;e<t;++e)o.push(n[e].GetValue())}s=r.GetFunctionParameters();for(let e=o.length,t=s.length;e<t;++e)o.push(s[e].GetInitialValue());return e.IsDebugging()?this._DebugDoCallMappedFunction(t,r,o,a,i):this._DoCallMappedFunction(t,r,o,a,i)}console.warn(`[Construct 3] Call mapped function: map '${e}' string '${t}' has a return type so cannot be called`)}}else console.warn(`[Construct 3] Call mapped function: map name '${e}' not found; call ignored`)}}}{const e=self.C3;e.Plugins.System.Exps={int:function(e){return"string"==typeof e&&(e=parseInt(e,10),isNaN(e)&&(e=0)),Math.floor(e)},float:function(e){return"string"==typeof e&&(e=parseFloat(e),isNaN(e)&&(e=0)),e},str:e=>e.toString(),len:e=>"string"==typeof e?e.length:0,random(e,t){return void 0===t?this._runtime.Random()*e:this._runtime.Random()*(t-e)+e},choose(...e){const t=Math.floor(this._runtime.Random()*e.length);return e[t]},pi:()=>Math.PI,infinity:()=>1/0,sqrt:e=>Math.sqrt(e),abs:e=>Math.abs(e),round:e=>Math.round(e),roundtodp:(e,t)=>(t=Math.max(Math.floor(t),0),t=Math.pow(10,t),Math.round((e+Number.EPSILON)*t)/t),floor:e=>Math.floor(e),ceil:e=>Math.ceil(e),sign:e=>Math.sign(e),sin:t=>Math.sin(e.toRadians(t)),cos:t=>Math.cos(e.toRadians(t)),tan:t=>Math.tan(e.toRadians(t)),asin:t=>e.toDegrees(Math.asin(t)),acos:t=>e.toDegrees(Math.acos(t)),atan:t=>e.toDegrees(Math.atan(t)),exp:e=>Math.exp(e),ln:e=>Math.log(e),log10:e=>Math.log(e)/Math.LN10,max(...e){let t=e[0];"number"!=typeof t&&(t=0);for(let s=1,i=e.length;s<i;++s){let i=e[s];"number"==typeof i&&t<i&&(t=i)}return t},min(...e){let t=e[0];"number"!=typeof t&&(t=0);for(let s=1,i=e.length;s<i;++s){let i=e[s];"number"==typeof i&&t>i&&(t=i)}return t},clamp:(t,s,i)=>e.clamp(t,s,i),distance:(t,s,i,r)=>e.distanceTo(t,s,i,r),angle:(t,s,i,r)=>e.toDegrees(e.angleTo(t,s,i,r)),lerp:(t,s,i)=>e.lerp(t,s,i),unlerp:(t,s,i)=>e.unlerp(t,s,i),qarp:(t,s,i,r)=>e.qarp(t,s,i,r),cubic:(t,s,i,r,n)=>e.cubic(t,s,i,r,n),cosp:(t,s,i)=>e.cosp(t,s,i),anglediff:(t,s)=>e.toDegrees(e.angleDiff(e.toRadians(t),e.toRadians(s))),anglelerp:(t,s,i)=>e.toDegrees(e.angleLerp(e.toRadians(t),e.toRadians(s),i)),anglerotate:(t,s,i)=>e.toDegrees(e.angleRotate(e.toRadians(t),e.toRadians(s),e.toRadians(i))),setbit:(e,t,s)=>(t|=0,(0|e)&~(1<<t)|(0!==s?1:0)<<t),togglebit:(e,t)=>(0|e)^1<<(0|t),getbit:(e,t)=>(0|e)&1<<(0|t)?1:0,newline:()=>"\n",uppercase:e=>"string"==typeof e?e.toUpperCase():"",lowercase:e=>"string"==typeof e?e.toLowerCase():"",left:(e,t)=>"string"==typeof e?e.substr(0,t):"",mid:(e,t,s)=>"string"!=typeof e?"":0>s?e.substr(t):e.substr(t,s),right:(e,t)=>"string"==typeof e?e.substr(Math.max(e.length-t,0)):"",trim:e=>"string"==typeof e?e.trim():"",tokenat:(e,t,s)=>"string"!=typeof e||"string"!=typeof s?"":(e=e.split(s),t=Math.floor(t),0>t||t>=e.length?"":e[t]),tokencount:(e,t)=>"string"==typeof e&&"string"==typeof t&&e.length?e.split(t).length:0,find:(t,s)=>"string"==typeof t&&"string"==typeof s?t.search(new RegExp(e.EscapeRegex(s),"i")):-1,findcase:(t,s)=>"string"==typeof t&&"string"==typeof s?t.search(new RegExp(e.EscapeRegex(s),"")):-1,replace:(t,s,i)=>"string"==typeof t&&"string"==typeof s&&"string"==typeof i?t.replace(new RegExp(e.EscapeRegex(s),"gi"),i):"string"==typeof t?t:"",regexsearch(e,t,s){return t=this.GetRegex(t,s),e?e.search(t):-1},regexreplace(e,t,s,i){return t=this.GetRegex(t,s),e?e.replace(t,i):""},regexmatchcount(e,t,s){return(e=this.GetRegexMatches(e.toString(),t,s))?e.length:0},regexmatchat(e,t,s,i){return i=Math.floor(i),e=this.GetRegexMatches(e.toString(),t,s),!e||0>i||i>=e.length?"":e[i]},zeropad(e,t){let s=0>e?"-":"";return 0>e&&(e=-e),s+="0".repeat(Math.max(t-e.toString().length,0)),s+e.toString()},urlencode:e=>encodeURIComponent(e),urldecode:e=>decodeURIComponent(e),dt(){return this._runtime._GetDtFast()},timescale(){return this._runtime.GetTimeScale()},wallclocktime(){return(Date.now()-this._runtime.GetStartTime())/1e3},unixtime:()=>Date.now(),time(){return this._runtime.GetGameTime()},tickcount(){return this._runtime.GetTickCount()},objectcount(){return this._runtime.GetObjectCount()},fps(){return this._runtime.GetFPS()},cpuutilisation(){return this._runtime.GetMainThreadTime()},gpuutilisation(){return this._runtime.GetGPUUtilisation()},windowwidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},windowheight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},originalwindowwidth(){return this._runtime.GetOriginalViewportWidth()},originalwindowheight(){return this._runtime.GetOriginalViewportHeight()},originalviewportwidth(){return this._runtime.GetOriginalViewportWidth()},originalviewportheight(){return this._runtime.GetOriginalViewportHeight()},scrollx(){return this._runtime.GetCurrentLayout().GetScrollX()},scrolly(){return this._runtime.GetCurrentLayout().GetScrollY()},layoutname(){return this._runtime.GetCurrentLayout().GetName()},layoutscale(){return this._runtime.GetCurrentLayout().GetScale()},layoutangle(){return e.toDegrees(this._runtime.GetCurrentLayout().GetAngle())},layoutwidth(){return this._runtime.GetCurrentLayout().GetWidth()},layoutheight(){return this._runtime.GetCurrentLayout().GetHeight()},viewportleft(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().getLeft():0},viewporttop(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().getTop():0},viewportright(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().getRight():0},viewportbottom(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().getBottom():0},viewportwidth(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().width():0},viewportheight(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetViewport3D().height():0},canvastolayerx(e,t,s){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.CanvasCssToLayer(t,s)[0]:0},canvastolayery(e,t,s){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.CanvasCssToLayer(t,s)[1]:0},layertocanvasx(e,t,s){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.LayerToCanvasCss(t,s)[0]:0},layertocanvasy(e,t,s){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.LayerToCanvasCss(t,s)[1]:0},layerscale(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetOwnScale():0},layerangle(t){return(t=this._runtime.GetCurrentLayout().GetLayer(t))?e.toDegrees(t.GetOwnAngle()):0},layeropacity(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?100*e.GetOpacity():0},layerscalerate(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetScaleRate():0},layerscrollx(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetScrollX():0},layerscrolly(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetScrollY():0},layerparallaxx(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?100*e.GetParallaxX():0},layerparallaxy(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?100*e.GetParallaxY():0},layerzelevation(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetZElevation():0},layerindex(e){return(e=this._runtime.GetCurrentLayout().GetLayer(e))?e.GetIndex():-1},canvassnapshot(){const e=this._runtime.GetCanvasManager();return e?e.GetCanvasSnapshotUrl():""},loopindex(e){const t=this._loopStack;return t.IsInLoop()?e?(e=t.FindByName(e))?e.GetIndex():0:t.GetCurrent().GetIndex():0},savestatejson(){return this._runtime.GetLastSaveJsonString()},callmapped(e,t,...s){var i=this._GetFunctionMap(e.toLowerCase(),!1);if(!i)return console.warn(`[Construct 3] Call mapped function: map name '${e}' not found; returning 0`),0;var r=i.strMap.get(t.toLowerCase());if(!r){if(!i.defaultFunc)return console.warn(`[Construct 3] Call mapped function: no function associated with map '${e}' string '${t}'; returning 0 (consider setting a default)`),0;r=i.defaultFunc}i=r.GetReturnType();const n=r.GetDefaultReturnValue();if(0===i)return console.warn(`[Construct 3] Call mapped function: map '${e}' string '${t}' has no return type so cannot be called from an expression; returning 0`),0;if(!r.IsEnabled())return n;e=this._runtime.GetEventSheetManager(),t=e.GetCurrentEvent().GetSolModifiersIncludingParents();const a=0<t.length;a&&e.PushCleanSol(t);const o=r.GetFunctionParameters();for(let e=s.length,t=o.length;e<t;++e)s.push(o[e].GetInitialValue());return r=r.GetEventBlock(),s=r.RunAsExpressionFunctionCall(r.GetSolModifiersIncludingParents(),i,n,...s),a&&e.PopSol(t),s},loadingprogress(){return this._runtime.GetAssetManager().GetLoadProgress()},imageloadingprogress(){return 0===this._imagesLoadingTotal?1:this._imagesLoadingComplete/this._imagesLoadingTotal},renderer(){return this._runtime.GetWebGPURenderer()?"webgpu":"webgl"},rendererdetail(){return this._runtime.GetWebGPURenderer()?"<unavailable>":this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},imagememoryusage(){let e=this._runtime.GetRenderer().GetEstimatedTextureMemoryUsage();return Math.round(100*e/1048576)/100},rgb:(t,s,i)=>e.PackRGB(t,s,i),rgbex:(t,s,i)=>e.PackRGBEx(t/100,s/100,i/100),rgba:(t,s,i,r)=>e.PackRGBAEx(t/100,s/100,i/100,r/100),rgbex255:(t,s,i)=>e.PackRGBEx(t/255,s/255,i/255),rgba255:(t,s,i,r)=>e.PackRGBAEx(t/255,s/255,i/255,r/255),projectname(){return this._runtime.GetProjectName()},projectversion(){return this._runtime.GetProjectVersion()},currenteventsheetname(){return this._runtime.GetCurrentEvent().GetEventSheet().GetName()},currenteventnumber(){return this._runtime.GetCurrentEvent().GetDisplayNumber()}}}{const e=self.C3;e.Plugins.Text=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Text.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}LoadTextures(e){}ReleaseTextures(){}}}{const e=self.C3,t=self.C3X,s=[0,0,0],i=["left","center","right"],r=["top","center","bottom"],n=new e.Rect,a=new e.Quad,o=new e.Color;e.Plugins.Text.Instance=class extends e.SDKWorldInstanceBase{constructor(t,s){super(t),this._text="",this._enableBBcode=!0,this._faceName="Arial",this._ptSize=12,this._lineHeightOffset=0,this._isItalic=this._isBold=!1,this._color=e.New(e.Color),this._verticalAlign=this._horizontalAlign=0,this._wrapByWord=!0,this._typewriterEndTime=this._typewriterStartTime=-1,this._typewriterLength=0,this._rendererText=e.New(e.Gfx.RendererText,this._runtime.GetRenderer(),{timeout:5}),this._rendererText.ontextureupdate=(()=>this._runtime.UpdateRender()),this._rendererText.SetIsAsync(!1),s&&(this._text=s[0],this._enableBBcode=!!s[1],this._faceName=s[2],this._ptSize=s[3],this._lineHeightOffset=s[4],this._isBold=!!s[5],this._isItalic=!!s[6],this._horizontalAlign=s[8],this._verticalAlign=s[9],this._wrapByWord=0===s[10],t=s[7],this._color.setRgb(t[0],t[1],t[2]),this.GetWorldInfo().SetVisible(s[11])),this._UpdateTextSettings()}Release(){this._CancelTypewriter(),this._rendererText.Release(),
this._rendererText=null,super.Release()}_UpdateTextSettings(){const e=this._rendererText;e.SetText(this._text),e.SetBBCodeEnabled(this._enableBBcode),e.SetFontName(this._faceName),e.SetLineHeight(this._lineHeightOffset),e.SetBold(this._isBold),e.SetItalic(this._isItalic),e.SetColor(this._color),e.SetHorizontalAlignment(i[this._horizontalAlign]),e.SetVerticalAlignment(r[this._verticalAlign]),e.SetWordWrapMode(this._wrapByWord?"word":"character")}_UpdateTextSize(){const e=this.GetWorldInfo();this._rendererText.SetFontSize(this._ptSize),this._rendererText.SetFontSizeScale(e.GetSceneGraphScale());var t=e.GetLayer();t=t.GetRenderScale()*t.Get2DScaleFactorToZ(e.GetTotalZElevation()),this._rendererText.SetSize(e.GetWidth(),e.GetHeight(),t)}Draw(e){var t=this.GetWorldInfo();this._UpdateTextSize();const s=this._rendererText.GetTexture();if(s){var i=t.GetLayer();if(0===t.GetAngle()&&0===i.GetAngle()&&0===t.GetTotalZElevation()&&!t.HasMesh()&&i.RendersIn2DMode()){t=t.GetBoundingQuad();const[r,o]=i.LayerToDrawSurface(t.getTlx(),t.getTly()),[h,l]=i.LayerToDrawSurface(t.getBrx(),t.getBry());t=r-Math.round(r);const c=o-Math.round(o);n.set(r,o,h,l),n.offset(-t,-c),a.setFromRect(n);const[u,_]=e.GetRenderTargetSize(e.GetRenderTarget());this._runtime.GetCanvasManager().SetDeviceTransform(e,u,_),e.SetTexture(s),e.Quad3(a,this._rendererText.GetTexRect()),i._SetTransform(e)}else e.SetTexture(s),t.HasMesh()?this._DrawMesh(t,e):this._DrawStandard(t,e)}}_DrawStandard(e,t){e=e.GetBoundingQuad(),this._runtime.IsPixelRoundingEnabled()&&(e=this._PixelRoundQuad(e)),t.Quad3(e,this._rendererText.GetTexRect())}_DrawMesh(e,t){const s=e.GetTransformedMesh();if(e.IsMeshChanged()){e.CalculateBbox(n,a,!1);let t=a;this._runtime.IsPixelRoundingEnabled()&&(t=this._PixelRoundQuad(t)),s.CalculateTransformedMesh(e.GetSourceMesh(),t,this._rendererText.GetTexRect()),e.SetMeshChanged(!1)}s.Draw(t)}_PixelRoundQuad(e){const t=e.getTlx()-Math.round(e.getTlx()),s=e.getTly()-Math.round(e.getTly());return 0===t&&0===s?e:(a.copy(e),a.offset(-t,-s),a)}SaveToJson(){const e={t:this._text,c:this._color.toJSON(),fn:this._faceName,ps:this._ptSize};return this._enableBBcode&&(e.bbc=this._enableBBcode),0!==this._horizontalAlign&&(e.ha=this._horizontalAlign),0!==this._verticalAlign&&(e.va=this._verticalAlign),this._wrapByWord||(e.wr=this._wrapByWord),0!==this._lineHeightOffset&&(e.lho=this._lineHeightOffset),this._isBold&&(e.b=this._isBold),this._isItalic&&(e.i=this._isItalic),-1!==this._typewriterEndTime&&(e.tw={st:this._typewriterStartTime,en:this._typewriterEndTime,l:this._typewriterLength}),e}LoadFromJson(e){this._CancelTypewriter(),this._text=e.t,this._color.setFromJSON(e.c),this._faceName=e.fn,this._ptSize=e.ps,this._enableBBcode=!!e.hasOwnProperty("bbc")&&e.bbc,this._horizontalAlign=e.hasOwnProperty("ha")?e.ha:0,this._verticalAlign=e.hasOwnProperty("va")?e.va:0,this._wrapByWord=!e.hasOwnProperty("wr")||e.wr,this._lineHeightOffset=e.hasOwnProperty("lho")?e.lho:0,this._isBold=!!e.hasOwnProperty("b")&&e.b,this._isItalic=!!e.hasOwnProperty("i")&&e.i,e.hasOwnProperty("tw")&&(e=e.tw,this._typewriterStartTime=e.st,this._typewriterEndTime=e.en,this._typewriterLength=e.l),this._UpdateTextSettings(),-1!==this._typewriterEndTime&&this._StartTicking()}GetPropertyValueByIndex(e){switch(e){case 0:return this._text;case 1:return this._enableBBcode;case 2:return this._faceName;case 3:return this._ptSize;case 4:return this._lineHeightOffset;case 5:return this._isBold;case 6:return this._isItalic;case 7:return s[0]=this._color.getR(),s[1]=this._color.getG(),s[2]=this._color.getB(),s;case 8:return this._horizontalAlign;case 9:return this._verticalAlign;case 10:return this._wrapByWord?1:0}}SetPropertyValueByIndex(e,t){switch(e){case 0:if(this._text===t)break;this._text=t,this._UpdateTextSettings();break;case 1:if(this._enableBBcode===!!t)break;this._enableBBcode=!!t,this._UpdateTextSettings();break;case 2:if(this._faceName===t)break;this._faceName=t,this._UpdateTextSettings();break;case 3:if(this._ptSize===t)break;this._ptSize=t,this._UpdateTextSettings();break;case 4:if(this._lineHeightOffset===t)break;this._lineHeightOffset=t,this._UpdateTextSettings();break;case 5:if(this._isBold===!!t)break;this._isBold=!!t,this._UpdateTextSettings();break;case 6:if(this._isItalic===!!t)break;this._isItalic=!!t,this._UpdateTextSettings();break;case 7:if(e=this._color,e.getR()===t[0]&&e.getG()===t[1]&&e.getB()===t[2])break;this._color.setRgb(t[0],t[1],t[2]),this._UpdateTextSettings();break;case 8:if(this._horizontalAlign===t)break;this._horizontalAlign=t,this._UpdateTextSettings();break;case 9:if(this._verticalAlign===t)break;this._verticalAlign=t,this._UpdateTextSettings();break;case 10:this._wrapByWord!==(0===t)&&(this._wrapByWord=0===t,this._UpdateTextSettings())}}SetPropertyColorOffsetValueByIndex(e,t,s,i){if(0!==t||0!==s||0!==i)switch(e){case 7:this._color.addRgb(t,s,i),this._UpdateTextSettings()}}_SetText(e){this._text!==e&&(this._text=e,this._rendererText.SetText(e),this._runtime.UpdateRender())}GetText(){return this._text}_StartTypewriter(t,s){this._SetText(t),this._typewriterStartTime=this._runtime.GetWallTime(),this._typewriterEndTime=this._typewriterStartTime+s/this.GetInstance().GetActiveTimeScale(),this._typewriterLength=e.BBString.StripAnyTags(t).length,this._rendererText.SetDrawMaxCharacterCount(0),this._StartTicking()}_CancelTypewriter(){this._typewriterEndTime=this._typewriterStartTime=-1,this._typewriterLength=0,this._rendererText.SetDrawMaxCharacterCount(-1),this._StopTicking()}_FinishTypewriter(){-1!==this._typewriterEndTime&&(this._CancelTypewriter(),this.Trigger(e.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender())}_SetFontFace(e){this._faceName!==e&&(this._faceName=e,this._rendererText.SetFontName(e),this._runtime.UpdateRender())}_GetFontFace(){return this._faceName}_SetBold(e){e=!!e,this._isBold!==e&&(this._isBold=e,this._rendererText.SetBold(e),this._runtime.UpdateRender())}_IsBold(){return this._isBold}_SetItalic(e){e=!!e,this._isItalic!==e&&(this._isItalic=e,this._rendererText.SetItalic(e),this._runtime.UpdateRender())}_IsItalic(){return this._isItalic}_SetFontSize(e){this._ptSize!==e&&(this._ptSize=e,this._runtime.UpdateRender())}_GetFontSize(){return this._ptSize}_SetFontColor(e){this._color.equalsIgnoringAlpha(e)||(this._color.copyRgb(e),this._rendererText.SetColor(this._color),this._runtime.UpdateRender())}_GetFontColor(){return this._color}_SetLineHeight(e){this._lineHeightOffset!==e&&(this._lineHeightOffset=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetLineHeight(){return this._lineHeightOffset}_SetHAlign(e){this._horizontalAlign!==e&&(this._horizontalAlign=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetHAlign(){return this._horizontalAlign}_SetVAlign(e){this._verticalAlign!==e&&(this._verticalAlign=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_GetVAlign(){return this._verticalAlign}_SetWrapByWord(e){e=!!e,this._wrapByWord!==e&&(this._wrapByWord=e,this._UpdateTextSettings(),this._runtime.UpdateRender())}_IsWrapByWord(){return this._wrapByWord}_GetTextWidth(){return this._UpdateTextSize(),this._rendererText.GetTextWidth()}_GetTextHeight(){return this._UpdateTextSize(),this._rendererText.GetTextHeight()}Tick(){var t=this._runtime.GetWallTime();t>=this._typewriterEndTime?(this._CancelTypewriter(),this.Trigger(e.Plugins.Text.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender()):(t=e.relerp(this._typewriterStartTime,this._typewriterEndTime,t,0,this._typewriterLength),t=Math.floor(t),t!==this._rendererText.GetDrawMaxCharacterCount()&&(this._rendererText.SetDrawMaxCharacterCount(t),this._runtime.UpdateRender()))}GetDebuggerProperties(){return[{title:"plugins.text.name",properties:[{name:"plugins.text.properties.text.name",value:this._text,onedit:e=>this._SetText(e)}]}]}GetScriptInterfaceClass(){return self.ITextInstance}};const h=new WeakMap,l=new Map([["left",0],["center",1],["right",2]]),c=new Map([["top",0],["center",1],["bottom",2]]),u=new Map([["word",!0],["character",!1]]);self.ITextInstance=class extends self.IWorldInstance{constructor(){super(),h.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get text(){return h.get(this).GetText()}set text(e){t.RequireString(e);const s=h.get(this);s._CancelTypewriter(),s._SetText(e)}typewriterText(e,s){t.RequireString(e),t.RequireFiniteNumber(s);const i=h.get(this);i._CancelTypewriter(),i._StartTypewriter(e,s)}typewriterFinish(){h.get(this)._FinishTypewriter()}set fontFace(e){t.RequireString(e),h.get(this)._SetFontFace(e)}get fontFace(){return h.get(this)._GetFontFace()}set isBold(e){h.get(this)._SetBold(e)}get isBold(){return h.get(this)._IsBold()}set isItalic(e){h.get(this)._SetItalic(e)}get isItalic(){return h.get(this)._IsItalic()}set sizePt(e){t.RequireFiniteNumber(e),h.get(this)._SetFontSize(e)}get sizePt(){return h.get(this)._GetFontSize()}set fontColor(e){if(t.RequireArray(e),3>e.length)throw Error("expected 3 elements");o.setRgb(e[0],e[1],e[2]),h.get(this)._SetFontColor(o)}get fontColor(){const e=h.get(this)._GetFontColor();return[e.getR(),e.getG(),e.getB()]}set lineHeight(e){t.RequireFiniteNumber(e),h.get(this)._SetLineHeight(e)}get lineHeight(){return h.get(this)._GetLineHeight()}set horizontalAlign(e){if(t.RequireString(e),e=l.get(e),void 0===e)throw Error("invalid mode");h.get(this)._SetHAlign(e)}get horizontalAlign(){return i[h.get(this)._GetHAlign()]}set verticalAlign(e){if(t.RequireString(e),e=c.get(e),void 0===e)throw Error("invalid mode");h.get(this)._SetVAlign(e)}get verticalAlign(){return r[h.get(this)._GetVAlign()]}set wordWrapMode(e){if(t.RequireString(e),e=u.get(e),void 0===e)throw Error("invalid mode");h.get(this)._SetWrapByWord(e)}get wordWrapMode(){return h.get(this)._IsWrapByWord()?"word":"character"}get textWidth(){return h.get(this)._GetTextWidth()}get textHeight(){return h.get(this)._GetTextHeight()}}}{const e=self.C3;e.Plugins.Text.Cnds={CompareText(t,s){return s?this._text===t:e.equalsNoCase(this._text,t)},IsRunningTypewriterText(){return-1!==this._typewriterEndTime},OnTypewriterTextFinished:()=>!0}}{const e=self.C3,t=e.New(e.Color);e.Plugins.Text.Acts={SetText(e){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),this._SetText(e.toString())},AppendText(e){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),(e=e.toString())&&this._SetText(this._text+e)},TypewriterText(e,t){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),this._StartTypewriter(e.toString(),t)},SetFontFace(e,t){let s=!1,i=!1;switch(t){case 1:s=!0;break;case 2:i=!0;break;case 3:i=s=!0}e===this._faceName&&s===this._isBold&&i===this._isItalic||(this._SetFontFace(e),this._SetBold(s),this._SetItalic(i))},SetFontSize(e){this._SetFontSize(e)},SetFontColor(e){t.setFromRgbValue(e),t.clamp(),this._SetFontColor(t)},SetWebFont(e,t){console.warn("[Text] 'Set web font' action is deprecated and no longer has any effect")},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},TypewriterFinish(){this._FinishTypewriter()},SetLineHeight(e){this._SetLineHeight(e)},SetHAlign(e){this._SetHAlign(e)},SetVAlign(e){this._SetVAlign(e)},SetWrapping(e){this._SetWrapByWord(0===e)}}}{const e=self.C3;e.Plugins.Text.Exps={Text(){return this._text},PlainText(){return this._enableBBcode?e.BBString.StripAnyTags(this._text):this._text},FaceName(){return this._faceName},FaceSize(){return this._ptSize},TextWidth(){return this._GetTextWidth()},TextHeight(){return this._GetTextHeight()},LineHeight(){return this._lineHeightOffset}}}{const e=self.C3;e.Plugins.Sprite=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Sprite.Type=class extends e.SDKTypeBase{constructor(e){super(e),this._animations=e.GetAnimations()}Release(){e.clearArray(this._animations),super.Release()}OnCreate(){for(const e of this._animations)e.LoadAllAssets(this._runtime)}LoadTextures(e){const t={sampling:this._runtime.GetSampling()};return Promise.all(this._animations.map(s=>s.LoadAllTextures(e,t)))}ReleaseTextures(){for(const e of this._animations)e.ReleaseAllTextures()}OnDynamicTextureLoadComplete(){this._UpdateAllCurrentTexture()}_UpdateAllCurrentTexture(){for(const e of this._objectClass.instancesIncludingPendingCreate())e.GetSdkInstance()._UpdateCurrentTexture()}FinishCondition(t){e.Plugins.Sprite.FinishCollisionCondition(this,t)}}}{const e=self.C3,t=self.C3X,s=e.New(e.Rect),i=e.New(e.Quad),r=e.New(e.Vector2);e.Plugins.Sprite.Instance=class extends e.SDKWorldInstanceBase{constructor(t,s){super(t);let i=!0,r="",n=0,a=!0;s&&(i=!!s[0],r=s[1],n=s[2],a=s[3]),this._currentAnimation=this._objectClass.GetAnimationByName(r)||this._objectClass.GetAnimations()[0],this._currentFrameIndex=e.clamp(n,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex),s=this._currentAnimationFrame.GetImageInfo(),this._currentTexture=s.GetTexture(),this._currentRcTex=s.GetTexRect(),this._currentQuadTex=s.GetTexQuad(),this.HandleWebGLContextLoss(),t.SetFlag(2,!0),t.SetFlag(1,0<=this._currentAnimation.GetSpeed()),this._currentAnimationSpeed=Math.abs(this._currentAnimation.GetSpeed()),this._currentAnimationRepeatTo=this._currentAnimation.GetRepeatTo(),this._animationTimer=e.New(e.KahanSum),this._animationRepeats=this._frameStartTime=0,this._animTriggerName="",this._changeAnimFrameIndex=-1,this._changeAnimationName="",this._changeAnimationFrom=0,t=this.GetWorldInfo(),this._bquadRef=t.GetBoundingQuad(),t.SetVisible(i),t.SetCollisionEnabled(a),t.SetOriginX(this._currentAnimationFrame.GetOriginX()),t.SetOriginY(this._currentAnimationFrame.GetOriginY()),t.SetSourceCollisionPoly(this._currentAnimationFrame.GetCollisionPoly()),t.SetBboxChanged(),1===this._objectClass.GetAnimationCount()&&1===this._objectClass.GetAnimations()[0].GetFrameCount()||0===this._currentAnimationSpeed||this._StartTicking()}Release(){this._animationTimer=this._currentTexture=this._currentAnimationFrame=this._currentAnimation=null,super.Release()}GetCurrentImageInfo(){return this._currentAnimationFrame.GetImageInfo()}IsOriginalSizeKnown(){return!0}OnWebGLContextLost(){this._currentTexture=null}OnWebGLContextRestored(){this._UpdateCurrentTexture()}Draw(e){var t=this._currentTexture;null!==t&&(e.SetTexture(t),t=this.GetWorldInfo(),t.HasMesh()?this._DrawMesh(t,e):this._DrawStandard(t,e))}_DrawStandard(e,t){let s=this._bquadRef;this._runtime.IsPixelRoundingEnabled()&&(s=e.PixelRoundQuad(s)),t.Quad4(s,this._currentQuadTex)}_DrawMesh(e,t){const r=e.GetTransformedMesh();if(e.IsMeshChanged()){e.CalculateBbox(s,i,!1);let t=i;this._runtime.IsPixelRoundingEnabled()&&(t=e.PixelRoundQuad(t)),r.CalculateTransformedMesh(e.GetSourceMesh(),t,this._currentQuadTex),e.SetMeshChanged(!1)}r.Draw(t)}GetAnimationTime(){return this._animationTimer.Get()}IsAnimationPlaying(){return this._inst.GetFlag(2)}SetAnimationPlaying(e){this._inst.SetFlag(2,e)}IsPlayingForwards(){return this._inst.GetFlag(1)}SetPlayingForwards(e){this._inst.SetFlag(1,e)}IsInAnimationTrigger(){return this._inst.GetFlag(4)}SetInAnimationTrigger(e){this._inst.SetFlag(4,e)}Tick(){this._changeAnimationName&&this._DoChangeAnimation(),0<=this._changeAnimFrameIndex&&this._DoChangeAnimFrame();const t=this._currentAnimationSpeed;if(this.IsAnimationPlaying()&&0!==t){var s=this._runtime.GetDt(this._inst);this._animationTimer.Add(s),s=this.GetAnimationTime();var i=this._currentAnimationFrame,r=i.GetDuration()/t;if(!(s<this._frameStartTime+r)){var n=this._currentAnimation,a=this._currentAnimationRepeatTo,o=n.GetFrameCount(),h=n.GetRepeatCount(),l=n.IsLooping(),c=n.IsPingPong();this.IsPlayingForwards()?this._currentFrameIndex++:this._currentFrameIndex--,this._frameStartTime+=r,this._currentFrameIndex>=o&&(c?(this.SetPlayingForwards(!1),this._currentFrameIndex=o-2):l?this._currentFrameIndex=a:(this._animationRepeats++,this._animationRepeats>=h?this._FinishAnimation(!1):this._currentFrameIndex=a)),0>this._currentFrameIndex&&(c?(this._currentFrameIndex=1,this.SetPlayingForwards(!0),l||(this._animationRepeats++,this._animationRepeats>=h&&this._FinishAnimation(!0))):l?this._currentFrameIndex=a:(this._animationRepeats++,this._animationRepeats>=h?this._FinishAnimation(!0):this._currentFrameIndex=a)),this._currentFrameIndex=e.clamp(this._currentFrameIndex,0,o-1),r=n.GetFrameAt(this._currentFrameIndex),s>this._frameStartTime+r.GetDuration()/t&&(this._frameStartTime=s),this._OnFrameChanged(i,r)}}else this._StopTicking()}_FinishAnimation(t){this._currentFrameIndex=t?0:this._currentAnimation.GetFrameCount()-1,this.SetAnimationPlaying(!1),this._animTriggerName=this._currentAnimation.GetName(),this.SetInAnimationTrigger(!0),this.DispatchScriptEvent("animationend",!1,{animationName:this._animTriggerName}),this.Trigger(e.Plugins.Sprite.Cnds.OnAnyAnimFinished),this.Trigger(e.Plugins.Sprite.Cnds.OnAnimFinished),this.SetInAnimationTrigger(!1),this._animationRepeats=0}_OnFrameChanged(t,s){if(t!==s){var i=this.GetWorldInfo(),r=t.GetImageInfo(),n=s.GetImageInfo(),a=r.GetWidth();r=r.GetHeight();var o=n.GetWidth(),h=n.GetHeight();a!==o&&i.SetWidth(i.GetWidth()*(o/a)),r!==h&&i.SetHeight(i.GetHeight()*(h/r)),i.SetOriginX(s.GetOriginX()),i.SetOriginY(s.GetOriginY()),i.SetSourceCollisionPoly(s.GetCollisionPoly()),i.SetBboxChanged(),this._currentAnimationFrame=s,this._currentTexture=n.GetTexture(),this._currentRcTex=n.GetTexRect(),this._currentQuadTex=n.GetTexQuad(),i=this.GetInstance().GetBehaviorInstances();for(let e=0,r=i.length;e<r;++e)i[e].OnSpriteFrameChanged(t,s);this.DispatchScriptEvent("framechange",!1,{animationName:this._currentAnimation.GetName(),animationFrame:this._currentFrameIndex}),this.Trigger(e.Plugins.Sprite.Cnds.OnFrameChanged),this._runtime.UpdateRender()}}_StartAnim(e){this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),1===e&&0!==this._currentFrameIndex&&(this._changeAnimFrameIndex=0,this.IsInAnimationTrigger()||this._DoChangeAnimFrame()),this._StartTicking()}_SetAnim(e,t){this._changeAnimationName=e,this._changeAnimationFrom=t,this._StartTicking(),this.IsInAnimationTrigger()||this._DoChangeAnimation()}_GetCurrentAnimationName(){return this._changeAnimationName?this._changeAnimationName:this._currentAnimation.GetName()}_SetAnimFrame(e){isFinite(e)&&(this._changeAnimFrameIndex=e,this.IsInAnimationTrigger()||this._DoChangeAnimFrame())}_GetAnimFrame(){return this._currentFrameIndex}_SetAnimSpeed(e){this._currentAnimationSpeed=Math.abs(e),this.SetPlayingForwards(0<=e),0<this._currentAnimationSpeed&&this._StartTicking()}_GetAnimSpeed(){return this.IsPlayingForwards()?this._currentAnimationSpeed:-this._currentAnimationSpeed}_SetAnimRepeatToFrame(t){this._currentAnimationRepeatTo=t=e.clamp(Math.floor(t),0,this._currentAnimation.GetFrameCount()-1)}_GetAnimRepeatToFrame(){return this._currentAnimationRepeatTo}_DoChangeAnimation(){const t=this._currentAnimationFrame;var s=this._objectClass.GetAnimationByName(this._changeAnimationName);this._changeAnimationName="",!s||s===this._currentAnimation&&this.IsAnimationPlaying()||(this._currentAnimation=s,this.SetPlayingForwards(0<=s.GetSpeed()),this._currentAnimationSpeed=Math.abs(s.GetSpeed()),this._currentAnimationRepeatTo=s.GetRepeatTo(),this._currentFrameIndex=e.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1),1===this._changeAnimationFrom&&(this._currentFrameIndex=0),this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),s=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._OnFrameChanged(t,s))}_DoChangeAnimFrame(){const t=this._currentAnimationFrame;var s=this._currentFrameIndex;this._currentFrameIndex=e.clamp(Math.floor(this._changeAnimFrameIndex),0,this._currentAnimation.GetFrameCount()-1),this._changeAnimFrameIndex=-1,s!==this._currentFrameIndex&&(s=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._OnFrameChanged(t,s),this._frameStartTime=this.GetAnimationTime())}_UpdateCurrentTexture(){const e=this._currentAnimationFrame.GetImageInfo();this._currentTexture=e.GetTexture(),this._currentRcTex=e.GetTexRect(),this._currentQuadTex=e.GetTexQuad(),this.GetWorldInfo().SetMeshChanged(!0)}GetTexture(){return this._currentTexture}GetTexRect(){return this._currentRcTex}GetTexQuad(){return this._currentQuadTex}GetImagePointCount(){return this._currentAnimationFrame.GetImagePointCount()}GetImagePoint(e){const t=this._currentAnimationFrame,s=this.GetWorldInfo();if("string"==typeof e)e=t.GetImagePointByName(e);else{if("number"!=typeof e)throw new TypeError("expected string or number");e=t.GetImagePointByIndex(e-1)}if(!e)return[s.GetX(),s.GetY()];if(r.copy(e.GetVec2()),s.HasMesh()){const[e,t]=s.GetSourceMesh().TransformPoint(r.getX(),r.getY());r.set(e,t)}return r.offset(-t.GetOriginX(),-t.GetOriginY()),r.scale(s.GetWidth(),s.GetHeight()),r.rotate(s.GetAngle()),r.offset(s.GetX(),s.GetY()),[r.getX(),r.getY()]}GetCollisionPolyPointCount(){return this.GetWorldInfo().GetTransformedCollisionPoly().pointCount()}GetCollisionPolyPoint(e){e=Math.floor(e);const t=this.GetWorldInfo();var s=t.GetTransformedCollisionPoly();const i=s.pointCount();return e===i&&(e=0),0>e||e>=i?[0,0]:(s=s.pointsArr(),[s[2*e]+t.GetX(),s[2*e+1]+t.GetY()])}GetDebuggerProperties(){const t=e.Plugins.Sprite.Acts;return[{title:"plugins.sprite.debugger.animation-properties.title",properties:[{name:"plugins.sprite.debugger.animation-properties.current-animation",value:this._currentAnimation.GetName(),onedit:e=>this.CallAction(t.SetAnim,e,0)},{name:"plugins.sprite.debugger.animation-properties.current-frame",value:this._currentFrameIndex,onedit:e=>this.CallAction(t.SetAnimFrame,e)},{name:"plugins.sprite.debugger.animation-properties.is-playing",value:this.IsAnimationPlaying(),onedit:e=>e?this.CallAction(t.StartAnim,0):this.CallAction(t.StopAnim)},{name:"plugins.sprite.debugger.animation-properties.speed",value:this._currentAnimationSpeed,onedit:e=>this.CallAction(t.SetAnimSpeed,e)},{name:"plugins.sprite.debugger.animation-properties.repeats",value:this._animationRepeats,onedit:e=>this._animationRepeats=e}]}]}SaveToJson(){const e={a:this._currentAnimation.GetSID()};0!==this._frameStartTime&&(e.fs=this._frameStartTime);var t=this.GetAnimationTime();return 0!==t&&(e.at=t),0!==this._currentFrameIndex&&(e.f=this._currentFrameIndex),0!==this._currentAnimationSpeed&&(e.cas=this._currentAnimationSpeed),1!==this._animationRepeats&&(e.ar=this._animationRepeats),0!==this._currentAnimationRepeatTo&&(e.rt=this._currentAnimationRepeatTo),this.IsAnimationPlaying()||(e.ap=this.IsAnimationPlaying()),this.IsPlayingForwards()||(e.af=this.IsPlayingForwards()),t=this.GetWorldInfo(),t.IsCollisionEnabled()&&(e.ce=t.IsCollisionEnabled()),e}LoadFromJson(t){var s=this.GetObjectClass().GetAnimationBySID(t.a);s&&(this._currentAnimation=s),this._frameStartTime=t.hasOwnProperty("fs")?t.fs:0,this._animationTimer.Set(t.hasOwnProperty("at")?t.at:0),s=t.hasOwnProperty("f")?t.f:0,this._currentFrameIndex=e.clamp(s,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationSpeed=t.hasOwnProperty("cas")?t.cas:0,this._animationRepeats=t.hasOwnProperty("ar")?t.ar:1,s=t.hasOwnProperty("rt")?t.rt:0,this._currentAnimationRepeatTo=e.clamp(s,0,this._currentAnimation.GetFrameCount()-1),this.SetAnimationPlaying(!t.hasOwnProperty("ap")||!!t.ap),this.SetPlayingForwards(!t.hasOwnProperty("af")||!!t.af),this._currentAnimationFrame=s=this._currentAnimation.GetFrameAt(this._currentFrameIndex),this._UpdateCurrentTexture();const i=this.GetWorldInfo();i.SetOriginX(s.GetOriginX()),i.SetOriginY(s.GetOriginY()),i.SetSourceCollisionPoly(s.GetCollisionPoly()),i.SetCollisionEnabled(!!t.ce)}GetPropertyValueByIndex(t){const s=this.GetWorldInfo();switch(t){case 3:return s.IsCollisionEnabled();case 2:return e.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1)}}SetPropertyValueByIndex(t,s){var i=this.GetWorldInfo();switch(t){case 3:i.SetCollisionEnabled(!!s);break;case 2:this.SetAnimationPlaying(!1),t=this._currentAnimation.GetFrameCount()-1,i=s=e.clamp(s,0,t),s=this._currentAnimation.GetFrameAt(this._currentFrameIndex);const r=this._currentAnimation.GetFrameAt(i);this._OnFrameChanged(s,r),this._currentFrameIndex=e.clamp(i,0,t)}}GetScriptInterfaceClass(){return self.ISpriteInstance}};const n=new WeakMap,a=new Map([["current-frame",0],["beginning",1]]);self.ISpriteInstance=class extends self.IWorldInstance{constructor(){super(),n.set(this,self.IInstance._GetInitInst().GetSdkInstance())}getImagePointCount(){return n.get(this).GetImagePointCount()}getImagePointX(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return n.get(this).GetImagePoint(e)[0]}getImagePointY(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return n.get(this).GetImagePoint(e)[1]}getImagePoint(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return n.get(this).GetImagePoint(e)}getPolyPointCount(){return n.get(this).GetCollisionPolyPointCount()}getPolyPointX(e){return t.RequireFiniteNumber(e),n.get(this).GetCollisionPolyPoint(e)[0]}getPolyPointY(e){return t.RequireFiniteNumber(e),n.get(this).GetCollisionPolyPoint(e)[1]}getPolyPoint(e){return t.RequireFiniteNumber(e),n.get(this).GetCollisionPolyPoint(e)}stopAnimation(){n.get(this).SetAnimationPlaying(!1)}startAnimation(e="current-frame"){if(t.RequireString(e),e=a.get(e),void 0===e)throw Error("invalid mode");n.get(this)._StartAnim(e)}setAnimation(e,s="beginning"){if(t.RequireString(e),t.RequireString(s),s=a.get(s),void 0===s)throw Error("invalid mode");n.get(this)._SetAnim(e,s)}get animationName(){return n.get(this)._GetCurrentAnimationName()}set animationFrame(e){t.RequireFiniteNumber(e),n.get(this)._SetAnimFrame(e)}get animationFrame(){return n.get(this)._GetAnimFrame()}set animationSpeed(e){t.RequireFiniteNumber(e),n.get(this)._SetAnimSpeed(e)}get animationSpeed(){return n.get(this)._GetAnimSpeed()}set animationRepeatToFrame(e){t.RequireFiniteNumber(e),n.get(this)._SetAnimRepeatToFrame(e)}get animationRepeatToFrame(){return n.get(this)._GetAnimRepeatToFrame()}get imageWidth(){return n.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return n.get(this).GetCurrentImageInfo().GetHeight()}}}{const e=self.C3;e.Plugins.Sprite.Cnds={IsAnimPlaying(t){return e.equalsNoCase(this._GetCurrentAnimationName(),t)},CompareFrame(t,s){return e.compare(this._currentFrameIndex,t,s)},CompareAnimSpeed(t,s){return e.compare(this._GetAnimSpeed(),t,s)},OnAnimFinished(t){return e.equalsNoCase(this._animTriggerName,t)},OnAnyAnimFinished:()=>!0,OnFrameChanged:()=>!0,IsMirrored(){return 0>this.GetWorldInfo().GetWidth()},IsFlipped(){return 0>this.GetWorldInfo().GetHeight()},OnURLLoaded:()=>!0,OnURLFailed:()=>!0,IsCollisionEnabled(){return this.GetWorldInfo().IsCollisionEnabled()}}}{const e=self.C3;e.Plugins.Sprite.Acts={Spawn(t,s,i,r){if(t&&s){var[n,a]=this.GetImagePoint(i);if((i=this._runtime.CreateInstance(t,s,n,a,r))&&(r&&s.SortAndAddInstancesByZIndex(i),t.GetPlugin().IsRotatable()&&(s=i.GetWorldInfo(),s.SetAngle(this.GetWorldInfo().GetAngle()),s.SetBboxChanged()),s=this._runtime.GetEventSheetManager(),s.BlockFlushingInstances(!0),i._TriggerOnCreatedOnSelfAndRelated(),s.BlockFlushingInstances(!1),r=this._runtime.GetCurrentAction().GetSavedDataMap(),s=!1,(!r.has("Spawn_LastExec")||r.get("Spawn_LastExec")<this._runtime.GetExecCount())&&(s=!0,r.set("Spawn_LastExec",this._runtime.GetExecCount())),t!==this.GetObjectClass()&&(t=t.GetCurrentSol(),t._SetSelectAll(!1),t=t._GetOwnInstances(),s&&e.clearArray(t),t.push(i),i.IsInContainer())))for(const e of i.siblings())i=e.GetObjectClass().GetCurrentSol(),s?i.SetSinglePicked(e):(i._SetSelectAll(!1),i._PushInstance(e))}},StopAnim(){this.SetAnimationPlaying(!1)},StartAnim(e){this._StartAnim(e)},SetAnim(e,t){this._SetAnim(e,t)},SetAnimFrame(e){this._SetAnimFrame(e)},SetAnimSpeed(e){this._SetAnimSpeed(e)},SetAnimRepeatToFrame(e){this._SetAnimRepeatToFrame(e)},SetMirrored(e){const t=this.GetWorldInfo(),s=t.GetWidth();e=Math.abs(s)*(0===e?-1:1),s!==e&&(t.SetWidth(e),t.SetBboxChanged())},SetFlipped(e){const t=this.GetWorldInfo(),s=t.GetHeight();e=Math.abs(s)*(0===e?-1:1),s!==e&&(t.SetHeight(e),t.SetBboxChanged())},SetScale(e){const t=this._currentAnimationFrame.GetImageInfo(),s=this.GetWorldInfo();var i=0>s.GetWidth()?-1:1;const r=0>s.GetHeight()?-1:1;i*=t.GetWidth()*e,e=t.GetHeight()*e*r,s.GetWidth()===i&&s.GetHeight()===e||(s.SetSize(i,e),s.SetBboxChanged())},async LoadURL(t,s,i){i=this._currentAnimationFrame.GetImageInfo();const r=this.GetWorldInfo(),n=this._runtime;if(i.GetURL()===t)0===s&&(r.SetSize(i.GetWidth(),i.GetHeight()),r.SetBboxChanged()),this.Trigger(e.Plugins.Sprite.Cnds.OnURLLoaded);else{var a=e.New(e.ImageInfo);try{if(await a.LoadDynamicAsset(n,t),!a.IsLoaded())throw Error("image failed to load");await a.LoadStaticTexture(n.GetRenderer(),{sampling:this._runtime.GetSampling()})}catch(t){return console.error("Load image from URL failed: ",t),void this.Trigger(e.Plugins.Sprite.Cnds.OnURLFailed)}i.ReplaceWith(a),this._sdkType._UpdateAllCurrentTexture(),this.WasReleased()||0!==s||(r.SetSize(i.GetWidth(),i.GetHeight()),r.SetBboxChanged()),n.UpdateRender(),this.WasReleased()||await this.TriggerAsync(e.Plugins.Sprite.Cnds.OnURLLoaded)}},SetCollisions(e){this.GetWorldInfo().SetCollisionEnabled(e)},SetSolidCollisionFilter(e,t){this.GetWorldInfo().SetSolidCollisionFilter(0===e,t)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}self.C3.Plugins.Sprite.Exps={AnimationFrame(){return this._currentFrameIndex},AnimationFrameCount(){return this._currentAnimation.GetFrameCount()},AnimationName(){return this._currentAnimation.GetName()},AnimationSpeed(){return this._GetAnimSpeed()},OriginalAnimationSpeed(){return this._currentAnimation.GetSpeed()},ImagePointX(e){return this.GetImagePoint(e)[0]},ImagePointY(e){return this.GetImagePoint(e)[1]},ImagePointCount(){return this.GetImagePointCount()},ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},PolyPointXAt(e){return this.GetCollisionPolyPoint(e)[0]},PolyPointYAt(e){return this.GetCollisionPolyPoint(e)[1]},PolyPointCount(){return this.GetCollisionPolyPointCount()}};{const e=self.C3;e.Plugins.Spritefont2=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Spritefont2.Type=class extends e.SDKTypeBase{constructor(t){super(t),this._spriteFont=e.New(self.SpriteFont)}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling()})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}GetSpriteFont(){return this._spriteFont}UpdateSettings(e,t,s,i){const r=this.GetImageInfo(),n=this._spriteFont;n.SetWidth(r.GetWidth()),n.SetHeight(r.GetHeight()),n.SetCharacterWidth(e),n.SetCharacterHeight(t),n.SetCharacterSet(s),n.SetSpacingData(i),n.UpdateCharacterMap()}}}{const e=self.C3,t=self.C3X,s=["left","center","right"],i=["top","center","bottom"];e.Plugins.Spritefont2.Instance=class extends e.SDKWorldInstanceBase{constructor(t,s){super(t),this._text="",this._enableBBcode=!0,this._characterHeight=this._characterWidth=16,this._characterSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789.,;:?!-_~#\"'&()[]|`\\/@+=*$<>",t="",this._characterScale=1,this._verticalAlign=this._horizontalAlign=this._lineHeight=this._characterSpacing=0,this._wrapByWord=!0,this._spriteFontText=null,this._typewriterEndTime=this._typewriterStartTime=-1,this._typewriterLength=0,s&&(this._text=s[0],this._enableBBcode=s[1],this._characterWidth=s[2],this._characterHeight=s[3],this._characterSet=s[4],t=s[5],this._characterScale=s[6],this._characterSpacing=s[7],this._lineHeight=s[8],this._horizontalAlign=s[9],this._verticalAlign=s[10],this._wrapByWord=0===s[11],
this.GetWorldInfo().SetVisible(s[12])),this._sdkType.UpdateSettings(this._characterWidth,this._characterHeight,this._characterSet,t),this._spriteFontText=e.New(self.SpriteFontText,this._sdkType.GetSpriteFont()),s=this.GetWorldInfo(),this._spriteFontText.SetSize(s.GetWidth(),s.GetHeight()),this._UpdateSettings(),this._inst.SetMustMitigateZFighting()}Release(){this._CancelTypewriter(),this._spriteFontText.Release(),this._spriteFontText=null,super.Release()}_UpdateSettings(){const e=this._spriteFontText;e&&(e.SetBBCodeEnabled(this._enableBBcode),e.SetText(this._text),e.SetWordWrapMode(this._wrapByWord?"word":"character"),e.SetHorizontalAlign(s[this._horizontalAlign]),e.SetVerticalAlign(i[this._verticalAlign]),e.SetSpacing(this._characterSpacing),e.SetLineHeight(this._lineHeight))}Draw(e){const t=this._objectClass.GetImageInfo();var s=t.GetTexture();if(s){e.SetTexture(s),s=this.GetWorldInfo();var i=s.GetBoundingQuad(),r=this._spriteFontText;r.SetScale(this._characterScale),r.SetSceneGraphScale(s.GetSceneGraphScale()),this._runtime.IsPixelRoundingEnabled()&&(i=s.PixelRoundQuad(i)),r.SetSize(s.GetWidth(),s.GetHeight()),r.GetSpriteFont().SetTexRect(t.GetTexRect()),r.SetColor(s.GetUnpremultipliedColor()),r.Draw(e,i.getTlx(),i.getTly(),s.GetAngle())}}SaveToJson(){const e={t:this._text,ebbc:this._enableBBcode,csc:this._characterScale,csp:this._characterSpacing,lh:this._lineHeight,ha:this._horizontalAlign,va:this._verticalAlign,w:this._wrapByWord,cw:this._sdkType.GetSpriteFont().GetCharacterWidth(),ch:this._sdkType.GetSpriteFont().GetCharacterHeight(),cs:this._sdkType.GetSpriteFont().GetCharacterSet(),sd:this._sdkType.GetSpriteFont().GetSpacingData()};return-1!==this._typewriterEndTime&&(e.tw={st:this._typewriterStartTime,en:this._typewriterEndTime,l:this._typewriterLength}),e}LoadFromJson(e){if(this._CancelTypewriter(),this._text=e.t,this._enableBBcode=e.ebbc,this._characterScale=e.csc,this._characterSpacing=e.csp,this._lineHeight=e.lh,this._horizontalAlign=e.ha,this._verticalAlign=e.va,this._wrapByWord=e.w,e.hasOwnProperty("tw")){var t=e.tw;this._typewriterStartTime=t.st,this._typewriterEndTime=t.en,this._typewriterLength=e.l}t=this._sdkType.GetSpriteFont(),t.SetCharacterWidth(e.cw),t.SetCharacterHeight(e.ch),t.SetCharacterSet(e.cs),t.SetSpacingData(e.sd),this._UpdateSettings(),-1!==this._typewriterEndTime&&this._StartTicking()}GetPropertyValueByIndex(e){switch(e){case 0:return this._text;case 1:return this._enableBBcode;case 2:return this._sdkType.GetSpriteFont().GetCharacterWidth();case 3:return this._sdkType.GetSpriteFont().GetCharacterHeight();case 4:return this._sdkType.GetSpriteFont().GetCharacterSet();case 5:return this._sdkType.GetSpriteFont().GetSpacingData();case 6:return this._characterScale;case 7:return this._characterSpacing;case 8:return this._lineHeight;case 9:return this._horizontalAlign;case 10:return this._verticalAlign;case 11:return this._wrapByWord?1:0}}SetPropertyValueByIndex(e,t){switch(e){case 0:if(this._text===t)break;this._text=t,this._UpdateSettings();break;case 1:if(this._enableBBcode===!!t)break;this._enableBBcode=!!t,this._UpdateSettings();break;case 2:this._sdkType.GetSpriteFont().SetCharacterWidth(t);break;case 3:this._sdkType.GetSpriteFont().SetCharacterHeight(t);break;case 4:this._sdkType.GetSpriteFont().SetCharacterSet(t);break;case 5:this._sdkType.GetSpriteFont().SetSpacingData(t);break;case 6:if(this._characterScale===t)break;this._characterScale=t,this._UpdateSettings();break;case 7:if(this._characterSpacing===t)break;this._characterSpacing=t,this._UpdateSettings();break;case 8:if(this._lineHeight===t)break;this._lineHeight=t,this._UpdateSettings();break;case 9:if(this._horizontalAlign===t)break;this._horizontalAlign=t,this._UpdateSettings();break;case 10:if(this._verticalAlign===t)break;this._verticalAlign=t,this._UpdateSettings();break;case 11:this._wrapByWord!==(0===t)&&(this._wrapByWord=0===t,this._UpdateSettings())}}_SetText(e){this._text!==e&&(this._text=e,this._spriteFontText.SetText(e),this._runtime.UpdateRender())}GetText(){return this._text}_StartTypewriter(t,s){this._SetText(t),this._typewriterStartTime=this._runtime.GetWallTime(),this._typewriterEndTime=this._typewriterStartTime+s/this.GetInstance().GetActiveTimeScale(),this._typewriterLength=e.BBString.StripAnyTags(t).length,this._spriteFontText.SetDrawMaxCharacterCount(0),this._StartTicking()}_CancelTypewriter(){this._typewriterEndTime=this._typewriterStartTime=-1,this._typewriterLength=0,this._spriteFontText.SetDrawMaxCharacterCount(-1),this._StopTicking()}_FinishTypewriter(){-1!==this._typewriterEndTime&&(this._CancelTypewriter(),this.Trigger(e.Plugins.Spritefont2.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender())}_SetScale(e){this._characterScale!==e&&(this._characterScale=e,this._spriteFontText.SetScale(this._characterScale),this._runtime.UpdateRender())}_GetScale(){return this._characterScale}_SetCharacterSpacing(e){this._characterSpacing!==e&&(this._characterSpacing=e,this._spriteFontText.SetSpacing(this._characterSpacing),this._runtime.UpdateRender())}_GetCharacterSpacing(){return this._characterSpacing}_SetLineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._spriteFontText.SetLineHeight(this._lineHeight),this._runtime.UpdateRender())}_GetLineHeight(){return this._lineHeight}_SetHAlign(e){this._horizontalAlign!==e&&(this._horizontalAlign=e,this._UpdateSettings(),this._runtime.UpdateRender())}_GetHAlign(){return this._horizontalAlign}_SetVAlign(e){this._verticalAlign!==e&&(this._verticalAlign=e,this._UpdateSettings(),this._runtime.UpdateRender())}_GetVAlign(){return this._verticalAlign}_SetWrapByWord(e){e=!!e,this._wrapByWord!==e&&(this._wrapByWord=e,this._UpdateSettings(),this._runtime.UpdateRender())}_IsWrapByWord(){return this._wrapByWord}Tick(){var t=this._runtime.GetWallTime();t>=this._typewriterEndTime?(this._CancelTypewriter(),this.Trigger(e.Plugins.Spritefont2.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender()):(t=e.relerp(this._typewriterStartTime,this._typewriterEndTime,t,0,this._typewriterLength),t=Math.floor(t),t!==this._spriteFontText.GetDrawMaxCharacterCount()&&(this._spriteFontText.SetDrawMaxCharacterCount(t),this._runtime.UpdateRender()))}GetDebuggerProperties(){return[{title:"plugins.spritefont2.name",properties:[{name:"plugins.spritefont2.properties.text.name",value:this._text,onedit:e=>this._SetText(e)}]}]}GetScriptInterfaceClass(){return self.ISpriteFontInstance}};const r=new WeakMap,n=new Map([["left",0],["center",1],["right",2]]),a=new Map([["top",0],["center",1],["bottom",2]]),o=new Map([["word",!0],["character",!1]]);self.ISpriteFontInstance=class extends self.IWorldInstance{constructor(){super(),r.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get text(){return r.get(this).GetText()}set text(e){t.RequireString(e);const s=r.get(this);s._CancelTypewriter(),s._SetText(e)}typewriterText(e,s){t.RequireString(e),t.RequireFiniteNumber(s);const i=r.get(this);i._CancelTypewriter(),i._StartTypewriter(e,s)}typewriterFinish(){r.get(this)._FinishTypewriter()}set characterScale(e){t.RequireFiniteNumber(e),r.get(this)._SetScale(e)}get characterScale(){return r.get(this)._GetScale()}set characterSpacing(e){t.RequireFiniteNumber(e),r.get(this)._SetCharacterSpacing(e)}get characterSpacing(){return r.get(this)._GetCharacterSpacing()}set lineHeight(e){t.RequireFiniteNumber(e),r.get(this)._SetLineHeight(e)}get lineHeight(){return r.get(this)._GetLineHeight()}set horizontalAlign(e){if(t.RequireString(e),e=n.get(e),void 0===e)throw Error("invalid mode");r.get(this)._SetHAlign(e)}get horizontalAlign(){return s[r.get(this)._GetHAlign()]}set verticalAlign(e){if(t.RequireString(e),e=a.get(e),void 0===e)throw Error("invalid mode");r.get(this)._SetVAlign(e)}get verticalAlign(){return i[r.get(this)._GetVAlign()]}set wordWrapMode(e){if(t.RequireString(e),e=o.get(e),void 0===e)throw Error("invalid mode");r.get(this)._SetWrapByWord(e)}get wordWrapMode(){return r.get(this)._IsWrapByWord()?"word":"character"}}}{const e=self.C3;e.Plugins.Spritefont2.Cnds={CompareText(t,s){return s?this._text===t:e.equalsNoCase(this._text,t)},IsRunningTypewriterText(){return-1!==this._typewriterEndTime},OnTypewriterTextFinished:()=>!0}}self.C3.Plugins.Spritefont2.Acts={SetText(e){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),this._SetText(e.toString())},AppendText(e){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),(e=e.toString())&&this._SetText(this._text+e)},TypewriterText(e,t){this._CancelTypewriter(),"number"==typeof e&&1e9>e&&(e=Math.round(1e10*e)/1e10),this._StartTypewriter(e.toString(),t)},TypewriterFinish(){this._FinishTypewriter()},SetScale(e){this._SetScale(e)},SetCharacterSpacing(e){this._SetCharacterSpacing(e)},SetLineHeight(e){this._SetLineHeight(e)},SetCharacterWidth(e,t){let s=!1;const i=this._sdkType.GetSpriteFont();for(const r of e)" "===r?(i.SetSpaceWidth(t),s=!0):(e=i.GetCharacter(r))&&(e.SetDisplayWidth(t),s=!0);s&&i.SetCharacterWidthsChanged(),this._runtime.UpdateRender()},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},SetHAlign(e){this._SetHAlign(e)},SetVAlign(e){this._SetVAlign(e)},SetWrapping(e){this._SetWrapByWord(0===e)}};{const e=self.C3;e.Plugins.Spritefont2.Exps={CharacterWidth(e){return(e=this._sdkType.GetSpriteFont().GetCharacter(e))?e.GetDisplayWidth():this._sdkType.GetSpriteFont().GetCharacterWidth()},CharacterHeight(){return this._characterHeight},CharacterScale(){return this._characterScale},CharacterSpacing(){return this._characterSpacing},LineHeight(){return this._lineHeight},Text(){return this._text},PlainText(){return this._enableBBcode?e.BBString.StripAnyTags(this._text):this._text},TextWidth(){const e=this.GetWorldInfo();return this._spriteFontText.SetSize(e.GetWidth(),e.GetHeight()),this._spriteFontText.GetTextWidth()},TextHeight(){const e=this.GetWorldInfo();return this._spriteFontText.SetSize(e.GetWidth(),e.GetHeight()),this._spriteFontText.GetTextHeight()}}}{const e=self.C3;self.SpriteFontCharacter=class{constructor(t,s,i,r){let n=t.GetCharacterWidth(),a=t.GetCharacterHeight();this._spriteFont=t,this._char=s,this._pxRect=new e.Rect(i,r,i+n,r+a),this._texRect=new e.Rect,this._displayWidth=-1,this._UpdateTexRect()}Release(){this._texRect=this._pxRect=this._spriteFont=null}_UpdateTexRect(){let e=this._spriteFont.GetWidth(),t=this._spriteFont.GetHeight();this._texRect.copy(this._pxRect),this._texRect.divide(e,t),this._texRect.lerpInto(this._spriteFont.GetTexRect())}GetSpriteFont(){return this._spriteFont}GetChar(){return this._char}GetTexRect(){return this._texRect}SetDisplayWidth(e){this._displayWidth=e}GetDisplayWidth(){return 0>this._displayWidth?this._spriteFont.GetCharacterWidth():this._displayWidth}}}{const e=self.C3,t=new e.Rect,s=new e.Quad,i=new e.Color,r=new Set(["left","center","right"]),n=new Set(["top","center","bottom"]),a=new Set(["word","character"]);self.SpriteFontText=class{constructor(t){this._spriteFont=t,this._cssHeight=this._cssWidth=0,this._text="",this._isBBcodeEnabled=!1,this._bbString=null,this._wrappedText=e.New(e.WordWrap),this._wrapMode="word",this._wrapChanged=!1,this._horizontalAlign="left",this._verticalAlign="top",this._sceneGraphScale=this._scale=1,this._lineHeight=this._spacing=0,this._color=e.New(e.Color),this._drawMaxCharCount=-1,this._drawCharCount=0,this._measureTextCallback=((e,t)=>this._MeasureText(e,t)),this._spriteFont._AddSpriteFontText(this)}Release(){this._spriteFont._RemoveSpriteFontText(this),this._measureTextCallback=this._color=null,this._wrappedText.Clear(),this._bbString=this._spriteFont=this._wrappedText=null}_MeasureText(e,t){var s=this._GetStyleTag(t,"scale"),i=(s?parseFloat(s.param):this._scale)*this._sceneGraphScale;s=this._GetStyleTag(t,"scalex"),s=(s?parseFloat(s.param):1)*i,t=this._GetStyleTag(t,"scaley"),t=(t?parseFloat(t.param):1)*i,t=this._spriteFont.GetCharacterHeight()*t+this._lineHeight;const r=this.GetSpriteFont();i=r.GetCharacterWidth()*s;const n=this.GetSpacing();if(r.HasAnyCustomWidths()){let o=0,h=0;for(var a of e){e=i;const t=r.GetCharacter(a);t?e=t.GetDisplayWidth()*s:" "===a&&(e=r.GetSpaceWidth()*s),h+=e,++o}return{width:h+o*n,height:t}}return a=[...e].length,{width:i*a+Math.max(a,0)*n,height:t}}_SetWrapChanged(){this._wrapChanged=!0,this._wrappedText.Clear()}SetSize(e,t){0>=e||0>=t||this._cssWidth===e&&this._cssHeight===t||(this._cssWidth!==e&&this._SetWrapChanged(),this._cssWidth=e,this._cssHeight=t)}SetDrawMaxCharacterCount(e){this._drawMaxCharCount=Math.floor(e)}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetStyleTag(e,t){for(let s=e.length-1;0<=s;--s){const i=e[s];if(i.tag===t)return i}return null}_HasStyleTag(e,t){return!!this._GetStyleTag(e,t)}_MaybeWrapText(){if(this._wrapChanged){!this._isBBcodeEnabled||this._bbString&&this._bbString.toString()===this._text||(this._bbString=new e.BBString(this._text,{noEscape:!0}));var t=-this.GetSpacing();this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,this._measureTextCallback,this._cssWidth,this._wrapMode,t),this._wrapChanged=!1}}Draw(t,s,i,r){this._MaybeWrapText();let n=this._drawCharCount=0;const a=this._lineHeight,o=e.cloneArray(this._wrappedText.GetLines()),h=Math.sin(r);r=Math.cos(r);var l=o.reduce((e,t)=>e+t.height,0)-a;"center"===this._verticalAlign?n=Math.max(Math.floor(this._cssHeight/2-l/2),0):"bottom"===this._verticalAlign&&(n=Math.floor(this._cssHeight-l));for(let e=0,c=o.length;e<c;++e){l=o[e];const c=l.height;if(0<e&&n>this._cssHeight-(c-a))break;0<=n&&this._DrawLine(t,l,s,i,n,h,r),n+=c}}_DrawLine(e,t,s,i,r,n,a){const o=t.height;let h=0;"center"===this._horizontalAlign?h=Math.max(Math.floor((this._cssWidth-t.width)/2),0):"right"===this._horizontalAlign&&(h=Math.max(Math.floor(this._cssWidth-t.width),0));for(const l of t.fragments)this._DrawFragment(e,l,s,i,h,r,n,a,o),h+=l.width}_DrawFragment(r,n,a,o,h,l,c,u,_){var d=n.text,p=n.width,g=n.styles;if(-1!==this._drawMaxCharCount){if(this._drawCharCount>=this._drawMaxCharCount)return;this._drawCharCount+d.length>this._drawMaxCharCount&&(d=d.substr(0,this._drawMaxCharCount-this._drawCharCount),p=this._MeasureText(d,g).width),this._drawCharCount+=d.length}var m=this._GetStyleTag(g,"background");if(!(e.IsStringAllWhitespace(d)&&!m||this._HasStyleTag(g,"hide"))){n=this._GetStyleTag(g,"scale");var f=(n?parseFloat(n.param):this._scale)*this._sceneGraphScale;n=this._GetStyleTag(g,"scalex"),n=(n?parseFloat(n.param):1)*f;var S=this._GetStyleTag(g,"scaley");f*=S?parseFloat(S.param):1,f*=this._spriteFont.GetCharacterHeight(),l+=_-this._lineHeight-f,_=this._GetStyleTag(g,"offsetx"),h+=_?parseFloat(_.param):0,_=this._GetStyleTag(g,"offsety"),l+=_?parseFloat(_.param):0,m&&(r.SetColorFillMode(),i.parseString(m.param),i.setA(1),r.SetColor(i),t.set(h,l,h+p,l+f),t.getRight()>this._cssWidth&&t.setRight(this._cssWidth),s.setFromRotatedRectPrecalc(t,c,u),s.offset(a,o),r.Quad(s),r.SetTextureFillMode()),(p=this._GetStyleTag(g,"color"))?(i.parseString(p.param),i.setA(this._color.getA())):i.copy(this._color),(p=this._GetStyleTag(g,"opacity"))&&i.setA(i.getA()*parseFloat(p.param)/100),i.premultiply(),r.SetColor(i),p=this._spriteFont.GetCharacterWidth()*n,g=Math.abs(this.GetSpacing());for(const e of d)if(d=this._spriteFont.GetCharacter(e)){if(m=d.GetDisplayWidth()*n,h+m>this._cssWidth+g+1e-5)break;t.set(h,l,h+p,l+f),s.setFromRotatedRectPrecalc(t,c,u),s.offset(a,o),r.Quad3(s,d.GetTexRect()),h+=m+this._spacing}else h+=this._spriteFont.GetSpaceWidth()*n+this._spacing}}GetSpriteFont(){return this._spriteFont}SetBBCodeEnabled(e){e=!!e,this._isBBcodeEnabled!==e&&(this._isBBcodeEnabled=e,this._SetWrapChanged())}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetText(e){this._text!==e&&(this._text=e,this._SetWrapChanged())}SetWordWrapMode(e){if(!a.has(e))throw Error("invalid word wrap mode");this._wrapMode!==e&&(this._wrapMode=e,this._SetWrapChanged())}SetHorizontalAlign(e){if(!r.has(e))throw Error("invalid alignment");this._horizontalAlign=e}SetVerticalAlign(e){if(!n.has(e))throw Error("invalid alignment");this._verticalAlign=e}SetScale(e){this._scale!==e&&(this._scale=e,this._SetWrapChanged())}GetScale(){return this._scale}SetSceneGraphScale(e){this._sceneGraphScale!==e&&(this._sceneGraphScale=e,this._SetWrapChanged())}GetSceneGraphScale(){return this._sceneGraphScale}SetSpacing(e){this._spacing!==e&&(this._spacing=e,this._SetWrapChanged())}GetSpacing(){return this._spacing}SetLineHeight(e){this._lineHeight=e,this._SetWrapChanged()}GetLineHeight(){return this._lineHeight}SetOpacity(t){t=e.clamp(t,0,1),this._color.a=t}SetColor(e){this._color.equals(e)||this._color.copy(e)}GetColor(){return this._color}GetTextWidth(){return this._MaybeWrapText(),this._wrappedText.GetMaxLineWidth()}GetTextHeight(){this._MaybeWrapText();var e=this._spriteFont.GetCharacterHeight()*this._scale;const t=this._lineHeight;return e+=t,this._wrappedText.GetLineCount()*e-t}}}{const e=self.C3,t={width:256,height:256,characterWidth:16,characterHeight:16,characterSet:""};self.SpriteFont=class{constructor(s){if(s=Object.assign({},t,s),0>=s.width||0>=s.height||0>=s.characterWidth||0>=s.characterHeight)throw Error("invalid size");this._width=s.width,this._height=s.height,this._characterWidth=s.characterWidth,this._characterHeight=s.characterHeight,this._characterSet=s.characterSet,this._spacingData="",this._spacingParsed=null,this._hasAnyCustomWidths=!1,this._spaceWidth=-1,this._texRect=new e.Rect(0,0,1,1),this._characterMap=new Map,this._mapChanged=!0,this._allTexts=new Set}Release(){this._texRect=null,this._ReleaseCharacters(),this._characterMap=null,this._allTexts&&this._allTexts.clear(),this._allTexts=null}_ReleaseCharacters(){for(let e of this._characterMap.values())e.Release();this._characterMap.clear()}_AddSpriteFontText(e){this._allTexts.add(e)}_RemoveSpriteFontText(e){this._allTexts.delete(e)}UpdateCharacterMap(){if(this._mapChanged){this._ReleaseCharacters();var t=[...this._characterSet],s=Math.floor(this._width/this._characterWidth),i=s*Math.floor(this._height/this._characterHeight);for(let r=0,n=t.length;r<n&&!(r>=i);++r){let i=t[r];this._characterMap.set(i,e.New(self.SpriteFontCharacter,this,i,r%s*this._characterWidth,Math.floor(r/s)*this._characterHeight))}if(this._hasAnyCustomWidths=!1,this._spaceWidth=-1,Array.isArray(this._spacingParsed))for(let e of this._spacingParsed)if(Array.isArray(e)&&2===e.length&&(t=e[0],s=e[1],"number"==typeof t&&isFinite(t)&&"string"==typeof s&&t!==this._characterWidth))for(let e of s)(s=this._characterMap.get(e))?(s.SetDisplayWidth(t),this._hasAnyCustomWidths=!0):" "===e&&(this._spaceWidth=t,this._hasAnyCustomWidths=!0);this._mapChanged=!1;for(let e of this._allTexts)e._SetWrapChanged()}}SetCharacterWidthsChanged(){this._hasAnyCustomWidths=!0;for(const e of this._allTexts)e._SetWrapChanged()}GetCharacter(e){return this.UpdateCharacterMap(),this._characterMap.get(e)||null}HasAnyCustomWidths(){return this._hasAnyCustomWidths}SetWidth(e){if(e=Math.floor(e),0>=e)throw Error("invalid size");this._width!==e&&(this._width=e,this._mapChanged=!0)}GetWidth(){return this._width}SetHeight(e){if(e=Math.floor(e),0>=e)throw Error("invalid size");this._height!==e&&(this._height=e,this._mapChanged=!0)}GetHeight(){return this._height}SetTexRect(e){if(!this._texRect.equals(e)){this._texRect.copy(e);for(const e of this._characterMap.values())e._UpdateTexRect()}}GetTexRect(){return this._texRect}SetCharacterWidth(e){if(e=Math.floor(e),0>=e)throw Error("invalid size");this._characterWidth!==e&&(this._characterWidth=e,this._mapChanged=!0)}GetCharacterWidth(){return this._characterWidth}SetCharacterHeight(e){if(e=Math.floor(e),0>=e)throw Error("invalid size");this._characterHeight!==e&&(this._characterHeight=e,this._mapChanged=!0)}GetCharacterHeight(){return this._characterHeight}SetCharacterSet(e){this._characterSet!==e&&(this._characterSet=e,this._mapChanged=!0)}GetCharacterSet(){return this._characterSet}SetSpacingData(e){if(this._spacingData!==e&&(this._spacingData=e,this._mapChanged=!0,this._spacingParsed=null,this._spacingData.length))try{this._spacingParsed=JSON.parse(this._spacingData)}catch(e){this._spacingParsed=null}}GetSpacingData(){return this._spacingData}SetSpaceWidth(e){0>e&&(e=-1),this._spaceWidth!==e&&(this._spaceWidth=e,0<=this._spaceWidth&&(this._hasAnyCustomWidths=!0))}GetSpaceWidth(){return 0>this._spaceWidth?this._characterWidth:this._spaceWidth}}}{const e=self.C3;e.Plugins.Dictionary=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Dictionary.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.IInstance;e.Plugins.Dictionary.Instance=class extends e.SDKInstanceBase{constructor(e,t){super(e),this._data=new Map,this._curKey=""}Release(){this._data.clear(),super.Release()}GetAsJsonString(){return JSON.stringify({c2dictionary:!0,data:e.MapToObject(this._data)})}GetDataMap(){return this._data}SaveToJson(){return e.MapToObject(this._data)}LoadFromJson(t){e.ObjectToMap(t,this._data)}GetDebuggerProperties(){return[{title:"plugins.dictionary.name",properties:[{name:"plugins.dictionary.debugger.key-count",value:this._data.size},...[...this._data].map(e=>({name:"$"+e[0],value:e[1],onedit:t=>this._data.set(e[0],t)}))]}]}GetScriptInterfaceClass(){return self.IDictionaryInstance}};const s=new WeakMap;self.IDictionaryInstance=class extends t{constructor(){super(),s.set(this,t._GetInitInst().GetSdkInstance())}getDataMap(){return s.get(this).GetDataMap()}}}{const e=self.C3;e.Plugins.Dictionary.Cnds={CompareValue(t,s,i){return t=this._data.get(t),void 0!==t&&e.compare(t,s,i)},ForEachKey(){const e=this._runtime,t=e.GetEventSheetManager(),s=e.GetCurrentEvent(),i=s.GetSolModifiers(),r=e.GetEventStack(),n=r.GetCurrentStackFrame(),a=r.Push(s);e.SetDebuggingEnabled(!1);for(const e of this._data.keys())this._curKey=e,t.PushCopySol(i),s.Retrigger(n,a),t.PopSol(i);return e.SetDebuggingEnabled(!0),this._curKey="",r.Pop(),!1},CompareCurrentValue(t,s){const i=this._data.get(this._curKey);return void 0!==i&&e.compare(i,t,s)},HasKey(e){return this._data.has(e)},IsEmpty(){return 0===this._data.size}}}{const e=self.C3;e.Plugins.Dictionary.Acts={AddKey(e,t){this._data.set(e,t)},SetKey(e,t){this._data.has(e)&&this._data.set(e,t)},DeleteKey(e){this._data.delete(e)},Clear(){this._data.clear()},JSONLoad(t){let s=null;try{s=JSON.parse(t)}catch(e){return void console.error("[Construct 3] Error parsing JSON: ",e)}s.c2dictionary&&e.ObjectToMap(s.data,this._data)},JSONDownload(e){const t=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(t,e)}}}self.C3.Plugins.Dictionary.Exps={Get(e){return e=this._data.get(e),void 0===e?0:e},GetDefault(e,t){return e=this._data.get(e),void 0===e?t:e},KeyCount(){return this._data.size},CurrentKey(){return this._curKey},CurrentValue(){return this._data.get(this._curKey)||0},AsJSON(){return this.GetAsJsonString()}};{const e=self.C3;e.Plugins.Audio=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;function b(){if(self.C3Audio_DOMInterface)return self.C3Audio_DOMInterface;throw Error("audio scripting API cannot be used here - make sure the project is using DOM mode, not worker mode")}e.Plugins.Audio.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IAudioObjectType}},self.IAudioObjectType=class extends self.IObjectClass{constructor(e){super(e)}get audioContext(){return b().GetAudioContext()}get destinationNode(){return b().GetDestinationNode()}}}{const e=self.C3,t=["interactive","balanced","playback"];e.Plugins.Audio.Instance=class extends e.SDKInstanceBase{constructor(s,i){super(s,"audio"),this._nextPlayTime=0,this._triggerTag="",this._saveLoadMode=this._timeScaleMode=0,this._playInBackground=!1,this._distanceModel=this._panningModel=1,this._listenerX=this._runtime.GetViewportWidth()/2,this._listenerY=this._runtime.GetViewportHeight()/2,this._listenerZ=-600,this._referenceDistance=600,this._maxDistance=1e4,this._rolloffFactor=1,this._listenerInst=null,this._loadListenerUid=-1,this._masterVolume=1,this._isSilent=!1,this._sampleRate=0,this._effectCount=new Map,this._preloadCount=this._preloadTotal=0,this._remoteUrls=new Map,s="interactive",i&&(this._timeScaleMode=i[0],this._saveLoadMode=i[1],this._playInBackground=i[2],s=t[i[3]],this._panningModel=i[4],this._distanceModel=i[5],this._listenerZ=-i[6],this._referenceDistance=i[7],this._maxDistance=i[8],this._rolloffFactor=i[9]),this._lastAIState=[],this._lastFxState=[],this._lastAnalysersData=[],this.AddDOMMessageHandlers([["state",e=>this._OnUpdateState(e)],["fxstate",e=>this._OnUpdateFxState(e)],["trigger",e=>this._OnTrigger(e)]]),i=this.GetRuntime().Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(i,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),e.Disposable.From(i,"afterload",()=>this._OnAfterLoad()),e.Disposable.From(i,"suspend",()=>this._OnSuspend()),e.Disposable.From(i,"resume",()=>this._OnResume())),this._runtime.AddLoadPromise(this.PostToDOMAsync("create-audio-context",{preloadList:this._runtime.GetAssetManager().GetAudioToPreload().map(e=>({originalUrl:e.originalUrl,url:e.url,type:e.type,fileSize:e.fileSize})),isiOSCordova:this._runtime.IsiOSCordova(),timeScaleMode:this._timeScaleMode,latencyHint:s,panningModel:this._panningModel,distanceModel:this._distanceModel,refDistance:this._referenceDistance,maxDistance:this._maxDistance,rolloffFactor:this._rolloffFactor,listenerPos:[this._listenerX,this._listenerY,this._listenerZ]}).then(e=>{this._sampleRate=e.sampleRate})),this._StartTicking()}Release(){this._listenerInst=null,super.Release()}_OnInstanceDestroyed(e){this._listenerInst===e&&(this._listenerInst=null)}DbToLinearNoCap(e){return Math.pow(10,e/20)}DbToLinear(e){return e=this.DbToLinearNoCap(e),isFinite(e)?Math.max(Math.min(e,1),0):0}LinearToDbNoCap(e){return Math.log(e)/Math.log(10)*20}LinearToDb(e){return this.LinearToDbNoCap(Math.max(Math.min(e,1),0))}_OnSuspend(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!0})}_OnResume(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!1})}_OnUpdateState(t){const s=t.tickCount,i=this._lastAIState.filter(e=>e.hasOwnProperty("placeholder")&&(e.placeholder>s||-1===e.placeholder));this._lastAIState=t.audioInstances,this._lastAnalysersData=t.analysers,0<i.length&&e.appendArray(this._lastAIState,i)}_OnUpdateFxState(e){this._lastFxState=e.fxstate}_GetFirstAudioStateByTag(t){for(const s of this._lastAIState)if(e.equalsNoCase(s.tag,t))return s;return null}_IsTagPlaying(t){return this._lastAIState.some(s=>e.equalsNoCase(t,s.tag)&&s.isPlaying)}_MaybeMarkAsPlaying(e,t,s,i){return this._IsTagPlaying(e)?null:(e={tag:e,duration:0,volume:i,isPlaying:!0,playbackTime:0,playbackRate:1,uid:-1,bufferOriginalUrl:"",bufferUrl:"",bufferType:"",isMusic:t,isLooping:s,isMuted:!1,resumePosition:0,pan:null,placeholder:-1},this._lastAIState.push(e),e)}async _OnTrigger(t){const s=t.type;if(this._triggerTag=t.tag,t=t.aiid,"ended"===s){for(const e of this._lastAIState)if(e.aiid===t){e.isPlaying=!1;break}await this.TriggerAsync(e.Plugins.Audio.Cnds.OnEnded)}else"fade-ended"===s&&await this.TriggerAsync(e.Plugins.Audio.Cnds.OnFadeEnded)}Tick(){const e={timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),instPans:this.GetInstancePans(),tickCount:this._runtime.GetTickCountNoSave()};if(this._listenerInst){const t=this._listenerInst.GetWorldInfo();this._listenerX=t.GetX(),this._listenerY=t.GetY(),e.listenerPos=[this._listenerX,this._listenerY,this._listenerZ]}this.PostToDOM("tick",e)}rotatePtAround(e,t,s,i,r){if(0===s)return[e,t];const n=Math.sin(s);s=Math.cos(s),e-=i,t-=r;const a=e*n;return e=e*s-t*n,[e+i,t*s+a+r]}GetInstancePans(){return this._lastAIState.filter(e=>-1!==e.uid).map(e=>this._runtime.GetInstanceByUID(e.uid)).filter(e=>e).map(e=>{const t=e.GetWorldInfo(),s=t.GetLayer().GetAngle(),[i,r]=this.rotatePtAround(t.GetX(),t.GetY(),-s,this._listenerX,this._listenerY);return{uid:e.GetUID(),x:i,y:r,angle:t.GetAngle()-s}})}GetAnalyserData(t,s){for(const i of this._lastAnalysersData)if(i.index===s&&e.equalsNoCase(i.tag,t))return i;return null}_IncrementEffectCount(e){this._effectCount.set(e,(this._effectCount.get(e)||0)+1)}_ShouldSave(e){return!e.hasOwnProperty("placeholder")&&3!==this._saveLoadMode&&((!e.isMusic||1!==this._saveLoadMode)&&!(!e.isMusic&&2===this._saveLoadMode))}SaveToJson(){return{isSilent:this._isSilent,masterVolume:this._masterVolume,listenerZ:this._listenerZ,listenerUid:this._listenerInst?this._listenerInst.GetUID():-1,remoteUrls:[...this._remoteUrls.entries()],playing:this._lastAIState.filter(e=>this._ShouldSave(e)),effects:this._lastFxState,analysers:this._lastAnalysersData}}LoadFromJson(e){if(this._isSilent=e.isSilent,this._masterVolume=e.masterVolume,this._listenerZ=e.listenerZ,this._listenerInst=null,this._loadListenerUid=e.listenerUid,this._remoteUrls.clear(),e.remoteUrls)for(const[t,s]of e.remoteUrls)this._remoteUrls.set(t,s);this._lastAIState=e.playing,this._lastFxState=e.effects,this._lastAnalysersData=e.analysers}_OnAfterLoad(){if(-1!==this._loadListenerUid&&(this._listenerInst=this._runtime.GetInstanceByUID(this._loadListenerUid),this._loadListenerUid=-1,this._listenerInst)){var e=this._listenerInst.GetWorldInfo();this._listenerX=e.GetX(),this._listenerY=e.GetY()}for(var t of this._lastAIState)(e=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t.bufferOriginalUrl))?(t.bufferUrl=e.url,t.bufferType=e.type):t.bufferUrl=null;for(const e of Object.values(this._lastFxState))for(const s of e)s.hasOwnProperty("bufferOriginalUrl")&&(t=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s.bufferOriginalUrl))&&(s.bufferUrl=t.url,s.bufferType=t.type);this.PostToDOM("load-state",{saveLoadMode:this._saveLoadMode,timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),listenerPos:[this._listenerX,this._listenerY,this._listenerZ],isSilent:this._isSilent,masterVolume:this._masterVolume,playing:this._lastAIState.filter(e=>null!==e.bufferUrl),effects:this._lastFxState})}GetDebuggerProperties(){const e=[];for(const[t,s]of Object.entries(this._lastFxState))e.push({name:"$"+t,value:s.map(e=>e.type).join(", ")});return[{title:"plugins.audio.debugger.tag-effects",properties:e},{title:"plugins.audio.debugger.currently-playing",properties:[{name:"plugins.audio.debugger.currently-playing-count",value:this._lastAIState.length},...this._lastAIState.map((e,t)=>({name:"$#"+t,value:`${e.bufferOriginalUrl} ("${e.tag}") ${Math.round(10*e.playbackTime)/10} / ${Math.round(10*e.duration)/10}`}))]}]}}}{const e=self.C3;e.Plugins.Audio.Cnds={OnEnded(t){return e.equalsNoCase(this._triggerTag,t)},OnFadeEnded(t){return e.equalsNoCase(this._triggerTag,t)},PreloadsComplete(){return this._preloadCount===this._preloadTotal},AdvancedAudioSupported:()=>!0,IsSilent(){return this._isSilent},IsAnyPlaying(){for(const e of this._lastAIState)if(e.isPlaying)return!0;return!1},IsTagPlaying(e){return this._IsTagPlaying(e)}}}{const e=self.C3,t="lowpass highpass bandpass lowshelf highshelf peaking notch allpass".split(" ");e.Plugins.Audio.Acts={async Play(e,t,s,i,r){if(!this._isSilent){var n=e[1],a=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);if(a){r=r||0;var o=this._nextPlayTime;this._nextPlayTime=0;var h=this._MaybeMarkAsPlaying(i.toLowerCase(),n,0!==t,this.DbToLinear(s));try{await this.PostToDOMAsync("play",{originalUrl:e[0],url:a.url,type:a.type,isMusic:n,tag:i.toLowerCase(),isLooping:0!==t,vol:this.DbToLinear(s),pos:r,off:o,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{h&&(h.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtPosition(t,s,i,r,n,a,o,h,l,c){if(!this._isSilent){var u=t[1],_=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t[0]);if(_){var d=this._nextPlayTime;this._nextPlayTime=0
;var p=this._MaybeMarkAsPlaying(c.toLowerCase(),u,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t[0],url:_.url,type:_.type,isMusic:u,tag:c.toLowerCase(),isLooping:0!==s,vol:this.DbToLinear(i),pos:0,off:d,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:r,y:n,angle:e.toRadians(a),innerAngle:e.toRadians(o),outerAngle:e.toRadians(h),outerGain:this.DbToLinear(l)}})}finally{p&&(p.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtObject(t,s,i,r,n,a,o,h){if(!this._isSilent&&r&&(r=r.GetFirstPicked())&&r.GetWorldInfo()){var l=r.GetWorldInfo(),c=l.GetLayer().GetAngle(),[u,_]=this.rotatePtAround(l.GetX(),l.GetY(),-c,this._listenerX,this._listenerY),d=t[1],p=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t[0]);if(p){var g=this._nextPlayTime;this._nextPlayTime=0;var m=this._MaybeMarkAsPlaying(h.toLowerCase(),d,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t[0],url:p.url,type:p.type,isMusic:d,tag:h.toLowerCase(),isLooping:0!==s,vol:this.DbToLinear(i),pos:0,off:g,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:u,y:_,angle:l.GetAngle()-c,innerAngle:e.toRadians(n),outerAngle:e.toRadians(a),outerGain:this.DbToLinear(o),uid:r.GetUID()}})}finally{m&&(m.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayByName(e,t,s,i,r){if(!this._isSilent){e=1===e;var n=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());if(n){var a=this._nextPlayTime;this._nextPlayTime=0;var o=this._MaybeMarkAsPlaying(r.toLowerCase(),e,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t,url:n.url,type:n.type,isMusic:e,tag:r.toLowerCase(),isLooping:0!==s,vol:this.DbToLinear(i),pos:0,off:a,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{o&&(o.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtPositionByName(t,s,i,r,n,a,o,h,l,c,u){if(!this._isSilent){t=1===t;var _=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s)||this._remoteUrls.get(s.toLowerCase());if(_){var d=this._nextPlayTime;this._nextPlayTime=0;var p=this._MaybeMarkAsPlaying(u.toLowerCase(),t,0!==i,this.DbToLinear(r));try{await this.PostToDOMAsync("play",{originalUrl:s,url:_.url,type:_.type,isMusic:t,tag:u.toLowerCase(),isLooping:0!==i,vol:this.DbToLinear(r),pos:0,off:d,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:n,y:a,angle:e.toRadians(o),innerAngle:e.toRadians(h),outerAngle:e.toRadians(l),outerGain:this.DbToLinear(c)}})}finally{p&&(p.placeholder=this._runtime.GetTickCountNoSave())}}}},async PlayAtObjectByName(t,s,i,r,n,a,o,h,l){if(!this._isSilent&&!this._isSilent&&n&&(n=n.GetFirstPicked())&&n.GetWorldInfo()){var c=n.GetWorldInfo(),u=c.GetLayer().GetAngle(),[_,d]=this.rotatePtAround(c.GetX(),c.GetY(),-u,this._listenerX,this._listenerY);t=1===t;var p=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s)||this._remoteUrls.get(s.toLowerCase());if(p){var g=this._nextPlayTime;this._nextPlayTime=0;var m=this._MaybeMarkAsPlaying(l.toLowerCase(),t,0!==i,this.DbToLinear(r));try{await this.PostToDOMAsync("play",{originalUrl:s,url:p.url,type:p.type,isMusic:t,tag:l.toLowerCase(),isLooping:0!==i,vol:this.DbToLinear(r),pos:0,off:g,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:_,y:d,angle:c.GetAngle()-u,innerAngle:e.toRadians(a),outerAngle:e.toRadians(o),outerGain:this.DbToLinear(h),uid:n.GetUID()}})}finally{m&&(m.placeholder=this._runtime.GetTickCountNoSave())}}}},SetLooping(e,t){this.PostToDOM("set-looping",{tag:e.toLowerCase(),isLooping:0===t})},SetMuted(e,t){this.PostToDOM("set-muted",{tag:e.toLowerCase(),isMuted:0===t})},SetVolume(e,t){this.PostToDOM("set-volume",{tag:e.toLowerCase(),vol:this.DbToLinear(t)})},FadeVolume(e,t,s,i){this.PostToDOM("fade-volume",{tag:e.toLowerCase(),vol:this.DbToLinear(t),duration:s,stopOnEnd:0===i})},async Preload(e){const t=e[1],s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);s&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:e[0],url:s.url,type:s.type,isMusic:t}),this._preloadCount++)},async PreloadByName(e,t){e=1===e;const s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());s&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:t,url:s.url,type:s.type,isMusic:e}),this._preloadCount++)},SetPlaybackRate(e,t){this.PostToDOM("set-playback-rate",{tag:e.toLowerCase(),rate:Math.max(t,0)})},Stop(e){this.PostToDOM("stop",{tag:e.toLowerCase()})},StopAll(){this.PostToDOM("stop-all")},SetPaused(e,t){this.PostToDOM("set-paused",{tag:e.toLowerCase(),paused:0===t})},Seek(e,t){this.PostToDOM("seek",{tag:e.toLowerCase(),pos:t})},SetSilent(e){2===e&&(e=this._isSilent?1:0),e=0===e,this._isSilent!==e&&(this._isSilent=e,this.PostToDOM("set-silent",{isSilent:e}))},SetMasterVolume(e){e=this.DbToLinear(e),this._masterVolume!==e&&(this._masterVolume=e,this.PostToDOM("set-master-volume",{vol:e}))},AddFilterEffect(s,i,r,n,a,o,h){s=s.toLowerCase(),i=t[i],this._IncrementEffectCount(s),this.PostToDOM("add-effect",{type:"filter",tag:s,params:[i,r,n,a,o,e.clamp(h/100,0,1)]})},AddDelayEffect(t,s,i,r){t=t.toLowerCase(),this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"delay",tag:t,params:[s,this.DbToLinear(i),e.clamp(r/100,0,1)]})},AddFlangerEffect(t,s,i,r,n,a){t=t.toLowerCase(),this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"flanger",tag:t,params:[s/1e3,i/1e3,r,n/100,e.clamp(a/100,0,1)]})},AddPhaserEffect(t,s,i,r,n,a,o){t=t.toLowerCase(),this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"phaser",tag:t,params:[s,i,r,n,a,e.clamp(o/100,0,1)]})},AddConvolutionEffect(t,s,i,r){t=t.toLowerCase();const n=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s[0]);n&&(this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"convolution",tag:t,bufferOriginalUrl:s[0],bufferUrl:n.url,bufferType:n.type,params:[0===i,e.clamp(r/100,0,1)]}))},AddGainEffect(e,t){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tag:e,params:[this.DbToLinear(t)]})},AddMuteEffect(e){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tag:e,params:[0]})},AddTremoloEffect(t,s,i){t=t.toLowerCase(),this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"tremolo",tag:t,params:[s,e.clamp(i/100,0,1)]})},AddRingModEffect(t,s,i){t=t.toLowerCase(),this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"ringmod",tag:t,params:[s,e.clamp(i/100,0,1)]})},AddDistortionEffect(t,s,i,r,n,a){t=t.toLowerCase(),this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"distortion",tag:t,params:[this.DbToLinearNoCap(s),this.DbToLinearNoCap(i),r,this.DbToLinearNoCap(n),e.clamp(a/100,0,1)]})},AddCompressorEffect(e,t,s,i,r,n){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"compressor",tag:e,params:[t,s,i,r/1e3,n/1e3]})},AddAnalyserEffect(e,t,s){e=e.toLowerCase(),this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"analyser",tag:e,params:[t,s]})},RemoveEffects(e){e=e.toLowerCase(),this._effectCount.set(e,0),this.PostToDOM("remove-effects",{tag:e}),this._lastFxState={}},SetEffectParameter(e,t,s,i,r,n){this.PostToDOM("set-effect-param",{tag:e.toLowerCase(),index:Math.floor(t),param:s,value:i,ramp:r,time:n})},SetListenerObject(e){e&&(e=e.GetFirstPicked())&&e.GetWorldInfo()&&(this._listenerInst=e)},SetListenerZ(e){this._listenerZ=e},ScheduleNextPlay(e){this._nextPlayTime=Math.max(e,0)},UnloadAudio(e){const t=e[1];(e=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]))&&this.PostToDOM("unload",{url:e.url,type:e.type,isMusic:t})},UnloadAudioByName(e,t){e=1===e,(t=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase()))&&this.PostToDOM("unload",{url:t.url,type:t.type,isMusic:e})},UnloadAll(){this.PostToDOM("unload-all")},AddRemoteURL(e,t,s){this._remoteUrls.set(s.toLowerCase(),{url:e,type:t})}}}self.C3.Plugins.Audio.Exps={Duration(e){return(e=this._GetFirstAudioStateByTag(e))?e.duration:0},PlaybackTime(e){return(e=this._GetFirstAudioStateByTag(e))?e.playbackTime:0},PlaybackRate(e){return(e=this._GetFirstAudioStateByTag(e))?e.playbackRate:0},Volume(e){return(e=this._GetFirstAudioStateByTag(e))?this.LinearToDb(e.volume):0},MasterVolume(){return this.LinearToDb(this._masterVolume)},EffectCount(e){return this._effectCount.get(e.toLowerCase())||0},AnalyserFreqBinCount(e,t){return(e=this.GetAnalyserData(e,Math.floor(t)))?e.binCount:0},AnalyserFreqBinAt(e,t,s){return e=this.GetAnalyserData(e,Math.floor(t)),e?(s=Math.floor(s),0>s||s>=e.binCount?0:e.freqBins[s]):0},AnalyserPeakLevel(e,t){return(e=this.GetAnalyserData(e,Math.floor(t)))?e.peak:0},AnalyserRMSLevel(e,t){return(e=this.GetAnalyserData(e,Math.floor(t)))?e.rms:0},SampleRate(){return this._sampleRate},CurrentTime:()=>self.C3_GetAudioContextCurrentTime?self.C3_GetAudioContextCurrentTime():performance.now()/1e3};{const e=self.C3;e.Plugins.Browser=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Browser.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Plugins.Browser.Instance=class extends e.SDKInstanceBase{constructor(t,s){super(t,"browser"),this._initLocationStr="",this._isOnline=!1,this._docTitle=this._referrer="",this._isCookieEnabled=!1,this._windowOuterHeight=this._windowOuterWidth=this._screenHeight=this._screenWidth=0,this._isScirraArcade=!1,this.AddDOMMessageHandlers([["online-state",e=>this._OnOnlineStateChanged(e)],["backbutton",()=>this._OnBackButton()],["sw-message",e=>this._OnSWMessage(e)],["hashchange",e=>this._OnHashChange(e)]]),t=this.GetRuntime().Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"afterfirstlayoutstart",()=>this._OnAfterFirstLayoutStart()),e.Disposable.From(t,"window-resize",()=>this._OnWindowResize()),e.Disposable.From(t,"suspend",()=>this._OnSuspend()),e.Disposable.From(t,"resume",()=>this._OnResume())),this._runtime.AddLoadPromise(this.PostToDOMAsync("get-initial-state",{exportType:this._runtime.GetExportType()}).then(e=>{this._initLocationStr=e.location,this._isOnline=e.isOnline,this._referrer=e.referrer,this._docTitle=e.title,this._isCookieEnabled=e.isCookieEnabled,this._screenWidth=e.screenWidth,this._screenHeight=e.screenHeight,this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._isScirraArcade=e.isScirraArcade}))}Release(){super.Release()}_OnAfterFirstLayoutStart(){this.PostToDOM("ready-for-sw-messages")}async _OnOnlineStateChanged(t){t=!!t.isOnline,this._isOnline!==t&&((this._isOnline=t)?await this.TriggerAsync(e.Plugins.Browser.Cnds.OnOnline):await this.TriggerAsync(e.Plugins.Browser.Cnds.OnOffline))}async _OnWindowResize(){await this.TriggerAsync(e.Plugins.Browser.Cnds.OnResize)}_OnSuspend(){this.Trigger(e.Plugins.Browser.Cnds.OnPageHidden)}_OnResume(){this.Trigger(e.Plugins.Browser.Cnds.OnPageVisible)}async _OnBackButton(){await this.TriggerAsync(e.Plugins.Browser.Cnds.OnBackButton)}_OnSWMessage(t){t=t.type,"downloading-update"===t?this.Trigger(e.Plugins.Browser.Cnds.OnUpdateFound):"update-ready"===t||"update-pending"===t?this.Trigger(e.Plugins.Browser.Cnds.OnUpdateReady):"offline-ready"===t&&this.Trigger(e.Plugins.Browser.Cnds.OnOfflineReady)}_OnHashChange(t){this._initLocationStr=t.location,this.Trigger(e.Plugins.Browser.Cnds.OnHashChange)}GetDebuggerProperties(){return[{title:"plugins.browser.name",properties:[{name:"plugins.browser.debugger.user-agent",value:navigator.userAgent},{name:"plugins.browser.debugger.is-online",value:this._isOnline},{name:"plugins.browser.debugger.is-fullscreen",value:this._runtime.GetCanvasManager().IsDocumentFullscreen()}]}]}}}self.C3.Plugins.Browser.Cnds={IsOnline(){return this._isOnline},OnOnline:()=>!0,OnOffline:()=>!0,OnResize:()=>!0,CookiesEnabled(){return this._isCookieEnabled},IsFullscreen(){return this._runtime.GetCanvasManager().IsDocumentFullscreen()},OnBackButton:()=>!0,IsPortraitLandscape(e){const t=this._runtime.GetCanvasManager().GetLastWidth(),s=this._runtime.GetCanvasManager().GetLastHeight();return(t<=s?0:1)===e},OnUpdateFound:()=>!0,OnUpdateReady:()=>!0,OnOfflineReady:()=>!0,OnHashChange:()=>!0,PageVisible(){return!this._runtime.IsSuspended()},OnPageHidden:()=>!0,OnPageVisible:()=>!0,HasJava:()=>!1,IsDownloadingUpdate:()=>!1,OnMenuButton:()=>!1,OnSearchButton:()=>!1,IsMetered:()=>!1,IsCharging:()=>!0,SupportsFullscreen:()=>!0};{const e=self.C3,b="portrait landscape portrait-primary portrait-secondary landscape-primary landscape-secondary".split(" ");e.Plugins.Browser.Acts={Alert(e){this.PostToDOM("alert",{message:e.toString()})},Close(){this._isScirraArcade||(this._runtime.IsDebug()?self.C3Debugger.CloseWindow():this.PostToDOM("close"))},Focus(){this.PostToDOM("set-focus",{isFocus:!0})},Blur(){this.PostToDOM("set-focus",{isFocus:!1})},GoBack(){this._isScirraArcade||this.PostToDOM("navigate",{type:"back"})},GoForward(){this._isScirraArcade||this.PostToDOM("navigate",{type:"forward"})},GoHome(){},Reload(){this._isScirraArcade||(this._runtime.IsDebug()?this._runtime.PostToDebugger({type:"reload"}):this.PostToDOM("navigate",{type:"reload"}))},GoToURL(e,t){this._PostToDOMMaybeSync("navigate",{type:"url",url:e,target:t,exportType:this._runtime.GetExportType()})},GoToURLWindow(e,t){this._PostToDOMMaybeSync("navigate",{type:"new-window",url:e,tag:t,exportType:this._runtime.GetExportType()})},RequestFullScreen(t,s){2<=t&&(t+=1),6===t&&(t=2),1===t&&(t=0),t=e.CanvasManager._FullscreenModeNumberToString(t),this._runtime.GetCanvasManager().SetDocumentFullscreenMode(t),this._PostToDOMMaybeSync("request-fullscreen",{navUI:s})},CancelFullScreen(){this._PostToDOMMaybeSync("exit-fullscreen")},Vibrate(e){e=e.split(",");for(let t=0,s=e.length;t<s;++t)e[t]=parseInt(e[t],10);this._PostToDOMMaybeSync("vibrate",{pattern:e})},async InvokeDownload(e,t){e&&t&&(e=await this._runtime.GetAssetManager().GetProjectFileUrl(e),this._runtime.InvokeDownload(e,t))},InvokeDownloadString(e,t,s){s&&(e=`data:${t},${encodeURIComponent(e)}`,this._runtime.InvokeDownload(e,s))},ConsoleLog(e,t){t=t.toString(),0===e?console.log(t):1===e?console.warn(t):2===e&&console.error(t)},ConsoleGroup(e){console.group(e)},ConsoleGroupEnd(){console.groupEnd()},ExecJs(a){try{eval(a)}catch(e){console.error("Error executing JavaScript: ",e)}},LockOrientation(e){e=Math.floor(e),0>e||e>=b.length||this._PostToDOMMaybeSync("lock-orientation",{orientation:b[e]})},UnlockOrientation(){this._PostToDOMMaybeSync("unlock-orientation")},LoadStyleSheet(e){this._runtime.GetAssetManager().LoadStyleSheet(e)},SetHash(e){this.PostToDOM("set-hash",{hash:e})}}}self.C3.Plugins.Browser.Exps={URL(){return this._runtime.IsInWorker()?this._initLocationStr:location.toString()},Protocol(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).protocol:location.protocol},Domain(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).hostname:location.hostname},Port(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).port:location.port},PathName(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).pathname:location.pathname},Hash(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).hash:location.hash},QueryString(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).search:location.search},QueryParam(e){const t=this._runtime.IsInWorker()?new URL(this._initLocationStr).search:location.search;return(e=RegExp("[?&]"+e+"=([^&]*)").exec(t))?decodeURIComponent(e[1].replace(/\+/g," ")):""},Referrer(){return this._referrer},Title(){return this._docTitle},Language:()=>navigator.language,Platform:()=>navigator.platform,UserAgent:()=>navigator.userAgent,ExecJS(e){let b=0;try{b=eval(e)}catch(e){console.error("Error executing JavaScript: ",e)}return"number"==typeof b||"string"==typeof b?b:"boolean"==typeof b&&b?1:0},Name:()=>navigator.appName,Version:()=>navigator.appVersion,Product:()=>navigator.product,Vendor:()=>navigator.vendor,BatteryLevel:()=>1,BatteryTimeLeft:()=>1/0,Bandwidth(){const e=navigator.connection;return e&&(e.downlink||e.downlinkMax||e.bandwidth)||1/0},ConnectionType(){const e=navigator.connection;return e&&e.type||"unknown"},DevicePixelRatio:()=>self.devicePixelRatio,ScreenWidth(){return this._screenWidth},ScreenHeight(){return this._screenHeight},WindowInnerWidth(){return this._runtime.GetCanvasManager().GetLastWidth()},WindowInnerHeight(){return this._runtime.GetCanvasManager().GetLastHeight()},WindowOuterWidth(){return this._windowOuterWidth},WindowOuterHeight(){return this._windowOuterWidth}};{const e=self.C3;e.Plugins.LocalStorage=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.LocalStorage.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Plugins.LocalStorage.Instance=class extends e.SDKInstanceBase{constructor(e,t){super(e),this._lastValue=this._currentKey="",this._keyNamesList=[],this._errorMessage="",this._pendingSets=this._pendingGets=0,this._storage=this._runtime._GetProjectStorage(),this._debugCache=new Map,this._isLoadingDebugCache=!1}Release(){super.Release()}async _TriggerStorageError(t){this._errorMessage=this._GetErrorString(t),await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnError)}_GetErrorString(e){return e?"string"==typeof e?e:"string"==typeof e.message?e.message:"string"==typeof e.name?e.name:"string"==typeof e.data?e.data:"unknown error":"unknown error"}GetDebuggerProperties(){return this._isLoadingDebugCache||this._DebugCacheStorage(),[{title:"plugins.localstorage.name",properties:[...this._debugCache.entries()].map(e=>({name:"$"+e[0],value:e[1],onedit:t=>this._storage.setItem(e[0],t)}))}]}async _DebugCacheStorage(){this._isLoadingDebugCache=!0;try{const e=await this._storage.keys();e.sort((e,t)=>(e=e.toLowerCase(),t=t.toLowerCase(),e<t?-1:t<e?1:0));const t=await Promise.all(e.map(e=>this._storage.getItem(e)));this._debugCache.clear();for(let s=0,i=e.length;s<i;++s)this._debugCache.set(e[s],t[s])}catch(e){console.warn("[C3 debugger] Error displaying local storage: ",e)}finally{this._isLoadingDebugCache=!1}}}}{const e=self.C3;e.Plugins.LocalStorage.Cnds={OnItemSet(e){return this._currentKey===e},OnAnyItemSet:()=>!0,OnItemGet(e){return this._currentKey===e},OnAnyItemGet:()=>!0,OnItemRemoved(e){return this._currentKey===e},OnAnyItemRemoved:()=>!0,OnCleared:()=>!0,OnAllKeyNamesLoaded:()=>!0,OnError:()=>!0,OnItemExists(e){return this._currentKey===e},OnItemMissing(e){return this._currentKey===e},CompareKey(t,s){return e.compare(this._currentKey,t,s)},CompareValue(t,s){return e.compare(this._lastValue,t,s)},IsProcessingSets(){return 0<this._pendingSets},IsProcessingGets(){return 0<this._pendingGets},OnAllSetsComplete:()=>!0,OnAllGetsComplete:()=>!0}}{const e=self.C3;function b(e){return"string"==typeof e||"number"==typeof e}e.Plugins.LocalStorage.Acts={async SetItem(t,s){this._pendingSets++;try{const i=await this._storage.setItem(t,s);await this.ScheduleTriggers(async()=>{this._currentKey=t,this._lastValue=i,await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAnyItemSet),await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnItemSet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingSets--,0===this._pendingSets&&await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAllSetsComplete)}},async SetBinaryItem(t,s){if(s&&(s=s.GetFirstPicked(this._inst))&&(s=s.GetSdkInstance())){s=s.GetArrayBufferReadOnly(),this._pendingSets++;try{await this._storage.setItem(t,s),await this.ScheduleTriggers(async()=>{this._currentKey=t,this._lastValue="",await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAnyItemSet),await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnItemSet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingSets--,0===this._pendingSets&&await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAllSetsComplete)}}},async GetItem(t){this._pendingGets++;try{const s=await this._storage.getItem(t);await this.ScheduleTriggers(async()=>{this._currentKey=t,this._lastValue=b(s)?s:"",await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAnyItemGet),await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnItemGet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingGets--,0===this._pendingGets&&await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAllGetsComplete)}},async GetBinaryItem(t,s){if(s&&(s=s.GetFirstPicked(this._inst))){var i=s.GetSdkInstance();this._pendingGets++;try{let s=await this._storage.getItem(t);s=s instanceof ArrayBuffer?s:new ArrayBuffer(0),await this.ScheduleTriggers(async()=>{this._lastValue="",this._currentKey=t,i.SetArrayBufferTransfer(s),await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAnyItemGet),await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnItemGet)})}catch(e){await this._TriggerStorageError(e)}finally{this._pendingGets--,0===this._pendingGets&&await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAllGetsComplete)}}},async CheckItemExists(t){try{const s=await this._storage.getItem(t);await this.ScheduleTriggers(async()=>{this._currentKey=t,null==s?(this._lastValue="",await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnItemMissing)):(this._lastValue=b(s)?s:"",await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnItemExists))})}catch(e){await this._TriggerStorageError(e)}},async RemoveItem(t){try{await this._storage.removeItem(t),await this.ScheduleTriggers(async()=>{this._currentKey=t,this._lastValue="",await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAnyItemRemoved),await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnItemRemoved)})}catch(e){await this._TriggerStorageError(e)}},async ClearStorage(){try{await this._storage.clear(),await this.ScheduleTriggers(async()=>{this._lastValue=this._currentKey="",e.clearArray(this._keyNamesList),await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnCleared)})}catch(e){await this._TriggerStorageError(e)}},async GetAllKeyNames(){try{const t=await this._storage.keys();await this.ScheduleTriggers(async()=>{this._keyNamesList=t,await this.TriggerAsync(e.Plugins.LocalStorage.Cnds.OnAllKeyNamesLoaded)})}catch(e){await this._TriggerStorageError(e)}}}}self.C3.Plugins.LocalStorage.Exps={ItemValue(){return this._lastValue},Key(){return this._currentKey},KeyCount(){return this._keyNamesList.length},KeyAt(e){return e=Math.floor(e),0>e||e>=this._keyNamesList.length?"":this._keyNamesList[e]},ErrorMessage(){return this._errorMessage}};{const e=self.C3;e.Plugins.NodeWebkit=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.NodeWebkit.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=new Map([["EACCES","access denied"],["EEXIST","file exists"],["EISDIR","is a directory"],["EMFILE","too many open files"],["ENOENT","no such file or directory"],["ENOTDIR","not a directory"],["ENOTEMPTY","directory not empty"],["EPERM","operation not permitted"]]);e.Plugins.NodeWebkit.Instance=class extends e.SDKInstanceBase{constructor(e,t){super(e,"nwjs"),this._isNWjs="nwjs"===this._runtime.GetExportType()||this._runtime.IsPreview()&&/nwjs\//i.test(navigator.userAgent),this._os=this._process=this._childProcess=this._fs=this._path=null,this._projectFilesFolder=this._userFolder=this._appFolder=this._fileError=this._currentTag="",this._slash="\\",this._fileList=[],this._chosenPath=this._droppedFile="",this._argv=[],this._windowTitle=this._clipboardText="",this._windowHeight=this._windowWidth=this._windowY=this._windowX=0,this._isNWjs&&this._InitNWjs()}_InitNWjs(){this._path=require("path"),this._fs=require("fs"),this._childProcess=require("child_process"),this._process=self.process||nw.process,this._os=require("os"),"win32"!==this._process.platform&&(this._slash="/"),this._appFolder=this._path.dirname(this._process.execPath)+this._slash,this._userFolder=this._os.homedir()+this._slash,this._projectFilesFolder=this._process.mainModule.filename;const e=Math.max(this._projectFilesFolder.lastIndexOf("/"),this._projectFilesFolder.lastIndexOf("\\"));-1!==e&&(this._projectFilesFolder=this._projectFilesFolder.substr(0,e+1)),this.AddDOMMessageHandlers([["drop",e=>this._OnDrop(e)],["open-dlg",e=>this._OnOpenDlg(e)],["open-dlg-cancel",()=>this._OnOpenDlgCancel()],["folder-dlg",e=>this._OnFolderDlg(e)],["folder-dlg-cancel",()=>this._OnFolderDlgCancel()],["save-dlg",e=>this._OnSaveDlg(e)],["save-dlg-cancel",()=>this._OnSaveDlgCancel()],["window-change",e=>this._OnWindowChange(e)],["clipboard-change",e=>this._OnClipboardChange(e)]]),this._runtime.AddLoadPromise(this.PostToDOMAsync("init").then(e=>{this._OnWindowChange(e),this._OnClipboardChange(e),this._argv=e.argv}))}Release(){super.Release()}_OnWindowChange(e){this._windowTitle=e["window-title"],this._windowX=e["window-x"],this._windowY=e["window-y"],this._windowWidth=e["window-width"],this._windowHeight=e["window-height"]}_OnClipboardChange(e){this._clipboardText=e["clipboard-text"]}_BufferToArrayBuffer(e){const t=e.buffer,s=e.byteLength,i=e.byteOffset;return t.byteLength!==e.length?t.slice(i,i+s):t}_GetBinaryDataSdkInstance(e){return e&&(e=e.GetFirstPicked(this._inst))?e.GetSdkInstance():null}_ReadBinaryFile(e){return new Promise((t,s)=>{this._fs.readFile(e,{},(e,i)=>{e?s(e):t(this._BufferToArrayBuffer(i))})})}_WriteBinaryFile(t,s){e.WeakRequireInstanceOf(s,ArrayBuffer);const i=new Uint8Array(s);return new Promise((e,s)=>{this._fs.writeFile(t,i,{},t=>{t?s(t):e()})})}_GetFileError(e){return e&&"string"==typeof e.code?t.get(e.code)||e.code:"unknown error"}_OnFileSystemError(t){this._fileError=this._GetFileError(t),this.Trigger(e.Plugins.NodeWebkit.Cnds.OnFileSystemError),this._fileError=""}async _OnDrop(t){t=t.filePaths;for(const s of t)this._droppedFile=s,await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnFileDrop);this._droppedFile=""}async _OnOpenDlg(t){this._chosenPath=t.chosenPath,await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnOpenDlg)}async _OnOpenDlgCancel(){await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnOpenDlgCancel)}async _OnFolderDlg(t){this._chosenPath=t.chosenPath,await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnFolderDlg)}async _OnFolderDlgCancel(){await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnFolderDlgCancel)}async _OnSaveDlg(t){this._chosenPath=t.chosenPath,await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnSaveDlg)}async _OnSaveDlgCancel(){await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnSaveDlgCancel)}GetDebuggerProperties(){return[{title:"plugins.nodewebkit.name",properties:[{name:"plugins.nodewebkit.debugger.app-folder",value:this._appFolder},{name:"plugins.nodewebkit.debugger.user-folder",value:this._userFolder},{name:"plugins.nodewebkit.debugger.project-files-folder",value:this._projectFilesFolder}]}]}}}self.C3.Plugins.NodeWebkit.Cnds={PathExists(e){return!!this._isNWjs&&this._fs.existsSync(e)},OnBinaryFileRead(e){return this._currentTag===e},OnBinaryFileWritten(e){return this._currentTag===e},OnFileSystemError:()=>!0,OnFileDrop:()=>!0,OnOpenDlg:()=>!0,OnFolderDlg:()=>!0,OnSaveDlg:()=>!0,OnOpenDlgCancel:()=>!0,OnFolderDlgCancel:()=>!0,OnSaveDlgCancel:()=>!0};{const e=self.C3;function b(e,t,s){"function"==typeof e.copyfileSync?e.copyfileSync(t,s):(t=e.readFileSync(t,{flags:"rb"}),e.writeFileSync(s,t,{flags:"wb"}))}e.Plugins.NodeWebkit.Acts={WriteTextFile(e,t){if(this._isNWjs)try{this._fs.writeFileSync(e,t,{encoding:"utf8"})}catch(t){console.error(`Error writing text file '${e}': `,t),this._OnFileSystemError(t)}},async ReadBinaryFile(t,s,i){if(i=this._GetBinaryDataSdkInstance(i),this._isNWjs&&i)try{const r=await this._ReadBinaryFile(s);i.SetArrayBufferTransfer(r),this._currentTag=t,await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnBinaryFileRead),this._currentTag=""}catch(e){console.error(`Error reading binary file '${s}': `,e),this._OnFileSystemError(e)}},async WriteBinaryFile(t,s,i){if(i=this._GetBinaryDataSdkInstance(i),this._isNWjs&&i)try{const r=i.GetArrayBufferReadOnly();await this._WriteBinaryFile(s,r),this._currentTag=t,await this.TriggerAsync(e.Plugins.NodeWebkit.Cnds.OnBinaryFileWritten),this._currentTag=""}catch(e){console.error(`Error writing binary file '${s}': `,e),this._OnFileSystemError(e)}},RenameFile(e,t){if(this._isNWjs)try{this._fs.renameSync(e,t)}catch(t){console.error(`Error renaming file '${e}': `,t),this._OnFileSystemError(t)}},DeleteFile(e){if(this._isNWjs)try{this._fs.unlinkSync(e)}catch(t){"ENOENT"!==t.code&&(console.error(`Error deleting file '${e}': `,t),this._OnFileSystemError(t))}},CopyFile(e,t){if(this._isNWjs)try{b(this._fs,e,t)}catch(t){console.error(`Error copying file '${e}': `,t),this._OnFileSystemError(t)}},MoveFile(e,t){if(this._isNWjs&&e!==t)try{b(this._fs,e,t),this._fs.existsSync(t)&&this._fs.unlinkSync(e)}catch(t){console.error(`Error moving file '${e}': `,t),this._OnFileSystemError(t)}},RunFile(e){this._isNWjs&&this._childProcess.exec(e,()=>{})},ShellOpen(e){this._isNWjs&&this.PostToDOM("shell-cmd",{method:"openItem",arg:e})},OpenBrowser(e){this._isNWjs&&this.PostToDOM("shell-cmd",{method:"openExternal",arg:e})},CreateFolder(e){if(this._isNWjs)try{this._fs.mkdirSync(e)}catch(t){console.error(`Error creating folder '${e}': `,t),this._OnFileSystemError(t)}},AppendFile(e,t){if(this._isNWjs)try{this._fs.appendFileSync(e,t,{encoding:"utf8"})}catch(t){console.error(`Error appending to file '${e}': `,t),this._OnFileSystemError(t)}},ListFiles(e){if(this._isNWjs)try{this._fileList=this._fs.readdirSync(e)}catch(t){this._fileList=[],console.error(`Error listing files at '${e}': `,t),this._OnFileSystemError(t)}},ShowOpenDlg(e){this._isNWjs&&this.PostToDOM("show-open-dlg",{accept:e})},ShowFolderDlg(){this._isNWjs&&this.PostToDOM("show-folder-dlg")},ShowSaveDlg(e){this._isNWjs&&this.PostToDOM("show-save-dlg",{accept:e})},SetWindowX(e){this._isNWjs&&this.PostToDOM("set-window-x",{x:e})},SetWindowY(e){this._isNWjs&&this.PostToDOM("set-window-y",{y:e})},SetWindowWidth(e){this._isNWjs&&this.PostToDOM("set-window-width",{width:e})},SetWindowHeight(e){this._isNWjs&&this.PostToDOM("set-window-height",{height:e})},SetWindowTitle(e){this._isNWjs&&(this._windowTitle=e,this.PostToDOM("set-title",{title:e}))},WindowMinimize(){this._isNWjs&&this.PostToDOM("window-cmd",{method:"minimize"})},WindowMaximize(){this._isNWjs&&this.PostToDOM("window-cmd",{method:"maximize"})},WindowUnmaximize(){this._isNWjs&&this.PostToDOM("window-cmd",{method:"unmaximize"})},WindowRestore(){this._isNWjs&&this.PostToDOM("window-cmd",{method:"restore"})},WindowRequestAttention(e){this._isNWjs&&this.PostToDOM("window-attention",{request:e?3:0})},WindowSetMaxSize(e,t){this._isNWjs&&this.PostToDOM("set-window-max-size",{width:e,height:t})},WindowSetMinSize(e,t){this._isNWjs&&this.PostToDOM("set-window-min-size",{width:e,height:t})},WindowSetResizable(e){this._isNWjs&&this.PostToDOM("set-window-resizable",{resizable:0!==e})},WindowSetAlwaysOnTop(e){this._isNWjs&&this.PostToDOM("set-window-always-top",{top:0!==e})},ShowDevTools(){this._isNWjs&&this.PostToDOM("window-cmd",{method:"showDevTools"})},SetClipboardText(e){this._isNWjs&&(this._clipboardText=e,this.PostToDOM("set-clipboard",{text:e}))},ClearClipboard(){this._isNWjs&&(this._clipboardText="",this.PostToDOM("clear-clipboard"))}}}self.C3.Plugins.NodeWebkit.Exps={AppFolder(){return this._appFolder},AppFolderURL(){return"file://"+this._appFolder},ProjectFilesFolder(){return this._projectFilesFolder},ProjectFilesFolderURL(){return"file://"+this._projectFilesFolder},UserFolder(){return this._userFolder},ReadFile(e){if(!this._isNWjs)return"";let t="";try{t=this._fs.readFileSync(e,{encoding:"utf8"})}catch(t){console.error(`Failed to read file '${e}': `,t),this._OnFileSystemError(t)}return t},FileSize(e){if(!this._isNWjs)return 0;let t=0;try{const s=this._fs.statSync(e);s&&(t=s.size||0)}catch(t){console.error(`Failed to read file '${e}' size: `,t),this._OnFileSystemError(t)}
return t},ListCount(){return this._fileList.length},ListAt(e){return e=Math.floor(e),0>e||e>=this._fileList.length?"":this._fileList[e]},DroppedFile(){return this._droppedFile},ChosenPath(){return this._chosenPath},WindowX(){return this._windowX},WindowY(){return this._windowY},WindowWidth(){return this._windowWidth},WindowHeight(){return this._windowHeight},WindowTitle(){return this._windowTitle},ClipboardText(){return this._isNWjs?this._clipboardText:""},ArgumentCount(){return this._isNWjs?this._argv.length:0},ArgumentAt(e){if(!this._isNWjs)return"";e=Math.floor(e);const t=this._argv;return 0>e||e>=t.length?"":t[e]},FileError(){return this._fileError}};{const e=self.C3;e.Plugins.Particles=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Particles.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling()})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}}}{const e=self.C3,t=e.New(e.Rect);e.Plugins.Particles.Instance=class extends e.SDKWorldInstanceBase{constructor(t,s){super(t),this._isFirstTick=!0,this._particleEngine=t=e.New(self.ParticleEngine),t.ononeshotfinish=(()=>this._OnOneShotFinish()),this._spawnObjectClass=null,this._particleUpdateCallback=((e,t,s,i,r,n)=>this._OnParticleUpdate(e,t,s,i,r,n)),this._particleDestroyCallback=(e=>this._OnParticleDestroy(e)),this._hasAnyDefaultParticle=!0,s&&(t.SetRate(s[0]),t.SetSprayCone(e.toRadians(s[1])),t.SetSprayType(s[2]?"one-shot":"continuous-spray"),this._SetParticleObjectClass(this._runtime.GetObjectClassBySID(s[3])),t.SetInitSpeed(s[4]),t.SetInitSize(s[5]),t.SetInitOpacity(s[6]/100),t.SetGrowRate(s[7]),t.SetInitXRandom(s[8]),t.SetInitYRandom(s[9]),t.SetInitSpeedRandom(s[10]),t.SetInitSizeRandom(s[11]),t.SetGrowRandom(s[12]),t.SetAcceleration(s[13]),t.SetGravity(s[14]),t.SetLifeAngleRandom(s[15]),t.SetLifeSpeedRandom(s[16]),t.SetLifeOpacityRandom(s[17]),t.SetDestroyModeIndex(s[18]),t.SetTimeout(s[19])),this._UpdateEngineParameters(),this._spawnObjectClass&&(this._hasAnyDefaultParticle=!1),"one-shot"===t.GetSprayType()?t.CreateOneShotSpray():t.SetSpraying(!0);const i=this.GetWorldInfo();i.SetBboxChangeEventEnabled(!0),this._inst.Dispatcher().addEventListener("bboxchange",()=>{i.OverwriteBoundingBox(this._particleEngine.GetBoundingBox())}),this.GetRuntime().GetRenderer().IsWebGPU()&&i.SetUsePointsShaderProgram(),this._afterLoad=(e=>this._OnAfterLoad(e)),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad),this._StartTicking()}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._particleEngine.Release(),this._particleDestroyCallback=this._particleUpdateCallback=this._particleEngine=null,super.Release()}_SetParticleObjectClass(e){e===this.GetObjectClass()&&(e=null),this._spawnObjectClass=e,this._particleEngine.onparticlecreate=e?e=>this._OnParticleCreate(e):null,this._spawnObjectClass||(this._hasAnyDefaultParticle=!0)}_UpdateEngineParameters(){const e=this._particleEngine,t=this.GetWorldInfo();e.SetMasterOpacity(t.GetOpacity()),e.SetPixelRounding(this._runtime.IsPixelRoundingEnabled()),e.SetSpawnX(t.GetX()),e.SetSpawnY(t.GetY()),e.SetSpawnAngle(t.GetAngle()),e.SetInitSizeScale(t.GetSceneGraphScale())}_OnOneShotFinish(){this._runtime.DestroyInstance(this._inst)}Draw(e){if(this._hasAnyDefaultParticle){var s=this._objectClass.GetImageInfo(),i=s.GetTexture();if(i){var r=this.GetWorldInfo(),n=r.GetLayer();this._runtime.GetCanvasManager().IsPastingToDrawingCanvas()?t.set(-1/0,-1/0,1/0,1/0):n.Has3DCamera()?n.CalculateViewport3D(r.GetTotalZElevation(),t):n.GetViewportForZ(r.GetTotalZElevation(),t),e.SetTexture(i),i=n.Get2DScaleFactorToZ(r.GetTotalZElevation()),this._particleEngine.SetParticleScale(n.GetRenderScale()*i),this._particleEngine.Draw(e,s.GetTexRect(),t,n.Has3DCamera())}}}SaveToJson(){const e=this._particleEngine;return{r:e.GetRate(),sc:e.GetSprayCone(),st:e.GetSprayType(),isp:e.GetInitSpeed(),isz:e.GetInitSize(),io:e.GetInitOpacity(),gr:e.GetGrowRate(),xr:e.GetInitXRandom(),yr:e.GetInitYRandom(),spr:e.GetInitSpeedRandom(),szr:e.GetInitSizeRandom(),grnd:e.GetGrowRandom(),acc:e.GetAcceleration(),g:e.GetGravity(),lar:e.GetLifeAngleRandom(),lsr:e.GetLifeSpeedRandom(),lor:e.GetLifeOpacityRandom(),dm:e.GetDestroyModeIndex(),to:e.GetTimeout(),s:e.IsSpraying(),pcc:e._GetCreateCounter(),ft:this._isFirstTick,p:e.GetParticles().map(e=>e.toJSON())}}LoadFromJson(e){var t=this._particleEngine;t.SetRate(e.r),t.SetSprayCone(e.sc),t.SetSprayType(e.st),t.SetInitSpeed(e.isp),t.SetInitSize(e.isz),t.SetInitOpacity(e.io),t.SetGrowRate(e.gr),t.SetInitXRandom(e.xr),t.SetInitYRandom(e.yr),t.SetInitSpeedRandom(e.spr),t.SetInitSizeRandom(e.szr),t.SetGrowRandom(e.grnd),t.SetAcceleration(e.acc),t.SetGravity(e.g),t.SetLifeAngleRandom(e.lar),t.SetLifeSpeedRandom(e.lsr),t.SetLifeOpacityRandom(e.lor),t.SetDestroyModeIndex(e.dm),t.SetTimeout(e.to),t.SetSpraying(e.s),t._SetCreateCounter(e.pcc),this._isFirstTick=e.ft,e=e.p,t.SetParticleCount(e.length),t=t.GetParticles();for(let i=0,r=t.length;i<r;++i){const r=t[i];r.setFromJSON(e[i]);var s=r.GetUserData();s&&(s=s.GetWorldInfo(),s.SetX(r.GetX()),s.SetY(r.GetY()),s.SetSize(r.GetSize(),r.GetSize()),s.SetOpacity(r.GetOpacity()),s.SetAngle(r.GetAngle()),s.SetUnpremultipliedColor(this.GetWorldInfo().GetUnpremultipliedColor()))}}_OnAfterLoad(){var e=this._particleEngine;if("one-shot"===e.GetSprayType()){e=e.GetParticles();for(let i=0,r=e.length;i<r;++i){var t=e[i],s=t.GetUserData();s&&(s=s.GetWorldInfo())&&(s=s.GetInstance())&&(t=t.GetUserDataUID(),s=s.GetUID(),"number"!=typeof t||"number"!=typeof s||t!==s)&&(s=this.GetRuntime(),(t=s.GetInstanceByUID(t))&&s.DestroyInstance(t))}}}Tick(){const e=this._runtime.GetDt(this._inst);this._UpdateEngineParameters(),this._isFirstTick&&"one-shot"===this._particleEngine.GetSprayType()&&this._particleEngine.ReInitAllParticles(),this._particleEngine.Tick(e),this._particleEngine.IsSpraying()&&this._runtime.UpdateRender(),this.GetWorldInfo().SetBboxChanged(),this._isFirstTick=!1}_OnParticleCreate(e){const t=this._runtime.CreateInstance(this._spawnObjectClass,this.GetWorldInfo().GetLayer(),e.GetX(),e.GetY()),s=t.GetWorldInfo();return s.SetSize(e.GetSize(),e.GetSize()),s.SetAngle(e.GetAngle()),s.SetOpacity(e.GetOpacity()),s.SetUnpremultipliedColor(this.GetWorldInfo().GetUnpremultipliedColor()),s.SetBboxChanged(),s.ZOrderMoveAdjacentToInstance(this.GetInstance(),!0),t._TriggerOnCreated(),e.SetUpdateCallback(this._particleUpdateCallback),e.SetDestroyCallback(this._particleDestroyCallback),t}_OnParticleUpdate(e,t,s,i,r,n){e.IsDestroyed()||(e=e.GetWorldInfo(),e.OffsetXY(t,s),e.SetSize(e.GetWidth()+i,e.GetHeight()+i),e.SetAngle(e.GetAngle()+r),e.SetOpacity(e.GetOpacity()+n),e.SetBboxChanged())}_OnParticleDestroy(e){e.IsDestroyed()||this._runtime.DestroyInstance(e)}GetPropertyValueByIndex(t){const s=this._particleEngine;switch(t){case 0:return s.GetRate();case 1:return e.toDegrees(s.GetSprayCone());case 2:return"one-shot"===s.GetSprayType()?1:0;case 4:return s.GetInitSpeed();case 5:return s.GetInitSize();case 6:return 100*s.GetInitOpacity();case 7:return s.GetGrowRate();case 8:return s.GetInitXRandom();case 9:return s.GetInitYRandom();case 10:return s.GetInitSpeedRandom();case 11:return s.GetInitSizeRandom();case 12:return s.GetGrowRandom();case 13:return s.GetAcceleration();case 14:return s.GetGravity();case 15:return s.GetLifeAngleRandom();case 16:return s.GetLifeSpeedRandom();case 17:return s.GetLifeOpacityRandom();case 18:return s.GetDestroyModeIndex();case 19:return s.GetTimeout()}}SetPropertyValueByIndex(t,s){const i=this._particleEngine;switch(t){case 0:i.SetRate(s);break;case 1:i.SetSprayCone(e.toRadians(s));break;case 2:i.SetSprayType(s?"one-shot":"continuous-spray");break;case 4:i.SetInitSpeed(s);break;case 5:i.SetInitSize(s);break;case 6:i.SetInitOpacity(s/100);break;case 7:i.SetGrowRate(s);break;case 8:i.SetInitXRandom(s);break;case 9:i.SetInitYRandom(s);break;case 10:i.SetInitSpeedRandom(s);break;case 11:i.SetInitSizeRandom(s);break;case 12:i.SetGrowRandom(s);break;case 13:i.SetAcceleration(s);break;case 14:i.SetGravity(s);break;case 15:i.SetLifeAngleRandom(s);break;case 16:i.SetLifeSpeedRandom(s);break;case 17:i.SetLifeOpacityRandom(s);break;case 18:i.SetDestroyModeIndex(s);break;case 19:i.SetTimeout(s)}}GetDebuggerProperties(){const t=this._particleEngine;return[{title:"plugins.particles.name",properties:[{name:"plugins.particles.debugger.particle-count",value:t.GetParticleCount()},{name:"plugins.particles.properties.type.name",value:["plugins.particles.properties.type.items."+t.GetSprayType()]},{name:"plugins.particles.debugger.is-spraying",value:t.IsSpraying(),onedit:e=>t.SetSpraying(e)},{name:"plugins.particles.properties.rate.name",value:t.GetRate(),onedit:e=>t.SetRate(e)},{name:"plugins.particles.properties.spray-cone.name",value:e.toDegrees(t.GetSprayCone()),onedit:s=>t.SetSprayCone(e.toRadians(s))},{name:"plugins.particles.properties.speed.name",value:t.GetInitSpeed(),onedit:e=>t.SetInitSpeed(e)},{name:"plugins.particles.properties.size.name",value:t.GetInitSize(),onedit:e=>t.SetInitSize(e)},{name:"plugins.particles.properties.opacity.name",value:t.GetInitOpacity(),onedit:e=>t.SetInitOpacity(e)},{name:"plugins.particles.properties.grow-rate.name",value:t.GetGrowRate(),onedit:e=>t.SetGrowRate(e)},{name:"plugins.particles.properties.x-randomiser.name",value:t.GetInitXRandom(),onedit:e=>t.SetInitXRandom(e)},{name:"plugins.particles.properties.y-randomiser.name",value:t.GetInitYRandom(),onedit:e=>t.SetInitYRandom(e)},{name:"plugins.particles.properties.initial-speed-randomiser.name",value:t.GetInitSpeedRandom(),onedit:e=>t.SetInitSpeedRandom(e)},{name:"plugins.particles.properties.size-randomiser.name",value:t.GetInitSizeRandom(),onedit:e=>t.SetInitSizeRandom(e)},{name:"plugins.particles.properties.grow-rate-randomiser.name",value:t.GetGrowRandom(),onedit:e=>t.SetGrowRandom(e)},{name:"plugins.particles.properties.acceleration.name",value:t.GetAcceleration(),onedit:e=>t.SetAcceleration(e)},{name:"plugins.particles.properties.gravity.name",value:t.GetGravity(),onedit:e=>t.SetGravity(e)},{name:"plugins.particles.properties.angle-randomiser.name",value:t.GetLifeAngleRandom(),onedit:e=>t.SetLifeAngleRandom(e)},{name:"plugins.particles.properties.life-speed-randomiser.name",value:t.GetLifeSpeedRandom(),onedit:e=>t.SetLifeSpeedRandom(e)},{name:"plugins.particles.properties.opacity-randomiser.name",value:t.GetLifeOpacityRandom(),onedit:e=>t.SetLifeOpacityRandom(e)},{name:"plugins.particles.properties.timeout.name",value:t.GetTimeout(),onedit:e=>t.SetTimeout(e)}]}]}}}self.C3.Plugins.Particles.Cnds={IsSpraying(){return this._particleEngine.IsSpraying()}};{const e=self.C3;e.Plugins.Particles.Acts={SetSpraying(e){this._particleEngine.SetSpraying(0!==e)},SetRate(e){this._particleEngine.SetRate(e),"one-shot"===this._particleEngine.GetSprayType()&&this._isFirstTick&&this._particleEngine.SetParticleCount(e)},SetParticleObject(e){this._SetParticleObjectClass(e)},UnsetParticleObject(){this._SetParticleObjectClass(null)},SetSprayCone(t){this._particleEngine.SetSprayCone(e.toRadians(t))},SetInitSpeed(e){this._particleEngine.SetInitSpeed(e)},SetInitSize(e){this._particleEngine.SetInitSize(e)},SetInitOpacity(e){this._particleEngine.SetInitOpacity(e/100)},SetGrowRate(e){this._particleEngine.SetGrowRate(e)},SetXRandomiser(e){this._particleEngine.SetInitXRandom(e)},SetYRandomiser(e){this._particleEngine.SetInitYRandom(e)},SetSpeedRandomiser(e){this._particleEngine.SetInitSpeedRandom(e)},SetSizeRandomiser(e){this._particleEngine.SetInitSizeRandom(e)},SetGrowRateRandomiser(e){this._particleEngine.SetGrowRandom(e)},SetParticleAcc(e){this._particleEngine.SetAcceleration(e)},SetGravity(e){this._particleEngine.SetGravity(e)},SetAngleRandomiser(e){this._particleEngine.SetLifeAngleRandom(e)},SetLifeSpeedRandomiser(e){this._particleEngine.SetLifeSpeedRandom(e)},SetOpacityRandomiser(e){this._particleEngine.SetLifeOpacityRandom(e)},SetTimeout(e){this._particleEngine.SetTimeout(e)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}{const e=self.C3;e.Plugins.Particles.Exps={ParticleCount(){return this._particleEngine.GetParticleCount()},Rate(){return this._particleEngine.GetRate()},SprayCone(){return e.toDegrees(this._particleEngine.GetSprayCone())},InitSpeed(){return this._particleEngine.GetInitSpeed()},InitSize(){return this._particleEngine.GetInitSize()},InitOpacity(){return 100*this._particleEngine.GetInitOpacity()},InitGrowRate(){return this._particleEngine.GetGrowRate()},XRandom(){return this._particleEngine.GetInitXRandom()},YRandom(){return this._particleEngine.GetInitYRandom()},InitSizeRandom(){return this._particleEngine.GetInitSizeRandom()},InitSpeedRandom(){return this._particleEngine.GetInitSpeedRandom()},InitGrowRandom(){return this._particleEngine.GetGrowRandom()},ParticleAcceleration(){return this._particleEngine.GetAcceleration()},Gravity(){return this._particleEngine.GetGravity()},ParticleAngleRandom(){return this._particleEngine.GetLifeAngleRandom()},ParticleSpeedRandom(){return this._particleEngine.GetLifeSpeedRandom()},ParticleOpacityRandom(){return this._particleEngine.GetLifeOpacityRandom()},Timeout(){return this._particleEngine.GetTimeout()}}}{const e=self.C3,t=[],s=new Set(["continuous-spray","one-shot"]),i=["fade-to-invisible","timeout-expired","particle-stopped"];self.ParticleEngine=class{constructor(){this._sprayCone=this._rate=0,this._sprayType="continuous-spray",this._isSpraying=!1,this._masterOpacity=0,this._isPixelRounding=!1,this._initSize=this._initSpeed=this._spawnAngle=this._spawnY=this._spawnX=0,this._initSizeScale=1,this._createCounter=this._timeout=this._destroyMode=this._lifeOpacityRandom=this._lifeSpeedRandom=this._lifeAngleRandom=this._gravity=this._acceleration=this._growRandom=this._initSizeRandom=this._initSpeedRandom=this._yRandom=this._xRandom=this._growRate=this._initOpacity=0,this._particleScale=1,this.onparticlecreate=this.ononeshotfinish=null,this._particles=[],this._boundingBox=new e.Rect,this._color=new e.Color}Release(){this.Cancel(),e.clearArray(this._particles),this._color=this._boundingBox=this.onparticlecreate=this.ononeshotfinish=this._particles=null}Cancel(){const s=this._particles;for(let e=0,t=s.length;e<t;++e)s[e].Destroy();e.appendArray(t,s),e.clearArray(s),1e3<t.length&&e.truncateArray(t,1e3),this._isSpraying=!1}CreateOneShotSpray(){for(let e=0,t=this._rate;e<t;++e)this._CreateParticle();this._particles.length&&(this._isSpraying=!0)}_CreateParticle(){let s;return t.length?(s=t.pop(),s.SetEngine(this)):s=e.New(self.Particle,this),this._particles.push(s),s.Init(this.onparticlecreate),s}ReInitAllParticles(){const e=this._particles,t=this.onparticlecreate;for(let s=0,i=e.length;s<i;++s)e[s].Init(t)}SetParticleCount(s){var i=this._particles;if(s<i.length){s=i.length-s;for(let e=0;e<s;++e){const e=i.pop();e.Destroy(),t.push(e)}1e3<t.length&&e.truncateArray(t,1e3)}else if(s>i.length)for(i=s-i.length,s=0;s<i;++s)this._CreateParticle()}GetParticles(){return this._particles}GetParticleCount(){return this._particles.length}Tick(e){this._SpawnContinuous(e),this._TickParticles(e),this._MaybeFinishOneShot()}_SpawnContinuous(e){if("continuous-spray"===this._sprayType&&this._isSpraying){this._createCounter+=e*this._rate,e=Math.floor(this._createCounter),this._createCounter-=e;for(let t=0;t<e;++t)this._CreateParticle()}}_SetCreateCounter(e){this._createCounter=e}_GetCreateCounter(){return this._createCounter}_TickParticles(s){const i=this._boundingBox;i.set(this._spawnX,this._spawnY,this._spawnX,this._spawnY);const r=this._particles;let n=0;for(let e=0,a=r.length;e<a;++e){const a=r[e];r[n]=a,a.Tick(s),a.IsActive()?(++n,i.expandToContain(a.GetBoundingBox())):(a.Destroy(),t.push(a))}e.truncateArray(r,n),1e3<t.length&&e.truncateArray(t,1e3)}_MaybeFinishOneShot(){"one-shot"===this._sprayType&&0===this._particles.length&&this._isSpraying&&(this.ononeshotfinish&&this.ononeshotfinish(),this._isSpraying=!1)}Draw(e,t,s,i){e.StartRenderingPoints(t),this._color.copy(e.GetColor());const r=this._particles;for(let n=0,a=r.length;n<a;++n){const a=r[n];s.intersectsRect(a.GetBoundingBox())&&a.Draw(e,t,i)}e.FinishRenderingPoints()}GetColor(){return this._color}SetRate(e){this._rate=+e}GetRate(){return this._rate}SetSprayCone(e){this._sprayCone=+e}GetSprayCone(){return this._sprayCone}SetSprayType(e){if(!s.has(e))throw Error("invalid spray type");this._sprayType=e}GetSprayType(){return this._sprayType}SetSpraying(e){this._isSpraying=!!e}IsSpraying(){return this._isSpraying}SetMasterOpacity(e){this._masterOpacity=+e}GetMasterOpacity(){return this._masterOpacity}SetPixelRounding(e){this._isPixelRounding=!!e}IsPixelRounding(){return this._isPixelRounding}SetSpawnX(e){this._spawnX=+e}GetSpawnX(){return this._spawnX}SetSpawnY(e){this._spawnY=+e}GetSpawnY(){return this._spawnY}SetSpawnAngle(e){this._spawnAngle=+e}GetInitAngle(){return this._spawnAngle}SetInitSpeed(e){this._initSpeed=+e}GetInitSpeed(){return this._initSpeed}SetInitSize(e){this._initSize=+e}GetInitSize(){return this._initSize}SetInitSizeScale(e){this._initSizeScale=+e}GetInitSizeScale(){return this._initSizeScale}SetInitOpacity(e){this._initOpacity=+e}GetInitOpacity(){return this._initOpacity}SetGrowRate(e){this._growRate=+e}GetGrowRate(){return this._growRate}SetInitXRandom(e){this._xRandom=+e}GetInitXRandom(){return this._xRandom}SetInitYRandom(e){this._yRandom=+e}GetInitYRandom(){return this._yRandom}SetInitSpeedRandom(e){this._initSpeedRandom=+e}GetInitSpeedRandom(){return this._initSpeedRandom}SetInitSizeRandom(e){this._initSizeRandom=+e}GetInitSizeRandom(){return this._initSizeRandom}SetGrowRandom(e){this._growRandom=+e}GetGrowRandom(){return this._growRandom}SetAcceleration(e){this._acceleration=+e}GetAcceleration(){return this._acceleration}SetGravity(e){this._gravity=+e}GetGravity(){return this._gravity}SetLifeAngleRandom(e){this._lifeAngleRandom=+e}GetLifeAngleRandom(){return this._lifeAngleRandom}SetLifeSpeedRandom(e){this._lifeSpeedRandom=+e}GetLifeSpeedRandom(){return this._lifeSpeedRandom}SetLifeOpacityRandom(e){this._lifeOpacityRandom=+e}GetLifeOpacityRandom(){return this._lifeOpacityRandom}SetDestroyMode(e){if(e=i.indexOf(e),-1===e)throw Error("invalid destroy mode");this._destroyMode=e}SetDestroyModeIndex(e){this.SetDestroyMode(i[e])}GetDestroyMode(){return i[this._destroyMode]}GetDestroyModeIndex(){return this._destroyMode}SetTimeout(e){this._timeout=+e}GetTimeout(){return this._timeout}SetParticleScale(e){this._particleScale=+e}GetParticleScale(){return this._particleScale}GetBoundingBox(){return this._boundingBox}}}{const e=self.C3;function b(e){return Math.random()*e-e/2}const t=new e.Quad,s=new e.Color,i=self.devicePixelRatio||1;let r=!1;self.Particle=class{constructor(t){this._engine=t,this._isActive=!1,this._angle=this._speed=this._y=this._x=0,this._opacity=1,this._age=this._gs=this._halfSize=this._size=this._grow=this._lastOpacity=0,this._bbox=new e.Rect,this._userData=null,this._userDataUid=NaN,this._destroyCallback=this._updateCallback=null}SetEngine(e){this._engine=e}Init(e){const t=this._engine;this._isActive=!0,this._x=t.GetSpawnX()+b(t.GetInitXRandom()),this._y=t.GetSpawnY()+b(t.GetInitYRandom()),this._speed=t.GetInitSpeed()+b(t.GetInitSpeedRandom()),this._angle=t.GetInitAngle()+b(t.GetSprayCone()),this._lastOpacity=this._opacity=t.GetInitOpacity(),this._size=(t.GetInitSize()+b(t.GetInitSizeRandom()))*t.GetInitSizeScale(),this._halfSize=this._size/2,this._grow=t.GetGrowRate()+b(t.GetGrowRandom()),this._age=this._gs=0,this._UpdateBoundingBox(),e?this._userData||(this._userData=e(this)):this._destroyCallback=this._updateCallback=this._userData=null}SetUpdateCallback(e){this._updateCallback=e}SetDestroyCallback(e){this._destroyCallback=e}Destroy(){const e=this._destroyCallback;e&&e(this._userData),this._destroyCallback=this._updateCallback=this._userData=null}toJSON(){let e;return this._userData&&(e=this._userData.GetWorldInfo().GetInstance().GetUID()),[this._x,this._y,this._speed,this._angle,this._opacity,this._grow,this._size,this._gs,this._age,e]}setFromJSON(e){this._x=e[0],this._y=e[1],this._speed=e[2],this._angle=e[3],this._opacity=e[4],this._grow=e[5],this._size=e[6],this._gs=e[7],this._age=e[8],this._userDataUid=e[9],this._halfSize=this._size/2,this._UpdateBoundingBox()}Tick(t){var s=this._engine,i=this._speed*t,r=this._angle;const n=Math.cos(r)*i;i=Math.sin(r)*i+this._gs*t,this._x+=n,this._y+=i,r=this._grow*t,this._size+=r,this._halfSize=this._size/2,this._speed+=s.GetAcceleration()*t,this._gs+=s.GetGravity()*t,this._age+=t,this._UpdateBoundingBox();var a=s.GetLifeAngleRandom(),o=s.GetLifeSpeedRandom();const h=s.GetLifeOpacityRandom();let l=0;0!==a&&(l=b(a*t),this._angle+=l),0!==o&&(this._speed+=b(o*t)),0!==h&&(this._opacity=e.clamp(this._opacity+b(h*t),0,1)),t=1<=this._size&&(2===s.GetDestroyModeIndex()?0<this._speed:this._age<s.GetTimeout()),(a=this._updateCallback)&&t&&(o=s.GetMasterOpacity()*this._opacity,0===s.GetDestroyModeIndex()&&(o*=1-this._age/s.GetTimeout()),s=o-this._lastOpacity,this._lastOpacity=o,a(this._userData,n,i,r,l,s)),this._isActive=t}IsActive(){return this._isActive}GetBoundingBox(){return this._bbox}_UpdateBoundingBox(){const e=this._x,t=this._y,s=this._halfSize;this._bbox.set(e-s,t-s,e+s,t+s)}Draw(e,n,a){if(!this._userData){var o=this._engine,h=o.GetMasterOpacity()*this._opacity;if(0===o.GetDestroyModeIndex()&&(h*=1-this._age/o.GetTimeout()),!(0>=h)){var l=this._size,c=l*o.GetParticleScale()*i;if(!(1>c)){var u=this._x,_=this._y;o.IsPixelRounding()&&(u=u+.5|0,_=_+.5|0),e.IsWebGPU()?e.Point(u,_,l,h):a||c>e.GetMaxPointSize()||c<e.GetMinPointSize()?(s.copy(o.GetColor()),s.multiplyAlpha(h),e.SetColor(s),r=!0,t.setFromRect(this._bbox),e.Quad3(t,n)):(r&&(e.SetColor(o.GetColor()),r=!1),e.Point(u,_,c,h))}}}}GetUserData(){return this._userData}GetUserDataUID(){return this._userDataUid}GetX(){return this._x}GetY(){return this._y}GetSize(){return this._size}GetAngle(){return this._angle}GetOpacity(){return this._opacity}}}{const e=self.C3;e.Plugins.Tilemap=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}},e.Plugins.Tilemap.TILE_FLIPPED_HORIZONTAL=-2147483648,e.Plugins.Tilemap.TILE_FLIPPED_VERTICAL=1073741824,e.Plugins.Tilemap.TILE_FLIPPED_DIAGONAL=536870912,e.Plugins.Tilemap.TILE_FLAGS_MASK=3758096384,e.Plugins.Tilemap.TILE_ID_MASK=536870911}{const e=self.C3,t=e.Plugins.Tilemap.TILE_FLIPPED_HORIZONTAL,s=e.Plugins.Tilemap.TILE_FLIPPED_VERTICAL,i=e.Plugins.Tilemap.TILE_FLIPPED_DIAGONAL,r=e.Plugins.Tilemap.TILE_ID_MASK;e.Plugins.Tilemap.Type=class extends e.SDKTypeBase{constructor(e){super(e),this._tilePolys=[],this._areTilePolysCached=!1,this._maxTileIndex=0,this._brushesData=[]}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling()})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}OnDynamicTextureLoadComplete(){for(const e of this.GetObjectClass().instancesIncludingPendingCreate())e.GetSdkInstance()._OnDynamicTextureLoadComplete()}LoadTilemapData(e,t,s){this._maxTileIndex=t;for(const t of e)t?this._tilePolys.push({poly:t[0],use:!!t[1],flipmap:[[[null,null],[null,null]],[[null,null],[null,null]]]}):this._tilePolys.push(null);for(const e of s)this._brushesData.push({name:e[0],type:e[1],tileData:e[2]})}_ForceCacheOfTileCollisionPolys(e,t){this._areTilePolysCached=!1,this._MaybeCacheTileCollisionPolys(e,t)}_MaybeCacheTileCollisionPolys(e,t){if(!this._areTilePolysCached){this._areTilePolysCached=!0;for(let s=0,i=this._tilePolys.length;s<i;++s)this._tilePolys[s]&&(this._CacheTilePoly(s,e,t,!1,!1,!1),this._CacheTilePoly(s,e,t,!1,!1,!0),this._CacheTilePoly(s,e,t,!1,!0,!1),this._CacheTilePoly(s,e,t,!1,!0,!0),this._CacheTilePoly(s,e,t,!0,!1,!1),this._CacheTilePoly(s,e,t,!0,!1,!0),this._CacheTilePoly(s,e,t,!0,!0,!1),this._CacheTilePoly(s,e,t,!0,!0,!0))}}_CacheTilePoly(t,s,i,r,n,a){if(!(0>t||t>=this._tilePolys.length)&&(t=this._tilePolys[t])){var o=e.New(e.CollisionPoly,t.poly,t.use);o.transform(s,i,0),a&&o.diag(),r&&o.mirror(s/2),n&&o.flip(i/2),t.flipmap[r?1:0][n?1:0][a?1:0]=null,t.flipmap[r?1:0][n?1:0][a?1:0]=o}}GetTilePoly(e){if(-1===e)return null;var n=e&r;return 0>n||n>=this._tilePolys.length?null:(n=this._tilePolys[n])?n.flipmap[e&t?1:0][e&s?1:0][e&i?1:0]:null}IsTilePolyEnabled(e){return!e||e.IsEnabled()}GetMaxTileIndex(){return this._maxTileIndex}GetBrushData(e){return this._brushesData[e]}}}{const e=self.C3,t=self.C3X,s=e.Plugins.Tilemap.TILE_FLIPPED_HORIZONTAL,i=e.Plugins.Tilemap.TILE_FLIPPED_VERTICAL,r=e.Plugins.Tilemap.TILE_FLIPPED_DIAGONAL,n=e.Plugins.Tilemap.TILE_FLAGS_MASK,a=e.Plugins.Tilemap.TILE_ID_MASK,o=e.New(e.Rect),h=e.New(e.Rect),l=e.New(e.Rect);function u(e){const t=[];e=e.split(",");for(let h=0,l=e.length;h<l;++h){var n=e[h],a=n.indexOf("x");if(-1<a){var o=parseInt(n.substring(0,a),10);for(n=n.substring(a+1),a=parseInt(n,10),n.includes("h")&&(a|=s),n.includes("v")&&(a|=i),n.includes("d")&&(a|=r);0<o;--o)t.push(a)}else o=parseInt(n,10),n.includes("h")&&(o|=s),n.includes("v")&&(o|=i),n.includes("d")&&(o|=r),t.push(o)}return t}e.Plugins.Tilemap.Instance=class extends e.SDKWorldInstanceBase{constructor(e,t){super(e),e=this.GetWorldInfo(),this._tileHeight=this._tileWidth=32,this._mapHeight=this._mapWidth=this._tileYspacing=this._tileXspacing=this._tileYoffset=this._tileXoffset=0,this._lastWidth=e.GetWidth(),this._lastHeight=e.GetHeight(),this._cellHeight=this._cellWidth=0,this._tileCells=[],this._tileTexQuads=new Map,this._isAnyQuadMapChanged=!0,this._ownImageInfo=null,t&&(e.SetVisible(t[0]),this._tileWidth=Math.max(t[1],1),this._tileHeight=Math.max(t[2],1),this._tileXoffset=t[3],this._tileYoffset=t[4],this._tileXspacing=t[5],this._tileYspacing=t[6]),this._cellWidth=Math.ceil(this._runtime.GetOriginalViewportWidth()/this._tileWidth),this._cellHeight=Math.ceil(this._runtime.GetOriginalViewportHeight()/this._tileHeight),this._sdkType._MaybeCacheTileCollisionPolys(this._tileWidth,this._tileHeight),this._autoTiling=null}Release(){this._ReleaseOwnImage(),e.clearArray(this._tileCells),this._tileCells=null,this._tileTexQuads.clear(),this._tileTexQuads=null,super.Release()}_ReleaseOwnImage(){this._ownImageInfo&&(this._ownImageInfo.Release(),this._ownImageInfo=null)}LoadTilemapData(e,t,s){this._mapWidth=t,this._mapHeight=s,this._MaybeResizeTilemap(!0),this.SetTilesFromRLECSV(e),this._MaybeBuildAllQuadMap()}_MaybeResizeTilemap(t){const[s,i]=this.GetMapDisplaySize();if(!(s<=this._mapWidth&&i<=this._mapHeight)||t){if(t){t=Math.ceil(this._mapHeight/this._cellHeight);var r=Math.ceil(this._mapWidth/this._cellWidth)}else t=this._tileCells.length,r=Math.ceil(this._mapWidth/this._cellWidth),i>this._mapHeight&&(this._mapHeight=i,t=Math.ceil(this._mapHeight/this._cellHeight)),s>this._mapWidth&&(this._mapWidth=s,r=Math.ceil(this._mapWidth/this._cellWidth)),this._SetAllQuadMapChanged(),this._SetPhysicsChanged(),this._runtime.UpdateRender();var n=this._tileCells;if(n.length<t)for(var a=n.length;a<t;++a)n.push([]);for(a=0;a<t;++a){const t=n[a];for(let s=t.length;s<r;++s)t.push(e.New(e.Plugins.Tilemap.TileCell,this,s,a))}}}SetTilesFromRLECSV(e){e=u(e);let t=0;const s=this._mapWidth,i=this._cellWidth,r=this._cellHeight;for(let n=0,a=this._mapHeight;n<a;++n)for(let a=0;a<s;++a){const s=e[t++],o=this.GetCellAt(a,n);o&&o.SetTileAt(a%i,n%r,s)}}GetTilesAsRLECSV(){let e="";if(0>=this._mapWidth||0>=this._mapHeight)return e;let t=1;var n=this.GetTileAt(0,0);const[o,h]=this.GetMapDisplaySize();let l,c,u;for(let _=0;_<h;++_)for(let h=0===_?1:0;h<o;++h){const o=this.GetTileAt(h,_);o===n?++t:(-1===n?(l=-1,n=u=c=!1):(l=n&a,c=0!=(n&s),u=0!=(n&i),n=0!=(n&r)),e=1===t?e+""+l:e+(t+"x")+l,c&&(e+="h"),u&&(e+="v"),n&&(e+="d"),e+=",",t=1,n=o)}return-1===n?(l=-1,n=u=c=!1):(l=n&a,c=0!=(n&s),u=0!=(n&i),n=0!=(n&r)),e=1===t?e+""+l:e+(t+"x")+l,c&&(e+="h"),u&&(e+="v"),n&&(e+="d"),e}_SetAllQuadMapChanged(){const e=this._tileCells;for(let t=0,s=e.length;t<s;++t){const s=e[t];for(let e=0,t=s.length;e<t;++e)s[e]._SetQuadMapChanged()}this._isAnyQuadMapChanged=!0}_MaybeBuildAllQuadMap(){if(this._isAnyQuadMapChanged){this._isAnyQuadMapChanged=!1;var e=this._tileCells;for(let t=0,s=e.length;t<s;++t){const s=e[t];for(let e=0,t=s.length;e<t;++e)s[e].MaybeBuildQuadMap()}}}SetTileChanged(){this._isAnyQuadMapChanged=!0,this._SetPhysicsChanged(),this._runtime.UpdateRender()}_SetPhysicsChanged(){this.GetWorldInfo().SetPhysicsBodyChanged(!0)}GetCellAt(e,t){return 0>e||0>t?null:(t=Math.floor(t/this._cellHeight),t>=this._tileCells.length?null:(t=this._tileCells[t],e=Math.floor(e/this._cellWidth),e>=t.length?null:t[e]))}GetCellAtIndex(e,t){return 0>e||0>t||t>=this._tileCells.length?null:(t=this._tileCells[t],e>=t.length?null:t[e])}GetTileAt(e,t){if(e=Math.floor(e),t=Math.floor(t),0>e||0>t||e>=this._mapWidth||t>=this._mapHeight)return-1;const s=this.GetCellAt(e,t);return s?s.GetTilesArr()[t%this._cellHeight][e%this._cellWidth]:-1}SetTileAt(e,t,s){if(e=Math.floor(e),t=Math.floor(t),!(0>e||0>t||e>=this._mapWidth||t>=this._mapHeight||-1!==s&&(s&a)>this.GetMaxTileIndex())){var i=this.GetCellAt(e,t);i&&i.SetTileAt(e%this._cellWidth,t%this._cellHeight,s)}}GetMaxTileIndex(){return this._sdkType.GetMaxTileIndex()}WorldToCellX(e){return Math.floor((e-this.GetWorldInfo().GetX())/(this._cellWidth*this._tileWidth))}WorldToCellY(e){return Math.floor((e-this.GetWorldInfo().GetY())/(this._cellHeight*this._tileHeight))}WorldToTileX(e){return Math.floor((e-this.GetWorldInfo().GetX())/this._tileWidth)}WorldToTileY(e){return Math.floor((e-this.GetWorldInfo().GetY())/this._tileHeight)}GetMapWidth(){return this._mapWidth}GetMapHeight(){return this._mapHeight}GetMapDisplayWidth(){return Math.floor(this.GetWorldInfo().GetWidth()/this.GetTileWidth())}GetMapDisplayHeight(){return Math.floor(this.GetWorldInfo().GetHeight()/this.GetTileHeight())}GetMapDisplaySize(){const e=this.GetWorldInfo();return[Math.floor(e.GetWidth()/this.GetTileWidth()),Math.floor(e.GetHeight()/this.GetTileHeight())]}GetTileWidth(){return this._tileWidth}GetTileHeight(){return this._tileHeight}GetCellWidth(){return this._cellWidth}GetCellHeight(){return this._cellHeight}GetCollisionRectCandidates(t,s){var i=this.WorldToCellX(t.getLeft());const r=this.WorldToCellY(t.getTop()),n=this.WorldToCellX(t.getRight());for(t=this.WorldToCellY(t.getBottom());i<=n;++i)for(let n=r;n<=t;++n){const t=this.GetCellAtIndex(i,n);t&&(t.MaybeBuildQuadMap(),e.appendArray(s,t.GetCollisionRects()))}}TestPointOverlapTile(e,t){var s=this.WorldToTileX(e),i=this.WorldToTileY(t);if(s=this.GetTileAt(s,i),-1===s)return!1;if(s=this._sdkType.GetTilePoly(s),!s)return!0;if(!this._sdkType.IsTilePolyEnabled(s))return!1;var r=this.GetWorldInfo();return i=Math.floor((e-r.GetX())/this._tileWidth)*this._tileWidth+r.GetX(),r=Math.floor((t-r.GetY())/this._tileHeight)*this._tileHeight+r.GetY(),s.containsPoint(e-i,t-r)}GetAllCollisionRects(t){const s=this._tileCells;for(let i=0,r=s.length;i<r;++i){const r=s[i];for(let s=0,i=r.length;s<i;++s){const i=r[s];i.MaybeBuildQuadMap(),e.appendArray(t,i.GetCollisionRects())}}}GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo()}GetTileUvQuad(t){const n=this._tileTexQuads;var h=n.get(t);if(h)return h;var l=t&a;h=0!=(t&s);const c=0!=(t&i),u=0!=(t&r);var _=this.GetCurrentImageInfo(),d=_.GetWidth(),p=this._tileWidth,g=this._tileXspacing;return p=Math.floor((Math.floor((d-this._tileXoffset)/(p+g)*p)+g)/p),d=l%p,l=Math.floor(l/p),p=_.GetOffsetX()+this._tileXoffset+(this._tileWidth+this._tileXspacing)*d,g=_.GetOffsetY()+this._tileYoffset+(this._tileHeight+this._tileYspacing)*l,o.setWH(p,g,this._tileWidth,this._tileHeight),o.divide(_.GetSheetWidth(),_.GetSheetHeight()),_=e.New(e.Quad),_.setFromRect(o),u&&_.diag(),h&&_.mirror(),c&&_.flip(),_.offset(d,l),n.set(t,_),
_}_OnDynamicTextureLoadComplete(){this._tileTexQuads.clear(),this._SetAllQuadMapChanged()}Draw(e){var t=this.GetCurrentImageInfo(),s=t.GetTexture();if(s){o.copy(t.GetTexRect()),o.offsetLeft(this._tileXoffset/s.GetWidth()),o.offsetTop(this._tileYoffset/s.GetHeight()),e.SetTilemapFillMode(),e.SetTilemapInfo(o,s.GetWidth(),s.GetHeight(),this._tileWidth,this._tileHeight,this._tileXspacing,this._tileYspacing),e.SetTexture(s);var i=this.GetWorldInfo(),r=i.GetLayer();i.GetWidth()===this._lastWidth&&i.GetHeight()===this._lastHeight||(this._SetPhysicsChanged(),this._SetAllQuadMapChanged(),this._lastWidth=i.GetWidth(),this._lastHeight=i.GetHeight()),t=i.GetX(),s=i.GetY(),this._runtime.IsPixelRoundingEnabled()&&(t=Math.round(t),s=Math.round(s));var n=this._cellWidth*this._tileWidth,a=this._cellHeight*this._tileHeight;if(i=i.GetTotalZElevation(),r.Has3DCamera())for(var c of(h.set(-1/0,-1/0,1/0,1/0),a=r._GetViewFrustum(),this._tileCells))for(var u of c)u.GetLayoutRect(l),a.ContainsAABB(l.getLeft(),l.getTop(),i,l.getRight(),l.getBottom(),i)&&(u.MaybeBuildQuadMap(),u.Draw(e,h,t,s));else for(r.GetViewportForZ(i,h),r=Math.floor((h.getLeft()-t)/n),c=Math.floor((h.getRight()-t)/n),u=Math.floor((h.getTop()-s)/a),a=Math.floor((h.getBottom()-s)/a),n=r;n<=c;++n)for(r=u;r<=a;++r)(i=this.GetCellAtIndex(n,r))&&(i.MaybeBuildQuadMap(),i.Draw(e,h,t,s))}}SaveToJson(){this._MaybeResizeTilemap();const[e,t]=this.GetMapDisplaySize();return{tw:this._tileWidth,th:this._tileHeight,tox:this._tileXoffset,toy:this._tileYoffset,tsx:this._tileXspacing,tsy:this._tileYspacing,w:e,h:t,d:this.GetTilesAsRLECSV()}}LoadFromJson(e){this._tileWidth=e.tw,this._tileHeight=e.th,this._tileXoffset=e.tox,this._tileYoffset=e.toy,this._tileXspacing=e.tsx,this._tileYspacing=e.tsy,this._mapWidth=e.w,this._mapHeight=e.h,this._MaybeResizeTilemap(!0),this.SetTilesFromRLECSV(e.d),this._SetPhysicsChanged(),this._SetAllQuadMapChanged()}GetAsJsonString(){this._MaybeResizeTilemap();const[e,t]=this.GetMapDisplaySize();return JSON.stringify({c2tilemap:!0,width:e,height:t,data:this.GetTilesAsRLECSV()})}StateComboToFlags(e){switch(e){case 0:return 0;case 1:return s;case 2:return i;case 3:return s|r;case 4:return s|i;case 5:return i|r;case 6:return s|i|r;case 7:return r;default:return 0}}GetPropertyValueByIndex(e){switch(e){case 1:return this._tileWidth;case 2:return this._tileHeight;case 3:return this._tileXoffset;case 4:return this._tileYoffset;case 5:return this._tileXspacing;case 6:return this._tileYspacing}}SetPropertyValueByIndex(e,t){switch(e){case 1:if(this._tileWidth===t)break;this._tileWidth=Math.max(t,1),this._cellWidth=Math.ceil(this._runtime.GetOriginalViewportWidth()/this._tileWidth),this._sdkType._ForceCacheOfTileCollisionPolys(),this._UpdateQuadMaps();break;case 2:if(this._tileHeight===t)break;this._tileHeight=Math.max(t,1),this._cellHeight=Math.ceil(this._runtime.GetOriginalViewportHeight()/this._tileHeight),this._sdkType._ForceCacheOfTileCollisionPolys(),this._UpdateQuadMaps();break;case 3:if(this._tileXoffset===t)break;this._tileXoffset=t,this._UpdateQuadMaps();break;case 4:if(this._tileYoffset===t)break;this._tileYoffset=t,this._UpdateQuadMaps();break;case 5:if(this._tileXspacing===t)break;this._tileXspacing=t,this._UpdateQuadMaps();break;case 6:this._tileYspacing!==t&&(this._tileYspacing=t,this._UpdateQuadMaps())}}_UpdateQuadMaps(){this._tileTexQuads.clear(),this._SetAllQuadMapChanged(),this._MaybeBuildAllQuadMap()}GetScriptInterfaceClass(){return _}};const c=new WeakMap,_=self.ITilemapInstance=class extends self.IWorldInstance{constructor(){super(),c.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get mapWidth(){return c.get(this).GetMapWidth()}get mapHeight(){return c.get(this).GetMapHeight()}get mapDisplayWidth(){return c.get(this).GetMapDisplayWidth()}get mapDisplayHeight(){return c.get(this).GetMapDisplayHeight()}get tileWidth(){return c.get(this).GetTileWidth()}get tileHeight(){return c.get(this).GetTileHeight()}getTileAt(e,s){return t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),c.get(this).GetTileAt(e,s)}setTileAt(e,s,i){return t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireFiniteNumber(i),c.get(this).SetTileAt(e,s,i)}};_.TILE_FLIPPED_HORIZONTAL=s,_.TILE_FLIPPED_VERTICAL=i,_.TILE_FLIPPED_DIAGONAL=r,_.TILE_FLAGS_MASK=n,_.TILE_ID_MASK=a}{const e=self.C3,t=e.Plugins.Tilemap.TILE_FLAGS_MASK,s=e.Plugins.Tilemap.TILE_ID_MASK;e.Plugins.Tilemap.Cnds={CompareTileAt(t,i,r,n){return t=this.GetTileAt(t,i),-1!==t&&(t&=s),e.compare(t,r,n)},CompareTileStateAt(e,s,i){return e=this.GetTileAt(e,s),s=0,-1!==e&&(s=e&t),s===this.StateComboToFlags(i)},OnURLLoaded:()=>!0,OnURLFailed:()=>!0}}{const e=self.C3,t=e.Plugins.Tilemap.TILE_ID_MASK;e.Plugins.Tilemap.Acts={EraseTile(e,t){this._MaybeResizeTilemap(),this.SetTileAt(e,t,-1)},SetTile(e,s,i,r){this._MaybeResizeTilemap(),this.SetTileAt(e,s,i&t|this.StateComboToFlags(r))},SetTileState(e,s,i){const r=this.GetTileAt(e,s);-1!==r&&(this._MaybeResizeTilemap(),this.SetTileAt(e,s,r&t|this.StateComboToFlags(i)))},EraseTileRange(e,t,s,i){const r=Math.floor(Math.max(e,0));var n=Math.floor(Math.max(t,0));for(e=Math.floor(Math.min(e+s,this._mapWidth)),t=Math.floor(Math.min(t+i,this._mapHeight));n<t;++n)for(i=r;i<e;++i)this.SetTileAt(i,n,-1)},SetTileRange(e,s,i,r,n,a){this._MaybeResizeTilemap();const o=Math.floor(Math.max(e,0));var h=Math.floor(Math.max(s,0));for(e=Math.floor(Math.min(e+i,this._mapWidth)),s=Math.floor(Math.min(s+r,this._mapHeight)),n=n&t|this.StateComboToFlags(a);h<s;++h)for(a=o;a<e;++a)this.SetTileAt(a,h,n)},SetTileStateRange(e,s,i,r,n){this._MaybeResizeTilemap();const a=Math.floor(Math.max(e,0));var o=Math.floor(Math.max(s,0));for(e=Math.floor(Math.min(e+i,this._mapWidth)),s=Math.floor(Math.min(s+r,this._mapHeight)),n=this.StateComboToFlags(n);o<s;++o)for(r=a;r<e;++r)i=this.GetTileAt(r,o),-1!==i&&this.SetTileAt(r,o,i&t|n)},LoadFromJSON(e){let t=null;try{t=JSON.parse(e)}catch(e){return void console.error("[Construct 3] Failed to parse tilemap JSON: ",e)}t.c2tilemap?(this._mapWidth=t.width,this._mapHeight=t.height,this._MaybeResizeTilemap(!0),this.SetTilesFromRLECSV(t.data),this._SetAllQuadMapChanged(),this._SetPhysicsChanged()):console.error("[Construct 3] Unrecognized JSON data format")},JSONDownload(e){const t=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(t,e)},async LoadURL(t,s){if(!this._ownImageInfo||this._ownImageInfo.GetURL()!==t){s=this._runtime;var i=e.New(e.ImageInfo);try{if(await i.LoadDynamicAsset(s,t),!i.IsLoaded())throw Error("image failed to load");if(this.WasReleased())return i.Release(),null;if(!await i.LoadStaticTexture(s.GetRenderer(),{sampling:this._runtime.GetSampling()}))return}catch(t){return console.error("Load image from URL failed: ",t),void this.Trigger(e.Plugins.Tilemap.Cnds.OnURLFailed)}this.WasReleased()?i.Release():(this._ReleaseOwnImage(),this._ownImageInfo=i,s.UpdateRender(),this._tileTexQuads.clear(),this._SetAllQuadMapChanged(),await this.TriggerAsync(e.Plugins.Tilemap.Cnds.OnURLLoaded))}},SetEffect(e){2<=e&&e++,this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},SetTileWithBrush(t,s,i){this._MaybeResizeTilemap(),this._autoTiling||(this._autoTiling=new e.Plugins.Tilemap.AutoTiling(this,this._sdkType)),this._autoTiling.SetAutoTile(t,s,i)},EraseTileWithBrush(t,s,i){this._MaybeResizeTilemap(),this._autoTiling||(this._autoTiling=new e.Plugins.Tilemap.AutoTiling(this,this._sdkType)),this._autoTiling.EraseAutoTile(t,s,i)}}}{const e=self.C3,t=e.Plugins.Tilemap.TILE_ID_MASK;e.Plugins.Tilemap.Exps={TileAt(e,s){return e=this.GetTileAt(e,s),-1===e?-1:e&t},PositionToTileX(e){return this.WorldToTileX(e)},PositionToTileY(e){return this.WorldToTileY(e)},TileToPositionX(e){return e*this._tileWidth+this.GetWorldInfo().GetX()+this._tileWidth/2},TileToPositionY(e){return e*this._tileHeight+this.GetWorldInfo().GetY()+this._tileHeight/2},SnapX(e){const t=this.GetWorldInfo().GetX();return Math.floor((e-t)/this._tileWidth)*this._tileWidth+t+this._tileWidth/2},SnapY(e){const t=this.GetWorldInfo().GetY();return Math.floor((e-t)/this._tileHeight)*this._tileHeight+t+this._tileHeight/2},TilesJSON(){return this.GetAsJsonString()},TileWidth(){return this.GetTileWidth()},TileHeight(){return this.GetTileHeight()},MapDisplayWidth(){return this.GetMapDisplayWidth()},MapDisplayHeight(){return this.GetMapDisplayHeight()}}}{const e=self.C3,t=e.Plugins.Tilemap.TILE_FLIPPED_HORIZONTAL,s=e.Plugins.Tilemap.TILE_FLIPPED_VERTICAL,i=e.Plugins.Tilemap.TILE_FLIPPED_DIAGONAL,r=e.Plugins.Tilemap.TILE_ID_MASK,n=e.New(e.Rect),a=e.New(e.Quad);e.Plugins.Tilemap.TileQuad=class extends e.DefendedBase{constructor(){super(),this._tileId=this._id=-1,this._isDiagFlip=this._isVertFlip=this._isHorizFlip=!1,this._rc=e.New(e.Rect),this._uv=null}Update(e,n,a,o,h,l,c,u){this._id=e,this._tileId=e&r,this._isHorizFlip=0!=(e&t),this._isVertFlip=0!=(e&s),this._isDiagFlip=0!=(e&i),this._rc.setWH(o*n+l,h*a+c,n,a),this._uv=u.GetTileUvQuad(this._id)}Draw(e,t,s,i,r){n.copy(this._rc),n.offset(s,i),n.intersectsRect(t)&&(a.setFromRect(n),e.Quad4(a,this._uv))}}}{const e=self.C3;e.Plugins.Tilemap.TileCollisionRect=class extends e.DefendedBase{constructor(){super(),this._id=-1,this._poly=null,this._rc=e.New(e.Rect)}Update(e,t,s,i,r,n,a,o){this._id=e,this._poly=t,this._rc.setWH(r*s+a,n*i+o,s,i)}ExtendRight(e){this._rc.setRight(this._rc.getRight()+e)}GetTileId(){return this._id}HasPoly(){return!!this._poly}GetPoly(){return this._poly}GetRect(){return this._rc}}}{const e=self.C3;e.Plugins.Tilemap.TileCell=class extends e.DefendedBase{constructor(e,t,s){super();const i=e.GetCellWidth(),r=e.GetCellHeight();for(this._sdkInst=e,this._x=t,this._y=s,this._left=this._x*i*e.GetTileWidth(),this._top=this._y*r*e.GetTileHeight(),this._tiles=[],this._quads=[],this._collisionRects=[],this._isQuadMapValid=!1,e=0;e<r;++e)t=new Int32Array(i),t.fill(-1),this._tiles.push(t)}Clear(){const t=this._sdkInst.GetCellWidth();var s=this._sdkInst.GetCellHeight();const i=this._tiles;if(i.length<s)for(let e=i.length;e<s;++e)i.push(new Int32Array(t));else i.length>s&&e.truncateArray(i,s);for(let e=0,r=i.length;e<r;++e)s=i[e],s.length!==t&&(s=new Int32Array(t),i[e]=s),s.fill(-1)}GetLayoutRect(e){var t=this._sdkInst,s=t.GetWorldInfo();const i=t.GetCellWidth()*t.GetTileWidth();t=t.GetCellHeight()*t.GetTileHeight();const r=s.GetX()+this._left;s=s.GetY()+this._top,e.set(r,s,r+i,s+t)}_SetQuadMapChanged(){this._isQuadMapValid=!1}MaybeBuildQuadMap(){if(!this._isQuadMapValid){var t=this._sdkInst,s=t.GetSdkType(),i=t.GetWorldInfo(),r=t.GetTileWidth(),n=t.GetTileHeight(),a=t.GetCellWidth(),o=t.GetCellHeight(),h=this._left,l=this._top;if(!(0>=r||0>=n)){var c=Math.min(t.GetMapWidth(),Math.floor(i.GetWidth()/r));i=Math.min(t.GetMapHeight(),Math.floor(i.GetHeight()/n)),c-=h/r,i-=l/n,c>a&&(c=a),i>o&&(i=o),a=this._tiles,o=this._quads;for(var u=0,_=0;_<i;++_)for(var d=a[_],p=0;p<c;++p){var g=d[p];if(-1!==g){var m=void 0;u<o.length?m=o[u]:(m=e.New(e.Plugins.Tilemap.TileQuad),o.push(m)),m.Update(g,r,n,p,_,h,l,t),++u}}for(u<o.length&&e.truncateArray(o,u),o=null,u=!1,t=this._collisionRects,e.clearArray(t),_=0;_<i;++_){for(d=a[_],p=0;p<c;++p){g=d[p],m=s.GetTilePoly(g);const i=s.IsTilePolyEnabled(m);-1!==g&&i?!o||m||u?(o&&t.push(o),o=e.New(e.Plugins.Tilemap.TileCollisionRect),o.Update(g,m,r,n,p,_,h,l),u=!!m):o.ExtendRight(r):o&&(t.push(o),o=null,u=!1)}o&&(t.push(o),o=null,u=!1)}for(s=t.length,r=0;r<s;++r)if(h=t[r],!h.HasPoly())for(h=h.GetRect(),l=r+1;l<s;++l)c=t[l],i=c.GetRect(),i.getTop()<h.getBottom()||i.getTop()>h.getBottom()||i.getRight()>h.getRight()||i.getLeft()>h.getLeft()||c.HasPoly()||i.getLeft()!==h.getLeft()||i.getRight()!==h.getRight()||(t.splice(l,1),--s,h.setBottom(h.getBottom()+n),--l);this._isQuadMapValid=!0}}}SetTileAt(e,t,s){this._tiles[t][e]!==s&&(this._tiles[t][e]=s,this._isQuadMapValid=!1,this._sdkInst.SetTileChanged())}GetTilesArr(){return this._tiles}GetCollisionRects(){return this._collisionRects}Draw(e,t,s,i){const r=this._sdkInst,n=this._quads;for(let a=0,o=n.length;a<o;++a)n[a].Draw(e,t,s,i,r)}}}{const e=self.C3,t=Object.freeze([[0,0,0],[0,0,0],[0,0,0]]);e.Plugins.Tilemap.AutoTiling=class{constructor(t,s){this._sdkInst=t,this._sdkType=s,this._brushAdapterInstances=[null,null],this._brushAdapterConstructors=[e.Plugins.Tilemap.AutoTiling16,e.Plugins.Tilemap.AutoTiling47],this._probabilityTable=new e.ProbabilityTable}get AUTO_TILING_PATCH(){return t}get IGNORE_INDEX(){return-999}get FORCE_INDEX(){return-998}get EMPTY_INDEX(){return-1}get PAINT_MODE(){return 0}get ERASE_MODE(){return 1}GetSdkIntance(){return this._sdkInst}GetSdkType(){return this._sdkType}SetAutoTile(e,t,s){this._SetAutoTileMode(s,0),this._SetAutoTilePatch(e,t,this._GetAutoTilePatch(e,t,s))}EraseAutoTile(e,t,s){this._SetAutoTileMode(s,1),this._EraseTile(e,t),this._SetAutoTilePatch(e,t,this._GetAutoTilePatch(e,t,s))}GetTile(e,t){return this.GetSdkIntance().GetTileAt(e,t)}DoesTileExist(e,t,s){return e=this.GetTile(e,t),!!this.IsTileValid(e,!0,e,s)}IsTileValid(e,t,s,i){return-1===e?0:t&&-998===e?1:t&&i&&!this._IsTileIndexInBrush(s,i)?0:1}GetTileIndex(e,t,s,i){if(e=i.tileData[e],!e.length)return-1;if(1===e.length)return e[0][0];const r=this.GetTile(t,s);if(this.IsTileValid(r)&&e.some(e=>r===e[0]))return r;this._probabilityTable.Clear();for(let[t,s]of e)"number"!=typeof s&&(s=1),this._probabilityTable.AddItem(s,t);return this._probabilityTable.Sample()}_SetTile(e,t,s){-1!==e&&this.GetSdkIntance().SetTileAt(e,t,s)}_EraseTile(e,t){this.GetSdkIntance().SetTileAt(e,t,-1)}_IsTileIndexInBrush(e,t){for(const s of t.tileData)for(const[t]of s)if(t===e)return!0;return!1}_SetAutoTilePatch(e,t,s){s&&(this._SetTile(e-1,t-1,s[0][0]),this._SetTile(e,t-1,s[1][0]),this._SetTile(e+1,t-1,s[2][0]),this._SetTile(e-1,t,s[0][1]),this._SetTile(e,t,s[1][1]),this._SetTile(e+1,t,s[2][1]),this._SetTile(e-1,t+1,s[0][2]),this._SetTile(e,t+1,s[1][2]),this._SetTile(e+1,t+1,s[2][2]))}_GetBrushType(e){return this.GetSdkType().GetBrushData(e).type}_MaybeCreateBrushAdapter(e){e=this._GetBrushType(e),this._brushAdapterInstances[e]||(this._brushAdapterInstances[e]=new this._brushAdapterConstructors[e](this))}_SetAutoTileMode(e,t){this._MaybeCreateBrushAdapter(e),e=this._GetBrushType(e),this._brushAdapterInstances[e]&&this._brushAdapterInstances[e].SetMode(t)}_GetAutoTilePatch(e,t,s){if(this._MaybeCreateBrushAdapter(s),s=this.GetSdkType().GetBrushData(s),this._brushAdapterInstances[s.type])return this._brushAdapterInstances[s.type].BuildPatch(e,t,s)}}}self.C3.Plugins.Tilemap.AutoTiling16=class{constructor(e){this._auto=e,this._mode=e.PAINT_MODE}SetMode(e){this._mode=e}BuildPatch(e,t,s){return this._Build4BitAutoTilePatch(e,t,s)}_Build4BitAutoTilePatch(e,t,s){const i=this._mode===this._auto.PAINT_MODE?this._4BitAutoTiling(e,t,void 0,s):this._auto.EMPTY_INDEX,r=this._Get4BitAutoTile(e,t-1,"s",s),n=this._Get4BitAutoTile(e-1,t,"e",s),a=this._Get4BitAutoTile(e+1,t,"w",s),o=this._Get4BitAutoTile(e,t+1,"n",s),h=this._auto.AUTO_TILING_PATCH;return h[0][0]=this._auto.IGNORE_INDEX,h[1][0]=this._Get4BitTileIndex(r,e,t-1,s),h[2][0]=this._auto.IGNORE_INDEX,h[0][1]=this._Get4BitTileIndex(n,e-1,t,s),h[1][1]=this._Get4BitTileIndex(i,e,t,s),h[2][1]=this._Get4BitTileIndex(a,e+1,t,s),h[0][2]=this._auto.IGNORE_INDEX,h[1][2]=this._Get4BitTileIndex(o,e,t+1,s),h[2][2]=this._auto.IGNORE_INDEX,h}_Get4BitAutoTile(e,t,s,i){return this._auto.DoesTileExist(e,t,i)?this._4BitAutoTiling(e,t,s,i):this._auto.IGNORE_INDEX}_4BitAutoTiling(e,t,s,i){this._mode===this._auto.ERASE_MODE&&(s=void 0);const r=this._auto.GetTile(e,t-1);var n=this._auto.GetTile(e-1,t),a=this._auto.GetTile(e+1,t);e=this._auto.GetTile(e,t+1);const o="w"===s?this._auto.FORCE_INDEX:n,h="e"===s?this._auto.FORCE_INDEX:a;return t="s"===s?this._auto.FORCE_INDEX:e,s=this._auto.IsTileValid("n"===s?this._auto.FORCE_INDEX:r,!0,r,i),n=this._auto.IsTileValid(o,!0,n,i),a=this._auto.IsTileValid(h,!0,a,i),i=this._auto.IsTileValid(t,!0,e,i),1*s+2*n+4*a+8*i}_Get4BitTileIndex(e,t,s,i){return e===this._auto.IGNORE_INDEX||e===this._auto.EMPTY_INDEX?e:this._auto.GetTileIndex(e,t,s,i)}};{const e=self.C3,t=new Map([[2,1],[8,2],[10,3],[11,4],[16,5],[18,6],[22,7],[24,8],[26,9],[27,10],[30,11],[31,12],[64,13],[66,14],[72,15],[74,16],[75,17],[80,18],[82,19],[86,20],[88,21],[90,22],[91,23],[94,24],[95,25],[104,26],[106,27],[107,28],[120,29],[122,30],[123,31],[126,32],[127,33],[208,34],[210,35],[214,36],[216,37],[218,38],[219,39],[222,40],[223,41],[248,42],[250,43],[251,44],[254,45],[255,46],[0,47]]);e.Plugins.Tilemap.AutoTiling47=class{constructor(e){this._auto=e,this._mode=e.PAINT_MODE}SetMode(e){this._mode=e}BuildPatch(e,t,s){return this._Build8BitAutoTilePatch(e,t,s)}_Build8BitAutoTilePatch(e,t,s){const i=this._mode===this._auto.PAINT_MODE?this._8BitAutoTiling(e,t,void 0,s):this._auto.EMPTY_INDEX,r=this._Get8BitAutoTile(e-1,t-1,"se",s),n=this._Get8BitAutoTile(e,t-1,"s",s),a=this._Get8BitAutoTile(e+1,t-1,"sw",s),o=this._Get8BitAutoTile(e-1,t,"e",s),h=this._Get8BitAutoTile(e+1,t,"w",s),l=this._Get8BitAutoTile(e-1,t+1,"ne",s),c=this._Get8BitAutoTile(e,t+1,"n",s),u=this._Get8BitAutoTile(e+1,t+1,"nw",s),_=this._auto.AUTO_TILING_PATCH;return _[0][0]=this._Get8BitTileIndex(r,e-1,t-1,s),_[1][0]=this._Get8BitTileIndex(n,e,t-1,s),_[2][0]=this._Get8BitTileIndex(a,e+1,t-1,s),_[0][1]=this._Get8BitTileIndex(o,e-1,t,s),_[1][1]=this._Get8BitTileIndex(i,e,t,s),_[2][1]=this._Get8BitTileIndex(h,e+1,t,s),_[0][2]=this._Get8BitTileIndex(l,e-1,t+1,s),_[1][2]=this._Get8BitTileIndex(c,e,t+1,s),_[2][2]=this._Get8BitTileIndex(u,e+1,t+1,s),_}_Get8BitAutoTile(e,t,s,i){return this._auto.DoesTileExist(e,t,i)?this._8BitAutoTiling(e,t,s,i):this._auto.IGNORE_INDEX}_8BitAutoTiling(e,t,s,i){this._mode===this._auto.ERASE_MODE&&(s=void 0);const r=this._auto.GetTile(e,t-1);var n=this._auto.GetTile(e-1,t),a=this._auto.GetTile(e+1,t),o=this._auto.GetTile(e,t+1),h=this._auto.GetTile(e-1,t-1),l=this._auto.GetTile(e+1,t-1),c=this._auto.GetTile(e-1,t+1);e=this._auto.GetTile(e+1,t+1);const u="w"===s?this._auto.FORCE_INDEX:n,_="e"===s?this._auto.FORCE_INDEX:a,d="s"===s?this._auto.FORCE_INDEX:o,p="nw"===s?this._auto.FORCE_INDEX:h,g="ne"===s?this._auto.FORCE_INDEX:l,m="sw"===s?this._auto.FORCE_INDEX:c;return t="se"===s?this._auto.FORCE_INDEX:e,s=this._auto.IsTileValid("n"===s?this._auto.FORCE_INDEX:r,!0,r,i),n=this._auto.IsTileValid(u,!0,n,i),a=this._auto.IsTileValid(_,!0,a,i),o=this._auto.IsTileValid(d,!0,o,i),h=s&&n?this._auto.IsTileValid(p,!0,h,i):0,l=s&&a?this._auto.IsTileValid(g,!0,l,i):0,c=o&&n?this._auto.IsTileValid(m,!0,c,i):0,i=o&&a?this._auto.IsTileValid(t,!0,e,i):0,1*h+2*s+4*l+8*n+16*a+32*c+64*o+128*i}_Get8BitTileIndex(e,s,i,r){return e===this._auto.IGNORE_INDEX||e===this._auto.EMPTY_INDEX?e:this._auto.GetTileIndex(t.get(e),s,i,r)}}}{const e=self.C3;e.Plugins.gamepad=class extends e.SDKPluginBase{constructor(e){super(e),this._isSupported=!1,this._runtime.AddLoadPromise(this._runtime.PostComponentMessageToDOMAsync("gamepad","is-supported").then(e=>this._isSupported=!!e))}Release(){super.Release()}IsSupported(){return this._isSupported}}}{const e=self.C3;e.Plugins.gamepad.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;class t{constructor(e,t){this._index=e,this._id=t,this._state=new s,this._oldState=new s,this._buttonsPressed=[],this._buttonsReleased=[]}GetID(){return this._id}Update(t,s){const i=this._oldState;this._oldState=this._state,this._state=i,this._state.Update(t,s),e.resizeArray(this._buttonsPressed,this._state.GetButtonCount(),!1),e.resizeArray(this._buttonsReleased,this._state.GetButtonCount(),!1);for(let e=0,i=this._state.GetButtonCount();e<i;++e)t=this._oldState.GetButtonAt(e),s=this._state.GetButtonAt(e),.5<=s&&.5>t&&(this._buttonsPressed[e]=!0),.5>s&&.5<=t&&(this._buttonsReleased[e]=!0)}GetButtonCount(){return this._state.GetButtonCount()}GetAxisCount(){return this._state.GetAxisCount()}HasButtonBecomePressed(e){return e=Math.floor(e),!(0>e||e>=this._buttonsPressed.length)&&this._buttonsPressed[e]}HasButtonBecomeReleased(e){return e=Math.floor(e),!(0>e||e>=this._buttonsReleased.length)&&this._buttonsReleased[e]}ResetButtonPressAndReleaseFlags(){this._buttonsPressed.fill(!1),this._buttonsReleased.fill(!1)}GetButtonAt(e){return this._state.GetButtonAt(e)}IsButtonDown(e){return.5<=this._state.GetButtonAt(e)}GetAxisAt(e){return this._state.GetAxisAt(e)}}class s{constructor(){this._buttons=[],this._axes=[]}Update(t,s){const i=this._buttons;let r=0;for(let e=t.length;r<e;++r){const e=t[r];r===i.length?i.push(e.value):i[r]=e.value}r<i.length&&e.truncateArray(i,r),e.shallowAssignArray(this._axes,s)}GetButtonCount(){return this._buttons.length}GetAxisCount(){return this._axes.length}GetButtonAt(e){return e=Math.floor(e),0>e||e>=this._buttons.length?0:this._buttons[e]}GetAxisAt(e){return e=Math.floor(e),0>e||e>=this._axes.length?0:this._axes[e]}}e.Plugins.gamepad.Instance=class extends e.SDKInstanceBase{constructor(t,s){super(t,"gamepad"),this._deadZone=25,this._lastButton=0,this._lastIndex=-1,this._gamepads=new Map,s&&(this._deadZone=s[0]),this.AddDOMMessageHandler("gamepad-connected",e=>this._OnGamepadConnected(e)),this.AddDOMMessageHandler("gamepad-disconnected",e=>this._OnGamepadDisconnected(e)),this.AddDOMMessageHandler("input-update",e=>this._OnInputUpdate(e)),t=this.GetRuntime().Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"tick2",()=>this._OnTick2())),this.PostToDOM("ready")}Release(){super.Release()}_OnGamepadConnected(s){const i=s.index;this._lastIndex=i,s=s.id,this._gamepads.has(i)||(this._gamepads.set(i,new t(i,s)),this.Trigger(e.Plugins.gamepad.Cnds.OnGamepadConnected),this._lastIndex=-1)}_OnGamepadDisconnected(t){this._lastIndex=t=t.index,this.Trigger(e.Plugins.gamepad.Cnds.OnGamepadDisconnected),this._gamepads.delete(t),this._lastIndex=-1}_OnInputUpdate(e){for(const t of e)this._OnGamepadInputUpdate(t)}_OnGamepadInputUpdate(e){var t=e.index;this._gamepads.has(t)||this._OnGamepadConnected(e),t=this._gamepads.get(t),t.Update(e.buttons,e.axes);for(let e=0,s=t.GetButtonCount();e<s;++e)t.HasButtonBecomePressed(e)&&(this._lastButton=e)}_GetGamepadByIndex(e){return this._gamepads.get(Math.floor(e))||null}_OnTick2(){for(const e of this._gamepads.values())e.ResetButtonPressAndReleaseFlags()}GetDebuggerProperties(){return[{title:"plugins.gamepad.name",properties:[{name:"plugins.gamepad.debugger.last-button",value:this._lastButton}]}]}}}{const e=self.C3;e.Plugins.gamepad.Cnds={SupportsGamepad(){return this.GetPlugin().IsSupported()},OnGamepadConnected:()=>!0,OnGamepadDisconnected:()=>!0,IsButtonDown(e,t){return e=this._GetGamepadByIndex(e),!!e&&((e=e.IsButtonDown(t))&&(this._lastButton=t),e)},OnButtonDown(e,t){return e=this._GetGamepadByIndex(e),!!e&&((e=e.HasButtonBecomePressed(t))&&(this._lastButton=t),e)},OnButtonUp(e,t){return e=this._GetGamepadByIndex(e),!!e&&((e=e.HasButtonBecomeReleased(t))&&(this._lastButton=t),e)},HasGamepads(){return 0<this._gamepads.size},CompareAxis(t,s,i,r){s=Math.floor(s);const n=this._GetGamepadByIndex(t);return!!n&&(t=n.GetAxisAt(s),s=0==s%2?n.GetAxisAt(s+1):n.GetAxisAt(s-1),t*=100,Math.hypot(t,100*s)<=this._deadZone&&(t=0),e.compare(t,i,r))},OnAnyButtonDown(e){if(e=this._GetGamepadByIndex(e),!e)return!1;for(let t=0,s=e.GetButtonCount();t<s;++t)if(e.HasButtonBecomePressed(t))return this._lastButton=t,!0;return!1},OnAnyButtonUp(e){if(e=this._GetGamepadByIndex(e),!e)return!1;for(let t=0,s=e.GetButtonCount();t<s;++t)if(e.HasButtonBecomeReleased(t))return this._lastButton=t,!0;return!1},IsButtonIndexDown(e,t){return t=Math.floor(t),e=this._GetGamepadByIndex(e),!!e&&((e=e.IsButtonDown(t))&&(this._lastButton=t),e)},OnButtonIndexDown(e,t){return t=Math.floor(t),e=this._GetGamepadByIndex(e),!!e&&((e=e.HasButtonBecomePressed(t))&&(this._lastButton=t),e)},OnButtonIndexUp(e,t){return t=Math.floor(t),e=this._GetGamepadByIndex(e),!!e&&((e=e.HasButtonBecomeReleased(t))&&(this._lastButton=t),e)}}}{const e=self.C3;e.Plugins.gamepad.Acts={Vibrate(t,s,i,r){this.PostToDOM("vibrate",{index:t,duration:s,weakMag:e.clamp(i/100,0,1),strongMag:e.clamp(r/100,0,1)})},ResetVibrate(e){this.PostToDOM("reset-vibrate",{index:e})}}}self.C3.Plugins.gamepad.Exps={GamepadCount(){return this._gamepads.size},GamepadID(e){return(e=this._GetGamepadByIndex(e))?e.GetID():""},GamepadIndex(){return this._lastIndex},GamepadAxes(e){if(e=this._GetGamepadByIndex(e),!e)return"";let t="";for(let s=0,i=e.GetAxisCount();s<i;++s)t+=`Axis ${s}: ${Math.round(100*e.GetAxisAt(s))}\n`;return t},GamepadButtons(e){if(e=this._GetGamepadByIndex(e),!e)return"";let t="";for(let s=0,i=e.GetButtonCount();s<i;++s)t+=`Button ${s}: ${Math.round(100*e.GetButtonAt(s))}\n`;return t},RawButton(e,t){return(e=this._GetGamepadByIndex(e))?e.GetButtonAt(Math.floor(t)):0},RawAxis(e,t){return(e=this._GetGamepadByIndex(e))?e.GetAxisAt(Math.floor(t)):0},RawButtonCount(e){return(e=this._GetGamepadByIndex(e))?e.GetButtonCount():0},RawAxisCount(e){return(e=this._GetGamepadByIndex(e))?e.GetAxisCount():0},Button(e,t){return(e=this._GetGamepadByIndex(e))?100*e.GetButtonAt(Math.floor(t)):0},Axis(e,t){t=Math.floor(t);const s=this._GetGamepadByIndex(e);return s?(e=s.GetAxisAt(t),t=0==t%2?s.GetAxisAt(t+1):s.GetAxisAt(t-1),e*=100,Math.hypot(e,100*t)<=this._deadZone&&(e=0),e):0},LastButton(){return this._lastButton}};{const e=self.C3;e.Plugins.Keyboard=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Keyboard.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IKeyboardObjectType}};let t=null;function a(){return t.GetSingleGlobalInstance().GetSdkInstance()}self.IKeyboardObjectType=class extends self.IObjectClass{constructor(e){super(e),t=e,e.GetRuntime()._GetCommonScriptInterfaces().keyboard=this}isKeyDown(e){const t=a();if("string"==typeof e)return t.IsKeyDown(e);if("number"==typeof e)return t.IsKeyCodeDown(e);throw new TypeError("expected string or number")}}}{const e=self.C3;e.Plugins.Keyboard.Instance=class extends e.SDKInstanceBase{constructor(t,s){super(t),this._keysDownByString=new Set,this._keysDownByWhich=new Set,this._triggerWhich=0,this._triggerTypedKey=this._triggerString="",t=this.GetRuntime().Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"keydown",e=>this._OnKeyDown(e.data)),e.Disposable.From(t,"keyup",e=>this._OnKeyUp(e.data)),e.Disposable.From(t,"window-blur",()=>this._OnWindowOrKeyboardBlur()),e.Disposable.From(t,"keyboard-blur",()=>this._OnWindowOrKeyboardBlur()))}Release(){super.Release()}_OnKeyDown(t){const s=t.which,i=t.code||s.toString();t=t.key,this._keysDownByString.has(i)||(this._keysDownByString.add(i),this._keysDownByWhich.add(s),this._triggerString=i,this._triggerWhich=s,this._triggerTypedKey=t,this.Trigger(e.Plugins.Keyboard.Cnds.OnAnyKey),this.Trigger(e.Plugins.Keyboard.Cnds.OnKey),this.Trigger(e.Plugins.Keyboard.Cnds.OnLeftRightKeyPressed),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyCode))}_OnKeyUp(t){const s=t.which,i=t.code||s.toString();t=t.key,this._keysDownByString.delete(i),this._keysDownByWhich.delete(s),this._triggerString=i,this._triggerWhich=s,this._triggerTypedKey=t,this.Trigger(e.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnLeftRightKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyCodeReleased)}_OnWindowOrKeyboardBlur(){for(const t of this._keysDownByWhich)this._keysDownByWhich.delete(t),this._triggerWhich=t,this.Trigger(e.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyCodeReleased);this._keysDownByString.clear()}IsKeyDown(e){return this._keysDownByString.has(e)}IsKeyCodeDown(e){return this._keysDownByWhich.has(e)}SaveToJson(){return{tk:this._triggerWhich,tkk:this._triggerTypedKey}}LoadFromJson(e){this._triggerWhich=e.tk,e.hasOwnProperty("tkk")&&(this._triggerTypedKey=e.tkk)}GetDebuggerProperties(){return[{title:"plugins.keyboard.name",properties:[{name:"plugins.keyboard.debugger.last-key-code",value:this._triggerWhich},{name:"plugins.keyboard.debugger.last-key-string",value:e.Plugins.Keyboard.Exps.StringFromKeyCode(this._triggerWhich)},{name:"plugins.keyboard.debugger.last-typed-key",value:this._triggerTypedKey}]}]}}}{const e="ShiftLeft ShiftRight ControlLeft ControlRight AltLeft AltRight MetaLeft MetaRight".split(" ");self.C3.Plugins.Keyboard.Cnds={IsKeyDown(e){return this._keysDownByWhich.has(e)},OnKey(e){return this._triggerWhich===e},OnAnyKey:()=>!0,OnAnyKeyReleased:()=>!0,OnKeyReleased(e){return this._triggerWhich===e},IsKeyCodeDown(e){return e=Math.floor(e),this._keysDownByWhich.has(e)},OnKeyCode(e){return this._triggerWhich===e},OnKeyCodeReleased(e){return this._triggerWhich===e},OnLeftRightKeyPressed(t){return this._triggerString===e[t]},OnLeftRightKeyReleased(t){return this._triggerString===e[t]},IsLeftRightKeyDown(t){return this._keysDownByString.has(e[t])}}}self.C3.Plugins.Keyboard.Acts={};{function e(e){switch(e=Math.floor(e),e){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"";case 38:return"";case 39:return"";case 40:return"";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(e)}}self.C3.Plugins.Keyboard.Exps={LastKeyCode(){return this._triggerWhich},StringFromKeyCode:t=>e(t),TypedKey(){return this._triggerTypedKey}}}{const e=self.C3;e.Plugins.Mouse=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Mouse.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IMouseObjectType}};let t=null;function a(){return t.GetSingleGlobalInstance().GetSdkInstance()}self.IMouseObjectType=class extends self.IObjectClass{constructor(e){super(e),t=e,e.GetRuntime()._GetCommonScriptInterfaces().mouse=this}getMouseX(e){return a().GetMousePositionForLayer(e)[0]}getMouseY(e){return a().GetMousePositionForLayer(e)[1]}getMousePosition(e){return a().GetMousePositionForLayer(e)}isMouseButtonDown(e){return a().IsMouseButtonDown(e)}}}{const e=self.C3;e.Plugins.Mouse.Instance=class extends e.SDKInstanceBase{constructor(t,s){super(t,"mouse"),this._buttonMap=[!1,!1,!1],this._triggerDir=this._triggerType=this._triggerButton=this._mouseYcanvas=this._mouseXcanvas=0,this._hasPointerLock=!1,this._movementY=this._movementX=0,this.AddDOMMessageHandlers([["pointer-lock-change",e=>this._OnPointerLockChange(e)],["pointer-lock-error",e=>this._OnPointerLockError(e)]]),t=this.GetRuntime().Dispatcher(),
this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"pointermove",e=>this._OnPointerMove(e.data)),e.Disposable.From(t,"pointerdown",e=>this._OnPointerDown(e.data)),e.Disposable.From(t,"pointerup",e=>this._OnPointerUp(e.data)),e.Disposable.From(t,"dblclick",e=>this._OnDoubleClick(e.data)),e.Disposable.From(t,"wheel",e=>this._OnMouseWheel(e.data)),e.Disposable.From(t,"window-blur",()=>this._OnWindowBlur()))}Release(){super.Release()}_OnPointerDown(e){"mouse"===e.pointerType&&(this._mouseXcanvas=e.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=e.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(e.lastButtons,e.buttons))}_OnPointerMove(t){this._movementX=t.movementX,this._movementY=t.movementY,this.Trigger(e.Plugins.Mouse.Cnds.OnMovement),this._movementY=this._movementX=0,"mouse"===t.pointerType&&(this._mouseXcanvas=t.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=t.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(t.lastButtons,t.buttons))}_OnPointerUp(e){"mouse"===e.pointerType&&this._CheckButtonChanges(e.lastButtons,e.buttons)}_CheckButtonChanges(e,t){this._CheckButtonChange(e,t,1,0),this._CheckButtonChange(e,t,4,1),this._CheckButtonChange(e,t,2,2)}_CheckButtonChange(e,t,s,i){!(e&s)&&t&s?this._OnMouseDown(i):e&s&&!(t&s)&&this._OnMouseUp(i)}_OnMouseDown(t){this._buttonMap[t]=!0,this.Trigger(e.Plugins.Mouse.Cnds.OnAnyClick),this._triggerButton=t,this._triggerType=0,this.Trigger(e.Plugins.Mouse.Cnds.OnClick),this.Trigger(e.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseUp(t){this._buttonMap[t]&&(this._buttonMap[t]=!1,this._triggerButton=t,this.Trigger(e.Plugins.Mouse.Cnds.OnRelease))}_OnDoubleClick(t){this._triggerButton=t.button,this._triggerType=1,this.Trigger(e.Plugins.Mouse.Cnds.OnClick),this.Trigger(e.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseWheel(t){this._triggerDir=0>t.deltaY?1:0,this.Trigger(e.Plugins.Mouse.Cnds.OnWheel)}_OnWindowBlur(){for(let t=0,s=this._buttonMap.length;t<s&&this._buttonMap[t];++t)this._buttonMap[t]=!1,this._triggerButton=t,this.Trigger(e.Plugins.Mouse.Cnds.OnRelease)}GetMousePositionForLayer(e){const t=this._runtime.GetMainRunningLayout(),s=this._mouseXcanvas,i=this._mouseYcanvas;return void 0===e?t.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(s,i):(e=t.GetLayer(e))?e.CanvasCssToLayer(s,i):[0,0]}IsMouseButtonDown(e){return e=Math.floor(e),!!this._buttonMap[e]}_IsMouseOverCanvas(){return 0<=this._mouseXcanvas&&0<=this._mouseYcanvas&&this._mouseXcanvas<this._runtime.GetCanvasCssWidth()&&this._mouseYcanvas<this._runtime.GetCanvasCssHeight()}_OnPointerLockChange(e){this._UpdatePointerLockState(e["has-pointer-lock"])}_OnPointerLockError(t){this._UpdatePointerLockState(t["has-pointer-lock"]),this.Trigger(e.Plugins.Mouse.Cnds.OnPointerLockError)}_UpdatePointerLockState(t){this._hasPointerLock!==t&&((this._hasPointerLock=t)?this.Trigger(e.Plugins.Mouse.Cnds.OnPointerLocked):this.Trigger(e.Plugins.Mouse.Cnds.OnPointerUnlocked))}GetDebuggerProperties(){return[{title:"plugins.mouse.name",properties:[{name:"plugins.mouse.debugger.absolute-position",value:this._mouseXcanvas+","+this._mouseYcanvas},{name:"plugins.mouse.debugger.left-button",value:this._buttonMap[0]},{name:"plugins.mouse.debugger.middle-button",value:this._buttonMap[1]},{name:"plugins.mouse.debugger.right-button",value:this._buttonMap[2]}]},{title:"plugins.mouse.debugger.position-on-each-layer",properties:this._runtime.GetMainRunningLayout().GetLayers().map(e=>({name:"$"+e.GetName(),value:e.CanvasCssToLayer(this._mouseXcanvas,this._mouseYcanvas).join(", ")}))}]}}}{const e=self.C3;e.Plugins.Mouse.Cnds={OnClick(e,t){return this._triggerButton===e&&this._triggerType===t},OnAnyClick:()=>!0,IsButtonDown(e){return this._buttonMap[e]},OnRelease(e){return this._triggerButton===e},IsOverObject(t){if(!this._IsMouseOverCanvas())return!1;const s=this._runtime.GetCurrentCondition().IsInverted(),i=this._mouseXcanvas,r=this._mouseYcanvas;return e.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(t,i,r,s),s)},OnObjectClicked(e,t,s){return!(e!==this._triggerButton||t!==this._triggerType||!this._IsMouseOverCanvas())&&(e=this._mouseXcanvas,t=this._mouseYcanvas,this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(s,e,t,!1))},OnWheel(e){return this._triggerDir===e},OnPointerLocked:()=>!0,OnPointerUnlocked:()=>!0,OnPointerLockError:()=>!0,HasPointerLock(){return this._hasPointerLock},OnMovement:()=>!0}}{const e=self.C3;let t=null;const s="auto pointer text crosshair move help wait none".split(" ");e.Plugins.Mouse.Acts={SetCursor(e){e=s[e],t!==e&&(t=e,this.PostToDOM("cursor",e))},SetCursorSprite(s){if(!e.Platform.IsMobile&&s&&(s=s.GetFirstPicked())){var i=s.GetWorldInfo(),r=s.GetCurrentImageInfo();i&&r&&t!==r&&(t=r,r.ExtractImageToCanvas().then(t=>e.CanvasToBlob(t)).then(e=>{e=`url(${URL.createObjectURL(e)}) ${Math.round(i.GetOriginX()*r.GetWidth())} ${Math.round(i.GetOriginY()*r.GetHeight())}, auto`,this.PostToDOM("cursor",""),this.PostToDOM("cursor",e)}))}},RequestPointerLock(){this._PostToDOMMaybeSync("request-pointer-lock")},ReleasePointerLock(){this.PostToDOM("release-pointer-lock")}}}self.C3.Plugins.Mouse.Exps={X(e){return this.GetMousePositionForLayer(e)[0]},Y(e){return this.GetMousePositionForLayer(e)[1]},AbsoluteX(){return this._mouseXcanvas},AbsoluteY(){return this._mouseYcanvas},MovementX(){return this._movementX},MovementY(){return this._movementY}};{const e=self.C3;e.Plugins.Touch=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3,t=self.C3X;e.Plugins.Touch.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.ITouchObjectType}};let s=null;function c(){return s.GetSingleGlobalInstance().GetSdkInstance()}self.ITouchObjectType=class extends self.IObjectClass{constructor(e){super(e),s=e,e.GetRuntime()._GetCommonScriptInterfaces().touch=this}requestPermission(e){t.RequireString(e);const s=c();if("orientation"===e)return s._RequestPermission(0);if("motion"===e)return s._RequestPermission(1);throw Error("invalid type")}}}{const e=self.C3;e.Plugins.Touch.Instance=class extends e.SDKInstanceBase{constructor(t,s){super(t,"touch"),this._touches=new Map,this._isMouseDown=this._useMouseInput=!1,this._getTouchIndex=this._curTouchY=this._curTouchX=this._triggerPermission=this._triggerId=this._triggerIndex=this._accWithGZ=this._accWithGY=this._accWithGX=this._accZ=this._accY=this._accX=this._orientGamma=this._orientBeta=this._orientAlpha=this._orientCompassHeading=0,this._permissionPromises=[],s&&(this._useMouseInput=s[0]),this.AddDOMMessageHandler("permission-result",e=>this._OnPermissionResult(e)),t=this.GetRuntime().Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"pointerdown",e=>this._OnPointerDown(e.data)),e.Disposable.From(t,"pointermove",e=>this._OnPointerMove(e.data)),e.Disposable.From(t,"pointerup",e=>this._OnPointerUp(e.data,!1)),e.Disposable.From(t,"pointercancel",e=>this._OnPointerUp(e.data,!0)),e.Disposable.From(t,"deviceorientation",e=>this._OnDeviceOrientation(e.data)),e.Disposable.From(t,"deviceorientationabsolute",e=>this._OnDeviceOrientationAbsolute(e.data)),e.Disposable.From(t,"devicemotion",e=>this._OnDeviceMotion(e.data)),e.Disposable.From(t,"tick2",e=>this._OnTick2()))}Release(){this._touches.clear(),super.Release()}_OnPointerDown(t){if("mouse"===t.pointerType){if(!this._useMouseInput)return;this._isMouseDown=!0}const s=t.pointerId;if(!this._touches.has(s)){var i=t.pageX-this._runtime.GetCanvasClientX();t=t.pageY-this._runtime.GetCanvasClientY();var r=performance.now(),n=this._touches.size;this._triggerIndex=n,this._triggerId=s;var a=e.New(e.Plugins.Touch.TouchInfo);a.Init(r,i,t,s,n),this._touches.set(s,a),this.Trigger(e.Plugins.Touch.Cnds.OnNthTouchStart),this.Trigger(e.Plugins.Touch.Cnds.OnTouchStart),this._curTouchX=i,this._curTouchY=t,this.Trigger(e.Plugins.Touch.Cnds.OnTouchObject)}}_OnPointerMove(e){if("mouse"!==e.pointerType||this._isMouseDown){var t=this._touches.get(e.pointerId);if(t){var s=performance.now();if(!(2>s-t.GetTime())){var i=e.pageX-this._runtime.GetCanvasClientX(),r=e.pageY-this._runtime.GetCanvasClientY();t.Update(s,i,r,e.width,e.height,e.pressure)}}}}_OnPointerUp(t,s){if("mouse"===t.pointerType){if(!this._isMouseDown)return;this._isMouseDown=!1}const i=performance.now();t=t.pointerId;const r=this._touches.get(t);r&&(this._triggerIndex=r.GetStartIndex(),this._triggerId=r.GetId(),this.Trigger(e.Plugins.Touch.Cnds.OnNthTouchEnd),this.Trigger(e.Plugins.Touch.Cnds.OnTouchEnd),s||(s=r.ShouldTriggerTap(i),"single-tap"===s?(this.Trigger(e.Plugins.Touch.Cnds.OnTapGesture),this._curTouchX=r.GetX(),this._curTouchY=r.GetY(),this.Trigger(e.Plugins.Touch.Cnds.OnTapGestureObject)):"double-tap"===s&&(this.Trigger(e.Plugins.Touch.Cnds.OnDoubleTapGesture),this._curTouchX=r.GetX(),this._curTouchY=r.GetY(),this.Trigger(e.Plugins.Touch.Cnds.OnDoubleTapGestureObject))),r.Release(),this._touches.delete(t))}_RequestPermission(e){return this._PostToDOMMaybeSync("request-permission",{type:e}),new Promise((t,s)=>{this._permissionPromises.push({type:e,resolve:t,reject:s})})}_OnPermissionResult(t){const s=t.result,i=t.type;this._triggerPermission=i,t=this._permissionPromises.filter(e=>e.type===i);for(const e of t)e.resolve(s?"granted":"denied");this._permissionPromises=this._permissionPromises.filter(e=>e.type!==i),s?(this.Trigger(e.Plugins.Touch.Cnds.OnPermissionGranted),0===i?this._runtime.RequestDeviceOrientationEvent():this._runtime.RequestDeviceMotionEvent()):this.Trigger(e.Plugins.Touch.Cnds.OnPermissionDenied)}_OnDeviceOrientation(e){"number"==typeof e.webkitCompassHeading?this._orientCompassHeading=e.webkitCompassHeading:e.absolute&&(this._orientCompassHeading=e.alpha),this._orientAlpha=e.alpha,this._orientBeta=e.beta,this._orientGamma=e.gamma}_OnDeviceOrientationAbsolute(e){this._orientCompassHeading=e.alpha}_OnDeviceMotion(e){const t=e.acceleration;t&&(this._accX=t.x,this._accY=t.y,this._accZ=t.z),(e=e.accelerationIncludingGravity)&&(this._accWithGX=e.x,this._accWithGY=e.y,this._accWithGZ=e.z)}_OnTick2(){const t=performance.now();let s=0;for(const i of this._touches.values())i.GetTime()<=t-50&&i._SetLastTime(t),i.ShouldTriggerHold(t)&&(this._triggerIndex=i.GetStartIndex(),this._triggerId=i.GetId(),this._getTouchIndex=s,this.Trigger(e.Plugins.Touch.Cnds.OnHoldGesture),this._curTouchX=i.GetX(),this._curTouchY=i.GetY(),this.Trigger(e.Plugins.Touch.Cnds.OnHoldGestureObject),this._getTouchIndex=0),++s}_GetTouchByIndex(e){e=Math.floor(e);for(const t of this._touches.values()){if(0===e)return t;--e}return null}_IsClientPosOnCanvas(e,t){return 0<=e&&0<=t&&e<this._runtime.GetCanvasCssWidth()&&t<this._runtime.GetCanvasCssHeight()}GetDebuggerProperties(){return[{title:"plugins.touch.debugger.touches",properties:[...this._touches.values()].map(e=>({name:"$"+e.GetId(),value:e.GetX()+", "+e.GetY()}))}]}}}{const e=self.C3,t=[];e.Plugins.Touch.Cnds={OnTouchStart:()=>!0,OnTouchEnd:()=>!0,IsInTouch(){return 0<this._touches.size},OnTouchObject(e){return!(!e||!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1)},IsTouchingObject(s){if(!s)return!1;const i=s.GetCurrentSol();var r=i.GetInstances();for(const e of r){r=e.GetWorldInfo();const s=r.GetLayer();for(const i of this._touches.values()){if(!this._IsClientPosOnCanvas(i.GetX(),i.GetY()))continue;const[n,a]=s.CanvasCssToLayer(i.GetX(),i.GetY(),r.GetTotalZElevation());if(r.ContainsPoint(n,a)){t.push(e);break}}}return!!t.length&&(i.SetArrayPicked(t),s.ApplySolToContainer(),e.clearArray(t),!0)},CompareTouchSpeed(t,s,i){return!!(t=this._GetTouchByIndex(t))&&e.compare(t.GetSpeed(),s,i)},OrientationSupported:()=>!0,MotionSupported:()=>!0,CompareOrientation(t,s,i){return this._runtime.RequestDeviceOrientationEvent(),e.compare(0===t?this._orientAlpha:1===t?this._orientBeta:this._orientGamma,s,i)},CompareAcceleration(t,s,i){return this._runtime.RequestDeviceMotionEvent(),e.compare(0===t?this._accWithGX:1===t?this._accWithGY:2===t?this._accWithGZ:3===t?this._accX:4===t?this._accY:this._accZ,s,i)},OnNthTouchStart(e){return e=Math.floor(e),e===this._triggerIndex},OnNthTouchEnd(e){return e=Math.floor(e),e===this._triggerIndex},HasNthTouch(e){return e=Math.floor(e),this._touches.size>=e+1},OnHoldGesture:()=>!0,OnTapGesture:()=>!0,OnDoubleTapGesture:()=>!0,OnHoldGestureObject(e){return!(!e||!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1)},OnTapGestureObject(e){return!(!e||!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1)},OnDoubleTapGestureObject(e){return!(!e||!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1)},OnPermissionGranted(e){return this._triggerPermission===e},OnPermissionDenied(e){return this._triggerPermission===e}}}self.C3.Plugins.Touch.Acts={RequestPermission(e){this._RequestPermission(e)}};{const e=self.C3;e.Plugins.Touch.Exps={TouchCount(){return this._touches.size},X(e){const t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!0):0},Y(e){const t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!1):0},XAt(e,t){return(e=this._GetTouchByIndex(e))?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YAt(e,t){return(e=this._GetTouchByIndex(e))?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},XForID(e,t){return(e=this._touches.get(e))?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YForID(e,t){return(e=this._touches.get(e))?e.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},AbsoluteX(){const e=this._GetTouchByIndex(0);return e?e.GetX():0},AbsoluteY(){const e=this._GetTouchByIndex(0);return e?e.GetY():0},AbsoluteXAt(e){return(e=this._GetTouchByIndex(e))?e.GetX():0},AbsoluteYAt(e){return(e=this._GetTouchByIndex(e))?e.GetY():0},AbsoluteXForID(e){return(e=this._touches.get(e))?e.GetX():0},AbsoluteYForID(e){return(e=this._touches.get(e))?e.GetY():0},SpeedAt(e){return(e=this._GetTouchByIndex(e))?e.GetSpeed():0},SpeedForID(e){return(e=this._touches.get(e))?e.GetSpeed():0},AngleAt(t){return(t=this._GetTouchByIndex(t))?e.toDegrees(t.GetAngle()):0},AngleForID(t){return(t=this._touches.get(t))?e.toDegrees(t.GetAngle()):0},CompassHeading(){return this._runtime.RequestDeviceOrientationEvent(),this._orientCompassHeading},Alpha(){return this._runtime.RequestDeviceOrientationEvent(),this._orientAlpha},Beta(){return this._runtime.RequestDeviceOrientationEvent(),this._orientBeta},Gamma(){return this._runtime.RequestDeviceOrientationEvent(),this._orientGamma},AccelerationXWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGX},AccelerationYWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGY},AccelerationZWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGZ},AccelerationX(){return this._runtime.RequestDeviceMotionEvent(),this._accX},AccelerationY(){return this._runtime.RequestDeviceMotionEvent(),this._accY},AccelerationZ(){return this._runtime.RequestDeviceMotionEvent(),this._accZ},TouchIndex(){return this._triggerIndex},TouchID(){return this._triggerId},WidthForID(e){return(e=this._touches.get(e))?e.GetWidth():0},HeightForID(e){return(e=this._touches.get(e))?e.GetHeight():0},PressureForID(e){return(e=this._touches.get(e))?e.GetPressure():0}}}{const e=self.C3;let t=-1e3,s=-1e3,i=-1e4;e.Plugins.Touch.TouchInfo=class extends e.DefendedBase{constructor(){super(),this._pressure=this._height=this._width=this._lastY=this._lastX=this._y=this._x=this._startY=this._startX=this._lastTime=this._time=this._startTime=this._startIndex=this._pointerId=0,this._isTooFarForHold=this._hasTriggeredHold=!1}Release(){}Init(e,t,s,i,r){this._pointerId=i,this._startIndex=r,this._startTime=this._lastTime=this._time=e,this._startX=t,this._startY=s,this._x=t,this._y=s,this._lastX=t,this._lastY=s}Update(t,s,i,r,n,a){this._lastTime=this._time,this._time=t,this._lastX=this._x,this._lastY=this._y,this._x=s,this._y=i,this._width=r,this._height=n,this._pressure=a,!this._isTooFarForHold&&15<=e.distanceTo(this._startX,this._startY,this._x,this._y)&&(this._isTooFarForHold=!0)}GetId(){return this._pointerId}GetStartIndex(){return this._startIndex}GetTime(){return this._time}_SetLastTime(e){this._lastTime=e}GetX(){return this._x}GetY(){return this._y}GetSpeed(){const t=e.distanceTo(this._x,this._y,this._lastX,this._lastY),s=(this._time-this._lastTime)/1e3;return 0<s?t/s:0}GetAngle(){return e.angleTo(this._lastX,this._lastY,this._x,this._y)}GetWidth(){return this._width}GetHeight(){return this._height}GetPressure(){return this._pressure}ShouldTriggerHold(t){return!this._hasTriggeredHold&&(500<=t-this._startTime&&!this._isTooFarForHold&&15>e.distanceTo(this._startX,this._startY,this._x,this._y)&&(this._hasTriggeredHold=!0))}ShouldTriggerTap(r){return this._hasTriggeredHold?"":333>=r-this._startTime&&!this._isTooFarForHold&&15>e.distanceTo(this._startX,this._startY,this._x,this._y)?666>=r-i&&25>e.distanceTo(t,s,this._x,this._y)?(s=t=-1e3,i=-1e4,"double-tap"):(t=this._x,s=this._y,i=r,"single-tap"):""}GetPositionForLayer(e,t,s){return void 0===t?e.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(this._x,this._y)[s?0:1]:(e=e.GetLayer(t))?e.CanvasCssToLayer(this._x,this._y)[s?0:1]:0}}}{const e=self.C3;e.Plugins.TiledBg=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;function b(e){switch(e){case 0:return"clamp-to-edge";case 2:return"mirror-repeat"}return"repeat"}e.Plugins.TiledBg.Type=class extends e.SDKTypeBase{constructor(e,t){super(e),this._wrapY=this._wrapX="repeat",t&&(this._wrapX=b(t[0]),this._wrapY=b(t[1]))}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling(),wrapX:this._wrapX,wrapY:this._wrapY})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}}}{const e=self.C3,t=self.C3X,s=e.New(e.Rect),i=e.New(e.Quad),r=e.New(e.Rect),n=e.New(e.Quad);e.Plugins.TiledBg.Instance=class extends e.SDKWorldInstanceBase{constructor(t,s){super(t),this._imageOffsetY=this._imageOffsetX=0,this._imageScaleY=this._imageScaleX=1,this._imageAngle=0,this._ownImageInfo=null,s&&(this.GetWorldInfo().SetVisible(!!s[0]),this._imageOffsetX=s[4],this._imageOffsetY=s[5],this._imageScaleX=s[6],this._imageScaleY=s[7],this._imageAngle=e.toRadians(s[8]))}Release(){this._ReleaseOwnImage(),super.Release()}_ReleaseOwnImage(){this._ownImageInfo&&(this._ownImageInfo.Release(),this._ownImageInfo=null)}CalculateTextureCoordsFor3DFace(e,t,s){var i=this.GetCurrentImageInfo();const n=i.GetWidth();i=i.GetHeight();const a=this._imageOffsetX/n,o=this._imageOffsetY/i,h=this._imageAngle;r.set(0,0,e/(n*this._imageScaleX),t/(i*this._imageScaleY)),r.offset(-a,-o),0===h?s.setFromRect(r):s.setFromRotatedRect(r,-h)}Draw(e){var t=this.GetCurrentImageInfo(),s=t.GetTexture();if(null!==s){e.SetTexture(s),s=t.GetWidth(),t=t.GetHeight();var i=this._imageOffsetX/s,n=this._imageOffsetY/t,a=this.GetWorldInfo();r.set(0,0,a.GetWidth()/(s*this._imageScaleX),a.GetHeight()/(t*this._imageScaleY)),r.offset(-i,-n),a.HasMesh()?this._DrawMesh(a,e):this._DrawStandard(a,e)}}_DrawStandard(e,t){let s=e.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&(s=e.PixelRoundQuad(s)),0===this._imageAngle?t.Quad3(s,r):(n.setFromRotatedRect(r,-this._imageAngle),t.Quad4(s,n))}_DrawMesh(e,t){const a=e.GetTransformedMesh();if(e.IsMeshChanged()){e.CalculateBbox(s,i,!1);let t=i;this._runtime.IsPixelRoundingEnabled()&&(t=e.PixelRoundQuad(t));let o=r;0!==this._imageAngle&&(n.setFromRotatedRect(r,-this._imageAngle),o=n),a.CalculateTransformedMesh(e.GetSourceMesh(),t,o),e.SetMeshChanged(!1)}a.Draw(t)}GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo()}IsOriginalSizeKnown(){return!0}GetTexture(){return this.GetCurrentImageInfo().GetTexture()}_SetMeshChanged(){this.GetWorldInfo().SetMeshChanged(!0)}_SetImageOffsetX(e){this._imageOffsetX!==e&&(this._imageOffsetX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetX(){return this._imageOffsetX}_SetImageOffsetY(e){this._imageOffsetY!==e&&(this._imageOffsetY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetY(){return this._imageOffsetY}_SetImageScaleX(e){this._imageScaleX!==e&&(this._imageScaleX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleX(){return this._imageScaleX}_SetImageScaleY(e){this._imageScaleY!==e&&(this._imageScaleY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleY(){return this._imageScaleY}_SetImageAngle(e){this._imageAngle!==e&&(this._imageAngle=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageAngle(){return this._imageAngle}GetPropertyValueByIndex(e){switch(e){case 4:return this._GetImageOffsetX();case 5:return this._GetImageOffsetY();case 6:return this._GetImageScaleX();case 7:return this._GetImageScaleY();case 8:return this._GetImageAngle()}}SetPropertyValueByIndex(e,t){switch(e){case 4:this._SetImageOffsetX(t);break;case 5:this._SetImageOffsetY(t);break;case 6:this._SetImageScaleX(t);break;case 7:this._SetImageScaleY(t);break;case 8:this._SetImageAngle(t)}}GetScriptInterfaceClass(){return self.ITiledBackgroundInstance}};const a=new WeakMap;self.ITiledBackgroundInstance=class extends self.IWorldInstance{constructor(){super(),a.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set imageOffsetX(e){t.RequireFiniteNumber(e),a.get(this)._SetImageOffsetX(e)}get imageOffsetX(){return a.get(this)._GetImageOffsetX()}set imageOffsetY(e){t.RequireFiniteNumber(e),a.get(this)._SetImageOffsetY(e)}get imageOffsetY(){return a.get(this)._GetImageOffsetY()}set imageScaleX(e){t.RequireFiniteNumber(e),a.get(this)._SetImageScaleX(e)}get imageScaleX(){return a.get(this)._GetImageScaleX()}set imageScaleY(e){t.RequireFiniteNumber(e),a.get(this)._SetImageScaleY(e)}get imageScaleY(){return a.get(this)._GetImageScaleY()}set imageAngle(e){t.RequireFiniteNumber(e),a.get(this)._SetImageAngle(e)}get imageAngle(){return a.get(this)._GetImageAngle()}set imageAngleDegrees(s){t.RequireFiniteNumber(s),a.get(this)._SetImageAngle(e.toRadians(s))}get imageAngleDegrees(){return e.toDegrees(a.get(this)._GetImageAngle())}get imageWidth(){return a.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return a.get(this).GetCurrentImageInfo().GetHeight()}}}self.C3.Plugins.TiledBg.Cnds={OnURLLoaded:()=>!0,OnURLFailed:()=>!0};{const e=self.C3;e.Plugins.TiledBg.Acts={SetImageOffsetX(e){this._SetImageOffsetX(e)},SetImageOffsetY(e){this._SetImageOffsetY(e)},SetImageScaleX(e){this._SetImageScaleX(e/100)},SetImageScaleY(e){this._SetImageScaleY(e/100)},SetImageAngle(t){this._SetImageAngle(e.toRadians(t))},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},async LoadURL(t,s){if(!this._ownImageInfo||this._ownImageInfo.GetURL()!==t){s=this._runtime;var i=e.New(e.ImageInfo);try{if(await i.LoadDynamicAsset(s,t),!i.IsLoaded())throw Error("image failed to load");if(this.WasReleased())return i.Release(),null;if(!await i.LoadStaticTexture(s.GetRenderer(),{sampling:this._runtime.GetSampling(),wrapX:"repeat",wrapY:"repeat"}))return}catch(t){return console.error("Load image from URL failed: ",t),void this.Trigger(e.Plugins.TiledBg.Cnds.OnURLFailed)}this.WasReleased()?i.Release():(this._ReleaseOwnImage(),this._ownImageInfo=i,s.UpdateRender(),await this.TriggerAsync(e.Plugins.TiledBg.Cnds.OnURLLoaded))}}}}{const e=self.C3;e.Plugins.TiledBg.Exps={ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},ImageOffsetX(){return this._imageOffsetX},ImageOffsetY(){return this._imageOffsetY},ImageScaleX(){return 100*this._imageScaleX},ImageScaleY(){return 100*this._imageScaleY},ImageAngle(){return e.toDegrees(this._imageAngle)}}}{const e=self.C3;e.Plugins.Timeline=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Timeline.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Plugins.Timeline.Instance=class extends e.SDKInstanceBase{constructor(e,t){super(e),this.GetRuntime().GetTimelineManager().SetPluginInstance(e)}Release(){super.Release()}}}{const e=self.C3;let t=null,s=null;e.Plugins.Timeline.Cnds={SetTriggerTimeline(e){t=e},GetTriggerTimeline:()=>t,SetTriggerKeyframe(e){s=e},GetTriggerKeyframe:()=>s,OnTimelineStarted:e=>t===e,OnTimelineStartedByName(s){const i=this._runtime.GetTimelineManager();for(const r of i.GetTimelinesByName(s))if(e.equalsNoCase(t.GetName(),r.GetName()))return!0;return!1},OnTimelineStartedByTags(e){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByTags(e))if(i.HasTags(t.GetTags()))return!0;return!1},OnAnyTimelineStarted:()=>!0,OnTimelineFinished:e=>t===e,OnTimelineFinishedByName(s){const i=this._runtime.GetTimelineManager();for(const r of i.GetTimelinesByName(s))if(e.equalsNoCase(t.GetName(),r.GetName()))return!0;return!1},OnTimelineFinishedByTags(e){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByTags(e))if(i.HasTags(t.GetTags()))return!0;return!1},OnAnyTimelineFinished:()=>!0,IsPlaying:e=>e.IsPlaying(),IsPlayingByName(e){const t=this._runtime.GetTimelineManager();for(const s of t.GetTimelinesByName(e))if(s.IsPlaying())return!0;return!1},IsPlayingByTags(e){const t=this._runtime.GetTimelineManager();for(const s of t.GetTimelinesByTags(e))if(s.IsPlaying())return!0;return!1},IsAnyPlaying(){return[...this._runtime.GetTimelineManager().GetTimelines()].some(e=>e.IsPlaying())},IsPaused:e=>e.IsPaused(),IsPausedByName(e){const t=this._runtime.GetTimelineManager();for(const s of t.GetTimelinesByName(e))if(s.IsPaused())return!0;return!1},IsPausedByTags(e){const t=this._runtime.GetTimelineManager();for(const s of t.GetTimelinesByTags(e))if(s.IsPaused())return!0;return!1},IsAnyPaused(){return[...this._runtime.GetTimelineManager().GetTimelines()].some(e=>e.IsPaused())},OnTimeSet:e=>t===e,OnTimeSetByName(e){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByName(e))if(t===i)return!0;return!1},OnTimeSetByTags(e){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByTags(e))if(t===i)return!0;return!1},OnAnyKeyframeReached:()=>!!s,OnKeyframeReached(e,t){if(!s||0===s.GetTags().length||!e)return!1;if(e=e?e.split(" "):[],0===t){for(const t of e)if(s.HasTag(t))return!0;return!1}for(const t of e)if(!s.HasTag(t))return!1;return!0}}}{const e=self.C3,t=new Map,s=(e,t)=>{for(const s of e)t.SetTrackInstance(s.trackId,s.instance)},i=()=>{const e=[];for(const[s,i]of t.entries()){const t=s.GetCurrentSol().GetInstances(),r=i.trackIds.length;for(let s=0;s<r;s++)t[i.startIndex+s]&&e.push({trackId:i.trackIds[s],instance:t[i.startIndex+s]});i.startIndex+=r}return e};e.Plugins.Timeline.Acts={async PlayTimeline(e,r,n){if(e){var a=this._runtime.GetTimelineManager(),o=[];if(t.size){let t=i();do{if(t.length){var h=a.GetTimelineOfTemplateForInstances(e,t);h||(h=a.CreateFromTemplate(e),h.ClearTrackInstances(),s(t,h)),h.SetTags(r),h.Play()&&o.push(h.GetPlayPromise()),t=i()}}while(t.length)}else e.SetTags(r),e.Play()&&o.push(e.GetPlayPromise());n||t.clear(),await Promise.all(o)}else n||t.clear()},async PlayTimelineByName(s,i){const r=this._runtime.GetTimelineManager(),n=[];for(const t of r.GetTimelinesByName(s))n.push(e.Plugins.Timeline.Acts.PlayTimeline.call(this,t,i,!0));t.clear(),await Promise.all(n)},async PlayAllTimelines(){const e=this._runtime.GetTimelineManager(),s=[];for(const t of e.GetTimelines())t.Play()&&s.push(t.GetPlayPromise());t.clear(),await Promise.all(s)},PauseTimeline(e){e&&e.Stop()},PauseTimelineByName(t){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByName(t))e.Plugins.Timeline.Acts.PauseTimeline.call(this,i)},PauseTimelineByTags(t){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByTags(t))e.Plugins.Timeline.Acts.PauseTimeline.call(this,i)},PauseAllTimelines(){const e=this._runtime.GetTimelineManager();for(const t of e.GetTimelines())t.Stop()},ResumeTimeline(e){e&&e.Resume()},ResumeTimelineByName(t){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByName(t))e.Plugins.Timeline.Acts.ResumeTimeline.call(this,i)},ResumeTimelineByTags(t){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByTags(t))e.Plugins.Timeline.Acts.ResumeTimeline.call(this,i)},ResumeAllTimelines(){const e=this._runtime.GetTimelineManager();for(const t of e.GetTimelines())t.Resume()},StopTimeline(e){e&&e.Reset()},StopTimelineByName(t){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByName(t))e.Plugins.Timeline.Acts.StopTimeline.call(this,i)},StopTimelineByTags(t){const s=this._runtime.GetTimelineManager();for(const i of s.GetTimelinesByTags(t))e.Plugins.Timeline.Acts.StopTimeline.call(this,i)},StopAllTimelines(){const e=this._runtime.GetTimelineManager();for(const t of e.GetTimelines())t.Reset()},SetTimelineTime(t,s){if(t)if(e.IsFiniteNumber(s))t.SetTime(s);else if(e.IsString(s)){const i=t.GetKeyframeWithTags(s);i?t.SetTime(i.GetTime()):e.Plugins.Timeline.Acts.SetTimelineTime.call(this,t,Number(s))}},SetTimelineTimeByName(t,s){const i=this._runtime.GetTimelineManager();for(const r of i.GetTimelinesByName(t))e.Plugins.Timeline.Acts.SetTimelineTime.call(this,r,s)},SetTimelineTimeByTags(t,s){const i=this._runtime.GetTimelineManager();for(const r of i.GetTimelinesByTags(t))e.Plugins.Timeline.Acts.SetTimelineTime.call(this,r,s)},SetTimelinePlaybackRate(e,t){e&&e.SetPlaybackRate(t)},SetTimelinePlaybackRateByName(t,s){const i=this._runtime.GetTimelineManager();for(const r of i.GetTimelinesByName(t))e.Plugins.Timeline.Acts.SetTimelinePlaybackRate.call(this,r,s)},SetTimelinePlaybackRateByTags(t,s){const i=this._runtime.GetTimelineManager();for(const r of i.GetTimelinesByTags(t))e.Plugins.Timeline.Acts.SetTimelinePlaybackRate.call(this,r,s)},SetInstance(e,s){t.has(e)||t.set(e,{startIndex:0,trackIds:[]}),t.get(e).trackIds.push(s)}}}{const e=self.C3;e.Plugins.Timeline.Exps={Time(e){const t=this._runtime.GetTimelineManager();for(const s of t.GetTimelinesByName(e))return s.GetTime();for(const s of t.GetTimelinesByTags(e))return s.GetTime();return 0},TotalTime(e){const t=this._runtime.GetTimelineManager();for(const s of t.GetTimelinesByName(e))return s.GetTotalTime();for(const s of t.GetTimelinesByTags(e))return s.GetTotalTime();return 0},Progress(e){const t=this._runtime.GetTimelineManager();for(const s of t.GetTimelinesByName(e))return s.GetTime()/s.GetTotalTime();for(const s of t.GetTimelinesByTags(e))return s.GetTime()/s.GetTotalTime();return 0},KeyframeTags(){const t=e.Plugins.Timeline.Cnds.GetTriggerKeyframe();return t?t.GetTags().join(" "):""},TimelineName(){const t=e.Plugins.Timeline.Cnds.GetTriggerTimeline();return t?t.GetName():""},TimelineTags(){const t=e.Plugins.Timeline.Cnds.GetTriggerTimeline();return t?t.GetStringTags():""},Value(e,t){const s=this._runtime.GetTimelineManager();for(const r of s.GetTimelinesByName(e)){var i=r.GetTrackByName(t);if(i){if(i=i.GetPropertyTrack("value"))return i.GetSourceAdapterValue()}else if((i=r.GetTrackById(t))&&(i=i.GetPropertyTrack("value")))return i.GetSourceAdapterValue()}for(const i of s.GetTimelinesByTags(e))if(e=i.GetTrackByName(t)){if(e=e.GetPropertyTrack("value"))return e.GetSourceAdapterValue()}else if((e=i.GetTrackById(t))&&(e=e.GetPropertyTrack("value")))return e.GetSourceAdapterValue();return 0}}}{const e=self.C3
;e.Plugins.PlatformInfo=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.PlatformInfo.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Plugins.PlatformInfo.Instance=class extends e.SDKInstanceBase{constructor(e,t){super(e,"platform-info"),this._windowOuterHeight=this._windowOuterWidth=this._screenHeight=this._screenWidth=0,this._safeAreaInset=[0,0,0,0],this._isWakeLockActive=this._supportsWakeLock=!1,this.AddDOMMessageHandlers([["window-resize",e=>this._OnWindowResize(e)],["wake-lock-acquired",e=>this._OnWakeLockAcquired(e)],["wake-lock-error",e=>this._OnWakeLockError(e)],["wake-lock-released",e=>this._OnWakeLockReleased(e)]]),navigator.connection&&navigator.connection.addEventListener("change",()=>this._OnNetworkChange()),this._runtime.AddLoadPromise(this.PostToDOMAsync("get-initial-state").then(e=>{this._screenWidth=e.screenWidth,this._screenHeight=e.screenHeight,this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._safeAreaInset=e.safeAreaInset,this._supportsWakeLock=e.supportsWakeLock}))}Release(){super.Release()}_OnWindowResize(e){this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._safeAreaInset=e.safeAreaInset}async _OnNetworkChange(){await this.TriggerAsync(e.Plugins.PlatformInfo.Cnds.OnNetworkChange)}async _OnWakeLockAcquired(){this._isWakeLockActive=!0,await this.TriggerAsync(e.Plugins.PlatformInfo.Cnds.OnWakeLockAcquired)}async _OnWakeLockError(){this._isWakeLockActive=!1,await this.TriggerAsync(e.Plugins.PlatformInfo.Cnds.OnWakeLockError)}async _OnWakeLockReleased(){this._isWakeLockActive=!1,await this.TriggerAsync(e.Plugins.PlatformInfo.Cnds.OnWakeLockReleased)}}}{const e=self.C3;e.Plugins.PlatformInfo.Cnds={IsOnMobile:()=>e.Platform.IsMobile,IsOnWindows:()=>"Windows"===e.Platform.OS,IsOnMacOS:()=>"Mac OS X"===e.Platform.OS,IsOnLinux:()=>"Linux"===e.Platform.OS,IsOnChromeOS:()=>"Chrome OS"===e.Platform.OS,IsOnAndroid:()=>"Android"===e.Platform.OS,IsOniOS:()=>"iOS"===e.Platform.OS,IsWebExport(){const e=this._runtime.GetExportType();return"html5"===e||"scirra-arcade"===e||"preview"===e||"instant-games"===e},IsCordovaExport(){return this._runtime.IsCordova()},IsNWjsExport(){return"nwjs"===this._runtime.GetExportType()},IsWindowsUWPExport(){return"windows-uwp"===this._runtime.GetExportType()},IsWindowsWebView2Export(){return"windows-webview2"===this._runtime.GetExportType()},IsMacOSWKWebView2Export(){return"macos-wkwebview"===this._runtime.GetExportType()},OnNetworkChange:()=>!0,OnWakeLockAcquired:()=>!0,OnWakeLockError:()=>!0,OnWakeLockReleased:()=>!0,IsWakeLockActive(){return this._isWakeLockActive},IsWakeLockSupported(){return this._supportsWakeLock}}}self.C3.Plugins.PlatformInfo.Acts={RequestWakeLock(){this._supportsWakeLock&&this._PostToDOMMaybeSync("request-wake-lock")},ReleaseWakeLock(){this._supportsWakeLock&&(this._isWakeLockActive=!1,this.PostToDOM("release-wake-lock"))}},self.C3.Plugins.PlatformInfo.Exps={Renderer(){let e;return e=this._runtime.GetWebGPURenderer()?"webgpu":"webgl"+this._runtime.GetWebGLRenderer().GetWebGLVersionNumber(),this._runtime.GetRenderer().HasMajorPerformanceCaveat()&&(e+="-software"),e},RendererDetail(){return this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},DevicePixelRatio:()=>self.devicePixelRatio,ScreenWidth(){return this._screenWidth},ScreenHeight(){return this._screenHeight},WindowInnerWidth(){return this._runtime.GetCanvasManager().GetLastWidth()},WindowInnerHeight(){return this._runtime.GetCanvasManager().GetLastHeight()},WindowOuterWidth(){return this._windowOuterWidth},WindowOuterHeight(){return this._windowOuterHeight},CanvasCssWidth(){return this._runtime.GetCanvasManager().GetCssWidth()},CanvasCssHeight(){return this._runtime.GetCanvasManager().GetCssHeight()},CanvasDeviceWidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},CanvasDeviceHeight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},Downlink:()=>navigator.connection&&navigator.connection.downlink||0,DownlinkMax:()=>navigator.connection&&navigator.connection.downlinkMax||0,ConnectionType:()=>navigator.connection&&navigator.connection.type||"unknown",ConnectionEffectiveType:()=>navigator.connection&&navigator.connection.effectiveType||"unknown",ConnectionRTT:()=>navigator.connection&&navigator.connection.rtt||0,HardwareConcurrency:()=>navigator.hardwareConcurrency||0,DeviceMemory:()=>navigator.deviceMemory||0,SafeAreaInsetTop(){return this._safeAreaInset[0]},SafeAreaInsetRight(){return this._safeAreaInset[1]},SafeAreaInsetBottom(){return this._safeAreaInset[2]},SafeAreaInsetLeft(){return this._safeAreaInset[3]}};{const e=self.C3;e.Plugins.AJAX=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.AJAX.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Plugins.AJAX.Instance=class extends e.SDKInstanceBase{constructor(e,t){super(e),this._curTag=this._lastData="",this._progress=0,this._timeout=-1,this._nextRequestHeaders=new Map,this._nextReponseBinaryData=null,this._nextRequestOverrideMimeType="",this._nwjsAppFolder=this._nwjsPath=this._nwjsFs=null,(this._isNWjs="nwjs"===this._runtime.GetExportType())&&(this._nwjsFs=require("fs"),this._nwjsPath=require("path"),this._nwjsAppFolder=this._nwjsPath.dirname((self.process||nw.process).execPath)+"\\")}Release(){super.Release()}async _TriggerError(t,s,i){console.error(`[Construct 3] AJAX request to '${s}' (tag '${t}') failed: `,i),this._curTag=t,await this.TriggerAsync(e.Plugins.AJAX.Cnds.OnAnyError),await this.TriggerAsync(e.Plugins.AJAX.Cnds.OnError)}async _TriggerComplete(t){this._curTag=t,await this.TriggerAsync(e.Plugins.AJAX.Cnds.OnAnyComplete),await this.TriggerAsync(e.Plugins.AJAX.Cnds.OnComplete)}async _OnProgress(t,s){s.lengthComputable&&(this._progress=s.loaded/s.total,this._curTag=t,await this.TriggerAsync(e.Plugins.AJAX.Cnds.OnProgress))}_OnError(e,t,s){if(this._isNWjs){var i=this._nwjsFs,r=this._nwjsAppFolder+t;i.existsSync(r)?i.readFile(r,{encoding:"utf8"},(s,i)=>{s?this._TriggerError(e,t,s):(this._lastData=i.replace(/\r\n/g,"\n"),this._TriggerComplete(e))}):this._TriggerError(e,t,s)}else this._TriggerError(e,t,s)}async _DoCordovaRequest(e,t){const s=this._runtime.GetAssetManager(),i=this._nextReponseBinaryData;this._nextReponseBinaryData=null;try{if(i){const e=await s.CordovaFetchLocalFileAsArrayBuffer(t);i.SetArrayBufferTransfer(e),this._lastData=""}else this._lastData=(await s.CordovaFetchLocalFileAsText(t)).replace(/\r\n/g,"\n");this._TriggerComplete(e)}catch(s){this._TriggerError(e,t,s)}}_DoRequest(e,t,s,i){return new Promise(r=>{const n=s=>{this._OnError(e,t,s),r()},a=this._nextReponseBinaryData;this._nextReponseBinaryData=null;try{const o=new XMLHttpRequest;o.onreadystatechange=(()=>{if(4===o.readyState){if(this._lastData=a?"":(o.responseText||"").replace(/\r\n/g,"\n"),400<=o.status)this._TriggerError(e,t,o.status+o.statusText);else{const t=this._lastData.length||a&&o.response instanceof ArrayBuffer;this._isNWjs&&!t||!this._isNWjs&&0===o.status&&!t||(a&&a.SetArrayBufferTransfer(o.response),this._TriggerComplete(e))}r()}}),o.onerror=n,o.ontimeout=n,o.onabort=n,o.onprogress=(t=>this._OnProgress(e,t)),o.open(s,t),0<=this._timeout&&void 0!==o.timeout&&(o.timeout=this._timeout),o.responseType=a?"arraybuffer":"text",i&&!this._nextRequestHeaders.has("Content-Type")&&("string"!=typeof i?o.setRequestHeader("Content-Type","application/octet-stream"):o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));for(const[e,t]of this._nextRequestHeaders)try{o.setRequestHeader(e,t)}catch(s){console.error(`[Construct 3] AJAX: Failed to set header '${e}: ${t}': `,s)}if(this._nextRequestHeaders.clear(),this._nextRequestOverrideMimeType){try{o.overrideMimeType(this._nextRequestOverrideMimeType)}catch(e){console.error("[Construct 3] AJAX: failed to override MIME type: ",e)}this._nextRequestOverrideMimeType=""}i?o.send(i):o.send()}catch(e){n(e)}})}GetDebuggerProperties(){return[{title:"plugins.ajax.debugger.title",properties:[{name:"plugins.ajax.debugger.last-data",value:this._lastData}]}]}SaveToJson(){return{lastData:this._lastData}}LoadFromJson(e){this._lastData=e.lastData,this._curTag="",this._progress=0}}}{const e=self.C3;e.Plugins.AJAX.Cnds={OnComplete(t){return e.equalsNoCase(this._curTag,t)},OnAnyComplete:()=>!0,OnError(t){return e.equalsNoCase(this._curTag,t)},OnAnyError:()=>!0,OnProgress(t){return e.equalsNoCase(this._curTag,t)}}}{const e=self.C3;e.Plugins.AJAX.Acts={async Request(t,s){this._runtime.IsCordova()&&e.IsRelativeURL(s)&&this._runtime.GetAssetManager().IsFileProtocol()?await this._DoCordovaRequest(t,s):this._runtime.IsPreview()&&e.IsRelativeURL(s)?(s=this._runtime.GetAssetManager().GetLocalUrlAsBlobUrl(s.toLowerCase()),await this._DoRequest(t,s,"GET",null)):await this._DoRequest(t,s,"GET",null)},async RequestFile(e,t){this._runtime.IsCordova()&&this._runtime.GetAssetManager().IsFileProtocol()?await this._DoCordovaRequest(e,t):await this._DoRequest(e,this._runtime.GetAssetManager().GetLocalUrlAsBlobUrl(t),"GET",null)},async Post(e,t,s,i){await this._DoRequest(e,t,i,s)},async PostBinary(e,t,s,i){s&&(s=s.GetFirstPicked(this._inst))&&(s=s.GetSdkInstance().GetArrayBufferReadOnly(),await this._DoRequest(e,t,i,s))},SetTimeout(e){this._timeout=1e3*e},SetHeader(e,t){this._nextRequestHeaders.set(e,t)},SetResponseBinary(e){e&&(e=e.GetFirstPicked(this._inst))&&(this._nextReponseBinaryData=e.GetSdkInstance())},OverrideMIMEType(e){this._nextRequestOverrideMimeType=e}}}self.C3.Plugins.AJAX.Exps={LastData(){return this._lastData},Progress(){return this._progress},Tag(){return this._curTag}};{const e=self.C3;e.Plugins.Arr=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Arr.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IInstance;function c(t,s,i){if(s<t.length)e.truncateArray(t,s);else if(s>t.length)if("function"==typeof i)for(var r=t.length;r<s;++r)t.push(i());else for(r=t.length;r<s;++r)t.push(i)}e.Plugins.Arr.Instance=class extends e.SDKInstanceBase{constructor(t,s){super(t),this._cx=10,this._cz=this._cy=1,this._arr=null,this._forX=[],this._forY=[],this._forZ=[],this._forDepth=-1,s&&(this._cx=s[0],this._cy=s[1],this._cz=s[2]),this._arr=e.MakeFilledArray(this._cx,()=>e.MakeFilledArray(this._cy,()=>e.MakeFilledArray(this._cz,0)))}Release(){this._arr=null,super.Release()}At(e,t,s){return e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),0<=e&&e<this._cx&&0<=t&&t<this._cy&&0<=s&&s<this._cz?this._arr[e][t][s]:0}Set(e,t,s,i){e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),0<=e&&e<this._cx&&0<=t&&t<this._cy&&0<=s&&s<this._cz&&(this._arr[e][t][s]=i)}SetSize(t,s,i){if(t=Math.floor(t),s=Math.floor(s),i=Math.floor(i),0>t&&(t=0),0>s&&(s=0),0>i&&(i=0),this._cx!==t||this._cy!==s||this._cz!==i){this._cx=t,this._cy=s,this._cz=i;var r=this._arr;c(r,t,()=>e.MakeFilledArray(s,()=>e.MakeFilledArray(i,0)));for(let n=0;n<t;++n){c(r[n],s,()=>e.MakeFilledArray(i,0));for(let e=0;e<s;++e)c(r[n][e],i,0)}}}GetWidth(){return this._cx}GetHeight(){return this._cy}GetDepth(){return this._cz}GetDebuggerProperties(){const e=[{title:"plugins.arr.debugger.array-properties.title",properties:[{name:"plugins.arr.properties.width.name",value:this._cx,onedit:e=>this.SetSize(e,this._cy,this._cz)},{name:"plugins.arr.properties.height.name",value:this._cy,onedit:e=>this.SetSize(this._cx,e,this._cz)},{name:"plugins.arr.properties.depth.name",value:this._cz,onedit:e=>this.SetSize(this._cx,this._cy,e)},{name:"plugins.arr.properties.elements.name",value:this._cx*this._cy*this._cz}]}],t=[];if(1===this._cy&&1===this._cz)for(let e=0;e<this._cx;++e)t.push({name:"$"+e,value:this._arr[e][0][0],onedit:t=>this._arr[e][0][0]=t});else for(let e=0;e<this._cx;++e)t.push({name:"$"+e,value:this._arr[e].toString()});return t.length&&e.push({title:"plugins.arr.debugger.array-data.title",properties:t}),e}GetAsJsonString(){return JSON.stringify({c2array:!0,size:[this._cx,this._cy,this._cz],data:this._arr})}SaveToJson(){return{size:[this._cx,this._cy,this._cz],data:this._arr}}LoadFromJson(e){const t=e.size;this._cx=t[0],this._cy=t[1],this._cz=t[2],this._arr=e.data}_GetForX(){return 0<=this._forDepth&&this._forDepth<this._forX.length?this._forX[this._forDepth]:0}_GetForY(){return 0<=this._forDepth&&this._forDepth<this._forY.length?this._forY[this._forDepth]:0}_GetForZ(){return 0<=this._forDepth&&this._forDepth<this._forZ.length?this._forZ[this._forDepth]:0}GetScriptInterfaceClass(){return self.IArrayInstance}};const i=new WeakMap;self.IArrayInstance=class extends s{constructor(){super(),i.set(this,s._GetInitInst().GetSdkInstance())}get width(){return i.get(this).GetWidth()}get height(){return i.get(this).GetHeight()}get depth(){return i.get(this).GetDepth()}setSize(e,s=1,r=1){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireFiniteNumber(r),i.get(this).SetSize(e,s,r)}getAt(e,s=0,r=0){return t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireFiniteNumber(r),i.get(this).At(e,s,r)}setAt(e,s,r=0,n=0){if(t.RequireFiniteNumber(s),t.RequireFiniteNumber(r),t.RequireFiniteNumber(n),"number"!=typeof e&&"string"!=typeof e)throw new TypeError("invalid type");i.get(this).Set(s,r,n,e)}}}{const e=self.C3;function b(e,t,s,i,r){e.PushCopySol(s),t.Retrigger(i,r),e.PopSol(s)}e.Plugins.Arr.Cnds={CompareX(t,s,i){return e.compare(this.At(t,0,0),s,i)},CompareXY(t,s,i,r){return e.compare(this.At(t,s,0),i,r)},CompareXYZ(t,s,i,r,n){return e.compare(this.At(t,s,i),r,n)},ArrForEach(e){const t=this._runtime,s=t.GetEventSheetManager(),i=t.GetCurrentEvent(),r=i.GetSolModifiers(),n=t.GetEventStack(),a=n.GetCurrentStackFrame(),o=n.Push(i),h=++this._forDepth,l=this._forX;var c=this._forY,u=this._forZ;const _=this._cx,d=this._cy;var p=this._cz;if(h===this._forX.length?(l.push(0),c.push(0),u.push(0)):(l[h]=0,c[h]=0,u[h]=0),t.SetDebuggingEnabled(!1),0===e)for(e=0;e<_;++e)for(let t=0;t<d;++t)for(let n=0;n<p;++n)l[h]=e,c[h]=t,u[h]=n,b(s,i,r,a,o);else if(1===e)for(u=0;u<_;++u)for(p=0;p<d;++p)l[h]=u,c[h]=p,b(s,i,r,a,o);else for(c=0;c<_;++c)l[h]=c,b(s,i,r,a,o);return t.SetDebuggingEnabled(!0),this._forDepth--,n.Pop(),!1},CompareCurrent(t,s){return e.compare(this.At(this._GetForX(),this._GetForY(),this._GetForZ()),t,s)},Contains(e){const t=this._cx,s=this._cy,i=this._cz,r=this._arr;for(let n=0;n<t;++n)for(let t=0;t<s;++t)for(let s=0;s<i;++s)if(r[n][t][s]===e)return!0;return!1},IsEmpty(){return 0===this._cx||0===this._cy||0===this._cz},CompareSize(t,s,i){let r=0;switch(t){case 0:r=this._cx;break;case 1:r=this._cy;break;case 2:r=this._cz}return e.compare(r,s,i)}}}{const e=self.C3;function b(e,t){return"number"==typeof e&&"number"==typeof t?e-t:(e=e.toString(),t=t.toString(),e<t?-1:e>t?1:0)}e.Plugins.Arr.Acts={Clear(e){const t=this._cx,s=this._cy,i=this._cz,r=this._arr;for(let n=0;n<t;++n)for(let t=0;t<s;++t)for(let s=0;s<i;++s)r[n][t][s]=e},SetSize(e,t,s){this.SetSize(e,t,s)},SetX(e,t){this.Set(e,0,0,t)},SetXY(e,t,s){this.Set(e,t,0,s)},SetXYZ(e,t,s,i){this.Set(e,t,s,i)},Push(t,s,i){var r=this._cx,n=this._cy;const a=this._cz,o=this._arr;if(0===i)r=e.MakeFilledArray(n,()=>e.MakeFilledArray(a,s)),0===t?o.push(r):o.unshift(r),this._cx++;else if(1===i){for(n=0;n<r;++n)i=e.MakeFilledArray(a,s),0===t?o[n].push(i):o[n].unshift(i);this._cy++}else{for(i=0;i<r;++i)for(let e=0;e<n;++e)0===t?o[i][e].push(s):o[i][e].unshift(s);this._cz++}},Pop(e,t){const s=this._cx;var i=this._cy,r=this._cz;const n=this._arr;if(0===t)0!==s&&(0===e?n.pop():n.shift(),this._cx--);else if(1===t){if(0!==i){for(i=0;i<s;++i)0===e?n[i].pop():n[i].shift();this._cy--}}else if(0!==r){for(t=0;t<s;++t)for(r=0;r<i;++r)0===e?n[t][r].pop():n[t][r].shift();this._cz--}},Reverse(e){const t=this._cx;var s=this._cy,i=this._cz;const r=this._arr;if(0!==t&&0!==s&&0!==i)if(0===e)r.reverse();else if(1===e)for(s=0;s<t;++s)r[s].reverse();else for(e=0;e<t;++e)for(i=0;i<s;++i)r[e][i].reverse()},Sort(e){const t=this._cx;var s=this._cy,i=this._cz;const r=this._arr;if(0!==t&&0!==s&&0!==i)if(0===e)r.sort((e,t)=>b(e[0][0],t[0][0]));else if(1===e)for(s=0;s<t;++s)r[s].sort((e,t)=>b(e[0],t[0]));else for(e=0;e<t;++e)for(i=0;i<s;++i)r[e][i].sort(b)},Delete(e,t){if(e=Math.floor(e),!(0>e)){var s=this._cx,i=this._cy,r=this._cz,n=this._arr;if(0===t)e>=s||(n.splice(e,1),this._cx--);else if(1===t){if(!(e>=i)){for(i=0;i<s;++i)n[i].splice(e,1);this._cy--}}else if(!(e>=r)){for(t=0;t<s;++t)for(r=0;r<i;++r)n[t][r].splice(e,1);this._cz--}}},Insert(t,s,i){if(s=Math.floor(s),!(0>s)){var r=this._cx,n=this._cy,a=this._cz,o=this._arr;if(0===i)s>r||(o.splice(s,0,e.MakeFilledArray(n,()=>e.MakeFilledArray(a,t))),this._cx++);else if(1===i){if(!(s>n)){for(n=0;n<r;++n)o[n].splice(s,0,e.MakeFilledArray(a,t));this._cy++}}else if(!(s>a)){for(i=0;i<r;++i)for(let e=0;e<n;++e)o[i][e].splice(s,0,t);this._cz++}}},JSONLoad(e){let t=null;try{t=JSON.parse(e)}catch(e){return void console.error("[Construct 3] Failed to parse JSON: ",e)}t.c2array&&(e=t.size,this._cx=e[0],this._cy=e[1],this._cz=e[2],this._arr=t.data)},JSONDownload(e){const t=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(t,e)}}}self.C3.Plugins.Arr.Exps={At(e,t,s){return this.At(e,t||0,s||0)},Width(){return this._cx},Height(){return this._cy},Depth(){return this._cz},CurX(){return this._GetForX()},CurY(){return this._GetForY()},CurZ(){return this._GetForZ()},CurValue(){return this.At(this._GetForX(),this._GetForY(),this._GetForZ())},Front(){return this.At(0,0,0)},Back(){return this.At(this._cx-1,0,0)},IndexOf(e){const t=this._arr;for(let s=0,i=this._cx;s<i;++s)if(t[s][0][0]===e)return s;return-1},LastIndexOf(e){const t=this._arr;for(let s=this._cx-1;0<=s;--s)if(t[s][0][0]===e)return s;return-1},AsJSON(){return this.GetAsJsonString()}};{const e=self.C3;e.Plugins.sliderbar=class extends e.SDKDOMPluginBase{constructor(e){super(e,"sliderbar"),this.AddElementMessageHandler("click",(e,t)=>e._OnClick(t)),this.AddElementMessageHandler("change",(e,t)=>e._OnChange(t)),this.AddElementMessageHandler("input",(e,t)=>e._OnInput(t))}Release(){super.Release()}}}{const e=self.C3;e.Plugins.sliderbar.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X;e.Plugins.sliderbar.Instance=class extends e.SDKDOMInstanceBase{constructor(e,t){super(e,"sliderbar"),this._min=this._value=0,this._max=100,this._step=1,this._title="",this._isEnabled=!0,this._id="",t&&(this._value=t[0],this._min=t[1],this._max=t[2],this._step=t[3],this._title=t[4],this.GetWorldInfo().SetVisible(t[5]),this._isEnabled=t[6],this._id=t[7]),this.CreateElement({id:this._id})}Release(){super.Release()}GetElementState(){return{value:this._value,min:this._min,max:this._max,step:this._step,title:this._title,isEnabled:this._isEnabled}}async _OnClick(t){this.DispatchScriptEvent("click",!0),await this.TriggerAsync(e.Plugins.sliderbar.Cnds.OnClicked)}async _OnChange(t){this._value=t.value,this.DispatchScriptEvent("change",!0),await this.TriggerAsync(e.Plugins.sliderbar.Cnds.OnChanged)}_OnInput(e){this._value=e.value}Draw(e){}_SetValue(e){this._value!==e&&(this._value=e,this.UpdateElementState())}_GetValue(){return this._value}_SetMaximum(e){this._max!==e&&(this._max=e,this.UpdateElementState())}_GetMaximum(){return this._max}_SetMinimum(e){this._min!==e&&(this._min=e,this.UpdateElementState())}_GetMinimum(){return this._min}_SetTooltip(e){this._title!==e&&(this._title=e,this.UpdateElementState())}_GetTooltip(){return this._title}_SetStep(e){this._step!==e&&(this._step=e,this.UpdateElementState())}_GetStep(){return this._step}_SetEnabled(e){e=!!e,this._isEnabled!==e&&(this._isEnabled=e,this.UpdateElementState())}_IsEnabled(){return this._isEnabled}SaveToJson(){return{v:this._value,min:this._min,max:this._max,s:this._step,t:this._title,e:this._isEnabled,id:this._id}}LoadFromJson(e){this._value=e.v,this._min=e.min,this._max=e.max,this._step=e.s,this._title=e.t,this._isEnabled=e.e,this._id=e.id,this.UpdateElementState()}GetPropertyValueByIndex(e){switch(e){case 0:return this._GetValue();case 1:return this._GetMinimum();case 2:return this._GetMaximum();case 3:return this._GetStep();case 4:return this._GetTooltip();case 6:return this._IsEnbled();case 7:return this._id}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetValue(t);break;case 1:this._SetMinimum(t);break;case 2:this._SetMaximum(t);break;case 3:this._SetStep(t);break;case 4:this._SetTooltip(t);break;case 6:this._SetEnabled(t);break;case 7:this._id!==t&&(this._id=t,this.UpdateElementState())}}GetDebuggerProperties(){return[{title:"plugins.sliderbar.name",properties:[{name:"plugins.sliderbar.properties.value.name",value:this._GetValue(),onedit:e=>this._SetValue(e)},{name:"plugins.sliderbar.properties.minimum.name",value:this._GetMinimum(),onedit:e=>this._SetMinimum(e)},{name:"plugins.sliderbar.properties.maximum.name",value:this._GetMaximum(),onedit:e=>this._SetMaximum(e)},{name:"plugins.sliderbar.properties.step.name",value:this._GetStep(),onedit:e=>this._SetStep(e)}]}]}GetScriptInterfaceClass(){return self.ISliderBarInstance}};const s=new WeakMap;self.ISliderBarInstance=class extends self.IDOMInstance{constructor(){super(),s.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set value(e){t.RequireFiniteNumber(e),s.get(this)._SetValue(e)}get value(){return s.get(this)._GetValue()}set maximum(e){t.RequireFiniteNumber(e),s.get(this)._SetMaximum(e)}get maximum(){return s.get(this)._GetMaximum()}set minimum(e){t.RequireFiniteNumber(e),s.get(this)._SetMinimum(e)}get minimum(){return s.get(this)._GetMinimum()}set step(e){t.RequireFiniteNumber(e),s.get(this)._SetStep(e)}get step(){return s.get(this)._GetStep()}set tooltip(e){t.RequireString(e),s.get(this)._SetTooltip(e)}get tooltip(){return s.get(this)._GetTooltip()}set isEnabled(e){s.get(this)._SetEnabled(e)}get isEnabled(){return s.get(this)._IsEnabled()}}}{const e=self.C3;e.Plugins.sliderbar.Cnds={OnClicked:()=>!0,OnChanged:()=>!0,CompareValue(t,s){return e.compare(this._GetValue(),t,s)}}}self.C3.Plugins.sliderbar.Acts={SetTooltip(e){this._SetTooltip(e)},SetValue(e){this._SetValue(e)},SetMaximum(e){this._SetMaximum(e)},SetMinimum(e){this._SetMinimum(e)},SetStep(e){this._SetStep(e)}},self.C3.Plugins.sliderbar.Exps={Value(){return this._GetValue()},Maximum(){return this._GetMaximum()},Minimum(){return this._GetMinimum()},Step(){return this._GetStep()}};{const e=self.C3;e.Behaviors.Tween=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Tween.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=e.Behaviors.Tween;t.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._allowMultiple=!1,this._enabled=!0,t&&(this._allowMultiple=!1,this._enabled=!!t[0]),this._activeTweens=new Map,this._disabledTweens=[],this._waitingForReleaseTweens=new Map,this._waitingForReleaseTweensJson=this._disabledTweensJson=this._activeTweensJson=this._finishingTween=null,this._finishingTweenName="",this._enabled&&this._StartTicking2(),this._afterLoad=(e=>this._OnAfterLoad(e)),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad)}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._finishingTween&&(this.ReleaseAndCompleteTween(this._finishingTween),this._finishingTween=null),this.ReleaseAndCompleteTweens(),this._tweens=null,this.ClearDisabledList(),this._disabledTweens=null,this._ReleaseWaitingTweens(),this._waitingForReleaseTweens=null,super.Release()}SetEnabled(e){(this._enabled=e)?this._StartTicking2():this._StopTicking2()}GetEnabled(){return this._enabled}AddToDisabledList(e){this._disabledTweens.push(e)}IsInDisabledList(e){return this._disabledTweens.includes(e)}ClearDisabledList(){e.clearArray(this._disabledTweens)}GetFinishingTween(){return this._finishingTween}IsInstanceValid(){const e=this.GetObjectInstance();return!!e&&!e.IsDestroyed()}GetTween(e,t,s=!1){if((t=t?this.PropertyTweens(t,s):this.AllTweens(s))&&t.length)for(const s of t)if(s.HasTags(e))return s}GetTweenIncludingWaitingForRelease(e,t){return this.GetTween(e,t,!0)}*GetTweens(e,t,s=!1){if((t=t?this.PropertyTweens(t,s):this.AllTweens(s))&&t.length)for(const s of t)s.HasTags(e)&&(yield s)}*GetTweensIncludingWaitingForRelease(e,t){yield*this.GetTweens(e,t,!0)}PropertyTweens(e,t){return t?(t=this._activeTweens.get(e),e=this._waitingForReleaseTweens.get(e),t||(t=[]),e||(e=[]),t.concat(e).filter(e=>e)):((e=this._activeTweens.get(e))||(e=[]),e.filter(e=>e))}AllTweens(e){if(e){e=[...this._activeTweens.values()].flat();const t=[...this._waitingForReleaseTweens.values()].flat();return e.concat(t).filter(e=>e)}return[...this._activeTweens.values()].flat().filter(e=>e)}AllTweensIncludingWaitingForRelease(){return this.AllTweens(!0)}SaveToJson(){return{s:!1,e:!!this._enabled,at:this._SaveActiveTweensToJson(),dt:this._SaveDisabledTweensToJson(),wt:this._SaveWaitingForReleaseTweensToJson(),ft:this._SaveFinishingTweenToJson()}}LoadFromJson(e){e&&(this._activeTweensJson=e.at,this._disabledTweensJson=e.dt,this._waitingForReleaseTweensJson=e.wt,this._finishingTweenName=e.ft,this._allowMultiple=!1,this._enabled=!!e.e)}_OnAfterLoad(t){if(t=this.GetRuntime().GetTimelineManager(),this._PopulateTweenMap(this._activeTweensJson,this._activeTweens,t),this._disabledTweensJson){e.clearArray(this._disabledTweens);for(const e of this._disabledTweensJson)this._PopulateTweenArray(this._disabledTweens,e,t)}this._PopulateTweenMap(this._waitingForReleaseTweensJson,this._waitingForReleaseTweens,t),this._finishingTween=this._GetTween(this._finishingTweenName,t),this._enabled?this._StartTicking2():this._StopTicking2()}_PopulateTweenMap(t,s,i){if(t)for(const n in t){let a=s.get(n);a?e.clearArray(a):a=[];var r=t[n];for(const t of r)this._PopulateTweenArray(a,t.name,i)?this._LoadTweenFromJson(t.name,t,i):(r=e.TweenState.Build({runtime:this.GetRuntime(),json:t}),r.AddCompletedCallback(e=>this._FinishTriggers(e)),i.AddScheduledTimeline(r),this._PopulateTweenArray(a,r,i));s.set(n,a)}}_GetTween(e,t){return t.GetScheduledOrPlayingTimelineByName(e)}_PopulateTweenArray(e,t,s){return"string"!=typeof t?!!e.push(t):!!(t=this._GetTween(t,s))&&!!e.push(t)}_LoadTweenFromJson(e,t,s){"string"==typeof e?(e=this._GetTween(e,s))&&e._LoadFromJson(t):e._LoadFromJson(t)}_SaveActiveTweensToJson(){const e={};for(const[t,s]of this._activeTweens)e[t]=s.map(e=>e._SaveToJson());return e}_SaveDisabledTweensToJson(){return this._disabledTweens.map(e=>e.GetName())}_SaveWaitingForReleaseTweensToJson(){const e={};for(const[t,s]of this._waitingForReleaseTweens)e[t]=s.map(e=>e._SaveToJson());return e}_SaveFinishingTweenToJson(){return this._finishingTween?this._finishingTween.GetName():""}Tick2(){this._ReleaseWaitingTweens()}CreateTween(s){var i=t.Config.GetPropertyTracksConfig(s.property,s.startValue,s.endValue,s.ease,s.resultMode,this.GetObjectInstance());const r=t.Maps.GetPropertyFromIndex(s.property);return t.Maps.IsValueId(r)||this.ReleaseTweens(s.property),i=e.TweenState.Build({runtime:this.GetRuntime(),id:r,tags:s.tags,time:s.time,instance:this.GetObjectInstance(),releaseOnComplete:!!s.releaseOnComplete,loop:!!s.loop,pingPong:!!s.pingPong,initialValueMode:s.initialValueMode,propertyTracksConfig:i}),i.AddCompletedCallback(e=>this._FinishTriggers(e)),this._AddTween(i,s.property),i}ReleaseTween(e,t=!1){var s=e.GetId();if(this._activeTweens.has(s)&&(s=this._activeTweens.get(s))){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}e.IsReleased()||this._IsInWaitingList(e)||(e.Stop(t),this._AddToWaitingList(e))}ReleaseTweens(s,i=!1){if(e.IsFiniteNumber(s)){var r=t.Maps.GetPropertyFromIndex(s);if(this._activeTweens.has(r)){r=this._activeTweens.get(r);var n=this.GetFinishingTween();for(var a of r)a===n||a.IsReleased()||this._IsInWaitingList(a)||(a.Stop(i),a.Release());e.clearArray(r)}}else{for(r of(a=this.GetFinishingTween(),this.AllTweens()))r===a||r.IsReleased()||this._IsInWaitingList(r)||(r.Stop(i),r.Release());for(n of this._activeTweens.keys())e.clearArray(this._activeTweens.get(n)),this._activeTweens.delete(n);this._activeTweens.clear()}}ReleaseAndCompleteTween(e){this.ReleaseTween(e,!0)}ReleaseAndCompleteTweens(){this.ReleaseTweens(NaN,!0)}GetPropertyValueByIndex(e){switch(e){case 0:return this._enabled}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._enabled=!!t}}_GetBehaviorType(e){e=e.GetInstance().GetBehaviorInstances();for(const t of e)if(e=t.GetBehaviorType(),e.GetInstanceSdkCtor()===this.constructor)return e}Trigger(e,t,s,i){return this._runtime?super.Trigger(e):t.Trigger(e,s,i)}_FinishTriggers(e){let s,i;if(this._finishingTween=e,t.Cnds.SetFinishingTween(e),this.GetRuntime())s=this._inst,i=this._runtime,this.Trigger(t.Cnds.OnTweensFinished),this.Trigger(t.Cnds.OnAnyTweensFinished),this.ReleaseTween(e);else{if(s=e.GetInstance(),!s||s&&s.IsDestroyed())return;i=s.GetRuntime();const r=this._GetBehaviorType(e);this.Trigger(t.Cnds.OnTweensFinished,i,s,r),this.Trigger(t.Cnds.OnAnyTweensFinished,i,s,r),e.Stop()}this._finishingTween=null,t.Cnds.SetFinishingTween(null),e.GetDestroyInstanceOnComplete()&&i.DestroyInstance(s)}_AddTween(e,s){s=t.Maps.GetPropertyFromIndex(s),this._activeTweens.has(s)||this._activeTweens.set(s,[]),this._activeTweens.get(s).push(e)}_AddToWaitingList(e){const t=e.GetId();this._waitingForReleaseTweens.has(t)||this._waitingForReleaseTweens.set(t,[]),this._waitingForReleaseTweens.get(t).push(e)}_IsInWaitingList(e){const t=e.GetId();return!!this._waitingForReleaseTweens.has(t)&&this._waitingForReleaseTweens.get(t).includes(e)}_ReleaseWaitingTweens(){if(this._waitingForReleaseTweens.size){for(const t of this._waitingForReleaseTweens.values()){for(const e of t)e.IsReleased()||e.Release();e.clearArray(t)}this._waitingForReleaseTweens.clear()}}}}{const e=self.C3;let t=null;e.Behaviors.Tween.Cnds={SetFinishingTween(e){t=e},OnTweensFinished:e=>t.HasTags(e),OnAnyTweensFinished:()=>!0,IsPlaying(t){return t=[...this.GetTweensIncludingWaitingForRelease(t)],!!t.length&&t.some(e.TweenState.IsPlaying)},IsAnyPlaying(){const t=[...this.AllTweensIncludingWaitingForRelease()];return!(!t||!t.length)&&t.some(e.TweenState.IsPlaying)},IsPaused(t){return t=[...this.GetTweensIncludingWaitingForRelease(t)],!!t.length&&t.some(e.TweenState.IsPaused)},IsAnyPaused(){const t=[...this.AllTweensIncludingWaitingForRelease()];return!(!t||!t.length)&&t.some(e.TweenState.IsPaused)}}}{const e=self.C3,t=self.Ease,s=e.Behaviors.Tween;s.Acts={SetEnabled(e){this.SetEnabled(!!e);for(const t of this.AllTweens())e?this.IsInDisabledList(t)&&t.Resume():((t.IsPlaying()||t.IsScheduled())&&this.AddToDisabledList(t),t.Stop());e&&this.ClearDisabledList()},async TweenOneProperty(...e){this.GetEnabled()&&this.IsInstanceValid()&&(e=this.CreateTween(s.TweenArguments.OneProperty(this,...e)),e.Play()&&await e.GetPlayPromise())},async TweenTwoProperties(...e){this.GetEnabled()&&this.IsInstanceValid()&&(e=this.CreateTween(s.TweenArguments.TwoProperties(this,...e)),e.Play()&&await e.GetPlayPromise())},async TweenValue(...e){this.GetEnabled()&&this.IsInstanceValid()&&(e=this.CreateTween(s.TweenArguments.ValueProperty(this,...e)),e.Play()&&await e.GetPlayPromise())},PauseTweens(e){if(this.GetEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))t.Stop()},PauseAllTweens(){if(this.GetEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())e.Stop()},ResumeTweens(e){if(this.GetEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))t.Resume()},ResumeAllTweens(){if(this.GetEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())e.Resume()},StopTweens(e){if(this.GetEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))this.ReleaseTween(t)},StopAllTweens(){
if(this.GetEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())this.ReleaseTween(e)},SetOnePropertyTweensEndValue(t,s,i){if(this.GetEnabled()&&this.IsInstanceValid()){s=e.Behaviors.Tween.Maps.GetSinglePropertyFromIndex(s);for(const e of this.GetTweens(t))e.BeforeSetEndValues([s]),e.SetEndValue(i,s)}},SetTwoPropertiesTweensEndValue(t,s,i,r){if(this.GetEnabled()&&this.IsInstanceValid()){s=e.Behaviors.Tween.Maps.GetRealProperties(s);for(const e of this.GetTweens(t))e.BeforeSetEndValues(s),e.SetEndValue(i,s[0]),e.SetEndValue(r,s[1])}},SetValuePropertyTweensStartValue(e,t){if(this.GetEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e,"value"))s.SetStartValue(t,"value")},SetValuePropertyTweensEndValue(e,t){if(this.GetEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e,"value"))s.BeforeSetEndValues(["value"]),s.SetEndValue(t,"value")},SetTweensEase(e,s){if(this.GetEnabled()&&this.IsInstanceValid()){s=t.GetEaseFromIndex(s);for(const t of this.GetTweens(e))t.SetEase(s)}},SetAllTweensEase(e){if(this.GetEnabled()&&this.IsInstanceValid()){e=t.GetEaseFromIndex(e);for(const t of this.AllTweens())t.SetEase(e)}},SetTweensTime(e,t){if(this.GetEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetTime(t)},SetAllTweensTime(e){if(this.GetEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetTime(e)},SetTweensPlaybackRate(e,t){if(this.GetEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetPlaybackRate(t)},SetAllTweensPlaybackRate(e){if(this.GetEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetPlaybackRate(e)},SetTweensDestroyOnComplete(e,t){if(this.GetEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetDestroyInstanceOnComplete(!!t)},SetAllTweensDestroyOnComplete(e){if(this.GetEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetDestroyInstanceOnComplete(!!e)}}}self.C3.Behaviors.Tween.Exps={Time(e){return(e=this.GetTweenIncludingWaitingForRelease(e))?e.GetTime():0},Progress(e){return(e=this.GetTweenIncludingWaitingForRelease(e))?e.GetTime()/e.GetTotalTime():0},Value(e){return(e=this.GetTweenIncludingWaitingForRelease(e,"value"))?e.GetPropertyTrack("value").GetSourceAdapterValue():0},Tags(){return this.GetFinishingTween()?this.GetFinishingTween().GetStringTags():""}};{const e=self.C3,t=self.Ease,s=["position","size","scale"],i="offsetX offsetY offsetWidth offsetHeight offsetAngle offsetOpacity offsetColor offsetZElevation offsetScaleX offsetScaleY".split(" "),r=["value"],n=[].concat(s).concat(i).concat(r),a={position:["offsetX","offsetY"],size:["offsetWidth","offsetHeight"],scale:["offsetScaleX","offsetScaleY"]},o=Object.assign({},n.reduce((e,t)=>Object.assign({},e,{[t]:[t]}),{}),a);e.Behaviors.Tween.Maps=class{constructor(){}static GetEases(){return[...t.GetRuntimeEaseNames()]}static GetEaseFromIndex(e){return[...t.GetRuntimeEaseNames()][e]}static GetPropertyFromIndex(e){return n[e]}static GetPropertyIndexFromName(e){return n.indexOf(e)}static GetPairPropertyFromIndex(e){return s[e]}static GetSinglePropertyFromIndex(e){return i[e]}static GetValuePropertyFromIndex(e){return r[e]}static GetPairProperties(e){return a[e]}static GetRealProperties(t){return e.IsString(t)?o[t]:o[n[t]]}static IsPairId(e){return!!a[e]}static IsColorId(e){return"offsetColor"===e}static IsAngleId(e){return"offsetAngle"===e}static IsOpacityId(e){return"offsetOpacity"===e}static IsValueId(e){return"value"===e}}}{const e=self.C3,t=e.Behaviors.Tween,s=new Map;t.Config=class{constructor(){}static GetPropertyTracksConfig(i,r,n,a,o,h){0===s.size&&this._CreateConfigObjects();var l=t.PropertyTypes.Pick(i);return l=s.get(l),e.IsFiniteNumber(i)&&(i=t.Maps.GetPropertyFromIndex(i)),this._GetConfig(l,i,r,n,a,o,h)}static TransformValue(t,s){return e.Behaviors.Tween.GetPropertyTracksConfig(t).valueGetter(s)}static _CreateConfigObjects(){const e=t.PropertyTypes,s=t.ValueGetters;this._AddConfigObject(e.PAIR,this._GetPairConfig,s._GetPropertyValue),this._AddConfigObject(e.COLOR,this._GetColorConfig,s._GetColorPropertyValue),this._AddConfigObject(e.ANGLE,this._GetAngleConfig,s._GetPropertyAngleValue),this._AddConfigObject(e.VALUE,this._GetValueConfig,s._GetPropertyValue),this._AddConfigObject(e.OTHER,this._GetCommonConfig,s._GetPropertyValue)}static _AddConfigObject(e,t,i){s.set(e,this._CreateConfigObject(e,t,i))}static _CreateConfigObject(e,t,s){return{name:e,configFunc:t,valueGetter:s}}static _GetConfig(e,t,s,i,r,n,a){return e.configFunc(t,e.valueGetter(s),e.valueGetter(i),r,n,a)}static _GetPairConfig(e,s,i,r,n,a){return t.Maps.GetPairProperties(e).map((e,a)=>({sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:s[a],endValue:i[a],ease:t.Maps.GetEaseFromIndex(r),resultMode:n}))}static _GetColorConfig(s,i,r,n,a,o){return e.Plugins.Text&&o.GetPlugin()instanceof e.Plugins.Text?{sourceId:"plugin",sourceArgs:[7],property:"color",type:"color",valueType:"color",startValue:i,endValue:r,ease:t.Maps.GetEaseFromIndex(n),resultMode:a}:{sourceId:"world-instance",property:s,type:"color",valueType:"color",startValue:i,endValue:r,ease:t.Maps.GetEaseFromIndex(n),resultMode:a}}static _GetAngleConfig(e,s,i,r,n,a){return{sourceId:"world-instance",property:e,type:"angle",valueType:"angle",startValue:s,endValue:i,ease:t.Maps.GetEaseFromIndex(r),resultMode:n}}static _GetCommonConfig(e,s,i,r,n,a){return{sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:s,endValue:i,ease:t.Maps.GetEaseFromIndex(r),resultMode:n}}static _GetValueConfig(e,s,i,r,n,a){return{sourceId:"value",property:e,type:"float",valueType:"numeric",startValue:s,endValue:i,ease:t.Maps.GetEaseFromIndex(r),resultMode:n}}}}{const e=self.C3,t=e.Behaviors.Tween,s=Object.assign({},{resultMode:"absolute"},{tags:"",property:"",time:0,ease:0,releaseOnComplete:0,loop:!1,pingPong:!1}),i=Object.assign({},s,{initialValueMode:"current-state",startValue:0,endValue:0}),r=Object.assign({},s,{initialValueMode:"current-state",startValue:[0,0],endValue:[0,0]}),n=Object.assign({},s,{initialValueMode:"current-state",startValue:[0,0,0],endValue:[0,0,0]}),a=Object.assign({},i,{initialValueMode:"start-value"});t.TweenArguments=class{constructor(){}static _SetCommonProperties(e,t,s,i,r,n,a){e.tags=t,e.time=s,e.ease=i,e.releaseOnComplete=r,e.loop=n,e.pingPong=a}static OneProperty(s,r,a,o,h,l,c,u,_){return s=t.Maps.GetSinglePropertyFromIndex(a),a=t.Maps.IsColorId(s)?n:i,this._SetCommonProperties(a,r,h,l,c,u,_),t.Maps.IsColorId(s)?(n.endValue[0]=e.GetRValue(o),n.endValue[1]=e.GetGValue(o),n.endValue[2]=e.GetBValue(o),n.property=t.Maps.GetPropertyIndexFromName(s)):t.Maps.IsOpacityId(s)?i.endValue=o/100:i.endValue=o,a.property=t.Maps.GetPropertyIndexFromName(s),a}static TwoProperties(e,s,i,n,a,o,h,l,c,u){return this._SetCommonProperties(r,s,o,h,l,c,u),e=t.Maps.GetPairPropertyFromIndex(i),r.endValue[0]=n,r.endValue[1]=a,r.property=t.Maps.GetPropertyIndexFromName(e),r}static ValueProperty(e,s,i,r,n,o,h,l,c){return this._SetCommonProperties(a,s,n,o,h,l,c),a.startValue=i,a.endValue=r,a.property=t.Maps.GetPropertyIndexFromName("value"),a}}}{const e=self.C3,t=e.Behaviors.Tween,s=[];t.PropertyTypes=class{constructor(){}static Pick(i){0===s.length&&(s.push({checkFunc:t.Maps.IsPairId,result:this.PAIR}),s.push({checkFunc:t.Maps.IsColorId,result:this.COLOR}),s.push({checkFunc:t.Maps.IsAngleId,result:this.ANGLE}),s.push({checkFunc:t.Maps.IsValueId,result:this.VALUE}),s.push({checkFunc:()=>!0,result:this.OTHER})),e.IsFiniteNumber(i)&&(i=e.Behaviors.Tween.Maps.GetPropertyFromIndex(i));for(const e of s)if(e.checkFunc(i))return e.result}static get PAIR(){return"pair"}static get COLOR(){return"color"}static get ANGLE(){return"angle"}static get VALUE(){return"value"}static get OTHER(){return"other"}}}{const e=self.C3;e.Behaviors.Tween.ValueGetters=class{constructor(){}static _GetPropertyAngleValue(t){return t=e.toRadians(parseFloat(t)),e.clampAngle(t)}static _GetColorPropertyValue(e){return e.slice(0)}static _GetPropertyValue(e){return e}}}{const e=self.C3;e.Behaviors.Bullet=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Bullet.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance;e.Behaviors.Bullet.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),e=this.GetWorldInfo(),this._g=this._acc=this._speed=0,this._isStepping=this._setAngle=this._bounceOffSolid=!1,this._isEnabled=!0,this._dy=this._dx=0,this._lastX=e.GetX(),this._lastY=e.GetY(),this._lastKnownAngle=e.GetAngle(),this._travelled=0,this._stepSize=Math.min(Math.abs(e.GetWidth()),Math.abs(e.GetHeight())/2),this._stopStepping=!1,t&&(this._speed=t[0],this._acc=t[1],this._g=t[2],this._bounceOffSolid=!!t[3],this._setAngle=!!t[4],this._isStepping=!!t[5],this._isEnabled=!!t[6]),t=e.GetAngle(),this._dx=Math.cos(t)*this._speed,this._dy=Math.sin(t)*this._speed,this._isEnabled&&(this._StartTicking(),this._bounceOffSolid&&this._StartPostTicking())}Release(){super.Release()}SaveToJson(){const e={dx:this._dx,dy:this._dy,lx:this._lastX,ly:this._lastY,lka:this._lastKnownAngle,t:this._travelled};return 0!==this._acc&&(e.acc=this._acc),0!==this._g&&(e.g=this._g),this._isStepping&&(e.st=this._isStepping),this._isEnabled||(e.e=this._isEnabled),this._bounceOffSolid&&(e.bos=this._bounceOffSolid),this._setAngle&&(e.sa=this._setAngle),e}LoadFromJson(e){this._dx=e.dx,this._dy=e.dy,this._lastX=e.lx,this._lastY=e.ly,this._lastKnownAngle=e.lka,this._travelled=e.t,this._acc=e.hasOwnProperty("acc")?e.acc:0,this._g=e.hasOwnProperty("g")?e.g:0,this._isStepping=!!e.hasOwnProperty("st")&&e.st,this._bounceOffSolid=!!e.hasOwnProperty("bos")&&e.bos,this._setAngle=!!e.hasOwnProperty("sa")&&e.sa,this._SetEnabled(!e.hasOwnProperty("e")||e.e)}Tick(){if(this._isEnabled){var t=this._runtime.GetDt(this._inst),s=this._inst.GetWorldInfo();if(s.GetAngle()!==this._lastKnownAngle){var i=s.GetAngle();if(this._setAngle){var r=e.distanceTo(0,0,this._dx,this._dy);this._dx=Math.cos(i)*r,this._dy=Math.sin(i)*r}this._lastKnownAngle=i}if(i=r=0,0!==this._acc){let n,a=e.distanceTo(0,0,this._dx,this._dy);n=0===this._dx&&0===this._dy?s.GetAngle():e.angleTo(0,0,this._dx,this._dy),a+=this._acc*t,r=Math.cos(n)*this._acc,i=Math.sin(n)*this._acc,0>a&&(i=r=a=0),this._dx=Math.cos(n)*a,this._dy=Math.sin(n)*a}0!==this._g&&(this._dy+=this._g*t,i+=this._g),this._lastX=s.GetX(),this._lastY=s.GetY(),0===this._dx&&0===this._dy||(r=this._dx*t+.5*r*t*t,t=this._dy*t+.5*i*t*t,i=e.distanceTo(0,0,r,t),this._MoveBy(r,t,i),this._travelled+=i,!this._setAngle||0===r&&0===t||(t=e.angleTo(0,0,r,t),s.SetAngle(t),this._lastKnownAngle=s.GetAngle()),s.SetBboxChanged())}}_MoveBy(t,s,i){const r=this.GetWorldInfo();if(!this._isStepping||i<=this._stepSize)r.OffsetXY(t,s),r.SetBboxChanged(),this._isStepping&&this.Trigger(e.Behaviors.Bullet.Cnds.OnStep);else{this._stopStepping=!1;var n=r.GetX(),a=r.GetY(),o=n+t,h=a+s;s=e.angleTo(0,0,t,s),t=Math.cos(s)*this._stepSize,s=Math.sin(s)*this._stepSize,i=Math.floor(i/this._stepSize);for(let o=1;o<=i;++o)if(r.SetXY(n+t*o,a+s*o),r.SetBboxChanged(),this.Trigger(e.Behaviors.Bullet.Cnds.OnStep),this._inst.IsDestroyed()||this._stopStepping)return;r.SetXY(o,h),r.SetBboxChanged(),this.Trigger(e.Behaviors.Bullet.Cnds.OnStep)}}PostTick(){if(this._isEnabled&&this._bounceOffSolid&&(0!==this._dx||0!==this._dy)){var t=this._runtime.GetDt(this._inst),s=this._inst.GetWorldInfo(),i=this._runtime.GetCollisionEngine(),r=i.TestOverlapSolid(this._inst);if(r){i.RegisterCollision(this._inst,r),r=e.distanceTo(0,0,this._dx,this._dy);const n=i.CalculateBounceAngle(this._inst,this._lastX,this._lastY);this._dx=Math.cos(n)*r,this._dy=Math.sin(n)*r,s.OffsetXY(this._dx*t,this._dy*t),s.SetBboxChanged(),this._setAngle&&(s.SetAngle(n),this._lastKnownAngle=s.GetAngle(),s.SetBboxChanged()),i.PushOutSolid(this._inst,this._dx/r,this._dy/r,Math.max(2.5*r*t,30))||i.PushOutSolidNearest(this._inst,100)}}}GetPropertyValueByIndex(e){switch(e){case 0:return this._GetSpeed();case 1:return this._GetAcceleration();case 2:return this._GetGravity();case 4:return this._setAngle;case 5:return this._isStepping;case 6:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetSpeed(t);break;case 1:this._acc=t;break;case 2:this._g=t;break;case 4:this._setAngle=!!t;break;case 5:this._isStepping=!!t;break;case 6:this._SetEnabled(!!t)}}_SetSpeed(t){const s=e.angleTo(0,0,this._dx,this._dy);this._dx=Math.cos(s)*t,this._dy=Math.sin(s)*t}_GetSpeed(){return e.round6dp(e.distanceTo(0,0,this._dx,this._dy))}_SetAcceleration(e){this._acc=e}_GetAcceleration(){return this._acc}_SetGravity(e){this._g=e}_GetGravity(){return this._g}_SetAngleOfMotion(t){const s=e.distanceTo(0,0,this._dx,this._dy);this._dx=Math.cos(t)*s,this._dy=Math.sin(t)*s}_GetAngleOfMotion(){return e.angleTo(0,0,this._dx,this._dy)}_SetBounceOffSolids(e){e=!!e,this._bounceOffSolid!==e&&(this._bounceOffSolid=e,this._isEnabled&&(this._bounceOffSolid?this._StartPostTicking():this._StopPostTicking()))}_IsBounceOffSolids(){return this._bounceOffSolid}_SetDistanceTravelled(e){this._travelled=e}_GetDistanceTravelled(){return this._travelled}_SetEnabled(e){(this._isEnabled=!!e)?(this._StartTicking(),this._bounceOffSolid&&this._StartPostTicking()):(this._StopTicking(),this._StopPostTicking())}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.bullet.debugger.vector-x",value:this._dx,onedit:e=>this._dx=e},{name:"behaviors.bullet.debugger.vector-y",value:this._dy,onedit:e=>this._dy=e},{name:"behaviors.bullet.properties.speed.name",value:this._GetSpeed(),onedit:e=>this._SetSpeed(e)},{name:"behaviors.bullet.debugger.angle-of-motion",value:e.toDegrees(this._GetAngleOfMotion())},{name:"behaviors.bullet.properties.gravity.name",value:this._GetGravity(),onedit:e=>this._SetGravity(e)},{name:"behaviors.bullet.properties.acceleration.name",value:this._GetAcceleration(),onedit:e=>this._SetAcceleration(e)},{name:"behaviors.bullet.debugger.distance-travelled",value:this._GetDistanceTravelled()},{name:"behaviors.bullet.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IBulletBehaviorInstance}};const i=new WeakMap;self.IBulletBehaviorInstance=class extends s{constructor(){super(),i.set(this,s._GetInitInst().GetSdkInstance())}get speed(){return i.get(this)._GetSpeed()}set speed(e){t.RequireFiniteNumber(e),i.get(this)._SetSpeed(e)}get acceleration(){return i.get(this)._GetAcceleration()}set acceleration(e){t.RequireFiniteNumber(e),i.get(this)._SetAcceleration(e)}get gravity(){return i.get(this)._GetGravity()}set gravity(e){t.RequireFiniteNumber(e),i.get(this)._SetGravity(e)}get angleOfMotion(){return i.get(this)._GetAngleOfMotion()}set angleOfMotion(e){t.RequireFiniteNumber(e),i.get(this)._SetAngleOfMotion(e)}get bounceOffSolids(){return i.get(this)._IsBounceOffSolids()}set bounceOffSolids(e){i.get(this)._SetBounceOffSolids(!!e)}get distanceTravelled(){return i.get(this)._GetDistanceTravelled()}set distanceTravelled(e){t.RequireFiniteNumber(e),i.get(this)._SetDistanceTravelled(e)}get isEnabled(){return i.get(this)._IsEnabled()}set isEnabled(e){i.get(this)._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.Bullet.Cnds={CompareSpeed(t,s){return e.compare(Math.sqrt(this._dx*this._dx+this._dy*this._dy),t,s)},CompareTravelled(t,s){return e.compare(this._GetDistanceTravelled(),t,s)},OnStep:()=>!0,IsEnabled(){return this._IsEnabled()}}}{const e=self.C3;e.Behaviors.Bullet.Acts={SetSpeed(e){this._SetSpeed(e)},SetAcceleration(e){this._SetAcceleration(e)},SetGravity(e){this._SetGravity(e)},SetAngleOfMotion(t){this._SetAngleOfMotion(e.toRadians(t))},Bounce(t){if(t&&(t=t.GetFirstPicked(this._inst))){var s=this._inst.GetWorldInfo(),i=this._runtime.GetCollisionEngine(),r=this._runtime.GetDt(this._inst),n=e.distanceTo(0,0,this._dx,this._dy),a=i.CalculateBounceAngle(this._inst,this._lastX,this._lastY,t);this._dx=Math.cos(a)*n,this._dy=Math.sin(a)*n,s.OffsetXY(this._dx*r,this._dy*r),s.SetBboxChanged(),this._setAngle&&(s.SetAngle(a),this._lastKnownAngle=s.GetAngle(),s.SetBboxChanged()),0!==n&&(this._bounceOffSolid?i.PushOutSolid(this._inst,this._dx/n,this._dy/n,Math.max(2.5*n*r,30))||i.PushOutSolidNearest(this._inst,100):i.PushOut(this._inst,this._dx/n,this._dy/n,Math.max(2.5*n*r,30),t))}},SetBounceOffSolids(e){this._SetBounceOffSolids(e)},SetDistanceTravelled(e){this._SetDistanceTravelled(e)},SetEnabled(e){this._SetEnabled(e)},StopStepping(){this._stopStepping=!0}}}{const e=self.C3;e.Behaviors.Bullet.Exps={Speed(){return this._GetSpeed()},Acceleration(){return this._GetAcceleration()},AngleOfMotion(){return e.toDegrees(this._GetAngleOfMotion())},DistanceTravelled(){return this._GetDistanceTravelled()},Gravity(){return this._GetGravity()}}}{const e=self.C3;e.Behaviors.solid=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.solid.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=new Set;e.Behaviors.solid.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this.SetEnabled(!0),t&&(this.SetEnabled(t[0]),this.SetTags(t[1]))}Release(){super.Release()}SetEnabled(e){this._inst._SetSolidEnabled(!!e)}IsEnabled(){return this._inst._IsSolidEnabled()}SetTags(e){const t=this._inst.GetSavedDataMap();if(e.trim()){var s=t.get("solidTags");s||(s=new Set,t.set("solidTags",s)),s.clear();for(const t of e.split(" "))t&&s.add(t.toLowerCase())}else t.delete("solidTags")}GetTags(){return this._inst.GetSavedDataMap().get("solidTags")||t}SaveToJson(){return{e:this.IsEnabled()}}LoadFromJson(e){this.SetEnabled(e.e)}GetPropertyValueByIndex(e){switch(e){case 0:return this.IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this.SetEnabled(t)}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.solid.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this.SetEnabled(e)}]}]}}}self.C3.Behaviors.solid.Cnds={IsEnabled(){return this.IsEnabled()}},self.C3.Behaviors.solid.Acts={SetEnabled(e){this.SetEnabled(e)},SetTags(e){this.SetTags(e)}},self.C3.Behaviors.solid.Exps={};{const e=self.C3;e.Behaviors.Sin=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Sin.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=2*Math.PI,r=Math.PI/2,n=3*Math.PI/2,a=[0,1,8,3,4,2,5,6,9,7];e.Behaviors.Sin.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._mag=this._period=this._wave=this._movement=this._i=0,this._isEnabled=!0,this._ratio=this._lastKnownValue2=this._lastKnownValue=this._initialValue2=this._initialValue=this._magnitudeRandom=this._periodOffsetRandom=this._periodRandom=this._baseMag=this._basePeriodOffset=this._basePeriod=0,s&&(this._movement=a[s[0]],this._wave=s[1],this._periodRandom=this._runtime.Random()*s[3],this._basePeriod=s[2],this._period=s[2],this._period+=this._periodRandom,this._basePeriodOffset=s[4],0!==this._period&&(this._periodOffsetRandom=this._runtime.Random()*s[5],this._i=s[4]/this._period*i,this._i+=this._periodOffsetRandom/this._period*i),this._magnitudeRandom=this._runtime.Random()*s[7],this._baseMag=s[6],this._mag=s[6],this._mag+=this._magnitudeRandom,this._isEnabled=!!s[8]),5===this._movement&&(this._mag=e.toRadians(this._mag)),this.Init(),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{i:this._i,e:this._isEnabled,mv:this._movement,w:this._wave,p:this._period,mag:this._mag,iv:this._initialValue,iv2:this._initialValue2,r:this._ratio,lkv:this._lastKnownValue,lkv2:this._lastKnownValue2}}LoadFromJson(e){this._i=e.i,this._SetEnabled(e.e),this._movement=e.mv,this._wave=e.w,this._period=e.p,this._mag=e.mag,this._initialValue=e.iv,this._initialValue2=e.iv2,this._ratio=e.r,this._lastKnownValue=e.lkv,this._lastKnownValue2=e.lkv2}Init(){const e=this._inst.GetWorldInfo();switch(this._movement){case 0:this._initialValue=e.GetX();break;case 1:this._initialValue=e.GetY();break;case 2:this._initialValue=e.GetWidth(),this._ratio=e.GetHeight()/e.GetWidth();break;case 3:this._initialValue=e.GetWidth();break;case 4:this._initialValue=e.GetHeight();break;case 5:this._initialValue=e.GetAngle();break;case 6:this._initialValue=e.GetOpacity();break;case 7:this._initialValue=0;break;case 8:this._initialValue=e.GetX(),this._initialValue2=e.GetY();break;case 9:this._initialValue=e.GetZElevation()}this._lastKnownValue=this._initialValue,this._lastKnownValue2=this._initialValue2}WaveFunc(e){switch(e%=i,this._wave){case 0:return Math.sin(e);case 1:return e<=r?e/r:e<=n?1-2*(e-r)/Math.PI:(e-n)/r-1;case 2:return 2*e/i-1;case 3:return-2*e/i+1;case 4:return e<Math.PI?-1:1}return 0}Tick(){const e=this._runtime.GetDt(this._inst);this._isEnabled&&0!==e&&(this._i=0===this._period?0:(this._i+e/this._period*i)%i,this._UpdateFromPhase())}_UpdateFromPhase(){const t=this._inst.GetWorldInfo();switch(this._movement){case 0:t.GetX()!==this._lastKnownValue&&(this._initialValue+=t.GetX()-this._lastKnownValue),t.SetX(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=t.GetX();break;case 1:t.GetY()!==this._lastKnownValue&&(this._initialValue+=t.GetY()-this._lastKnownValue),t.SetY(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=t.GetY();break;case 2:t.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag),t.SetHeight(t.GetWidth()*this._ratio);break;case 3:t.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case 4:t.SetHeight(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case 5:t.GetAngle()!==this._lastKnownValue&&(this._initialValue=e.clampAngle(this._initialValue+(t.GetAngle()-this._lastKnownValue))),t.SetAngle(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=t.GetAngle();break;case 6:t.SetOpacity(this._initialValue+this.WaveFunc(this._i)*this._mag/100);break;case 8:t.GetX()!==this._lastKnownValue&&(this._initialValue+=t.GetX()-this._lastKnownValue),t.GetY()!==this._lastKnownValue2&&(this._initialValue2+=t.GetY()-this._lastKnownValue2),t.SetX(this._initialValue+Math.cos(t.GetAngle())*this.WaveFunc(this._i)*this._mag),t.SetY(this._initialValue2+Math.sin(t.GetAngle())*this.WaveFunc(this._i)*this._mag),this._lastKnownValue=t.GetX(),this._lastKnownValue2=t.GetY();break;case 9:t.SetZElevation(this._initialValue+this.WaveFunc(this._i)*this._mag)}t.SetBboxChanged()}_OnSpriteFrameChanged(e,t){}_SetPeriod(e){this._period=e}_GetPeriod(){return this._period}_SetMagnitude(e){this._mag=e}_SetMagnitude_ConvertAngle(t){5===this._movement&&(t=e.toRadians(t)),this._SetMagnitude(t)}_GetMagnitude(){return this._mag}_GetMagnitude_ConvertAngle(){let t=this._GetMagnitude();return 5===this._movement&&(t=e.toDegrees(t)),t}_SetMovement(t){5===this._movement&&5!==t&&(this._mag=e.toDegrees(this._mag)),this._movement=t,this.Init()}_GetMovement(){return this._movement}_SetWave(e){this._wave=e}_GetWave(){return this._wave}_SetPhase(t){this._i=e.clamp(t,0,2*Math.PI),this._UpdateFromPhase()}_GetPhase(){return this._i}_SetEnabled(e){(this._isEnabled=!!e)?this._StartTicking():this._StopTicking()}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(e){switch(e){case 0:return this._movement;case 1:return this._wave;case 2:return this._basePeriod;case 6:return this._baseMag;case 8:return this._isEnabled}}SetPropertyValueByIndex(t,s){switch(t){case 0:this._movement=a[s],this.Init();break;case 1:this._wave=s;break;case 2:this._basePeriod=s,this._period=this._basePeriod+this._periodRandom,this._isEnabled||(0!==this._period?(this._i=this._basePeriodOffset/this._period*i,this._i+=this._periodOffsetRandom/this._period*i):this._i=0);break;case 6:this._baseMag=s,this._mag=this._baseMag+this._magnitudeRandom,5===this._movement&&(this._mag=e.toRadians(this._mag));break;case 8:this._isEnabled=!!s}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.sin.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)},{name:"behaviors.sin.properties.period.name",value:this._GetPeriod(),onedit:e=>this._SetPeriod(e)},{name:"behaviors.sin.properties.magnitude.name",value:this._GetMagnitude_ConvertAngle(),onedit:e=>this._SetMagnitude_ConvertAngle(e)},{name:"behaviors.sin.debugger.value",value:this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}]}]}GetScriptInterfaceClass(){return self.ISineBehaviorInstance}};const o=new WeakMap,h="horizontal vertical size width height angle opacity value-only forwards-backwards z-elevation".split(" "),l=["sine","triangle","sawtooth","reverse-sawtooth","square"];self.ISineBehaviorInstance=class extends s{constructor(){super(),o.set(this,s._GetInitInst().GetSdkInstance())}set period(e){t.RequireFiniteNumber(e),o.get(this)._SetPeriod(e)}get period(){return o.get(this)._GetPeriod()}set magnitude(e){t.RequireFiniteNumber(e),o.get(this)._SetMagnitude(e)}get magnitude(){return o.get(this)._GetMagnitude()}set phase(e){o.get(this)._SetPhase(e)}get phase(){return o.get(this)._GetPhase()}set movement(e){if(t.RequireString(e),e=h.indexOf(e),-1===e)throw Error("invalid movement");o.get(this)._SetMovement(e)}get movement(){return h[o.get(this)._GetMovement()]}set wave(e){if(t.RequireString(e),e=l.indexOf(e),-1===e)throw Error("invalid wave");o.get(this)._SetWave(e)}get wave(){return l[o.get(this)._GetWave()]}get value(){const e=o.get(this);return e.WaveFunc(e._GetPhase())*e._GetMagnitude()}updateInitialState(){o.get(this).Init()}set isEnabled(e){o.get(this)._SetEnabled(!!e)}get isEnabled(){return o.get(this)._IsEnabled()}}}{const e=self.C3;e.Behaviors.Sin.Cnds={IsEnabled(){return this._IsEnabled()},CompareMovement(e){return this._GetMovement()===e},ComparePeriod(t,s){return e.compare(this._GetPeriod(),t,s)},CompareMagnitude(t,s){return e.compare(this._GetMagnitude_ConvertAngle(),t,s)},CompareWave(e){return this._GetWave()===e}}}self.C3.Behaviors.Sin.Acts={SetEnabled(e){this._SetEnabled(0!==e)},SetPeriod(e){this._SetPeriod(e)},SetMagnitude(e){this._SetMagnitude_ConvertAngle(e)},SetMovement(e){this._SetMovement(e)},SetWave(e){this._wave=e},SetPhase(e){const t=2*Math.PI;this._SetPhase(e*t%t)},UpdateInitialState(){this.Init()}},self.C3.Behaviors.Sin.Exps={CyclePosition(){return this._GetPhase()/(2*Math.PI)},Period(){return this._GetPeriod()},Magnitude(){return this._GetMagnitude_ConvertAngle()},Value(){return this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}};{const e=self.C3;e.Behaviors.Orbit=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Orbit.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.Orbit.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._acceleration=this._speed=0,this._isEnabled=!0,this._offsetAngle=this._majorAxis=this._minorAxis=0,this._matchRotation=!1,this._targetY=this._targetX=0,this._targetObject=null,this._targetUid=-1,this._totalAbsoluteRotation=this._totalRotation=this._rotation=0,s&&(this._speed=e.toRadians(s[0]),this._acceleration=e.toRadians(s[1]),this._isEnabled=s[6],this._minorAxis=s[2],this._majorAxis=s[3],this._offsetAngle=e.toRadians(s[4]),this._matchRotation=s[5]),t=this._runtime.Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),e.Disposable.From(t,"afterload",e=>this._OnAfterLoad())),this._SetEnabled(this._isEnabled),t=this._inst.GetWorldInfo(),this._targetX=t.GetX(),this._targetY=t.GetY(),this._rotation=t.GetAngle()}Release(){this._targetObject=null,super.Release()}SaveToJson(){return{s:this._speed,a:this._acceleration,r:this._rotation,e:this._isEnabled,a1:this._majorAxis,a2:this._minorAxis,oa:this._offsetAngle,mr:this._matchRotation,tx:this._targetX,ty:this._targetY,tuid:this._targetObject?this._targetObject.GetUID():-1}}LoadFromJson(e){this._speed=e.s,this._acceleration=e.a,this._rotation=e.r,this._majorAxis=e.a1,this._minorAxis=e.a2,this._offsetAngle=e.oa,this._matchRotation=e.mr,this._targetX=e.tx,this._targetY=e.ty,this._targetUid=e.tuid,this._SetEnabled(e.e)}_OnAfterLoad(){-1===this._targetUid?this._targetObject=null:(this._targetObject=this._runtime.GetInstanceByUID(this._targetUid),this._targetUid=-1)}_OnInstanceDestroyed(e){this._targetObject===e&&(this._targetObject=null)}_Initialise(){if(this._shouldInitialise){var e=this._inst.GetWorldInfo();this._targetX=e.GetX(),this._targetY=e.GetY(),this._rotation=e.GetAngle(),this._shouldInitialise=!1}}_UpdateTarget(){if(this._targetObject){var e=this._targetObject.GetWorldInfo();this._targetX=e.GetX(),this._targetY=e.GetY()}}_ShouldTickLate(){return!!this._targetObject}Tick(){this._TickInternal()}Tick2(){this._TickInternal()}_TickInternal(){if(this._isEnabled){var t=this._runtime.GetDt(this._inst);if(0!==t){0!==this._acceleration&&(this._speed+=this._acceleration*t);var s=this._inst.GetWorldInfo();t*=this._speed,this._rotation=e.clampAngle(this._rotation+t),this._totalRotation+=t,this._totalAbsoluteRotation+=Math.abs(t),t=this._minorAxis*Math.cos(this._rotation);var i=this._majorAxis*Math.sin(this._rotation),r=Math.cos(this._offsetAngle),n=Math.sin(this._offsetAngle);this._UpdateTarget(),s.SetXY(this._targetX+(t*r-i*n),this._targetY+(t*n+i*r)),this._matchRotation&&s.SetAngle(this._rotation+this._offsetAngle+.5*Math.PI),s.SetBboxChanged()}}}GetPropertyValueByIndex(t){switch(t){case 0:return e.toDegrees(this._speed);case 1:return e.toDegrees(this._acceleration);case 6:return this._isEnabled;case 2:return this._minorAxis;case 3:return this._majorAxis;case 4:return this._offsetAngle;case 5:return this._matchRotation}}SetPropertyValueByIndex(t,s){switch(t){case 0:this._speed=e.toRadians(s);break;case 1:this._acceleration=e.toRadians(s);break;case 6:this._SetEnabled(s);break;case 2:this._minorAxis=s;break;case 3:this._majorAxis=s;break;case 4:this._offsetAngle=s;break;case 5:this._matchRotation=s}}_SetEnabled(e){this._isEnabled=!!e,this._ShouldTickLate()?this._isEnabled?this._StartTicking2():this._StopTicking2():this._isEnabled?this._StartTicking():this._StopTicking()}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.orbit.debugger.rotation",value:e.toDegrees(this._rotation)},{name:"behaviors.orbit.debugger.total-rotation",value:e.toDegrees(this._totalRotation)},{name:"behaviors.orbit.debugger.total-absolute-rotation",value:e.toDegrees(this._totalAbsoluteRotation)},{name:"behaviors.orbit.properties.speed.name",value:e.toDegrees(this._speed),onedit:t=>this._speed=e.toRadians(t)},{name:"behaviors.orbit.properties.acceleration.name",value:e.toDegrees(this._acceleration),onedit:t=>this._acceleration=e.toRadians(t)},{name:"behaviors.orbit.properties.primary-axis.name",value:this._majorAxis,onedit:e=>this._majorAxis=e},{name:"behaviors.orbit.properties.secondary-axis.name",value:this._minorAxis,onedit:e=>this._minorAxis=e},{name:"behaviors.orbit.properties.offset-angle.name",value:e.toDegrees(this._offsetAngle),onedit:t=>this._offsetAngle=e.toRadians(t)},{name:"behaviors.orbit.properties.match-rotation.name",value:this._matchRotation,onedit:e=>this._matchRotation=!!e},{name:"behaviors.orbit.properties.enabled.name",value:this._isEnabled,onedit:e=>this._SetEnabled(e)}]}]}}}self.C3.Behaviors.Orbit.Cnds={IsEnabled(){return this._isEnabled}};{const e=self.C3;e.Behaviors.Orbit.Acts={SetSpeed(t){this._speed=e.toRadians(t)},SetTarget(e,t){this._targetObject=null,this._targetX=e,this._targetY=t},SetRotation(t){this._rotation=e.toRadians(t)},SetOffsetAngle(t){
this._offsetAngle=e.toRadians(t)},SetRadius(e,t){this._minorAxis=e,this._majorAxis=t},SetMatchRotation(e){this._matchRotation=!!e},Pin(e){if(e&&(e=e.GetFirstPicked(this._inst))&&e.GetWorldInfo()){var t=this._isEnabled;t&&this._SetEnabled(!1),this._targetObject=e,t&&this._SetEnabled(!0)}},Unpin(){const e=this._isEnabled;e&&this._SetEnabled(!1),this._targetObject=null,e&&this._SetEnabled(!0)},SetAcceleration(t){this._acceleration=e.toRadians(t)},SetEnabled(e){this._SetEnabled(e)},ResetTotalRotation(){this._totalAbsoluteRotation=this._totalRotation=0}}}{const e=self.C3;e.Behaviors.Orbit.Exps={Speed(){return e.toDegrees(this._speed)},Acceleration(){return e.toDegrees(this._acceleration)},PrimaryRadius(){return this._majorAxis},SecondaryRadius(){return this._minorAxis},OffsetAngle(){return e.toDegrees(this._offsetAngle)},Rotation(){return e.toDegrees(this._rotation)},TotalRotation(){return e.toDegrees(this._totalRotation)},TotalAbsoluteRotation(){return e.toDegrees(this._totalAbsoluteRotation)},TargetX(){return this._targetX},TargetY(){return this._targetY},DistanceToTarget(){return Math.sqrt((this._minorAxis*Math.cos(this._rotation))**2+(this._majorAxis*Math.sin(this._rotation))**2)}}}{const e=self.C3;e.Behaviors.Timer=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Timer.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.Timer.SingleTimer=class{constructor(t,s,i,r){this._current=e.New(e.KahanSum),this._current.Set(t||0),this._total=e.New(e.KahanSum),this._total.Set(s||0),this._duration=i||0,this._isRegular=!!r,this._isPaused=!1}GetCurrentTime(){return this._current.Get()}GetTotalTime(){return this._total.Get()}GetDuration(){return this._duration}SetPaused(e){this._isPaused=!!e}IsPaused(){return this._isPaused}Add(e){this._current.Add(e),this._total.Add(e)}HasFinished(){return this._current.Get()>=this._duration}Update(){if(this.HasFinished()){if(!this._isRegular)return!0;this._current.Subtract(this._duration)}return!1}SaveToJson(){return{c:this._current.Get(),t:this._total.Get(),d:this._duration,r:this._isRegular,p:this._isPaused}}LoadFromJson(e){this._current.Set(e.c),this._total.Set(e.t),this._duration=e.d,this._isRegular=!!e.r,this._isPaused=!!e.p}},e.Behaviors.Timer.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._timers=new Map}Release(){this._timers.clear(),super.Release()}_UpdateTickState(){0<this._timers.size?(this._StartTicking(),this._StartTicking2()):(this._StopTicking(),this._StopTicking2())}SaveToJson(){const e={};for(const[t,s]of this._timers.entries())e[t]=s.SaveToJson();return e}LoadFromJson(t){this._timers.clear();for(const[s,i]of Object.entries(t))t=new e.Behaviors.Timer.SingleTimer,t.LoadFromJson(i),this._timers.set(s,t);this._UpdateTickState()}Tick(){const e=this._runtime.GetDt(this._inst);for(const t of this._timers.values())t.IsPaused()||t.Add(e)}Tick2(){for(const[e,t]of this._timers.entries())t.Update()&&this._timers.delete(e)}GetDebuggerProperties(){return[{title:"behaviors.timer.debugger.timers",properties:[...this._timers.entries()].map(e=>({name:"$"+e[0],value:`${Math.round(10*e[1].GetCurrentTime())/10} / ${Math.round(10*e[1].GetDuration())/10}`}))}]}}}self.C3.Behaviors.Timer.Cnds={OnTimer(e){return!!(e=this._timers.get(e.toLowerCase()))&&e.HasFinished()},IsTimerRunning(e){return this._timers.has(e.toLowerCase())},IsTimerPaused(e){return(e=this._timers.get(e.toLowerCase()))&&e.IsPaused()}};{const e=self.C3;e.Behaviors.Timer.Acts={StartTimer(t,s,i){t=new e.Behaviors.Timer.SingleTimer(0,0,t,1===s),this._timers.set(i.toLowerCase(),t),this._UpdateTickState()},StopTimer(e){this._timers.delete(e.toLowerCase()),this._UpdateTickState()},PauseResumeTimer(e,t){(e=this._timers.get(e.toLowerCase()))&&e.SetPaused(0===t)}}}self.C3.Behaviors.Timer.Exps={CurrentTime(e){return(e=this._timers.get(e.toLowerCase()))?e.GetCurrentTime():0},TotalTime(e){return(e=this._timers.get(e.toLowerCase()))?e.GetTotalTime():0},Duration(e){return(e=this._timers.get(e.toLowerCase()))?e.GetDuration():0}};{const e=self.C3;e.Behaviors.Rotate=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Rotate.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.Rotate.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._acceleration=this._speed=0,this._isEnabled=!0,s&&(this._speed=e.toRadians(s[0]),this._acceleration=e.toRadians(s[1]),this._isEnabled=s[2]),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{s:this._speed,a:this._acceleration,e:this._isEnabled}}LoadFromJson(e){this._speed=e.s,this._acceleration=e.a,this._SetEnabled(e.e)}Tick(){if(this._isEnabled){var e=this._runtime.GetDt(this._inst);if(0!==e&&(0!==this._acceleration&&(this._speed+=this._acceleration*e),0!==this._speed)){const t=this._inst.GetWorldInfo();t.SetAngle(t.GetAngle()+this._speed*e),t.SetBboxChanged()}}}GetPropertyValueByIndex(t){switch(t){case 0:return e.toDegrees(this._speed);case 1:return e.toDegrees(this._acceleration);case 2:return this._isEnabled}}SetPropertyValueByIndex(t,s){switch(t){case 0:this._speed=e.toRadians(s);break;case 1:this._acceleration=e.toRadians(s);break;case 2:this._SetEnabled(s)}}_SetEnabled(e){(this._isEnabled=!!e)?this._StartTicking():this._StopTicking()}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.rotate.properties.speed.name",value:e.toDegrees(this._speed),onedit:t=>this._speed=e.toRadians(t)},{name:"behaviors.rotate.properties.acceleration.name",value:e.toDegrees(this._acceleration),onedit:t=>this._acceleration=e.toRadians(t)},{name:"behaviors.rotate.properties.enabled.name",value:this._isEnabled,onedit:e=>this._SetEnabled(e)}]}]}}}self.C3.Behaviors.Rotate.Cnds={IsEnabled(){return this._isEnabled}};{const e=self.C3;e.Behaviors.Rotate.Acts={SetSpeed(t){this._speed=e.toRadians(t)},SetAcceleration(t){this._acceleration=e.toRadians(t)},SetEnabled(e){this._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.Rotate.Exps={Speed(){return e.toDegrees(this._speed)},Acceleration(){return e.toDegrees(this._acceleration)}}}{const e=self.C3;e.Behaviors.Pin=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Pin.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.Pin.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._pinInst=null,this._pinUid=-1,this._mode="",this._propSet=new Set,this._lastKnownAngle=this._dz=this._dAngle=this._dHeight=this._dWidth=this._dy=this._dx=this._pinImagePoint=this._pinAngle=this._pinDist=0,this._destroy=!1,s&&(this._destroy=s[0]),t=this._runtime.Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),e.Disposable.From(t,"afterload",e=>this._OnAfterLoad()))}Release(){this._pinInst=null,super.Release()}_SetPinInst(e){e?(this._pinInst=e,this._StartTicking2()):(this._pinInst=null,this._StopTicking2())}_Pin(t,s,i){if(t&&(t=t.GetFirstPicked(this._inst)))if(this._mode=s,this._SetPinInst(t),s=this._inst.GetWorldInfo(),t=t.GetWorldInfo(),"properties"===this._mode){const r=this._propSet;r.clear();for(const e of i)r.add(e);this._dx=s.GetX()-t.GetX(),this._dy=s.GetY()-t.GetY(),this._dAngle=s.GetAngle()-t.GetAngle(),this._lastKnownAngle=s.GetAngle(),this._dz=s.GetZElevation()-t.GetZElevation(),r.has("x")&&r.has("y")&&(this._pinAngle=e.angleTo(t.GetX(),t.GetY(),s.GetX(),s.GetY())-t.GetAngle(),this._pinDist=e.distanceTo(t.GetX(),t.GetY(),s.GetX(),s.GetY())),r.has("width-abs")?this._dWidth=s.GetWidth()-t.GetWidth():r.has("width-scale")&&(this._dWidth=s.GetWidth()/t.GetWidth()),r.has("height-abs")?this._dHeight=s.GetHeight()-t.GetHeight():r.has("height-scale")&&(this._dHeight=s.GetHeight()/t.GetHeight())}else this._pinDist=e.distanceTo(t.GetX(),t.GetY(),s.GetX(),s.GetY())}SaveToJson(){const e=this._propSet,t=this._mode,s={uid:this._pinInst?this._pinInst.GetUID():-1,m:t,d:this._destroy};return"rope"===t||"bar"===t?s.pd=this._pinDist:"properties"===t&&(s.ps=[...this._propSet],e.has("imagepoint")?s.ip=this._pinImagePoint:e.has("x")&&e.has("y")?(s.pa=this._pinAngle,s.pd=this._pinDist):(e.has("x")&&(s.dx=this._dx),e.has("y")&&(s.dy=this._dy)),e.has("angle")&&(s.da=this._dAngle,s.lka=this._lastKnownAngle),(e.has("width-abs")||e.has("width-scale"))&&(s.dw=this._dWidth),(e.has("height-abs")||e.has("height-scale"))&&(s.dh=this._dHeight),e.has("z")&&(s.dz=this._dz)),s}LoadFromJson(e){const t=e.m,s=this._propSet;if(s.clear(),this._pinUid=e.uid,"number"==typeof t)this._LoadFromJson_Legacy(e);else if(this._mode=t,e.hasOwnProperty("d")&&(this._destroy=!!e.d),"rope"===t||"bar"===t)this._pinDist=e.pd;else if("properties"===t){for(const t of e.ps)s.add(t);s.has("imagepoint")?this._pinImagePoint=e.ip:s.has("x")&&s.has("y")?(this._pinAngle=e.pa,this._pinDist=e.pd):(s.has("x")&&(this._dx=e.dx),s.has("y")&&(this._dy=e.dy)),s.has("angle")&&(this._dAngle=e.da,this._lastKnownAngle=e.lka||0),(s.has("width-abs")||s.has("width-scale"))&&(this._dWidth=e.dw),(s.has("height-abs")||s.has("height-scale"))&&(this._dHeight=e.dh),s.has("z")&&(this._dz=e.dz)}}_LoadFromJson_Legacy(e){const t=this._propSet,s=e.msa,i=e.tsa,r=e.pa,n=e.pd;switch(e.m){case 0:this._mode="properties",t.add("x").add("y").add("angle"),this._pinAngle=r,this._pinDist=n,this._dAngle=s-i,this._lastKnownAngle=e.lka;break;case 1:this._mode="properties",t.add("x").add("y"),this._pinAngle=r,this._pinDist=n;break;case 2:this._mode="properties",t.add("angle"),this._dAngle=s-i,this._lastKnownAngle=e.lka;break;case 3:this._mode="rope",this._pinDist=e.pd;break;case 4:this._mode="bar",this._pinDist=e.pd}}_OnAfterLoad(){-1===this._pinUid?this._SetPinInst(null):(this._SetPinInst(this._runtime.GetInstanceByUID(this._pinUid)),this._pinUid=-1)}_OnInstanceDestroyed(e){this._pinInst===e&&(this._SetPinInst(null),this._destroy&&this._runtime.DestroyInstance(this._inst))}Tick2(){var t=this._pinInst;if(t){var s=t.GetWorldInfo(),i=this._inst.GetWorldInfo(),r=this._mode,n=!1;if("rope"===r||"bar"===r)t=e.distanceTo(i.GetX(),i.GetY(),s.GetX(),s.GetY()),(t>this._pinDist||"bar"===r&&t<this._pinDist)&&(n=e.angleTo(s.GetX(),s.GetY(),i.GetX(),i.GetY()),i.SetXY(s.GetX()+Math.cos(n)*this._pinDist,s.GetY()+Math.sin(n)*this._pinDist),n=!0);else{if(r=this._propSet,r.has("imagepoint")){const[e,s]=t.GetImagePoint(this._pinImagePoint);i.EqualsXY(e,s)||(i.SetXY(e,s),n=!0)}else if(r.has("x")&&r.has("y")){t=s.GetX()+Math.cos(s.GetAngle()+this._pinAngle)*this._pinDist;const e=s.GetY()+Math.sin(s.GetAngle()+this._pinAngle)*this._pinDist;i.EqualsXY(t,e)||(i.SetXY(t,e),n=!0)}else t=s.GetX()+this._dx,r.has("x")&&t!==i.GetX()&&(i.SetX(t),n=!0),t=s.GetY()+this._dy,r.has("y")&&t!==i.GetY()&&(i.SetY(t),n=!0);r.has("angle")&&(this._lastKnownAngle!==i.GetAngle()&&(this._dAngle=e.clampAngle(this._dAngle+(i.GetAngle()-this._lastKnownAngle))),t=e.clampAngle(s.GetAngle()+this._dAngle),t!==i.GetAngle()&&(i.SetAngle(t),n=!0),this._lastKnownAngle=i.GetAngle()),r.has("width-abs")&&(t=s.GetWidth()+this._dWidth,t!==i.GetWidth()&&(i.SetWidth(t),n=!0)),r.has("width-scale")&&(t=s.GetWidth()*this._dWidth,t!==i.GetWidth()&&(i.SetWidth(t),n=!0)),r.has("height-abs")&&(t=s.GetHeight()+this._dHeight,t!==i.GetHeight()&&(i.SetHeight(t),n=!0)),r.has("height-scale")&&(t=s.GetHeight()*this._dHeight,t!==i.GetHeight()&&(i.SetHeight(t),n=!0)),r.has("z")&&(t=s.GetZElevation()+this._dz,t!==i.GetZElevation()&&(i.SetZElevation(t),this._runtime.UpdateRender()))}n&&i.SetBboxChanged()}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.pin.debugger.is-pinned",value:!!this._pinInst},{name:"behaviors.pin.debugger.pinned-uid",value:this._pinInst?this._pinInst.GetUID():0}]}]}}}self.C3.Behaviors.Pin.Cnds={IsPinned(){return!!this._pinInst},WillDestroy(){return this._destroy}},self.C3.Behaviors.Pin.Acts={PinByDistance(e,t){this._Pin(e,0===t?"rope":"bar")},PinByProperties(e,t,s,i,r,n,a){const o=[];t&&o.push("x"),s&&o.push("y"),i&&o.push("angle"),a&&o.push("z"),1===r?o.push("width-abs"):2===r&&o.push("width-scale"),1===n?o.push("height-abs"):2===n&&o.push("height-scale"),0!==o.length&&this._Pin(e,"properties",o)},PinByImagePoint(e,t,s,i,r,n){const a=["imagepoint"];s&&a.push("angle"),n&&a.push("z"),1===i?a.push("width-abs"):2===i&&a.push("width-scale"),1===r?a.push("height-abs"):2===r&&a.push("height-scale"),this._pinImagePoint=t,this._Pin(e,"properties",a)},SetPinDistance(e){"rope"!==this._mode&&"bar"!==this._mode||(this._pinDist=Math.max(e,0))},SetDestroy(e){this._destroy=e},Unpin(){this._SetPinInst(null),this._mode="",this._propSet.clear(),this._pinImagePoint=""},Pin(e,t){switch(t){case 0:this._Pin(e,"properties",["x","y","angle"]);break;case 1:this._Pin(e,"properties",["x","y"]);break;case 2:this._Pin(e,"properties",["angle"]);break;case 3:this._Pin(e,"rope");break;case 4:this._Pin(e,"bar")}}},self.C3.Behaviors.Pin.Exps={PinnedUID(){return this._pinInst?this._pinInst.GetUID():-1}};{const e=self.C3;e.Behaviors.Platform=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Platform.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance;function c(t,s,i,r,n){return e.clamp(t*n+.5*r*n*n,s*n,i*n)}e.Behaviors.Platform.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._keyboardDisposables=null,this._simJump=this._simRight=this._simLeft=this._ignoreInput=this._canDoubleJump=this._doubleJumped=this._jumped=this._jumpKey=this._rightKey=this._leftKey=!1,this._lastFloorObject=null,this._loadFloorUid=-1,this._lastFloorY=this._lastFloorX=0,this._wasOnFloor=this._floorIsJumpthru=!1,this._wasOverJumpthru=!!this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst),this._loadJumpthruUid=-1,this._animMode="stopped",this._fallThrough=0,this._isFirstTick=!0,this._rightY=this._rightX=this._downY=this._downX=this._dy=this._dx=0,this._g1=this._g=1500,this._ga=e.toRadians(90),this._maxSpeed=330,this._dec=this._acc=1500,this._jumpStrength=650,this._maxFall=1e3,this._enableDoubleJump=!1,this._sustainTime=this._jumpSustain=0,this._defaultControls=!0,this._ceilingCollisionMode=0,this._isEnabled=!0,s&&(this._maxSpeed=s[0],this._acc=s[1],this._dec=s[2],this._jumpStrength=s[3],this._g=s[4],this._maxFall=s[5],this._enableDoubleJump=!!s[6],this._jumpSustain=s[7]/1e3,this._defaultControls=!!s[8],this._isEnabled=!!s[9]),t=this._runtime.Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),e.Disposable.From(t,"afterload",e=>this._OnAfterLoad())),this._defaultControls&&this._BindEvents(),this._isEnabled&&this._StartPostTicking(),this._UpdateGravity(),this._inst.GetUnsavedDataMap().set("isPlatformBehavior",!0)}Release(){this._keyboardDisposables&&(this._keyboardDisposables.Release(),this._keyboardDisposables=null),this._wasOverJumpthru=this._lastFloorObject=null,super.Release()}_BindEvents(){if(!this._keyboardDisposables){var t=this._runtime.Dispatcher();this._keyboardDisposables=new e.CompositeDisposable(e.Disposable.From(t,"keydown",e=>this._OnKeyDown(e.data)),e.Disposable.From(t,"keyup",e=>this._OnKeyUp(e.data)),e.Disposable.From(t,"window-blur",()=>this._OnWindowOrKeyboardBlur()),e.Disposable.From(t,"keyboard-blur",()=>this._OnWindowOrKeyboardBlur()))}}_UnBindEvents(){this._keyboardDisposables&&(this._keyboardDisposables.Release(),this._keyboardDisposables=null)}_OnInstanceDestroyed(e){this._lastFloorObject===e&&(this._lastFloorObject=null),this._wasOverJumpthru===e&&(this._wasOverJumpthru=null)}_OnKeyDown(e){switch(e.key){case"ArrowLeft":this._leftKey=!0;break;case"ArrowRight":this._rightKey=!0;break;case"ArrowUp":this._jumpKey=!0}}_OnKeyUp(e){switch(e.key){case"ArrowLeft":this._leftKey=!1;break;case"ArrowRight":this._rightKey=!1;break;case"ArrowUp":this._jumped=this._jumpKey=!1}}_OnWindowOrKeyboardBlur(){this._jumped=this._jumpKey=this._rightKey=this._leftKey=!1}SaveToJson(){return{ii:this._ignoreInput,lfx:this._lastFloorX,lfy:this._lastFloorY,lfo:this._lastFloorObject?this._lastFloorObject.GetUID():-1,am:this._animMode,en:this._isEnabled,fall:this._fallThrough,ft:this._isFirstTick,dx:this._dx,dy:this._dy,ms:this._maxSpeed,acc:this._acc,dec:this._dec,js:this._jumpStrength,g:this._g,g1:this._g1,mf:this._maxFall,wof:this._wasOnFloor,woj:this._wasOverJumpthru?this._wasOverJumpthru.GetUID():-1,ga:this._ga,edj:this._enableDoubleJump,cdj:this._canDoubleJump,dj:this._doubleJumped,sus:this._jumpSustain,dc:this._defaultControls,cc:this._ceilingCollisionMode}}LoadFromJson(e){this._ignoreInput=e.ii,this._lastFloorX=e.lfx,this._lastFloorY=e.lfy,this._loadFloorUid=e.lfo,this._animMode=e.am;const t=e.en;this._fallThrough=e.fall,this._isFirstTick=e.ft,this._dx=e.dx,this._dy=e.dy,this._maxSpeed=e.ms,this._acc=e.acc,this._dec=e.dec,this._jumpStrength=e.js,this._g=e.g,this._g1=e.g1,this._maxFall=e.mf,this._wasOnFloor=e.wof,this._loadJumpthruUid=e.woj,this._ga=e.ga,this._enableDoubleJump=e.edj,this._canDoubleJump=e.cdj,this._doubleJumped=e.dj,this._jumpSustain=e.sus,this._defaultControls=e.dc,this._ceilingCollisionMode=e.cc||0,this._simJump=this._simRight=this._simLeft=this._jumped=this._jumpKey=this._rightKey=this._leftKey=!1,this._sustainTime=0,this._defaultControls?this._BindEvents():this._UnBindEvents(),this._SetEnabled(t),this._UpdateGravity()}_OnAfterLoad(){this._lastFloorObject=-1===this._loadFloorUid?null:this._runtime.GetInstanceByUID(this._loadFloorUid),this._wasOverJumpthru=-1===this._loadJumpthruUid?null:this._runtime.GetInstanceByUID(this._loadJumpthruUid)}_UpdateGravity(){this._downX=Math.cos(this._ga),this._downY=Math.sin(this._ga),this._rightX=Math.cos(this._ga-Math.PI/2),this._rightY=Math.sin(this._ga-Math.PI/2),this._downX=e.round6dp(this._downX),this._downY=e.round6dp(this._downY),this._rightX=e.round6dp(this._rightX),this._rightY=e.round6dp(this._rightY),this._g1=this._g,0>this._g&&(this._downX*=-1,this._downY*=-1,this._g=Math.abs(this._g))}_GetGDir(){return 0>this._g?-1:1}_IsOnFloor(){var e=this._inst.GetWorldInfo();const t=this._runtime.GetCollisionEngine(),s=this._inst;var i=this._lastFloorObject;const r=e.GetX(),n=e.GetY();if(e.OffsetXY(this._downX,this._downY),e.SetBboxChanged(),i&&t.TestOverlap(s,i)&&(!i.GetObjectClass().HasSolidBehavior()||t.IsSolidCollisionAllowed(i,s)))return e.SetXY(r,n),e.SetBboxChanged(),i;{let a=t.TestOverlapSolid(s);if(i=null,a||0!==this._fallThrough||(i=t.TestOverlapJumpthru(s,!0)),e.SetXY(r,n),e.SetBboxChanged(),a)return t.TestOverlap(s,a)?null:(this._floorIsJumpthru=!1,a);if(i&&i.length){e=0;for(let r=0,n=i.length;r<n;++r)i[e]=i[r],t.TestOverlap(s,i[r])||++e;if(1<=e)return this._floorIsJumpthru=!0,i[0]}return null}}PostTick(){if(this._isEnabled){var e=this._runtime.GetDt(this._inst);this._jumpKey||this._simJump||(this._jumped=!1);var t=this._leftKey||this._simLeft,s=this._rightKey||this._simRight,i=this._jumpKey||this._simJump,r=i&&!this._jumped;this._simJump=this._simRight=this._simLeft=!1,this._ignoreInput&&(r=i=s=t=!1),i||(this._sustainTime=0),this._HandleFirstTick();var n,[a,,o]=this._TrackMovingPlatform(),h=this._IsOnFloor(),l=h&&!this._wasOnFloor;if([n,h]=this._MaybePushOutSolid(h),!n){if(this._TrackFloor(h,o,a,i),r=this._HandleJump(h,r,i),h||this._ApplyJumpGravity(r,i,e),this._wasOnFloor=!!h,t=this._ApplyHorizontalAcceleration(t,s,e),s=!1,i=0,0!==this._dx&&(s=this._HandleHorizontalMovement(e,t,h,r)),0!==this._dy){const[t,r]=this._HandleVerticalMovement(e,h);s=s||t,i=r}!s&&l&&0>this._dy&&0<i&&(this._dy=0,s=!0),this._HandleAnimationTriggers(h,s,r),0<this._fallThrough&&this._fallThrough--,this._wasOverJumpthru=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst)}}}_HandleFirstTick(){if(this._isFirstTick){var e=this._inst,t=this._runtime.GetCollisionEngine();(t.TestOverlapSolid(e)||t.TestOverlapJumpthru(e))&&t.PushOutSolid(e,-this._downX,-this._downY,4,!0),this._isFirstTick=!1}}_TrackMovingPlatform(){var e=this._lastFloorObject,t=e?e.GetWorldInfo():null;let s=0,i=0;var r=!1;if(e&&0===this._dy&&(t.GetY()!==this._lastFloorY||t.GetX()!==this._lastFloorX)){e=this._inst,r=e.GetWorldInfo();const n=this._runtime.GetCollisionEngine(),a=t.GetX();t=t.GetY(),s=a-this._lastFloorX,i=t-this._lastFloorY,r.OffsetXY(s,i),r.SetBboxChanged(),this._lastFloorX=a,this._lastFloorY=t,r=!0,n.TestOverlapSolid(e)&&n.PushOutSolid(e,-s,-i,2.5*Math.hypot(s,i))}return[s,i,r]}_MaybePushOutSolid(e){let t=!1;var s=this._inst,i=s.GetWorldInfo();const r=this._runtime.GetCollisionEngine(),n=r.TestOverlapSolid(s);if(!n)return[!1,e];const a=Math.abs(i.GetWidth());return i=Math.abs(i.GetHeight()),s.GetSavedDataMap().get("inputPredicted")?r.PushOutSolid(s,-this._downX,-this._downY,10,!1):r.PushOutSolidAxis(s,-this._downX,-this._downY,i/8)?(r.RegisterCollision(s,n),this._lastFloorObject=e=n,s=n.GetWorldInfo(),this._lastFloorX=s.GetX(),this._lastFloorY=s.GetY(),this._floorIsJumpthru=!1):r.PushOutSolidAxis(s,this._rightX,this._rightY,a/2)||r.PushOutSolidAxis(s,this._downX,this._downY,i/2)||r.PushOutSolidNearest(s,Math.max(a,i)/2)?r.RegisterCollision(s,n):t=!0,[t,e]}_TrackFloor(e,t,s,i){const r=this._inst,n=this._runtime.GetCollisionEngine();if(e){i=this._downX;const a=this._downY,o=this._rightX,h=this._rightY;this._canDoubleJump=this._doubleJumped=!1,0<this._dy&&(this._wasOnFloor||(n.PushInFractional(r,-i,-a,e,16),this._wasOnFloor=!0),this._dy=0),this._lastFloorObject!==e?(this._lastFloorObject=e,s=e.GetWorldInfo(),this._lastFloorX=s.GetX(),this._lastFloorY=s.GetY(),n.RegisterCollision(r,e)):t&&(e=n.TestOverlapSolid(r))&&(n.RegisterCollision(r,e),0!==s&&(0<s?n.PushOutSolid(r,-o,-h):n.PushOutSolid(r,o,h)),n.PushOutSolid(r,-i,-a))}else i||(this._canDoubleJump=!0)}_HandleJump(t,s,i){if(t&&s||!t&&this._enableDoubleJump&&i&&this._canDoubleJump&&!this._doubleJumped){s=this._inst,i=s.GetWorldInfo();const r=this._runtime.GetCollisionEngine(),n=i.GetX(),a=i.GetY();i.OffsetXY(-this._downX,-this._downY),i.SetBboxChanged(),r.TestOverlapSolid(s)?s=!1:(this._sustainTime=this._jumpSustain,this.Trigger(e.Behaviors.Platform.Cnds.OnJump),this._animMode="jumping",this._dy=-this._jumpStrength,s=!0,t?this._jumped=!0:this._doubleJumped=!0),i.SetXY(n,a),i.SetBboxChanged()}return s}_ApplyJumpGravity(e,t,s){t&&0<this._sustainTime?(this._dy=-this._jumpStrength,this._sustainTime-=s):(this._lastFloorObject=null,this._dy+=this._g*s,this._dy>this._maxFall&&(this._dy=this._maxFall)),e&&(this._jumped=!0)}_ApplyHorizontalAcceleration(t,s,i){const r=this._acc,n=this._dec;t===s&&(0>this._dx?(this._dx+=n*i,0<this._dx&&(this._dx=0)):0<this._dx&&(this._dx-=n*i,0>this._dx&&(this._dx=0)));let a=0;return t&&!s&&(a=0<this._dx?-(r+n):-r),s&&!t&&(a=0>this._dx?r+n:r),this._dx+=a*i,this._dx=e.clamp(this._dx,-this._maxSpeed,this._maxSpeed),a}_HandleHorizontalMovement(e,t,s,i){const r=this._inst;var n=r.GetWorldInfo();const a=this._runtime.GetCollisionEngine(),o=this._downX,h=this._downY,l=this._rightX,u=this._rightY;var _=this._maxSpeed;let d=!1;var p=n.GetX();let g=n.GetY();var m=c(this._dx,-_,_,t,e)*l;const f=c(this._dx,-_,_,t,e)*u;n.OffsetXY(l*(1<this._dx?1:-1)-o,u*(1<this._dx?1:-1)-h),n.SetBboxChanged(),t=!1,_=a.TestOverlapSolid(r),n.SetXY(p+m,g+f),n.SetBboxChanged();let S=a.TestOverlapSolid(r);return!S&&s&&(S=a.TestOverlapJumpthru(r))&&(n.SetXY(p,g),n.SetBboxChanged(),a.TestOverlap(r,S)?(S=null,t=!1):t=!0,n.SetXY(p+m,g+f),n.SetBboxChanged()),S?(m=Math.abs(this._dx*e)+2,_||!a.PushOutSolid(r,-o,-h,m,t,S)?(a.RegisterCollision(r,S),m=Math.max(Math.abs(this._dx*e*2.5),30),a.PushOutSolid(r,l*(0>this._dx?1:-1),u*(0>this._dx?1:-1),m,!1)?!s||t||this._floorIsJumpthru||(p=n.GetX(),g=n.GetY(),n.OffsetXY(o,h),a.TestOverlapSolid(r)&&a.PushOutSolid(r,-o,-h,3,!1)||(n.SetXY(p,g),n.SetBboxChanged())):(n.SetXY(p,g),n.SetBboxChanged()),t||(this._dx=0)):!_&&!i&&Math.abs(this._dy)<Math.abs(this._jumpStrength/4)&&(this._dy=0,s||(d=!0))):(p=this._IsOnFloor(),s&&!p?(e=Math.ceil(Math.abs(this._dx*e))+2,p=n.GetX(),g=n.GetY(),n.OffsetXY(o*e,h*e),n.SetBboxChanged(),a.TestOverlapSolid(r)||a.TestOverlapJumpthru(r)?a.PushOutSolid(r,-o,-h,e+2,!0):(n.SetXY(p,g),n.SetBboxChanged())):p&&(!s&&this._floorIsJumpthru&&(this._lastFloorObject=p,n=p.GetWorldInfo(),this._lastFloorX=n.GetX(),this._lastFloorY=n.GetY(),this._dy=0,d=!0),0===this._dy&&a.PushInFractional(r,-o,-h,p,16))),d}_HandleVerticalMovement(t,s){const i=this._inst,r=i.GetWorldInfo(),n=this._runtime.GetCollisionEngine(),a=this._downX,o=this._downY;let h=!1,l=r.GetX(),u=r.GetY();const _=c(this._dy,-1/0,this._maxFall,this._g,t);r.OffsetXY(_*a,_*o);var d=r.GetX();const p=r.GetY();r.SetBboxChanged();let g=n.TestOverlapSolid(i);var m=!1;if(!g&&0<this._dy&&!s){if((m=0<this._fallThrough?null:n.TestOverlapJumpthru(i,!0))&&m.length){if(this._wasOverJumpthru){r.SetXY(l,u),r.SetBboxChanged(),s=0;for(let e=0,t=m.length;e<t;++e)m[s]=m[e],n.TestOverlap(i,m[e])||++s;e.truncateArray(m,s),r.SetXY(d,p),r.SetBboxChanged()}1<=m.length&&(g=m[0])}m=!!g}return g&&(n.RegisterCollision(i,g),this._sustainTime=0,d=1.1,m&&!this._wasOverJumpthru&&(d=2),n.PushOutSolid(i,a*(0>this._dy?1:-1),o*(0>this._dy?1:-1),Math.max(Math.abs(this._dy*t*d),2),m,g)?(this._lastFloorObject=g,t=g.GetWorldInfo(),this._lastFloorX=t.GetX(),this._lastFloorY=t.GetY(),(this._floorIsJumpthru=m)&&(h=!0),(0<this._dy||0===this._ceilingCollisionMode)&&(this._dy=0),0>this._dy&&1===this._ceilingCollisionMode&&n.PushInFractional(i,a,o,g,32)):(r.SetXY(l,u),r.SetBboxChanged(),this._wasOnFloor=!0,m||(this._dy=0))),[h,_]}_HandleAnimationTriggers(t,s,i){"falling"!==this._animMode&&0<this._dy&&!t&&(this.Trigger(e.Behaviors.Platform.Cnds.OnFall),this._animMode="falling"),(t||s)&&0<=this._dy&&("falling"===this._animMode||s||i&&0===this._dy?(this.Trigger(e.Behaviors.Platform.Cnds.OnLand),this._animMode=0===this._dx&&0===this._dy?"stopped":"moving"):("stopped"!==this._animMode&&0===this._dx&&0===this._dy&&(this.Trigger(e.Behaviors.Platform.Cnds.OnStop),this._animMode="stopped"),"moving"===this._animMode||0===this._dx&&0===this._dy||i||(this.Trigger(e.Behaviors.Platform.Cnds.OnMove),this._animMode="moving")))}_IsMoving(){return 0!==this._GetVectorX()||0!==this._GetVectorY()}_CheckIfStandingOnFloor(){if(0!==this._dy)return!1;const e=this._inst;var t=this.GetWorldInfo();const s=this._runtime.GetCollisionEngine(),i=t.GetX(),r=t.GetY();t.OffsetXY(this._downX,this._downY),t.SetBboxChanged();const n=s.TestOverlapSolid(e);let a=null;if(n||0!==this._fallThrough||(a=s.TestOverlapJumpthru(e,!0)),t.SetXY(i,r),t.SetBboxChanged(),n)return!s.TestOverlap(e,n);if(a&&a.length){t=0;for(let i=0,r=a.length;i<r;++i)a[t]=a[i],s.TestOverlap(e,a[i])||t++;if(1<=t)return!0}return!1}_IsByWall(e){const t=this._inst,s=this.GetWorldInfo(),i=this._runtime.GetCollisionEngine(),r=s.GetX(),n=s.GetY();return 0===e?s.OffsetXY(2*-this._rightX,2*-this._rightY):s.OffsetXY(2*this._rightX,2*this._rightY),s.SetBboxChanged(),i.TestOverlapSolid(t)?(s.OffsetXY(3*-this._downX,3*-this._downY),s.SetBboxChanged(),e=!!i.TestOverlapSolid(t),s.SetXY(r,n),s.SetBboxChanged(),e):(s.SetXY(r,n),s.SetBboxChanged(),!1)}_FallThroughJumpThru(){const e=this.GetWorldInfo(),t=e.GetX(),s=e.GetY();e.OffsetXY(this._downX,this._downY),e.SetBboxChanged();const i=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst,!1);e.SetXY(t,s),e.SetBboxChanged(),i&&(this._fallThrough=3,this._lastFloorObject=null)}_ResetDoubleJump(e){this._doubleJumped=!e}_GetSpeed(){return Math.hypot(this._dx,this._dy)}_GetMovingAngle(){return Math.atan2(this._dy,this._dx)}_IsJumping(){return 0>this._dy}_IsFalling(){return 0<this._dy}_SetMaxSpeed(e){this._maxSpeed=Math.max(e,0)}_GetMaxSpeed(){return this._maxSpeed}_SetAcceleration(e){this._acc=Math.max(e,0)}_GetAcceleration(){return this._acc}_SetDeceleration(e){this._dec=Math.max(e,0)}_GetDeceleration(){return this._dec}_SetJumpStrength(e){this._jumpStrength=Math.max(e,0)}_GetJumpStrength(){return this._jumpStrength}_SetMaxFallSpeed(e){this._maxFall=Math.max(e,0)}_GetMaxFallSpeed(){return this._maxFall}_SetGravity(e){if(this._g1!==e){this._g=e,this._UpdateGravity(),e=this._runtime.GetCollisionEngine();var t=this.GetWorldInfo();e.TestOverlapSolid(this._inst)&&(e.PushOutSolid(this._inst,this._downX,this._downY,10),t.OffsetXY(2*this._downX,2*this._downY),t.SetBboxChanged()),this._lastFloorObject=null}}_GetGravity(){return this._g}_SetGravityAngle(t){t=e.clampAngle(t),this._ga!==t&&(this._ga=t,this._UpdateGravity(),this._lastFloorObject=null)}_GetGravityAngle(){return this._ga}_SetDoubleJumpEnabled(e){this._enableDoubleJump=!!e}_IsDoubleJumpEnabled(){return this._enableDoubleJump}_SetJumpSustain(e){this._jumpSustain=e}_GetJumpSustain(){return this._jumpSustain}_SetCeilingCollisionMode(e){this._ceilingCollisionMode=e}_GetCeilingCollisionMode(){return this._ceilingCollisionMode}_SetVectorX(e){this._dx=e}_GetVectorX(){return this._dx}_SetVectorY(e){this._dy=e}_GetVectorY(){return this._dy}_SimulateControl(e){if(this._isEnabled)switch(e){case 0:this._simLeft=!0;break;case 1:this._simRight=!0;break;case 2:this._simJump=!0}}_SetDefaultControls(e){e=!!e,this._defaultControls!==e&&((this._defaultControls=e)?this._BindEvents():(this._UnBindEvents(),this._OnWindowOrKeyboardBlur()))}_IsDefaultControls(){return this._defaultControls}_SetIgnoreInput(e){this._ignoreInput=!!e}_IsIgnoreInput(){return this._ignoreInput}_SetEnabled(e){e=!!e,this._isEnabled!==e&&((this._isEnabled=e)?this._StartPostTicking():(this._StopPostTicking(),this._lastFloorObject=null,this._simJump=this._simRight=this._simLeft=!1))}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(e){switch(e){case 0:return this._GetMaxSpeed();case 1:return this._GetAcceleration();case 2:return this._GetDeceleration();case 3:return this._GetJumpStrength();case 4:return this._GetGravity();case 5:return this._GetMaxFallSpeed();case 6:return this._IsDoubleJumpEnabled();case 7:return 1e3*this._GetJumpSustain();case 8:return this._IsDefaultControls();case 9:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetMaxSpeed(t);break;case 1:this._SetAcceleration(t);break;case 2:this._SetDeceleration(t);break;case 3:this._SetJumpStrength(t);break;case 4:this._SetGravity(t);break;case 5:this._SetMaxFallSpeed(t);break;case 6:this._SetDoubleJumpEnabled(!!t);break;case 7:this._SetJumpSustain(t/1e3);break;case 8:this._SetDefaultControls(!!t);break;case 9:this._SetEnabled(!!t)}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.platform.debugger.vector-x",value:this._GetVectorX(),onedit:e=>this._SetVectorX(e)},{name:"behaviors.platform.debugger.vector-y",value:this._GetVectorY(),onedit:e=>this._SetVectorY(e)},{name:"behaviors.platform.properties.max-speed.name",value:this._GetMaxSpeed(),onedit:e=>this._SetMaxSpeed(e)},{name:"behaviors.platform.properties.acceleration.name",value:this._GetAcceleration(),onedit:e=>this._SetAcceleration(e)},{name:"behaviors.platform.properties.deceleration.name",value:this._GetDeceleration(),onedit:e=>this._SetDeceleration(e)},{name:"behaviors.platform.properties.jump-strength.name",value:this._GetJumpStrength(),onedit:e=>this._SetJumpStrength(e)},{name:"behaviors.platform.properties.gravity.name",value:this._GetGravity(),onedit:e=>this._SetGravity(e)},{name:"behaviors.platform.debugger.gravity-angle",value:e.toDegrees(this._GetGravityAngle()),onedit:t=>this._SetGravityAngle(e.toRadians(t))},{name:"behaviors.platform.properties.max-fall-speed.name",value:this._GetMaxFallSpeed(),onedit:e=>this._SetMaxFallSpeed(e)},{name:"behaviors.platform.debugger.animation-mode",value:["behaviors.platform.debugger.anim-"+this._animMode]},{
name:"behaviors.platform.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IPlatformBehaviorInstance}};const i=new WeakMap,r=new Map([["left",0],["right",1],["jump",2]]);self.IPlatformBehaviorInstance=class extends s{constructor(){super(),i.set(this,s._GetInitInst().GetSdkInstance())}fallThrough(){i.get(this)._FallThroughJumpThru()}resetDoubleJump(e){i.get(this)._ResetDoubleJump(!!e)}simulateControl(e){if(t.RequireString(e),e=r.get(e),"number"!=typeof e)throw Error("invalid control");i.get(this)._SimulateControl(e)}get speed(){return i.get(this)._GetSpeed()}get maxSpeed(){return i.get(this)._GetMaxSpeed()}set maxSpeed(e){t.RequireFiniteNumber(e),i.get(this)._SetMaxSpeed(e)}get acceleration(){return i.get(this)._GetAcceleration()}set acceleration(e){t.RequireFiniteNumber(e),i.get(this)._SetAcceleration(e)}get deceleration(){return i.get(this)._GetDeceleration()}set deceleration(e){t.RequireFiniteNumber(e),i.get(this)._SetDeceleration(e)}get jumpStrength(){return i.get(this)._GetJumpStrength()}set jumpStrength(e){t.RequireFiniteNumber(e),i.get(this)._SetJumpStrength(e)}get maxFallSpeed(){return i.get(this)._GetMaxFallSpeed()}set maxFallSpeed(e){t.RequireFiniteNumber(e),i.get(this)._SetMaxFallSpeed(e)}get gravity(){return i.get(this)._GetGravity()}set gravity(e){t.RequireFiniteNumber(e),i.get(this)._SetGravity(e)}get gravityAngle(){return i.get(this)._GetGravityAngle()}set gravityAngle(e){t.RequireFiniteNumber(e),i.get(this)._SetGravityAngle(e)}get isDoubleJumpEnabled(){return i.get(this)._IsDoubleJumpEnabled()}set isDoubleJumpEnabled(e){i.get(this)._SetDoubleJumpEnabled(!!e)}get jumpSustain(){return i.get(this)._GetJumpSustain()}set jumpSustain(e){t.RequireFiniteNumber(e),i.get(this)._SetJumpSustain(e)}get ceilingCollisionMode(){return 0===i.get(this)._GetCeilingCollisionMode()?"stop":"preserve-momentum"}set ceilingCollisionMode(e){t.RequireString(e);const s=i.get(this);if("stop"===e)s._SetCeilingCollisionMode(0);else{if("preserve-momentum"!==e)throw Error("invalid mode");s._SetCeilingCollisionMode(1)}}get isOnFloor(){return i.get(this)._CheckIfStandingOnFloor()}isByWall(e){t.RequireString(e);const s=i.get(this);if("left"===e)return s._IsByWall(0);if("right"===e)return s._IsByWall(1);throw Error("invalid side")}get isMoving(){return i.get(this)._IsMoving()}get isJumping(){return i.get(this)._IsJumping()}get isFalling(){return i.get(this)._IsFalling()}get vectorX(){return i.get(this)._GetVectorX()}set vectorX(e){t.RequireFiniteNumber(e),i.get(this)._SetVectorX(e)}get vectorY(){return i.get(this)._GetVectorY()}set vectorY(e){t.RequireFiniteNumber(e),i.get(this)._SetVectorY(e)}get isDefaultControls(){return i.get(this)._IsDefaultControls()}set isDefaultControls(e){i.get(this)._SetDefaultControls(!!e)}get isIgnoringInput(){return i.get(this)._IsIgnoreInput()}set isIgnoringInput(e){i.get(this)._SetIgnoreInput(!!e)}get isEnabled(){return i.get(this)._IsEnabled()}set isEnabled(e){i.get(this)._SetEnabled(!!e)}}}{const e=self.C3;e.Behaviors.Platform.Cnds={IsMoving(){return this._IsMoving()},CompareSpeed(t,s){return e.compare(this._GetSpeed(),t,s)},IsOnFloor(){return this._CheckIfStandingOnFloor()},IsByWall(e){return this._IsByWall(e)},IsJumping(){return this._IsJumping()},IsFalling(){return this._IsFalling()},IsDoubleJumpEnabled(){return this._IsDoubleJumpEnabled()},OnJump:()=>!0,OnFall:()=>!0,OnStop:()=>!0,OnMove:()=>!0,OnLand:()=>!0,IsEnabled(){return this._IsEnabled()}}}{const e=self.C3;e.Behaviors.Platform.Acts={SetMaxSpeed(e){this._SetMaxSpeed(e)},SetAcceleration(e){this._SetAcceleration(e)},SetDeceleration(e){this._SetDeceleration(e)},SetJumpStrength(e){this._SetJumpStrength(e)},SetMaxFallSpeed(e){this._SetMaxFallSpeed(e)},SetGravity(e){this._SetGravity(e)},SimulateControl(e){this._SimulateControl(e)},SetIgnoreInput(e){this._SetIgnoreInput(!!e)},SetVectorX(e){this._SetVectorX(e)},SetVectorY(e){this._SetVectorY(e)},SetGravityAngle(t){this._SetGravityAngle(e.toRadians(t))},SetEnabled(e){this._SetEnabled(0!==e)},FallThrough(){this._FallThroughJumpThru()},SetDoubleJumpEnabled(e){this._SetDoubleJumpEnabled(0!==e)},SetJumpSustain(e){this._SetJumpSustain(e/1e3)},SetCeilingCollision(e){this._SetCeilingCollisionMode(e)},SetDefaultControls(e){this._SetDefaultControls(e)},ResetDoubleJump(e){this._ResetDoubleJump(e)}}}{const e=self.C3;e.Behaviors.Platform.Exps={Speed(){return this._GetSpeed()},MaxSpeed(){return this._GetMaxSpeed()},Acceleration(){return this._GetAcceleration()},Deceleration(){return this._GetDeceleration()},JumpStrength(){return this._GetJumpStrength()},Gravity(){return this._GetGravity()},GravityAngle(){return e.toDegrees(this._GetGravityAngle())},MaxFallSpeed(){return this._GetMaxFallSpeed()},MovingAngle(){return e.toDegrees(this._GetMovingAngle())},VectorX(){return this._GetVectorX()},VectorY(){return this._GetVectorY()},JumpSustain(){return 1e3*this._GetJumpSustain()}}}{const e=self.C3;e.Behaviors.Flash=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Flash.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.Flash.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._timeLeft=this._stageTimeLeft=this._stage=this._offTime=this._onTime=0,this._StartTicking()}Release(){super.Release()}SaveToJson(){return{on:this._onTime,off:this._offTime,s:this._stage,stl:this._stageTimeLeft,tl:this._timeLeft}}LoadFromJson(e){this._onTime=e.on,this._offTime=e.off,this._stage=e.s,this._stageTimeLeft=e.stl,this._timeLeft=null===e.tl?1/0:e.tl}Tick(){if(!(0>=this._timeLeft)){var t=this._runtime.GetDt(this._inst);if(this._timeLeft-=t,0>=this._timeLeft)return this._timeLeft=0,this._inst.GetWorldInfo().SetVisible(!0),this._runtime.UpdateRender(),this.DebugTrigger(e.Behaviors.Flash.Cnds.OnFlashEnded);this._stageTimeLeft-=t,0>=this._stageTimeLeft&&(0===this._stage?(this._inst.GetWorldInfo().SetVisible(!1),this._stage=1,this._stageTimeLeft+=this._offTime):(this._inst.GetWorldInfo().SetVisible(!0),this._stage=0,this._stageTimeLeft+=this._onTime),this._runtime.UpdateRender())}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.flash.debugger.on-time",value:this._onTime,onedit:e=>this._onTime=e},{name:"behaviors.flash.debugger.off-time",value:this._offTime,onedit:e=>this._offTime=e},{name:"behaviors.flash.debugger.is-flashing",value:0<this._timeLeft},{name:"behaviors.flash.debugger.time-left",value:this._timeLeft}]}]}}}self.C3.Behaviors.Flash.Cnds={IsFlashing(){return 0<this._timeLeft},OnFlashEnded:()=>!0},self.C3.Behaviors.Flash.Acts={Flash(e,t,s){this._onTime=e,this._offTime=t,this._stage=1,this._stageTimeLeft=t,this._timeLeft=s,this._inst.GetWorldInfo().SetVisible(!1),this._runtime.UpdateRender()},StopFlashing(){this._timeLeft=0,this._inst.GetWorldInfo().SetVisible(!0),this._runtime.UpdateRender()}},self.C3.Behaviors.Flash.Exps={};{const e=self.C3;e.Behaviors.scrollto=class extends e.SDKBehaviorBase{constructor(e){super(e),this._shakeMode=this._shakeEnd=this._shakeStart=this._shakeMag=0}Release(){super.Release()}SetShakeMagnitude(e){this._shakeMag=e}GetShakeMagnitude(){return this._shakeMag}SetShakeStart(e){this._shakeStart=e}GetShakeStart(){return this._shakeStart}SetShakeEnd(e){this._shakeEnd=e}GetShakeEnd(){return this._shakeEnd}SetShakeMode(e){this._shakeMode=e}GetShakeMode(){return this._shakeMode}}}{const e=self.C3;e.Behaviors.scrollto.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.scrollto.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._isEnabled=!0,t&&(this._isEnabled=t[0]),this._isEnabled&&this._StartTicking2()}Release(){super.Release()}SaveToJson(){const e=this.GetBehavior();return{e:this._isEnabled,smg:e.GetShakeMagnitude(),ss:e.GetShakeStart(),se:e.GetShakeEnd(),smd:e.GetShakeMode()}}LoadFromJson(e){const t=this.GetBehavior();t.SetShakeMagnitude(e.smg),t.SetShakeStart(e.ss),t.SetShakeEnd(e.se),t.SetShakeMode(e.smd),(this._isEnabled=e.e)?this._StartTicking2():this._StopTicking2()}IsEnabled(){return this._isEnabled}Tick2(){if(this.IsEnabled()){this._runtime.GetDt(this._inst);var t=this.GetBehavior(),s=t.GetInstances(),i=0,r=0,n=0;for(var a of s)(s=a.GetBehaviorInstanceFromCtor(e.Behaviors.scrollto))&&s.GetSdkInstance().IsEnabled()&&(s=a.GetWorldInfo(),i+=s.GetX(),r+=s.GetY(),++n);a=this._inst.GetWorldInfo().GetLayout();var o=this._runtime.GetGameTime(),h=s=0;o>=t.GetShakeStart()&&o<t.GetShakeEnd()&&(s=t.GetShakeMagnitude()*Math.min(this._runtime.GetTimeScale(),1),0===t.GetShakeMode()&&(s*=1-(o-t.GetShakeStart())/(t.GetShakeEnd()-t.GetShakeStart())),t=this._runtime.Random()*Math.PI*2,o=this._runtime.Random()*s,s=Math.cos(t)*o,h=Math.sin(t)*o),a.SetScrollX(i/n+s),a.SetScrollY(r/n+h)}}GetPropertyValueByIndex(e){switch(e){case 0:return this._isEnabled}}SetPropertyValueByIndex(e,t){switch(e){case 0:(this._isEnabled=!!t)?this._StartTicking2():this._StopTicking2()}}}}self.C3.Behaviors.scrollto.Cnds={IsEnabled(){return this._isEnabled}},self.C3.Behaviors.scrollto.Acts={Shake(e,t,s){const i=this.GetBehavior();i.SetShakeMagnitude(e),i.SetShakeStart(this._runtime.GetGameTime()),i.SetShakeEnd(this._runtime.GetGameTime()+t),i.SetShakeMode(s)},SetEnabled(e){(this._isEnabled=0!==e)?this._StartTicking2():this._StopTicking2()}},self.C3.Behaviors.scrollto.Exps={};{const e=self.C3;e.Behaviors.MoveTo=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.MoveTo.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance;e.Behaviors.MoveTo.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._maxSpeed=200,this._dec=this._acc=600,this._rotateSpeed=0,this._setAngle=!0,this._stopOnSolids=!1,this._isEnabled=!0,this._speed=0,this._movingAngle=this.GetWorldInfo().GetAngle(),this._waypoints=[],s&&(this._maxSpeed=s[0],this._acc=s[1],this._dec=s[2],this._rotateSpeed=e.toRadians(s[3]),this._setAngle=s[4],this._stopOnSolids=s[5],this._isEnabled=s[6])}Release(){super.Release()}SaveToJson(){return{ms:this._maxSpeed,acc:this._acc,dec:this._dec,rs:this._rotateSpeed,sa:this._setAngle,sos:this._stopOnSolids,s:this._speed,ma:this._movingAngle,wp:this._waypoints.map(e=>({x:e.x,y:e.y})),e:this._isEnabled}}LoadFromJson(e){this._maxSpeed=e.ms,this._acc=e.acc,this._dec=e.dec,this._rotateSpeed=e.rs,this._setAngle=e.sa,this._stopOnSolids=e.sos,this._speed=e.s,this._movingAngle=e.ma,this._waypoints=e.wp.map(e=>({x:e.x,y:e.y})),this._SetEnabled(e.e),this._isEnabled&&0<this._waypoints.length&&this._StartTicking()}_AddWaypoint(t,s,i){i&&e.clearArray(this._waypoints),this._waypoints.push({x:t,y:s}),this._isEnabled&&this._StartTicking()}_GetWaypointCount(){return this._waypoints.length}_GetWaypointXAt(e){return e=Math.floor(e),0>e||e>=this._waypoints.length?0:this._waypoints[e].x}_GetWaypointYAt(e){return e=Math.floor(e),0>e||e>=this._waypoints.length?0:this._waypoints[e].y}_IsMoving(){return 0<this._waypoints.length}_Stop(){e.clearArray(this._waypoints),this._speed=0,this._StopTicking()}_GetTargetX(){return 0<this._waypoints.length?this._waypoints[0].x:0}_GetTargetY(){return 0<this._waypoints.length?this._waypoints[0].y:0}_SetSpeed(e){this._IsMoving()&&(this._speed=Math.min(e,this._maxSpeed))}_GetSpeed(){return this._speed}_SetMaxSpeed(e){this._maxSpeed=Math.max(e,0),this._SetSpeed(this._speed)}_GetMaxSpeed(){return this._maxSpeed}_IsRotationEnabled(){return 0!==this._rotateSpeed}Tick(){if(this._isEnabled&&this._IsMoving()){var t=this._runtime.GetDt(this._inst),s=this._inst.GetWorldInfo(),i=s.GetX(),r=s.GetY(),n=s.GetAngle(),a=this._speed,o=this._maxSpeed,h=this._acc,l=this._dec,c=this._GetTargetX(),u=this._GetTargetY(),_=e.angleTo(i,r,c,u),d=!1;if(0<l&&1===this._waypoints.length&&(d=.5*a*a/l*1.0001,d=e.distanceSquared(i,r,c,u)<=d*d)&&(o=e.distanceTo(i,r,c,u),this._speed=o=a=Math.sqrt(2*l*o)),this._IsRotationEnabled()){var p=e.angleDiff(this._movingAngle,_);if(p>Number.EPSILON){const t=p/this._rotateSpeed;p*=e.distanceTo(s.GetX(),s.GetY(),c,u)/(2*Math.sin(p)),o=Math.min(o,e.clamp(p/t,0,this._maxSpeed))}}if(a=Math.min(a*t+.5*(d?-l:h)*t*t,o*t),d){if(0<l&&(this._speed=Math.max(this._speed-l*t,0),0===this._speed))return void this._OnArrived(s,c,u)}else this._speed=0===h?o:Math.min(this._speed+h*t,o);e.distanceSquared(s.GetX(),s.GetY(),c,u)<=a*a?this._OnArrived(s,c,u):(this._IsRotationEnabled()?this._movingAngle=e.angleRotate(this._movingAngle,_,this._rotateSpeed*t):this._movingAngle=_,s.OffsetXY(Math.cos(this._movingAngle)*a,Math.sin(this._movingAngle)*a),this._setAngle&&s.SetAngle(this._movingAngle),s.SetBboxChanged(),this._CheckSolidCollision(i,r,n))}}_OnArrived(t,s,i){t.SetXY(s,i),t.SetBboxChanged(),this._waypoints.shift(),0===this._waypoints.length&&(this._speed=0,this._StopTicking()),this.DispatchScriptEvent("arrived"),this.Trigger(e.Behaviors.MoveTo.Cnds.OnArrived)}_CheckSolidCollision(t,s,i){const r=this._runtime.GetCollisionEngine();if(this._stopOnSolids&&r.TestOverlapSolid(this._inst)){this._Stop();const a=this._inst.GetWorldInfo();var n=a.GetX();const o=a.GetY(),h=e.angleTo(n,o,t,s);n=e.distanceTo(n,o,t,s),r.PushOutSolid(this._inst,Math.cos(h),Math.sin(h),Math.max(n,1))||(a.SetXY(t,s),a.SetAngle(i),a.SetBboxChanged()),this.DispatchScriptEvent("hitsolid"),this.Trigger(e.Behaviors.MoveTo.Cnds.OnHitSolid)}}_IsSetAngle(){return this._setAngle}_SetSetAngle(e){this._setAngle=!!e}_SetAngleOfMotion(e){this._movingAngle=e,this._isEnabled&&this._setAngle&&!this._IsMoving()&&(e=this.GetWorldInfo(),e.SetAngle(this._movingAngle),e.SetBboxChanged())}_GetAngleOfMotion(){return this._movingAngle}_SetAcceleration(e){this._acc=Math.max(e,0)}_GetAcceleration(){return this._acc}_SetDeceleration(e){this._dec=Math.max(e,0)}_GetDeceleration(){return this._dec}_SetRotateSpeed(e){this._rotateSpeed=Math.max(e,0)}_GetRotateSpeed(){return this._rotateSpeed}_SetStopOnSolids(e){this._stopOnSolids=!!e}_IsStopOnSolids(){return this._stopOnSolids}_SetEnabled(e){e=!!e,this._isEnabled!==e&&((this._isEnabled=e)&&this._IsMoving()?this._StartTicking():this._StopTicking())}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(t){switch(t){case 0:return this._GetMaxSpeed();case 1:return this._GetAcceleration();case 2:return this._GetDeceleration();case 3:return e.toDegrees(this._GetRotateSpeed());case 4:return this._IsSetAngle();case 5:return this._IsStopOnSolids();case 6:return this._IsEnabled()}}SetPropertyValueByIndex(t,s){switch(t){case 0:this._SetMaxSpeed(s);break;case 1:this._SetAcceleration(s);break;case 2:this._SetDeceleration(s);break;case 3:this._SetRotateSpeed(e.toRadians(s));break;case 4:this._SetSetAngle(s);break;case 5:this._SetStopOnSolids(s);break;case 6:this._SetEnabled(s)}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.moveto.debugger.speed",value:this._GetSpeed(),onedit:e=>this._SetSpeed(e)},{name:"behaviors.moveto.debugger.angle-of-motion",value:e.toDegrees(this._GetAngleOfMotion()),onedit:t=>this._movingAngle=e.toRadians(t)},{name:"behaviors.moveto.debugger.target-x",value:this._GetTargetX()},{name:"behaviors.moveto.debugger.target-y",value:this._GetTargetY()},{name:"behaviors.moveto.debugger.waypoint-count",value:this._GetWaypointCount()},{name:"behaviors.moveto.properties.max-speed.name",value:this._GetMaxSpeed(),onedit:e=>this._SetMaxSpeed(e)},{name:"behaviors.moveto.properties.acceleration.name",value:this._GetAcceleration(),onedit:e=>this._SetAcceleration(e)},{name:"behaviors.moveto.properties.deceleration.name",value:this._GetDeceleration(),onedit:e=>this._SetDeceleration(e)},{name:"behaviors.moveto.properties.rotate-speed.name",value:e.toDegrees(this._GetRotateSpeed()),onedit:t=>this._SetRotateSpeed(e.toRadians(t))},{name:"behaviors.moveto.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IMoveToBehaviorInstance}};const i=new WeakMap;self.IMoveToBehaviorInstance=class extends s{constructor(){super(),i.set(this,s._GetInitInst().GetSdkInstance())}moveToPosition(e,s,r=!0){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),i.get(this)._AddWaypoint(e,s,!!r)}getTargetX(){return i.get(this)._GetTargetX()}getTargetY(){return i.get(this)._GetTargetY()}getTargetPosition(){const e=i.get(this);return[e._GetTargetX(),e._GetTargetY()]}getWaypointCount(){return i.get(this)._GetWaypointCount()}getWaypointX(e){return t.RequireFiniteNumber(e),i.get(this)._GetWaypointXAt(e)}getWaypointY(e){return t.RequireFiniteNumber(e),i.get(this)._GetWaypointYAt(e)}getWaypoint(e){t.RequireFiniteNumber(e);const s=i.get(this);return[s._GetWaypointXAt(e),s._GetWaypointYAt(e)]}stop(){i.get(this)._Stop()}get isMoving(){return i.get(this)._IsMoving()}get speed(){return i.get(this)._GetSpeed()}set speed(e){t.RequireFiniteNumber(e),i.get(this)._SetSpeed(e)}get maxSpeed(){return i.get(this)._GetMaxSpeed()}set maxSpeed(e){t.RequireFiniteNumber(e),i.get(this)._SetMaxSpeed(e)}get acceleration(){return i.get(this)._GetAcceleration()}set acceleration(e){t.RequireFiniteNumber(e),i.get(this)._SetAcceleration(e)}get deceleration(){return i.get(this)._GetDeceleration()}set deceleration(e){t.RequireFiniteNumber(e),i.get(this)._SetDeceleration(e)}get angleOfMotion(){return i.get(this)._GetAngleOfMotion()}set angleOfMotion(e){t.RequireFiniteNumber(e),i.get(this)._SetAngleOfMotion(e)}get rotateSpeed(){return i.get(this)._GetRotateSpeed()}set rotateSpeed(e){t.RequireFiniteNumber(e),i.get(this)._SetRotateSpeed(e)}get isStopOnSolids(){return i.get(this)._IsStopOnSolids()}set isStopOnSolids(e){i.get(this)._SetStopOnSolids(e)}get isEnabled(){return i.get(this)._IsEnabled()}set isEnabled(e){i.get(this)._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.MoveTo.Cnds={IsMoving(){return this._IsMoving()},CompareSpeed(t,s){return e.compare(this._GetSpeed(),t,s)},IsEnabled(){return this._IsEnabled()},OnArrived:()=>!0,OnHitSolid:()=>!0}}{const e=self.C3;e.Behaviors.MoveTo.Acts={MoveToPosition(e,t,s){this._AddWaypoint(e,t,0===s)},MoveToObject(e,t,s){if(e&&(e=e.GetPairedInstance(this._inst))&&e.GetWorldInfo()){var[i,r]=e.GetImagePoint(t);this._AddWaypoint(i,r,0===s)}},MoveAlongPathfindingPath(t){var s=this._inst.GetBehaviorSdkInstanceFromCtor(e.Behaviors.Pathfinding);if(s&&(s=s._GetPath(),0!==s.length))for(let e=0,i=s.length;e<i;++e){const i=s[e];this._AddWaypoint(i.x,i.y,0===e&&0===t)}},MoveAlongTimeline(t,s,i){if((s=s?t.GetTrackById(s):e.first(t.GetTracks()))&&(t=s.GetPropertyTrack("offsetX"),s=s.GetPropertyTrack("offsetY"),t&&s)){var r=[...t.GetPropertyKeyframeValues()],n=[...s.GetPropertyKeyframeValues()];if(0!==r.length&&0!==n.length){var a=0,o=0,h=this._inst.GetWorldInfo();"relative"===t.GetResultMode()&&(a=h.GetX()),"relative"===s.GetResultMode()&&(o=h.GetY());for(let e=0,t=Math.min(r.length,n.length);e<t;++e)this._AddWaypoint(r[e]+a,n[e]+o,0===e&&0===i)}}},MoveAlongTimelineByName(t,s,i){(t=this._runtime.GetTimelineManager().GetTimelineByName(t))&&e.Behaviors.MoveTo.Acts.MoveAlongTimeline.call(this,t,s,i)},Stop(){this._Stop()},SetMovingAngle(t){this._SetAngleOfMotion(e.toRadians(t))},SetSpeed(e){this._SetSpeed(e)},SetMaxSpeed(e){this._SetMaxSpeed(e)},SetAcceleration(e){this._SetAcceleration(e)},SetDeceleration(e){this._SetDeceleration(e)},SetRotateSpeed(t){this._SetRotateSpeed(e.toRadians(t))},SetStopOnSolids(e){this._SetStopOnSolids(e)},SetEnabled(e){this._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.MoveTo.Exps={Speed(){return this._GetSpeed()},MaxSpeed(){return this._GetMaxSpeed()},Acceleration(){return this._GetAcceleration()},Deceleration(){return this._GetDeceleration()},MovingAngle(){return e.toDegrees(this._GetAngleOfMotion())},RotateSpeed(){return e.toDegrees(this._GetRotateSpeed())},TargetX(){return this._GetTargetX()},TargetY(){return this._GetTargetY()},WaypointCount(){return this._GetWaypointCount()},WaypointXAt(e){return this._GetWaypointXAt(e)},WaypointYAt(e){return this._GetWaypointYAt(e)}}}{const e=self.C3;e.Behaviors.LOS=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.LOS.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e),this._obstacleTypes=[]}Release(){e.clearArray(this._obstacleTypes),super.Release()}OnCreate(){}GetObstacleTypes(){return this._obstacleTypes}FindLOSBehavior(e){const t=this.GetBehaviorType();for(const s of e.GetBehaviorInstances())if(s.GetBehaviorType()===t)return s.GetSdkInstance();return null}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=[];e.Behaviors.LOS.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._obstacleMode=0,this._range=1e4,this._cone=e.toRadians(360),this._useCollisionCells=!0,this._ray=new e.Ray,s&&(this._obstacleMode=s[0],this._range=s[1],this._cone=e.toRadians(s[2]),this._useCollisionCells=s[3])}Release(){super.Release()}SaveToJson(){return{r:this._range,c:this._cone,om:this._obstacleMode,ucc:this._useCollisionCells,t:this.GetSdkType().GetObstacleTypes().map(e=>e.GetSID())}}LoadFromJson(t){this._range=t.r,this._cone=t.c,this._obstacleMode=t.om||0,this._useCollisionCells=!!t.ucc;const s=this.GetSdkType().GetObstacleTypes();e.clearArray(s);for(const e of t.t)(t=this._runtime.GetObjectClassBySID(e))&&s.push(t)}HasLOSToInstance(e,t){const s=e.GetUID(),[i,r]=e.GetImagePoint(t);return this.HasLOSTo(i,r)||this._ray.hitUid===s}HasLOSTo(e,t){const s=this.GetWorldInfo();let i=s.GetAngle();return 0>s.GetWidth()&&(i+=Math.PI),this.HasLOSBetweenPositions(s.GetX(),s.GetY(),i,e,t)}HasLOSBetweenPositions(t,s,i,r,n){var a=this._range;return!(e.distanceSquared(t,s,r,n)>a*a)&&(a=e.angleTo(t,s,r,n),!(e.angleDiff(i,a)>this._cone/2)&&!this.CastRay(t,s,r,n,this._useCollisionCells).DidCollide())}_GetCollisionCandidates(t,s){if(s){s=this.GetWorldInfo().GetLayer();var r=this._runtime.GetCollisionEngine();return 0===this._obstacleMode?r.GetSolidCollisionCandidates(s,t.rect,i):r.GetObjectClassesCollisionCandidates(s,this._GetObstacleTypes(),t.rect,i),i}if(0===this._obstacleMode)return(t=this._runtime.GetSolidBehavior())?t.GetInstances():i;for(r of this._GetObstacleTypes())e.appendArray(i,r.GetInstances());return i}_GetObstacleTypes(){return this.GetSdkType().GetObstacleTypes()}CastRay(t,s,r,n,a){t=this._ray.Set(t,s,r,n),a=this._GetCollisionCandidates(t,a),s=this._runtime.GetCollisionEngine(),r=0===this._obstacleMode,n=this._inst;for(let e=0,i=a.length;e<i;++e){const i=a[e];i!==n&&(r&&!s.IsSolidCollisionAllowed(i,n)||s.TestRayIntersectsInstance(i,t))}return t.Complete(),e.clearArray(i),t}_GetRay(){return this._ray}_GetRayHitX(){const e=this._ray;return e.DidCollide()?e.hitX:0}_GetRayHitY(){const e=this._ray;return e.DidCollide()?e.hitY:0}_GetRayHitDistance(){const e=this._ray;return e.DidCollide()?e.distance:0}_GetRayHitUID(){const e=this._ray;return e.DidCollide()?e.hitUid:-1}_GetRayNormalX(e){const t=this._ray;return t.DidCollide()?t.hitX+e*t.normalX:0}_GetRayNormalY(e){const t=this._ray;return t.DidCollide()?t.hitY+e*t.normalY:0}_GetRayNormalAngle(){const e=this._ray;return e.DidCollide()?e.hitNormal:0}_GetRayReflectionX(e){const t=this._ray;return t.DidCollide()?t.hitX+e*t.reflectionX:0}_GetRayReflectionY(e){const t=this._ray;return t.DidCollide()?t.hitY+e*t.reflectionY:0}_GetRayReflectionAngle(){const e=this._ray;return e.DidCollide()?Math.atan2(e.reflectionY,e.reflectionX):0}_SetRange(e){this._range=e}_GetRange(){return this._range}_SetConeOfView(e){this._cone=e}_GetConeOfView(){return this._cone}GetPropertyValueByIndex(t){switch(t){case 0:return this._obstacleMode;case 1:return this._range;case 2:return e.toDegrees(this._cone);case 3:return this._useCollisionCells}}SetPropertyValueByIndex(t,s){switch(t){case 0:this._obstacleMode=s;break;case 1:this._range=s;break;case 2:this._cone=e.toRadians(s);break;case 3:this._useCollisionCells=!!s}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.los.properties.range.name",value:this._GetRange(),onedit:e=>this._SetRange(e)},{name:"behaviors.los.properties.cone-of-view.name",value:e.toDegrees(this._GetConeOfView()),onedit:t=>this._SetConeOfView(e.toRadians(t))}]}]}GetScriptInterfaceClass(){return self.ILOSBehaviorInstance}};const r=new WeakMap;self.ILOSBehaviorInstance=class extends s{constructor(){super();const e=s._GetInitInst().GetSdkInstance();r.set(this,e),this.ray=new self.ILOSBehaviorRay(e)}set range(e){t.RequireFiniteNumber(e),r.get(this)._SetRange(e)}get range(){return r.get(this)._GetRange()}set coneOfView(e){t.RequireFiniteNumber(e),r.get(this)._SetConeOfView(e)}get coneOfView(){return r.get(this)._GetConeOfView()}hasLOStoPosition(e,s){return t.RequireNumber(e),t.RequireNumber(s),r.get(this).HasLOSTo(e,s)}hasLOSBetweenPositions(e,s,i,n,a){return t.RequireNumber(e),t.RequireNumber(s),t.RequireNumber(i),t.RequireNumber(n),t.RequireNumber(a),r.get(this).HasLOSBetweenPositions(e,s,i,n,a)}castRay(e,s,i,n,a=!0){return t.RequireNumber(e),t.RequireNumber(s),t.RequireNumber(i),t.RequireNumber(n),r.get(this).CastRay(e,s,i,n,a),this.ray}},self.ILOSBehaviorRay=class{constructor(e){r.set(this,e)}get didCollide(){return r.get(this)._GetRay().DidCollide()}get hitX(){return r.get(this)._GetRayHitX()}get hitY(){return r.get(this)._GetRayHitY()}get hitDistance(){return r.get(this)._GetRayHitDistance()}get hitUid(){return r.get(this)._GetRayHitUID()}getNormalX(e){return t.RequireFiniteNumber(e),r.get(this)._GetRayNormalX(e)}getNormalY(e){return t.RequireFiniteNumber(e),r.get(this)._GetRayNormalY(e)}get normalAngle(){return r.get(this)._GetRayNormalAngle()}getReflectionX(e){return t.RequireFiniteNumber(e),r.get(this)._GetRayReflectionX(e)}getReflectionY(e){return t.RequireFiniteNumber(e),r.get(this)._GetRayReflectionY(e)}get reflectionAngle(){return r.get(this)._GetRayReflectionAngle()}}}{const e=self.C3,t=new Set,s=new Set;e.Behaviors.LOS.Cnds={HasLOSToPosition(e,t){return this.HasLOSTo(e,t)},RayIntersected(){return this._ray.DidCollide()},HasLOSBetweenPositions(t,s,i,r,n){return this.HasLOSBetweenPositions(t,s,e.toRadians(i),r,n)},HasLOSToObject(i,r){if(!i)return!1;var n=this._runtime.GetCurrentCondition();const a=n.GetEventBlock().IsOrBlock();var o=n.GetRuntime();const h=n.GetObjectClass().GetCurrentSol();i=i.GetCurrentSol();let l=h.GetInstances(),c=i.GetInstances();h.IsSelectAll()?e.clearArray(h._GetOwnElseInstances()):a&&(l=o.IsCurrentConditionFirst()&&!h._GetOwnElseInstances().length&&h._GetOwnInstances().length?h._GetOwnInstances():h._GetOwnElseInstances()),i.IsSelectAll()?e.clearArray(i._GetOwnElseInstances()):a&&(c=o.IsCurrentConditionFirst()&&!i._GetOwnElseInstances().length&&i._GetOwnInstances().length?i._GetOwnInstances():i._GetOwnElseInstances()),n=n.IsInverted(),o=this.GetSdkType();for(const i of l){let a=!1;const h=o.FindLOSBehavior(i);if(0===c.length)n&&(a=!0);else for(const t of c)i!==t&&e.xor(h.HasLOSToInstance(t,r),n)&&(a=!0,s.add(t));a&&t.add(i)}return a?(l===h._GetOwnElseInstances()?h.TransferElseInstancesToOwn(t):(h.AddElseInstances(t,l),h.SetSetPicked(t)),c===i._GetOwnElseInstances()?i.TransferElseInstancesToOwn(s):(i.AddElseInstances(s,c),i.SetSetPicked(s))):(h.SetSetPicked(t),i.SetSetPicked(s)),t.clear(),s.clear(),h.HasAnyInstances()}}}{const e=self.C3;e.Behaviors.LOS.Acts={SetRange(e){this._SetRange(e)},SetCone(t){this._SetConeOfView(e.toRadians(t))},CastRay(e,t,s,i,r){this.CastRay(e,t,s,i,r)},AddObstacle(e){const t=this.GetSdkType().GetObstacleTypes();if(!t.includes(e)){for(const s of t)if(s.IsFamily()&&s.FamilyHasMember(e))return;t.push(e)}},ClearObstacles(){e.clearArray(this.GetSdkType().GetObstacleTypes())}}}{const e=self.C3;e.Behaviors.LOS.Exps={Range(){return this._GetRange()},ConeOfView(){return e.toDegrees(this._GetConeOfView())},HitX(){return this._GetRayHitX()},HitY(){return this._GetRayHitY()},HitDistance(){return this._GetRayHitDistance()},HitUID(){return this._GetRayHitUID()},NormalX(e){return this._GetRayNormalX(e)},NormalY(e){return this._GetRayNormalY(e)},NormalAngle(){return e.toDegrees(this._GetRayNormalAngle())},ReflectionX(e){return this._GetRayReflectionX(e)},ReflectionY(e){return this._GetRayReflectionY(e)},ReflectionAngle(){return e.toDegrees(this._GetRayReflectionAngle())}}}{const e=self.C3;e.Behaviors.jumpthru=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.jumpthru.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.jumpthru.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this.SetEnabled(!0),t&&this.SetEnabled(t[0])}Release(){super.Release()}SetEnabled(e){this._inst._SetJumpthruEnabled(!!e)}IsEnabled(){return this._inst._IsJumpthruEnabled()}SaveToJson(){return{e:this.IsEnabled()}}LoadFromJson(e){this.SetEnabled(e.e)}GetPropertyValueByIndex(e){switch(e){case 0:return this.IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this.SetEnabled(t)}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.jumpthru.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this.SetEnabled(e)}]}]}}}self.C3.Behaviors.jumpthru.Cnds={IsEnabled(){return this.IsEnabled()}},self.C3.Behaviors.jumpthru.Acts={SetEnabled(e){this.SetEnabled(e)}},self.C3.Behaviors.jumpthru.Exps={};{const e=self.C3;e.Behaviors.Turret=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Turret.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e),this._targetTypes=[]}Release(){e.clearArray(this._targetTypes),super.Release()}OnCreate(){}GetTargetTypes(){return this._targetTypes}}}{const e=self.C3,t=e.New(e.Rect),s=[];e.Behaviors.Turret.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._range=300,this._rateOfFire=1,this._isRotateEnabled=!0,this._rotateSpeed=e.toRadians(180),this._targetMode=0,this._predictiveAim=!1,this._projectileSpeed=500,this._isEnabled=this._useCollisionCells=!0,this._fireTimeCount=this._lastCheckTime=0,this._currentTarget=null,this._loadTargetUid=-1,this._oldTargetY=this._oldTargetX=0,this._lastSpeeds=[0,0,0,0],this._speedsCount=0,this._firstTickWithTarget=!0,s&&(this._range=s[0],this._rateOfFire=s[1],this._isRotateEnabled=!!s[2],this._rotateSpeed=e.toRadians(s[3]),this._targetMode=s[4],this._predictiveAim=!!s[5],this._projectileSpeed=s[6],this._useCollisionCells=!!s[7],this._isEnabled=!!s[8]),this._fireTimeCount=this._rateOfFire,t=this._runtime.Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),e.Disposable.From(t,"afterload",e=>this._OnAfterLoad())),this._isEnabled&&this._StartTicking()}Release(){this._currentTarget=null,super.Release()}_OnAfterLoad(){this._currentTarget=-1===this._loadTargetUid?null:this._runtime.GetInstanceByUID(this._loadTargetUid)}_OnInstanceDestroyed(e){this._currentTarget===e&&(this._currentTarget=null)}SaveToJson(){return{r:this._range,rof:this._rateOfFire,re:this._isRotateEnabled,rs:this._rotateSpeed,tm:this._targetMode,pa:this._predictiveAim,ps:this._projectileSpeed,ucc:this._useCollisionCells,e:this._isEnabled,lct:this._lastCheckTime,ftc:this._fireTimeCount,t:this._currentTarget?this._currentTarget.GetUID():-1,ox:this._oldTargetX,oy:this._oldTargetY,ls:this._lastSpeeds,sc:this._speedsCount,targs:this.GetSdkType().GetTargetTypes().map(e=>e.GetSID())}}LoadFromJson(t){this._range=t.r,this._rateOfFire=t.rof,this._isRotateEnabled=t.re,this._rotateSpeed=t.rs,this._targetMode=t.tm,this._predictiveAim=t.pa,this._projectileSpeed=t.ps,this._useCollisionCells=t.ucc,this._SetEnabled(t.e),this._lastCheckTime=t.lct,this._fireTimeCount=t.ftc,this._loadTargetUid=t.t,this._oldTargetX=t.ox,this._oldTargetY=t.oy,
this._lastSpeeds=t.ls,this._speedsCount=t.sc;const s=this.GetSdkType().GetTargetTypes();e.clearArray(s);for(const e of t.targs)(t=this._runtime.GetObjectClassBySID(e))&&s.push(t)}AddSpeed(e){4>this._speedsCount?(this._lastSpeeds[this._speedsCount]=e,this._speedsCount++):(this._lastSpeeds.shift(),this._lastSpeeds.push(e))}GetSpeed(){let e=0;for(let t=0;t<this._speedsCount;++t)e+=this._lastSpeeds[t];return e/this._speedsCount}IsInRange(e){var t=this.GetWorldInfo();const s=e.GetWorldInfo();return e=s.GetX()-t.GetX(),t=s.GetY()-t.GetY(),e*e+t*t<=this._range*this._range}LookForFirstTarget(){const i=this.GetWorldInfo(),r=this.GetSdkType().GetTargetTypes(),n=this._runtime.GetCollisionEngine();if(this._useCollisionCells)t.set(i.GetX()-this._range,i.GetY()-this._range,i.GetX()+this._range,i.GetY()+this._range),n.GetObjectClassesCollisionCandidates(null,r,t,s);else for(const t of r)e.appendArray(s,t.GetInstances());for(const t of s)if(this.IsInRange(t))return this._currentTarget=t,void e.clearArray(s);e.clearArray(s)}LookForNearestTarget(){var i=this.GetWorldInfo(),r=this.GetSdkType().GetTargetTypes(),n=this._runtime.GetCollisionEngine();const a=i.GetX();i=i.GetY();let o=this._range*this._range;if(this._currentTarget=null,this._useCollisionCells)t.set(a-this._range,i-this._range,a+this._range,i+this._range),n.GetObjectClassesCollisionCandidates(null,r,t,s);else for(const t of r)e.appendArray(s,t.GetInstances());for(const e of s)n=e.GetWorldInfo(),r=a-n.GetX(),n=i-n.GetY(),r=r*r+n*n,r<o&&(this._currentTarget=e,o=r);e.clearArray(s)}_OnTargetAcquired(){this._speedsCount=0,this._firstTickWithTarget=!0;const t=this._currentTarget.GetWorldInfo();this._oldTargetX=t.GetX(),this._oldTargetY=t.GetY(),this.Trigger(e.Behaviors.Turret.Cnds.OnTargetAcquired)}Tick(){if(this._isEnabled){var t=this._runtime.GetDt(this._inst),s=this._runtime.GetGameTime(),i=this.GetWorldInfo();if(this._currentTarget&&!this.IsInRange(this._currentTarget)&&(this._currentTarget=null,this._speedsCount=0,this._firstTickWithTarget=!0),s>=this._lastCheckTime+.1&&(this._lastCheckTime=s,0!==this._targetMode||this._currentTarget?1===this._targetMode&&(s=this._currentTarget,this.LookForNearestTarget(),this._currentTarget&&this._currentTarget!==s&&this._OnTargetAcquired()):(this.LookForFirstTarget(),this._currentTarget&&this._OnTargetAcquired())),this._fireTimeCount+=t,this._currentTarget){var r=this._currentTarget.GetWorldInfo();if(s=e.angleTo(i.GetX(),i.GetY(),r.GetX(),r.GetY()),this._predictiveAim){var n=i.GetX();const a=i.GetY(),o=r.GetX();r=r.GetY();const h=e.angleTo(o,r,this._oldTargetX,this._oldTargetY);this._firstTickWithTarget||this.AddSpeed(e.distanceTo(o,r,this._oldTargetX,this._oldTargetY)/t);const l=this.GetSpeed(),c=r-a,u=o-n;n=Math.asin((l*Math.sin(h)*(n-o)-l*Math.cos(h)*(a-r))/this._projectileSpeed/Math.sqrt(c*c+u*u))-Math.atan2(c,-u)+Math.PI,isNaN(n)||(s=n)}this._isRotateEnabled&&(i.SetAngle(e.angleRotate(i.GetAngle(),s,this._rotateSpeed*t)),i.SetBboxChanged()),this._fireTimeCount>=this._rateOfFire&&(!this._isRotateEnabled||.1>=e.toDegrees(e.angleDiff(i.GetAngle(),s)))&&(!this._predictiveAim||4<=this._speedsCount)&&(this._fireTimeCount-=this._rateOfFire,this._fireTimeCount>=this._rateOfFire&&(this._fireTimeCount=0),this.Trigger(e.Behaviors.Turret.Cnds.OnShoot)),this._currentTarget&&(r=this._currentTarget.GetWorldInfo(),this._oldTargetX=r.GetX(),this._oldTargetY=r.GetY()),this._firstTickWithTarget=!1}this._fireTimeCount>this._rateOfFire&&(this._fireTimeCount=this._rateOfFire)}}GetPropertyValueByIndex(t){switch(t){case 0:return this._range;case 1:return this._rateOfFire;case 2:return this._isRotateEnabled;case 3:return e.toDegrees(this._rotateSpeed);case 4:return this._targetMode;case 5:return this._predictiveAim;case 6:return this._projectileSpeed;case 7:return this._useCollisionCells;case 8:return this._isEnabled}}SetPropertyValueByIndex(t,s){switch(t){case 0:this._range=s;break;case 1:this._rateOfFire=s;break;case 2:this._isRotateEnabled=!!s;break;case 3:if(!this._isRotateEnabled)break;this._rotateSpeed=e.toRadians(s);break;case 4:this._targetMode=s;break;case 5:this._predictiveAim=!!s;break;case 6:if(!this._predictiveAim)break;this._projectileSpeed=s;break;case 7:this._useCollisionCells=!!s;break;case 8:this._SetEnabled(s)}}_SetEnabled(e){(this._isEnabled=!!e)?this._StartTicking():this._StopTicking()}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.turret.properties.range.name",value:this._range,onedit:e=>this._range=e},{name:"behaviors.turret.properties.rate-of-fire.name",value:this._rateOfFire,onedit:e=>this._rateOfFire=e},{name:"behaviors.turret.properties.rotate-speed.name",value:e.toDegrees(this._rotateSpeed),onedit:t=>this._rotateSpeed=e.toRadians(t)},{name:"behaviors.turret.properties.predictive-aim.name",value:this._predictiveAim,onedit:e=>this._predictiveAim=e},{name:"behaviors.turret.properties.projectile-speed.name",value:this._projectileSpeed,onedit:e=>this._projectileSpeed=e},{name:"behaviors.turret.debugger.has-target",value:!!this._currentTarget},{name:"behaviors.turret.debugger.target-uid",value:this._currentTarget?this._currentTarget.GetUID():0},{name:"behaviors.turret.properties.enabled.name",value:this._isEnabled,onedit:e=>this._SetEnabled(e)}]}]}}}self.C3.Behaviors.Turret.Cnds={HasTarget(){return!!this._currentTarget},OnShoot:()=>!0,OnTargetAcquired:()=>!0,IsEnabled(){return this._isEnabled}};{const e=self.C3;e.Behaviors.Turret.Acts={AcquireTarget(e){if(e){e=e.GetCurrentSol().GetInstances();for(const t of e)if(this._currentTarget!==t&&this.IsInRange(t)){this._currentTarget=t,this._OnTargetAcquired();break}}},AddTarget(e){const t=this.GetSdkType().GetTargetTypes();if(!t.includes(e)){for(const s of t)if(s.IsFamily()&&s.FamilyHasMember(e))return;t.push(e)}},ClearTargets(){e.clearArray(this.GetSdkType().GetTargetTypes())},UnacquireTarget(){this._currentTarget=null,this._speedsCount=0,this._firstTickWithTarget=!0},SetEnabled(e){this._SetEnabled(0!==e)},SetRange(e){this._range=e},SetRateOfFire(e){this._rateOfFire=e},SetRotate(e){this._isRotateEnabled=0!==e},SetRotateSpeed(t){this._rotateSpeed=e.toRadians(t)},SetTargetMode(e){this._targetMode=e},SetPredictiveAim(e){this._predictiveAim=0!==e},SetProjectileSpeed(e){this._projectileSpeed=e}}}{const e=self.C3;e.Behaviors.Turret.Exps={TargetUID(){return this._currentTarget?this._currentTarget.GetUID():0},Range(){return this._range},RateOfFire(){return this._rateOfFire},RotateSpeed(){return e.toDegrees(this._rotateSpeed)}}}{const e=self.C3;e.Behaviors.EightDir=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.EightDir.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance;e.Behaviors.EightDir.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._simRight=this._simLeft=this._simDown=this._simUp=this._ignoreInput=this._rightKey=this._leftKey=this._downKey=this._upKey=!1,this._dy=this._dx=0,this._maxSpeed=200,this._acc=600,this._dec=500,this._angleMode=this._directions=3,this._isEnabled=this._defaultControls=!0,t&&(this._maxSpeed=t[0],this._acc=t[1],this._dec=t[2],this._directions=t[3],this._angleMode=t[4],this._defaultControls=!!t[5],this._isEnabled=!!t[6]),this._isEnabled&&this._StartTicking(),this._defaultControls&&this._BindEvents()}_BindEvents(){if(!this._disposables){var t=this._runtime.Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(t,"keydown",e=>this._OnKeyDown(e.data)),e.Disposable.From(t,"keyup",e=>this._OnKeyUp(e.data)),e.Disposable.From(t,"window-blur",()=>this._OnWindowOrKeyboardBlur()),e.Disposable.From(t,"keyboard-blur",()=>this._OnWindowOrKeyboardBlur()))}}_UnBindEvents(){this._disposables&&(this._disposables.Release(),this._disposables=null)}Release(){super.Release()}SaveToJson(){return{dx:this._dx,dy:this._dy,e:this._isEnabled,ms:this._maxSpeed,acc:this._acc,dec:this._dec,d:this._directions,am:this._angleMode,dc:this._defaultControls,ii:this._ignoreInput}}LoadFromJson(e){this._dx=e.dx,this._dy=e.dy,this._SetEnabled(e.e),this._maxSpeed=e.ms,this._acc=e.acc,this._dec=e.dec,this._directions=e.d,this._angleMode=e.am,this._defaultControls=e.dc,this._ignoreInput=e.ii,this._simRight=this._simLeft=this._simDown=this._simUp=this._rightKey=this._leftKey=this._downKey=this._upKey=!1,this._defaultControls?this._BindEvents():this._UnBindEvents()}_OnKeyDown(e){switch(e.key){case"ArrowLeft":this._leftKey=!0;break;case"ArrowUp":this._upKey=!0;break;case"ArrowRight":this._rightKey=!0;break;case"ArrowDown":this._downKey=!0}}_OnKeyUp(e){switch(e.key){case"ArrowLeft":this._leftKey=!1;break;case"ArrowUp":this._upKey=!1;break;case"ArrowRight":this._rightKey=!1;break;case"ArrowDown":this._downKey=!1}}_OnWindowOrKeyboardBlur(){this._rightKey=this._leftKey=this._downKey=this._upKey=!1}Tick(){var t=this._runtime.GetDt(this._inst);const s=this._runtime.GetCollisionEngine();var i=this._leftKey||this._simLeft,r=this._rightKey||this._simRight,n=this._upKey||this._simUp,a=this._downKey||this._simDown;if(this._simDown=this._simUp=this._simRight=this._simLeft=!1,this._isEnabled){var o=s.TestOverlapSolid(this._inst);if(o&&(s.RegisterCollision(this._inst,o),!s.PushOutSolidNearest(this._inst)))return;this._ignoreInput&&(i=r=n=a=!1),0===this._directions?i=r=!1:1===this._directions&&(n=a=!1),2===this._directions&&(n||a)&&(i=r=!1),i===r&&(0>this._dx?this._dx=Math.min(this._dx+this._dec*t,0):0<this._dx&&(this._dx=Math.max(this._dx-this._dec*t,0))),n===a&&(0>this._dy?this._dy=Math.min(this._dy+this._dec*t,0):0<this._dy&&(this._dy=Math.max(this._dy-this._dec*t,0)));var h=o=0;if(i&&!r&&(o=0<this._dx?-(this._acc+this._dec):-this._acc),r&&!i&&(o=0>this._dx?this._acc+this._dec:this._acc),n&&!a&&(h=0<this._dy?-(this._acc+this._dec):-this._acc),a&&!n&&(h=0>this._dy?this._acc+this._dec:this._acc),this._dx+=o*t,this._dy+=h*t,0!==this._dx||0!==this._dy){r=Math.atan2(this._dy,this._dx),i=this._maxSpeed*Math.cos(r),r=this._maxSpeed*Math.sin(r),Math.sqrt(this._dx*this._dx+this._dy*this._dy)>this._maxSpeed&&(this._dx=i,this._dy=r);var l=Math.abs(i)*t;a=Math.abs(r)*t,i=this._inst.GetWorldInfo();const c=i.GetX();n=i.GetY(),r=i.GetAngle(),l=e.clamp(this._dx*t+.5*o*t*t,-l,l),i.OffsetX(l),i.SetBboxChanged(),(o=s.TestOverlapSolid(this._inst))&&(s.PushOutSolid(this._inst,0>this._dx?1:-1,0,Math.max(Math.abs(Math.floor(l)),1))||(i.SetX(c),i.SetBboxChanged()),this._dx=0,s.RegisterCollision(this._inst,o)),t=e.clamp(this._dy*t+.5*h*t*t,-a,a),i.OffsetY(t),i.SetBboxChanged(),(o=s.TestOverlapSolid(this._inst))&&(s.PushOutSolid(this._inst,0,0>this._dy?1:-1,Math.max(Math.abs(Math.floor(t)),1))||(i.SetY(n),i.SetBboxChanged()),this._dy=0,s.RegisterCollision(this._inst,o)),t=e.round6dp(this._dx),h=e.round6dp(this._dy),0===t&&0===h||!this._inst.GetPlugin().IsRotatable()||(1===this._angleMode?i.SetAngle(e.toRadians(90*Math.round(e.toDegrees(Math.atan2(h,t))/90))):2===this._angleMode?i.SetAngle(e.toRadians(45*Math.round(e.toDegrees(Math.atan2(h,t))/45))):3===this._angleMode&&i.SetAngle(Math.atan2(h,t))),i.SetBboxChanged(),i.GetAngle()!=r&&(o=s.TestOverlapSolid(this._inst))&&(i.SetAngle(r),i.SetBboxChanged(),s.RegisterCollision(this._inst,o))}}}GetPropertyValueByIndex(e){switch(e){case 0:return this._GetMaxSpeed();case 1:return this._GetAcceleration();case 2:return this._GetDeceleration();case 3:return this._directions;case 4:return this._angleMode;case 5:return this._IsDefaultControls();case 6:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._SetMaxSpeed(t);break;case 1:this._SetAcceleration(t);break;case 2:this._SetDeceleration(t);break;case 3:this._directions=t;break;case 4:this._angleMode=t;break;case 5:this._SetDefaultControls(!!t);break;case 6:this._SetEnabled(!!t)}}_Stop(){this._dy=this._dx=0}_Reverse(){this._dx*=-1,this._dy*=-1}_MaybeClampSpeed(){const e=Math.hypot(this._dx,this._dy);e>this._maxSpeed&&this._SetSpeed(e)}_SetSpeed(t){t=e.clamp(t,0,this._maxSpeed);const s=Math.atan2(this._dy,this._dx);this._dx=t*Math.cos(s),this._dy=t*Math.sin(s)}_GetSpeed(){return Math.hypot(this._dx,this._dy)}_SetMaxSpeed(e){this._maxSpeed=Math.max(e,0)}_GetMaxSpeed(){return this._maxSpeed}_SetAcceleration(e){this._acc=Math.max(e,0)}_GetAcceleration(){return this._acc}_SetDeceleration(e){this._dec=Math.max(e,0)}_GetDeceleration(){return this._dec}_GetMovingAngle(){return Math.atan2(this._dy,this._dx)}_SetVectorX(e){this._dx=e,this._MaybeClampSpeed()}_GetVectorX(){return this._dx}_SetVectorY(e){this._dy=e,this._MaybeClampSpeed()}_GetVectorY(){return this._dy}_SimulateControl(e){if(this._isEnabled)switch(e){case 0:this._simLeft=!0;break;case 1:this._simRight=!0;break;case 2:this._simUp=!0;break;case 3:this._simDown=!0}}_SetDefaultControls(e){e=!!e,this._defaultControls!==e&&((this._defaultControls=e)?this._BindEvents():(this._UnBindEvents(),this._OnWindowOrKeyboardBlur()))}_IsDefaultControls(){return this._defaultControls}_SetIgnoreInput(e){this._ignoreInput=!!e}_IsIgnoreInput(){return this._ignoreInput}_SetEnabled(e){(this._isEnabled=!!e)?this._StartTicking():(this._simDown=this._simUp=this._simRight=this._simLeft=!1,this._StopTicking())}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.eightdir.debugger.vector-x",value:this._GetVectorX(),onedit:e=>this._SetVectorX(e)},{name:"behaviors.eightdir.debugger.vector-y",value:this._GetVectorY(),onedit:e=>this._SetVectorY(e)},{name:"behaviors.eightdir.debugger.speed",value:this._GetSpeed(),onedit:e=>this._SetSpeed(e)},{name:"behaviors.eightdir.debugger.angle-of-motion",value:e.toDegrees(this._GetMovingAngle())},{name:"behaviors.eightdir.properties.max-speed.name",value:this._GetMaxSpeed(),onedit:e=>this._SetMaxSpeed(e)},{name:"behaviors.eightdir.properties.acceleration.name",value:this._GetAcceleration(),onedit:e=>this._SetAcceleration(e)},{name:"behaviors.eightdir.properties.deceleration.name",value:this._GetDeceleration(),onedit:e=>this._SetDeceleration(e)},{name:"behaviors.eightdir.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.I8DirectionBehaviorInstance}};const i=new WeakMap,r=new Map([["left",0],["right",1],["up",2],["down",3]]);self.I8DirectionBehaviorInstance=class extends s{constructor(){super(),i.set(this,s._GetInitInst().GetSdkInstance())}stop(){i.get(this)._Stop()}reverse(){i.get(this)._Reverse()}simulateControl(e){if(t.RequireString(e),e=r.get(e),"number"!=typeof e)throw Error("invalid control");i.get(this)._SimulateControl(e)}get speed(){return i.get(this)._GetSpeed()}set speed(e){t.RequireFiniteNumber(e),i.get(this)._SetSpeed(e)}get maxSpeed(){return i.get(this)._GetMaxSpeed()}set maxSpeed(e){t.RequireFiniteNumber(e),i.get(this)._SetMaxSpeed(e)}get acceleration(){return i.get(this)._GetAcceleration()}set acceleration(e){t.RequireFiniteNumber(e),i.get(this)._SetAcceleration(e)}get deceleration(){return i.get(this)._GetDeceleration()}set deceleration(e){t.RequireFiniteNumber(e),i.get(this)._SetDeceleration(e)}get vectorX(){return i.get(this)._GetVectorX()}set vectorX(e){t.RequireFiniteNumber(e),i.get(this)._SetVectorX(e)}get vectorY(){return i.get(this)._GetVectorY()}set vectorY(e){t.RequireFiniteNumber(e),i.get(this)._SetVectorX(e)}get isDefaultControls(){return i.get(this)._IsDefaultControls()}set isDefaultControls(e){i.get(this)._SetDefaultControls(!!e)}get isIgnoringInput(){return i.get(this)._IsIgnoreInput()}set isIgnoringInput(e){i.get(this)._SetIgnoreInput(!!e)}get isEnabled(){return i.get(this)._IsEnabled()}set isEnabled(e){i.get(this)._SetEnabled(!!e)}}}{const e=self.C3;e.Behaviors.EightDir.Cnds={IsMoving(){return 1e-10<this._GetSpeed()},CompareSpeed(t,s){return e.compare(this._GetSpeed(),t,s)},IsEnabled(){return this._IsEnabled()}}}self.C3.Behaviors.EightDir.Acts={Stop(){this._Stop()},Reverse(){this._Reverse()},SetIgnoreInput(e){this._SetIgnoreInput(e)},SetSpeed(e){this._SetSpeed(e)},SetMaxSpeed(e){this._SetMaxSpeed(e)},SetAcceleration(e){this._SetAcceleration(e)},SetDeceleration(e){this._SetDeceleration(e)},SimulateControl(e){this._SimulateControl(e)},SetEnabled(e){this._SetEnabled(e)},SetVectorX(e){this._SetVectorX(e)},SetVectorY(e){this._SetVectorY(e)},SetDefaultControls(e){this._SetDefaultControls(!!e)}};{const e=self.C3;e.Behaviors.EightDir.Exps={Speed(){return this._GetSpeed()},MaxSpeed(){return this._GetMaxSpeed()},Acceleration(){return this._GetAcceleration()},Deceleration(){return this._GetDeceleration()},MovingAngle(){return e.toDegrees(this._GetMovingAngle())},VectorX(){return this._GetVectorX()},VectorY(){return this._GetVectorY()}}}{const e=self.C3,t=self.C3X;let s=null,i=null,r=[],n=null,a=null;function g(e,t,s){var i=e.GetSavedDataMap();const r=t.GetSavedDataMap();s?((i=i.get("Physics_DisabledCollisions"))&&i.delete(t.GetSID()),(t=r.get("Physics_DisabledCollisions"))&&t.delete(e.GetSID())):(s=i.get("Physics_DisabledCollisions"),s||(s=new Set,i.set("Physics_DisabledCollisions",s)),i=r.get("Physics_DisabledCollisions"),i||(i=new Set,r.set("Physics_DisabledCollisions",i)),s.add(t.GetSID()),i.add(e.GetSID()))}e.Behaviors.Physics=class extends e.SDKBehaviorBase{constructor(e){e.scriptInterfaceClass=self.IPhysicsBehavior,super(e),this._world=null,this._worldG=10,this._worldScale=.02,this._worldManifold=null,this._lastUpdateTick=-1,this._steppingMode=1,this._velocityIterations=8,this._positionIterations=3,this._allCollisionsEnabled=!0,this._runtime.AddLoadPromise(this._LoadBox2DWasm())}async _LoadBox2DWasm(){const e=await this._runtime.GetAssetManager().GetProjectFileUrl("box2d.wasm");await new Promise(t=>{self.Box2DWasmModule({wasmBinaryFile:e}).then(e=>{n=e,this._InitBox2DWorld(),t()})})}_InitBox2DWorld(){const t=this._runtime.GetCollisionEngine();s=e.Behaviors.Physics.GetVec2(0,0),i=e.Behaviors.Physics.GetVec2(0,0),this._world=new n.b2World(e.Behaviors.Physics.GetTempVec2A(0,this._worldG),!0);var r=new n.JSContactListener;r.BeginContact=(s=>{var i=n.wrapPointer(s,n.b2Contact);s=e.Behaviors.Physics.Instance.LookupBehInstFromBody(i.GetFixtureA().GetBody()),i=e.Behaviors.Physics.Instance.LookupBehInstFromBody(i.GetFixtureB().GetBody()),t.RegisterCollision(s.GetObjectInstance(),i.GetObjectInstance())}),r.EndContact=(()=>{}),r.PreSolve=(()=>{}),r.PostSolve=(()=>{}),this._world.SetContactListener(r),r=new n.JSContactFilter,r.ShouldCollide=((t,s)=>{if(this._allCollisionsEnabled)return!0;t=n.wrapPointer(t,n.b2Fixture),s=n.wrapPointer(s,n.b2Fixture),t=e.Behaviors.Physics.Instance.LookupBehInstFromBody(t.GetBody()),s=e.Behaviors.Physics.Instance.LookupBehInstFromBody(s.GetBody()),t=t.GetObjectInstance().GetObjectClass();const i=s.GetObjectInstance().GetObjectClass();s=t.GetSID();const r=i.GetSID();return(!(t=t.GetSavedDataMap().get("Physics_DisabledCollisions"))||!t.has(r))&&(!(t=i.GetSavedDataMap().get("Physics_DisabledCollisions"))||!t.has(s))}),this._world.SetContactFilter(r),this._worldManifold=new n.b2WorldManifold}Release(){super.Release()}GetBox2D(){return n}GetWorld(){return this._world}GetWorldScale(){return this._worldScale}GetSteppingMode(){return this._steppingMode}SetSteppingMode(e){this._steppingMode=e}SetLastUpdateTick(e){this._lastUpdateTick=e}GetLastUpdateTick(){return this._lastUpdateTick}SetVelocityIterations(e){this._velocityIterations=Math.max(e,1)}GetVelocityIterations(){return this._velocityIterations}SetPositionIterations(e){this._positionIterations=Math.max(e,1)}GetPositionIterations(){return this._positionIterations}SetIterations(e,t){this.SetVelocityIterations(e),this.SetPositionIterations(t)}GetGravity(){return this._worldG}SetGravity(t){t!==this._worldG&&(this._world.SetGravity(e.Behaviors.Physics.GetTempVec2A(0,t)),this._worldG=t,this._WakeUpAllPhysicsBodies())}_WakeUpAllPhysicsBodies(){for(const s of this.GetInstances()){var t=e.Behaviors.Physics.Instance.LookupBehInstFromInst(s);t&&(t=t.GetBody())&&t.SetAwake(!0)}}DisableShouldCollideFastPath(){this._allCollisionsEnabled=!1}SetCollisionsEnabled(e,t,s){if(s=!!s,e&&t){if(t.IsFamily())for(const i of t.GetFamilyMembers())g(e,i,s);else g(e,t,s);this.DisableShouldCollideFastPath()}}GetWorldManifold(){return this._worldManifold}static GetPhysicsCollisionKey(){return"Physics_DisabledCollisions"}static GetVec2(e,t){if(r.length){const s=r.pop();return s.set_x(e),s.set_y(t),s}return new n.b2Vec2(e,t)}static FreeVec2(e){r.push(e)}static GetTempVec2A(e,t){return s.set_x(e),s.set_y(t),s}static GetTempVec2B(e,t){return i.set_x(e),i.set_y(t),i}static CreatePolygonShape(e){const t=new n.b2PolygonShape,s=n._malloc(8*e.length);var i=0;for(let t=0;t<e.length;++t)n.HEAPF32[s+i>>2]=e[t].get_x(),n.HEAPF32[s+(i+4)>>2]=e[t].get_y(),i+=8;return i=n.wrapPointer(s,n.b2Vec2),t.Set(i,e.length),n._free(s),t}};const o=["fixed","variable"];self.IPhysicsBehavior=class extends self.IBehavior{constructor(e){super(e),a=e}set worldGravity(e){t.RequireFiniteNumber(e),a.SetGravity(e)}get worldGravity(){return a.GetGravity()}set steppingMode(e){if(e=o.indexOf(e),0>e)throw Error("invalid stepping mode");a.SetSteppingMode(o[e])}get steppingMode(){return o[a.GetSteppingMode()]}set velocityIterations(e){t.RequireFiniteNumber(e),a.SetVelocityIterations(e)}get velocityIterations(){return a.GetVelocityIterations()}set positionIterations(e){t.RequireFiniteNumber(e),a.SetPositionIterations(e)}get positionIterations(){return a.GetPositionIterations()}setCollisionsEnabled(e,t,s){const i=a.GetRuntime();e=i._UnwrapIObjectClass(e),t=i._UnwrapIObjectClass(t),a.SetCollisionsEnabled(e,t,!!s)}}}{const e=self.C3;e.Behaviors.Physics.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=new WeakMap,r=new WeakMap,n=new WeakMap,a=e.Behaviors.Physics.GetTempVec2A,o=e.Behaviors.Physics.GetTempVec2B,h=e.New(e.Rect),l=e.New(e.Quad);e.Behaviors.Physics.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),t=this.GetBehavior();const i=this.GetWorldInfo();this._box2d=t.GetBox2D(),this._world=t.GetWorld(),this._worldScale=t.GetWorldScale(),this._isImmovable=!1,this._collisionMask=0,this._preventRotation=!1,this._density=1,this._friction=.5,this._restitution=.2,this._linearDamping=0,this._angularDamping=.01,this._isBullet=!1,this._isEnabled=!0,this._body=null,this._fixtures=[],this._myJoints=[],this._myCreatedJoints=[],this._joiningMe=new Set,this._lastKnownX=i.GetX(),this._lastKnownY=i.GetY(),this._lastKnownAngle=i.GetAngle(),this._lastHeight=this._lastWidth=0,this._lastTickOverride=!1,s&&(this._isImmovable=!!s[0],this._collisionMask=s[1],this._preventRotation=!!s[2],this._density=s[3],this._friction=s[4],this._restitution=s[5],this._linearDamping=s[6],this._angularDamping=s[7],this._isBullet=!!s[8],this._isEnabled=!!s[9]),s=this._runtime.Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(s,"instancedestroy",e=>this._OnInstanceDestroyed(e.instance)),e.Disposable.From(s,"beforeload",()=>this._OnBeforeLoad()),e.Disposable.From(s,"afterload",()=>this._OnAfterLoad())),r.set(this._inst,this),this._isEnabled&&this._StartTicking()}PostCreate(){this._CreateBody()}Release(){this._DestroyMyJoints(),e.clearArray(this._myCreatedJoints),this._joiningMe.clear(),this._body&&(this._DestroyFixtures(),this._world.DestroyBody(this._body),this._body=null),super.Release()}_CreateFixture(e){if(this._body)return e=this._body.CreateFixture(e),this._fixtures.push(e),e}_DestroyFixtures(){if(this._body){for(const e of this._fixtures)this._body.DestroyFixture(e);e.clearArray(this._fixtures)}}_GetBoundingQuadExcludingMesh(){const e=this.GetWorldInfo();return e.HasMesh()?(e.CalculateBbox(h,l,!1),l):e.GetBoundingQuad()}_Destroy(e){this._box2d.destroy(e)}_CreateBody(){if(this._isEnabled){var e=this._box2d.b2FixtureDef,t=this._box2d.b2BodyDef,s=this.GetWorldInfo();if(!this._body){t=new t,t.set_type(this._isImmovable?0:2);var r=this._GetBoundingQuadExcludingMesh();t.set_position(o(r.midX()*this._worldScale,r.midY()*this._worldScale)),t.set_angle(s.GetAngle()),t.set_fixedRotation(this._preventRotation),t.set_linearDamping(this._linearDamping),t.set_angularDamping(this._angularDamping),t.set_bullet(this._isBullet),this._body=this._world.CreateBody(t),this._Destroy(t),i.set(this._body,this)}this._DestroyFixtures(),e=new e,e.set_density(this._density),e.set_friction(this._friction),e.set_restitution(this._restitution),r=s.HasOwnCollisionPoly(),t=this._collisionMask,r||this._inst.HasTilemap()||0!==t||(t=1),r=Math.max(Math.abs(s.GetWidth()),1);var n=Math.max(Math.abs(s.GetHeight()),1);0===t?this._inst.HasTilemap()?this._CreateTilemapFixtures(e):this._CreatePolygonFixture(e,r,n):1===t?this._CreateBoundingBoxFixture(e,r,n):this._CreateCircleFixture(e,r,n),this._lastWidth=s.GetWidth(),this._lastHeight=s.GetHeight(),s.SetPhysicsBodyChanged(!1),this._Destroy(e)}}_CreateBoundingBoxFixture(e,t,s){const i=new this._box2d.b2PolygonShape;i.SetAsBox(t*this._worldScale*.5,s*this._worldScale*.5),e.set_shape(i),this._CreateFixture(e),this._Destroy(i)}_CreateCircleFixture(e,t,s){const i=new this._box2d.b2CircleShape;i.set_m_radius(Math.min(t,s)*this._worldScale*.5),e.set_shape(i),this._CreateFixture(e),this._Destroy(i)}_CreatePolygonFixture(t,s,i){var r=this.GetWorldInfo(),n=0>r.GetWidth();const a=0>r.GetHeight(),o=this._worldScale;var h=r.GetAngle();0!==h&&(r.SetAngle(0),r.SetBboxChanged());var l=this._GetBoundingQuadExcludingMesh();const c=l.midX()-r.GetX();l=l.midY()-r.GetY(),0!==h&&(r.SetAngle(h),r.SetBboxChanged()),h=r.GetCustomTransformedCollisionPoly(n?-s:s,a?-i:i,0).pointsArr();const u=h.length/2;r=[];for(let t=0;t<u;++t)r.push(e.Behaviors.Physics.GetVec2(h[2*t]-c,h[2*t+1]-l));n!==a&&r.reverse(),n=e.Behaviors.Physics.Separator.Separate(r,s*i);for(const t of r)e.Behaviors.Physics.FreeVec2(t);if(n.length)for(const i of n){for(const e of i)e.set_x(e.get_x()*o),e.set_y(e.get_y()*o);s=e.Behaviors.Physics.CreatePolygonShape(i),t.set_shape(s),this._CreateFixture(t),this._Destroy(s);for(const t of i)e.Behaviors.Physics.FreeVec2(t)}else this._CreateBoundingBoxFixture(t,s,i)}_CreateTilemapFixtures(t){var s=this.GetWorldInfo(),i=this._GetBoundingQuadExcludingMesh();const r=i.midX()-s.GetX();s=i.midY()-s.GetY(),i=this._worldScale;const a=e.Behaviors.Physics.GetVec2,o=e.Behaviors.Physics.FreeVec2,h=[];this._inst.GetSdkInstance().GetAllCollisionRects(h);const l=[];for(let p=0,g=h.length;p<g;++p){var c=h[p],u=c.GetRect(),_=c.GetPoly();if(_){var d=n.get(_);if(!d){d=_.pointsArr();const t=_.pointCount();for(let e=0;e<t;++e)l.push(a(d[2*e],d[2*e+1]));c=3758096384&c.GetTileId(),(-2147483648===c||1073741824===c||536870912===c||-2147483648&c&&1073741824&c&&536870912&c)&&l.reverse(),d=e.Behaviors.Physics.Separator.Separate(l,u.width()*u.height()),n.set(_,d);for(const e of l)o(e);e.clearArray(l)}for(let n=0,h=d.length;n<h;++n){_=d[n];for(let e=0,t=_.length;e<t;++e)l.push(a((u.getLeft()+_[e].get_x()-r)*i,(u.getTop()+_[e].get_y()-s)*i));_=e.Behaviors.Physics.CreatePolygonShape(l),t.set_shape(_),this._CreateFixture(t),this._Destroy(_);for(const e of l)o(e);e.clearArray(l)}}else l.push(a((u.getLeft()-r)*i,(u.getTop()-s)*i)),l.push(a((u.getRight()-r)*i,(u.getTop()-s)*i)),l.push(a((u.getRight()-r)*i,(u.getBottom()-s)*i)),l.push(a((u.getLeft()-r)*i,(u.getBottom()-s)*i)),u=e.Behaviors.Physics.CreatePolygonShape(l),t.set_shape(u),this._CreateFixture(t),this._Destroy(u);for(const e of l)o(e);e.clearArray(l)}}_DestroyBody(){this._body&&(this._DestroyMyJoints(),i.delete(this._body),this._DestroyFixtures(),this._world.DestroyBody(this._body),this._body=null)}_DestroyMyJoints(){for(const e of this._myJoints)this._world.DestroyJoint(e);e.clearArray(this._myJoints)}_RecreateMyJoints(){for(const e of this._myCreatedJoints)switch(e.type){case 0:this._DoCreateDistanceJoint(...e.params);break;case 1:this._DoCreateRevoluteJoint(...e.params);break;case 2:this._DoCreateLimitedRevoluteJoint(...e.params);break;case 3:this._DoCreatePrismaticJoint(...e.params)}}_GetInstImagePoint(e){var t=this.GetWorldInfo();return-1===e?[t.GetX(),t.GetY()]:0===e&&this._body?(e=this._body.GetPosition(),t=this._body.GetLocalCenter(),[(e.get_x()+t.get_x())/this._worldScale,(e.get_y()+t.get_y())/this._worldScale]):this._inst.GetImagePoint(e)}_CreateDistanceJoint(t,s,i,r,n){this._isEnabled&&s&&s!==this._inst&&e.Behaviors.Physics.Instance.LookupBehInstFromInst(s)&&(this._myCreatedJoints.push({type:0,params:[t,s.GetUID(),i,r,n]}),this._DoCreateDistanceJoint(t,s.GetUID(),i,r,n))}_DoCreateDistanceJoint(t,s,i,n,h){if(this._isEnabled){var l=this._runtime.GetInstanceByUID(s);if(l&&l!==this._inst&&r.has(l)){s=e.Behaviors.Physics.Instance.LookupBehInstFromInst(l),s._joiningMe.add(this._inst),this._UpdateBodyToMatchInstance(!1),s._UpdateBodyToMatchInstance(!1);var[c,u]=this._GetInstImagePoint(t),[_,d]=l.GetImagePoint(i);t=c-_,i=u-d,l=this._worldScale;var p=new this._box2d.b2DistanceJointDef;p.Initialize(this._body,s.GetBody(),a(c*l,u*l),o(_*l,d*l)),p.set_length(Math.hypot(t,i)*l),p.set_dampingRatio(n),p.set_frequencyHz(h),this._myJoints.push(this._world.CreateJoint(p)),this._Destroy(p)}}}_CreateRevoluteJoint(t,s){this._isEnabled&&s&&s!==this._inst&&e.Behaviors.Physics.Instance.LookupBehInstFromInst(s)&&(this._myCreatedJoints.push({type:1,params:[t,s.GetUID()]}),this._DoCreateRevoluteJoint(t,s.GetUID()))}_DoCreateRevoluteJoint(t,s){if(this._isEnabled&&(s=this._runtime.GetInstanceByUID(s))&&s!==this._inst&&r.has(s)){s=e.Behaviors.Physics.Instance.LookupBehInstFromInst(s),s._joiningMe.add(this._inst),this._UpdateBodyToMatchInstance(!1),s._UpdateBodyToMatchInstance(!1);var[i,n]=this._GetInstImagePoint(t);t=this._worldScale;var o=new this._box2d.b2RevoluteJointDef;o.Initialize(this._body,s.GetBody(),a(i*t,n*t)),this._myJoints.push(this._world.CreateJoint(o)),this._Destroy(o)}}_CreateLimitedRevoluteJoint(t,s,i,r){this._isEnabled&&s&&s!==this._inst&&e.Behaviors.Physics.Instance.LookupBehInstFromInst(s)&&(i=e.toDegrees(i),r=e.toDegrees(r),this._myCreatedJoints.push({type:2,params:[t,s.GetUID(),i,r]}),this._DoCreateLimitedRevoluteJoint(t,s.GetUID(),i,r))}_DoCreateLimitedRevoluteJoint(t,s,i,n){if(this._isEnabled&&(s=this._runtime.GetInstanceByUID(s))&&s!==this._inst&&r.has(s)){s=e.Behaviors.Physics.Instance.LookupBehInstFromInst(s),s._joiningMe.add(this._inst),this._UpdateBodyToMatchInstance(!1),s._UpdateBodyToMatchInstance(!1);var[o,h]=this._GetInstImagePoint(t);t=this._worldScale;var l=new this._box2d.b2RevoluteJointDef;l.Initialize(this._body,s.GetBody(),a(o*t,h*t)),l.set_enableLimit(!0),l.set_lowerAngle(e.toRadians(i)),l.set_upperAngle(e.toRadians(n)),this._myJoints.push(this._world.CreateJoint(l)),this._Destroy(l)}}_CreatePrismaticJoint(t,s,i,r,n,a,o,h,l){this._isEnabled&&s&&s!==this._inst&&e.Behaviors.Physics.Instance.LookupBehInstFromInst(s)&&(i=e.toDegrees(i),h=e.toDegrees(h),this._myCreatedJoints.push({type:3,params:[t,s.GetUID(),i,r,n,a,o,h,l]}),this._DoCreatePrismaticJoint(t,s.GetUID(),i,r,n,a,o,h,l))}_DoCreatePrismaticJoint(t,s,i,n,h,l,c,u,_){if(this._isEnabled&&(s=this._runtime.GetInstanceByUID(s))&&s!==this._inst&&r.has(s)){s=e.Behaviors.Physics.Instance.LookupBehInstFromInst(s),s._joiningMe.add(this._inst),this._UpdateBodyToMatchInstance(!1),s._UpdateBodyToMatchInstance(!1);var[d,p]=this._GetInstImagePoint(t);i=e.toRadians(i),t=Math.cos(i),i=Math.sin(i);var g=this._worldScale,m=new this._box2d.b2PrismaticJointDef;m.Initialize(this._body,s.GetBody(),a(d*g,p*g),o(t,i)),m.set_enableLimit(!!n),m.set_lowerTranslation(h*g),m.set_upperTranslation(l*g),m.set_enableMotor(!!c),m.set_motorSpeed(e.toRadians(u)),m.set_maxMotorForce(_),this._myJoints.push(this._world.CreateJoint(m)),this._Destroy(m)}}_RemoveJoints(){this._isEnabled&&(this._DestroyMyJoints(),e.clearArray(this._myCreatedJoints),this._joiningMe.clear())}_OnInstanceDestroyed(t){const s=t.GetUID();let i=0;for(let e=0,t=this._myCreatedJoints.length;e<t;++e)this._myCreatedJoints[i]=this._myCreatedJoints[e],
i<this._myJoints.length&&(this._myJoints[i]=this._myJoints[e]),this._myCreatedJoints[e].params[1]===s?e<this._myJoints.length&&this._world.DestroyJoint(this._myJoints[e]):++i;e.truncateArray(this._myCreatedJoints,i),i<this._myJoints.length&&e.truncateArray(this._myJoints,i),this._joiningMe.delete(t)}GetBody(){return this._body}static LookupBehInstFromBody(e){return i.get(e)||null}static LookupBehInstFromInst(e){return r.get(e)||null}SaveToJson(){const e={e:this._isEnabled,pr:this._preventRotation,d:this._density,fr:this._friction,re:this._restitution,ld:this._linearDamping,ad:this._angularDamping,b:this._isBullet,mcj:this._myCreatedJoints};if(this._isEnabled){const t=this._body.GetLinearVelocity();e.vx=t.get_x(),e.vy=t.get_y(),e.om=this._body.GetAngularVelocity()}return e}_OnBeforeLoad(){this._DestroyMyJoints(),e.clearArray(this._myCreatedJoints),this._joiningMe.clear()}LoadFromJson(e){this._DestroyBody(),this._isEnabled=e.e,this._preventRotation=e.pr,this._density=e.d,this._friction=e.fr,this._restitution=e.re,this._linearDamping=e.ld,this._angularDamping=e.ad,this._isBullet=e.b,this._myCreatedJoints=e.mcj;const t=this.GetWorldInfo();this._lastKnownX=t.GetX(),this._lastKnownY=t.GetY(),this._lastKnownAngle=t.GetAngle(),this._lastWidth=t.GetWidth(),this._lastHeight=t.GetHeight(),this._isEnabled&&(this._CreateBody(),this._body.SetLinearVelocity(a(e.vx,e.vy)),this._body.SetAngularVelocity(e.om),0===e.vx&&0===e.vy&&0===e.om||this._body.SetAwake(!0),this._myCreatedJoints=e.mcj),this._isEnabled?this._StartTicking():this._StopTicking()}_OnAfterLoad(){this._isEnabled&&this._RecreateMyJoints()}Tick(){if(this._isEnabled){var e=this._runtime,t=this.GetBehavior();if(0===t.GetSteppingMode())var s=e.GetTimeScale()/60;else s=e.GetDt(this._inst),s>1/30&&(s=1/30);var i=e.GetTickCountNoSave();if(i>t.GetLastUpdateTick()&&0<e.GetTimeScale()){e=this._runtime.IsDebug();let r=0;e&&(r=performance.now()),0!==s&&this._world.Step(s,t.GetVelocityIterations(),t.GetPositionIterations()),this._world.ClearForces(),e&&self.C3Debugger.AddPhysicsTime(performance.now()-r),t.SetLastUpdateTick(i)}this._UpdateBodyToMatchInstance(!0)}}_UpdateBodyToMatchInstance(e){const t=this._inst.GetWorldInfo();var s=this._worldScale;(t.GetWidth()!==this._lastWidth||t.GetHeight()!==this._lastHeight||t.IsPhysicsBodyChanged())&&this._CreateBody();var i=this._body,r=t.GetX()!==this._lastKnownX||t.GetY()!==this._lastKnownY,n=t.GetAngle()!==this._lastKnownAngle;if(r){var o=this._GetBoundingQuadExcludingMesh();const r=o.midX();o=o.midY();const h=r-this._lastKnownX,l=o-this._lastKnownY;n?i.SetTransform(a(r*s,o*s),t.GetAngle()):i.SetTransform(a(r*s,o*s),i.GetAngle()),e&&(i.SetLinearVelocity(a(h,l)),this._lastTickOverride=!0),i.SetAwake(!0)}else e&&this._lastTickOverride&&(e=this._GetBoundingQuadExcludingMesh(),this._lastTickOverride=!1,i.SetLinearVelocity(a(0,0)),i.SetTransform(a(e.midX()*s,e.midY()*s),i.GetAngle()));!r&&n&&(i.SetTransform(i.GetPosition(),t.GetAngle()),i.SetAwake(!0)),n=i.GetPosition(),r=n.get_x()/s,s=n.get_y()/s,i=i.GetAngle(),r===t.GetX()&&s===t.GetY()&&i===t.GetAngle()||(t.SetXY(r,s),t.SetAngle(i),t.SetBboxChanged(),s=this._GetBoundingQuadExcludingMesh(),i=s.midX()-t.GetX(),s=s.midY()-t.GetY(),(0!==i||0!==s)&&(t.OffsetXY(-i,-s),t.SetBboxChanged())),this._lastKnownX=t.GetX(),this._lastKnownY=t.GetY(),this._lastKnownAngle=t.GetAngle()}GetPropertyValueByIndex(e){switch(e){case 2:return this._IsPreventRotate();case 3:return this._GetDensity();case 4:return this._GetFriction();case 5:return this._GetElasticity();case 6:return this._GetLinearDamping();case 7:return this._GetAngularDamping();case 8:return this._IsBullet();case 9:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case 2:this._SetPreventRotate(t);break;case 3:this._SetDensity(t);break;case 4:this._SetFriction(t);break;case 5:this._SetElasticity(t);break;case 6:this._SetLinearDamping(t);break;case 7:this._SetAngularDamping(t);break;case 8:this._SetBullet(t);break;case 9:this._SetEnabled(t)}}_SetEnabled(e){e=!!e,this._isEnabled&&!e?(this._DestroyBody(),this._isEnabled=!1,this._StopTicking()):!this._isEnabled&&e&&(this._isEnabled=!0,this._CreateBody(),this._StartTicking())}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){const t=[{name:"behaviors.physics.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)},{name:"behaviors.physics.properties.immovable.name",value:this._IsImmovable(),onedit:e=>this._SetImmovable(e)},{name:"behaviors.physics.properties.density.name",value:this._GetDensity(),onedit:e=>this._SetDensity(e)},{name:"behaviors.physics.properties.friction.name",value:this._GetFriction(),onedit:e=>this._SetFriction(e)},{name:"behaviors.physics.properties.elasticity.name",value:this._GetElasticity(),onedit:e=>this._SetElasticity(e)},{name:"behaviors.physics.properties.linear-damping.name",value:this._GetLinearDamping(),onedit:e=>this._SetLinearDamping(e)},{name:"behaviors.physics.properties.angular-damping.name",value:this._GetAngularDamping(),onedit:e=>this._SetAngularDamping(e)}];return this._isEnabled&&(t.push({name:"behaviors.physics.debugger.is-sleeping",value:this._IsSleeping()}),t.push({name:"behaviors.physics.debugger.velocity-x",value:this._GetVelocityX(),onedit:e=>this._SetVelocity(e,this._GetVelocityY())}),t.push({name:"behaviors.physics.debugger.velocity-y",value:this._GetVelocityY(),onedit:e=>this._SetVelocity(this._GetVelocityX(),e)}),t.push({name:"behaviors.physics.debugger.angular-velocity",value:e.toDegrees(this._GetAngularVelocity()),onedit:t=>this._SetAngularVelocity(e.toRadians(t))}),t.push({name:"behaviors.physics.debugger.mass",value:this._GetMass()})),[{title:"$"+this.GetBehaviorType().GetName(),properties:t}]}_ApplyForce(e,t,s){const[i,r]=this._GetInstImagePoint(s);this._DoApplyForce(e,t,i,r)}_ApplyForceToward(t,s,i,r){const[n,a]=this._GetInstImagePoint(r);s=e.angleTo(n,a,s,i),this._DoApplyForce(Math.cos(s)*t,Math.sin(s)*t,n,a)}_ApplyForceAtAngle(e,t,s){const[i,r]=this._GetInstImagePoint(s);this._DoApplyForce(Math.cos(t)*e,Math.sin(t)*e,i,r)}_DoApplyForce(e,t,s,i){if(this._isEnabled){var r=this._worldScale;this._body.ApplyForce(a(e,t),o(s*r,i*r),!0)}}_ApplyImpulse(e,t,s){const[i,r]=this._GetInstImagePoint(s);this._DoApplyImpulse(e,t,i,r)}_ApplyImpulseToward(t,s,i,r){const[n,a]=this._GetInstImagePoint(r);s=e.angleTo(n,a,s,i),this._DoApplyImpulse(Math.cos(s)*t,Math.sin(s)*t,n,a)}_ApplyImpulseAtAngle(e,t,s){const[i,r]=this._GetInstImagePoint(s);this._DoApplyImpulse(Math.cos(t)*e,Math.sin(t)*e,i,r)}_DoApplyImpulse(e,t,s,i){if(this._isEnabled){var r=this._worldScale;this._body.ApplyLinearImpulse(a(e,t),o(s*r,i*r),!0),e=this.GetWorldInfo(),this._lastKnownX=e.GetX(),this._lastKnownY=e.GetY(),this._lastTickOverride=!1}}_ApplyTorque(e){this._isEnabled&&this._body.ApplyTorque(e,!0)}_ApplyTorqueToAngle(t,s){s=e.angleClockwise(this.GetWorldInfo().GetAngle(),s)?-1:1,this._ApplyTorque(t*s)}_ApplyTorqueToPosition(t,s,i){var r=this.GetWorldInfo();s=e.angleTo(r.GetX(),r.GetY(),s,i),r=e.angleClockwise(r.GetAngle(),s)?-1:1,this._ApplyTorque(t*r)}_SetAngularVelocity(e){this._isEnabled&&(this._body.SetAngularVelocity(e),this._body.SetAwake(!0))}_GetAngularVelocity(){return this._isEnabled?this._body.GetAngularVelocity():0}_SetVelocity(e,t){if(this._isEnabled){var s=this._worldScale;this._body.SetLinearVelocity(a(e*s,t*s)),this._body.SetAwake(!0),e=this.GetWorldInfo(),this._lastKnownX=e.GetX(),this._lastKnownY=e.GetY(),this._lastTickOverride=!1}}_GetVelocity(){if(!this._isEnabled)return[0,0];const e=this._worldScale,t=this._body.GetLinearVelocity();return[t.get_x()/e,t.get_y()/e]}_GetVelocityX(){return this._isEnabled?this._body.GetLinearVelocity().get_x()/this._worldScale:0}_GetVelocityY(){return this._isEnabled?this._body.GetLinearVelocity().get_y()/this._worldScale:0}_SetDensity(e){if(this._isEnabled&&this._density!==e){this._density=e;for(const t of this._fixtures)t.SetDensity(e);this._body.ResetMassData()}}_GetDensity(){return this._isEnabled?this._density:0}_SetFriction(e){if(this._isEnabled&&this._friction!==e){for(var t of(this._friction=e,this._fixtures))t.SetFriction(e);for(e=this._body.GetContactList();this._box2d.getPointer(e);e=e.get_next())(t=e.get_contact())&&t.ResetFriction()}}_GetFriction(){return this._isEnabled?this._friction:0}_SetElasticity(e){if(this._isEnabled&&this._restitution!==e){this._restitution=e;for(const t of this._fixtures)t.SetRestitution(e)}}_GetElasticity(){return this._isEnabled?this._restitution:0}_SetLinearDamping(e){this._isEnabled&&this._linearDamping!==e&&(this._linearDamping=e,this._body.SetLinearDamping(e))}_GetLinearDamping(){return this._isEnabled?this._linearDamping:0}_SetAngularDamping(e){this._isEnabled&&this._angularDamping!==e&&(this._angularDamping=e,this._body.SetAngularDamping(e))}_GetAngularDamping(){return this._isEnabled?this._angularDamping:0}_SetImmovable(e){this._isEnabled&&(e=!!e,this._isImmovable!==e&&(this._isImmovable=e,this._body.SetType(this._isImmovable?0:2),this._body.SetAwake(!0)))}_IsImmovable(){return this._isImmovable}_SetPreventRotate(e){this._isEnabled&&(e=!!e,this._preventRotation!==e&&(this._preventRotation=e,this._body.SetFixedRotation(this._preventRotation),this._body.SetAngularVelocity(0),this._body.SetAwake(!0)))}_IsPreventRotate(){return this._preventRotation}_SetBullet(e){this._isEnabled&&(e=!!e,this._isBullet!==e&&(this._isBullet=e,this._body.SetBullet(this._isBullet),this._body.SetAwake(!0)))}_IsBullet(){return this._isBullet}_GetMass(){return this._isEnabled?this._body.GetMass()/this._worldScale:0}_GetCenterOfMassX(){return this._isEnabled?(this._body.GetPosition().get_x()+this._body.GetLocalCenter().get_x())/this._worldScale:0}_GetCenterOfMassY(){return this._isEnabled?(this._body.GetPosition().get_y()+this._body.GetLocalCenter().get_y())/this._worldScale:0}_GetCenterOfMass(){if(!this._isEnabled)return[0,0];const e=this._body.GetPosition(),t=this._body.GetLocalCenter(),s=this._worldScale;return[(e.get_x()+t.get_x())/s,(e.get_y()+t.get_y())/s]}_IsSleeping(){return!!this._isEnabled&&!this._body.IsAwake()}_GetContactCount(){if(!this._isEnabled)return 0;let e=0;for(let s=this._body.GetContactList();this._box2d.getPointer(s);s=s.get_next()){var t=s.get_contact();t&&(t=t.GetManifold().get_pointCount(),e+=t)}return e}_GetContactPositionAt(e){if(e=Math.floor(e),!this._isEnabled)return[0,0];var t=0;for(let i=this._body.GetContactList();this._box2d.getPointer(i);i=i.get_next()){var s=i.get_contact();if(!s)continue;const r=s.GetManifold().get_pointCount();if(e>=t&&e<t+r)return e-=t,t=this.GetBehavior().GetWorldManifold(),s.GetWorldManifold(t),s=t.get_points(e),[s.get_x()/this._worldScale,s.get_y()/this._worldScale];t+=r}return[0,0]}GetScriptInterfaceClass(){return self.IPhysicsBehaviorInstance}};const c=new WeakMap;function v(e,t){return c.get(e).GetRuntime()._UnwrapIWorldInstance(t)}self.IPhysicsBehaviorInstance=class extends s{constructor(){super(),c.set(this,s._GetInitInst().GetSdkInstance())}get isEnabled(){return c.get(this)._IsEnabled()}set isEnabled(e){c.get(this)._SetEnabled(e)}applyForce(e,s,i=0){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),c.get(this)._ApplyForce(e,s,i)}applyForceTowardPosition(e,s,i,r=0){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireFiniteNumber(i),c.get(this)._ApplyForceToward(e,s,i,r)}applyForceAtAngle(e,s,i=0){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),c.get(this)._ApplyForceAtAngle(e,s,i)}applyImpulse(e,s,i=0){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),c.get(this)._ApplyImpulse(e,s,i)}applyImpulseTowardPosition(e,s,i,r=0){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireFiniteNumber(i),c.get(this)._ApplyImpulseToward(e,s,i,r)}applyImpulseAtAngle(e,s,i=0){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),c.get(this)._ApplyImpulseAtAngle(e,s,i)}applyTorque(e){t.RequireFiniteNumber(e),c.get(this)._ApplyTorque(e)}applyTorqueToAngle(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),c.get(this)._ApplyTorqueToAngle(e,s)}applyTorqueToPosition(e,s,i){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireFiniteNumber(i),c.get(this)._ApplyTorqueToPosition(e,s,i)}set angularVelocity(e){t.RequireFiniteNumber(e),c.get(this)._SetAngularVelocity(e)}get angularVelocity(){return c.get(this)._GetAngularVelocity()}setVelocity(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),c.get(this)._SetVelocity(e,s)}getVelocityX(){return c.get(this)._GetVelocityX()}getVelocityY(){return c.get(this)._GetVelocityY()}getVelocity(){return c.get(this)._GetVelocity()}set density(e){t.RequireFiniteNumber(e),c.get(this)._SetDensity(e)}get density(){return c.get(this)._GetDensity()}set friction(e){t.RequireFiniteNumber(e),c.get(this)._SetFriction(e)}get friction(){return c.get(this)._GetFriction()}set elasticity(e){t.RequireFiniteNumber(e),c.get(this)._SetElasticity(e)}get elasticity(){return c.get(this)._GetElasticity()}set linearDamping(e){t.RequireFiniteNumber(e),c.get(this)._SetLinearDamping(e)}get linearDamping(){return c.get(this)._GetLinearDamping()}set angularDamping(e){t.RequireFiniteNumber(e),c.get(this)._SetAngularDamping(e)}get angularDamping(){return c.get(this)._GetAngularDamping()}set isImmovable(e){c.get(this)._SetImmovable(e)}get isImmovable(){return c.get(this)._IsImmovable()}set isPreventRotation(e){c.get(this)._SetPreventRotate(e)}get isPreventRotation(){return c.get(this)._IsPreventRotate()}set isBullet(e){c.get(this)._SetBullet(e)}get isBullet(){return c.get(this)._IsBullet()}get mass(){return c.get(this)._GetMass()}getCenterOfMassX(){return c.get(this)._GetCenterOfMassX()}getCenterOfMassY(){return c.get(this)._GetCenterOfMassY()}getCenterOfMass(){return c.get(this)._GetCenterOfMass()}getContactCount(){return c.get(this)._GetContactCount()}getContactX(e){return t.RequireFiniteNumber(e),c.get(this)._GetContactPositionAt(e)[0]}getContactY(e){return t.RequireFiniteNumber(e),c.get(this)._GetContactPositionAt(e)[1]}getContact(e){return t.RequireFiniteNumber(e),c.get(this)._GetContactPositionAt(e)}get isSleeping(){return c.get(this)._IsSleeping()}createDistanceJoint(e,s,i,r,n){t.RequireFiniteNumber(r),t.RequireFiniteNumber(n),s=v(this,s),c.get(this)._CreateDistanceJoint(e,s,i,r,n)}createRevoluteJoint(e,t){t=v(this,t),c.get(this)._CreateRevoluteJoint(e,t)}createLimitedRevoluteJoint(e,s,i,r){t.RequireFiniteNumber(i),t.RequireFiniteNumber(r),s=v(this,s),c.get(this)._CreateLimitedRevoluteJoint(e,s,i,r)}createPrismaticJoint(e,t,s,i,r,n,a,o,h){t=v(this,t),c.get(this)._CreatePrismaticJoint(e,t,s,i,r,n,a,o,h)}removeAllJoints(){c.get(this)._RemoveJoints()}}}{const e=self.C3;e.Behaviors.Physics.Cnds={IsSleeping(){return this._IsSleeping()},CompareVelocity(t,s,i){if(!this._isEnabled)return!1;if(0===t)t=this._GetVelocityX();else if(1===t)t=this._GetVelocityY();else{const[e,s]=this._GetVelocity();t=Math.hypot(e,s)}return e.compare(t,s,i)},CompareAngularVelocity(t,s){if(!this._isEnabled)return!1;const i=e.toDegrees(this._GetAngularVelocity());return e.compare(i,t,s)},CompareMass(t,s){if(!this._isEnabled)return!1;const i=this._GetMass();return e.compare(i,t,s)},IsEnabled(){return this._IsEnabled()}}}{const e=self.C3;e.Behaviors.Physics.Acts={ApplyForce(e,t,s){this._ApplyForce(e,t,s)},ApplyForceToward(e,t,s,i){this._ApplyForceToward(e,t,s,i)},ApplyForceAtAngle(t,s,i){this._ApplyForceAtAngle(t,e.toRadians(s),i)},ApplyImpulse(e,t,s){this._ApplyImpulse(e,t,s)},ApplyImpulseToward(e,t,s,i){this._ApplyImpulseToward(e,t,s,i)},ApplyImpulseAtAngle(t,s,i){this._ApplyImpulseAtAngle(t,e.toRadians(s),i)},ApplyTorque(t){this._ApplyTorque(e.toRadians(t))},ApplyTorqueToAngle(t,s){this._ApplyTorqueToAngle(e.toRadians(t),e.toRadians(s))},ApplyTorqueToPosition(t,s,i){this._ApplyTorqueToPosition(e.toRadians(t),s,i)},SetAngularVelocity(t){this._SetAngularVelocity(e.toRadians(t))},CreateDistanceJoint(e,t,s,i,r){t&&(t=t.GetFirstPicked(this._inst),this._CreateDistanceJoint(e,t,s,i,r))},CreateRevoluteJoint(e,t){t&&(t=t.GetFirstPicked(this._inst),this._CreateRevoluteJoint(e,t))},CreateLimitedRevoluteJoint(t,s,i,r){s&&(s=s.GetFirstPicked(this._inst),this._CreateLimitedRevoluteJoint(t,s,e.toRadians(i),e.toRadians(r)))},CreatePrismaticJoint(t,s,i,r,n,a,o,h,l){s&&(s=s.GetFirstPicked(this._inst),this._CreatePrismaticJoint(t,s,e.toRadians(i),r,n,a,o,e.toRadians(h),l))},RemoveJoints(){this._RemoveJoints()},SetWorldGravity(e){this.GetBehavior().SetGravity(e)},SetSteppingMode(e){this.GetBehavior().SetSteppingMode(e)},SetIterations(e,t){this.GetBehavior().SetIterations(e,t)},SetVelocity(e,t){this._SetVelocity(e,t)},SetDensity(e){this._SetDensity(e)},SetFriction(e){this._SetFriction(e)},SetElasticity(e){this._SetElasticity(e)},SetLinearDamping(e){this._SetLinearDamping(e)},SetAngularDamping(e){this._SetAngularDamping(e)},SetImmovable(e){this._SetImmovable(e)},EnableCollisions(e,t){this.GetBehavior().SetCollisionsEnabled(this.GetObjectClass(),e,0!==t)},SetPreventRotate(e){this._SetPreventRotate(0!==e)},SetBullet(e){this._SetBullet(0!==e)},SetEnabled(e){this._SetEnabled(0!==e)}}}{const e=self.C3;e.Behaviors.Physics.Exps={VelocityX(){return this._GetVelocityX()},VelocityY(){return this._GetVelocityY()},AngularVelocity(){return e.toDegrees(this._GetAngularVelocity())},Mass(){return this._GetMass()},CenterOfMassX(){return this._GetCenterOfMassX()},CenterOfMassY(){return this._GetCenterOfMassY()},Density(){return this._GetDensity()},Friction(){return this._GetFriction()},Elasticity(){return this._GetElasticity()},LinearDamping(){return this._GetLinearDamping()},AngularDamping(){return this._GetAngularDamping()},ContactCount(){return this._GetContactCount()},ContactXAt(e){return this._GetContactPositionAt(e)[0]},ContactYAt(e){return this._GetContactPositionAt(e)[1]}}}{const e=self.C3,t={};e.Behaviors.Physics.Separator=t;const s=e.Behaviors.Physics.GetVec2,i=e.Behaviors.Physics.FreeVec2;function d(e){return s(e.get_x(),e.get_y())}function f(e){const t=[];for(const s of e)8>=s.length?t.push(s):t.push.apply(t,h(s));return t}function h(e){const t=[];t.push(e.splice(0,8));const s=t[0][0];let i=t[0][7];for(;e.length;){const r=e.splice(0,Math.min(e.length,6));let n=r.at(-1);r.push(d(s)),r.push(d(i)),t.push(r),i=n}return t}t.det=function(e,t,s,i,r,n){return e*i+s*n+r*t-t*s-i*r-n*e},t.hitRay=function(e,i,r,n,a,o,h,l){var c=r-e,u=n-i,_=h-a;const d=l-o;return _=(_*(o-i)-d*(a-e))/(u*_-c*d),c=e+_*c,u=i+_*u,e=t.isOnSegment(r,n,e,i,c,u),a=t.isOnSegment(c,u,a,o,h,l),e&&a?s(c,u):null},t.isOnSegment=function(e,s,i,r,n,a){return(i+.1>=e&&e>=n-.1||i-.1<=e&&e<=n+.1)&&(r+.1>=s&&s>=a-.1||r-.1<=s&&s<=a+.1)&&t.isOnLine(e,s,i,r,n,a)},t.isOnLine=function(e,t,s,i,r,n){return.1<Math.abs(r-s)?.1>Math.abs((n-i)/(r-s)*(e-s)+i-t):.1>Math.abs(e-s)},t.pointsMatch=function(e,t,s,i){return.1>Math.abs(s-e)&&.1>Math.abs(i-t)},t.Separate=function(e,r){e=t.calcShapes(e);let n=[];for(let t=0,a=e.length;t<a;++t){const a=e[t],o=[];let h=0;for(let e=0,t=a.length;e<t;++e){const i=a[e],r=a[(e+1)%t];h+=i.get_x()*r.get_y()-i.get_y()*r.get_x(),o.push(s(i.get_x(),i.get_y()))}if(h=Math.abs(h/2),h>=.001*r)n.push(o);else for(let e=0,t=o.length;e<t;e++)i(o[e])}return f(n)},t.calcShapes=function(e){var s;let r;var n;let a,o,h,l,c,u;var _=0;let d,p=0,g=[],m=[];for(m.push(e);m.length;){for(e=m[0],r=e.length,d=!0,s=0;s<r;s++){o=s,h=s<r-1?s+1:s+1-r;var f=s<r-2?s+2:s+2-r;if(l=e[o],c=e[h],f=e[f],f=t.det(l.get_x(),l.get_y(),c.get_x(),c.get_y(),f.get_x(),f.get_y()),0>f){d=!1;var S=1e9;for(n=0;n<r;n++)if(n!==o&&n!==h){s=n,f=n<r-1?n+1:0;var y=e[s],G=e[f];(y=t.hitRay(l.get_x(),l.get_y(),c.get_x(),c.get_y(),y.get_x(),y.get_y(),G.get_x(),G.get_y()))&&(G=c.get_x()-y.get_x(),a=c.get_y()-y.get_y(),G=G*G+a*a,G<S?(p=s,_=f,u=y,S=G):i(y))}if(1e9===S)return[];for(n=[],S=[],s=p,f=_,y=e[s],G=e[f],_=!1,t.pointsMatch(u.get_x(),u.get_y(),G.get_x(),G.get_y())||(n.push(u),_=!0),t.pointsMatch(u.get_x(),u.get_y(),y.get_x(),y.get_y())||(S.push(u),_=!0),_||i(u),p=-1,_=o;;){if(_===f){if(0>p||p>=r)return[];t.isOnSegment(G.get_x(),G.get_y(),e[p].get_x(),e[p].get_y(),l.get_x(),l.get_y())||n.push(e[_]);break}n.push(e[_]),p=_,0>_-1?_=r-1:_--}for(n.reverse(),p=-1,_=h;;){if(_===s){if(0>p||p>=r)return[];_!==s||t.isOnSegment(y.get_x(),y.get_y(),e[p].get_x(),e[p].get_y(),c.get_x(),c.get_y())||S.push(e[_]);break}S.push(e[_]),p=_,_+1>r-1?_=0:_++}m.push(n,S),m.shift();break}}d&&g.push(m.shift())}return g}}{const e=self.C3;e.Behaviors.Anchor=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Anchor.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.Anchor.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._anchorTop=this._anchorLeft=2,this._anchorBottom=this._anchorRight=0,this._isEnabled=!0,t=this._inst.GetWorldInfo().GetBoundingBox(),this._xLeft=t.getLeft(),this._yTop=t.getTop(),this._xRight=this._runtime.GetOriginalViewportWidth()-t.getLeft(),this._yBottom=this._runtime.GetOriginalViewportHeight()-t.getTop(),this._rDiff=this._runtime.GetOriginalViewportWidth()-t.getRight(),this._bDiff=this._runtime.GetOriginalViewportHeight()-t.getBottom(),s&&(this._anchorLeft=s[0],this._anchorTop=s[1],this._anchorRight=s[2],this._anchorBottom=s[3],this._isEnabled=!!s[4]),s=this._runtime.Dispatcher(),this._disposables=new e.CompositeDisposable(e.Disposable.From(s,"layoutchange",()=>this._OnLayoutChange())),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{xl:this._xLeft,yt:this._yTop,xr:this._xRight,yb:this._yBottom,rd:this._rDiff,bd:this._bDiff,al:this._anchorLeft,at:this._anchorTop,ar:this._anchorRight,ab:this._anchorBottom,e:this._isEnabled}}LoadFromJson(e){this._xLeft=e.xl,this._yTop=e.yt,this._xRight=e.xr,this._yBottom=e.yb,this._rDiff=e.rd,this._bDiff=e.bd,this._anchorLeft=e.al,this._anchorTop=e.at,this._anchorRight=e.ar,this._anchorBottom=e.ab,(this._isEnabled=e.e)?this._StartTicking():this._StopTicking()}_UpdatePosition(){if(this._isEnabled){var e=this._inst.GetWorldInfo(),t=e.GetLayer().GetViewport();if(0===this._anchorLeft){var s=t.getLeft()+this._xLeft-e.GetBoundingBox().getLeft();0!==s&&(e.OffsetX(s),e.SetBboxChanged())}else 1===this._anchorLeft&&(s=t.getRight()-this._xRight-e.GetBoundingBox().getLeft(),0!==s&&(e.OffsetX(s),e.SetBboxChanged()));0===this._anchorTop?(s=t.getTop()+this._yTop-e.GetBoundingBox().getTop(),0!==s&&(e.OffsetY(s),e.SetBboxChanged())):1===this._anchorTop&&(s=t.getBottom()-this._yBottom-e.GetBoundingBox().getTop(),0!==s&&(e.OffsetY(s),e.SetBboxChanged())),1===this._anchorRight&&(s=t.getRight()-this._rDiff-e.GetBoundingBox().getRight(),0!==s&&(e.OffsetX(e.GetOriginX()*s),e.SetWidth(Math.max(e.GetWidth()+s),0),e.SetBboxChanged(),this._rDiff=t.getRight()-e.GetBoundingBox().getRight())),1===this._anchorBottom&&(s=t.getBottom()-this._bDiff-e.GetBoundingBox().getBottom(),0!==s&&(e.OffsetY(e.GetOriginY()*s),e.SetHeight(Math.max(e.GetHeight()+s,0)),e.SetBboxChanged(),this._bDiff=t.getBottom()-e.GetBoundingBox().getBottom()))}}Tick(){this._UpdatePosition()}_OnLayoutChange(){this._UpdatePosition()}GetPropertyValueByIndex(e){switch(e){case 0:return this._anchorLeft;case 1:return this._anchorTop;case 2:return this._anchorRight;case 3:return this._anchorBottom;case 4:return this._isEnabled}}SetPropertyValueByIndex(e,t){switch(e){case 0:this._anchorLeft=t;break;case 1:this._anchorTop=t;break;case 2:this._anchorRight=t;break;case 3:this._anchorBottom=t;break;case 4:(this._isEnabled=!!t)?this._StartTicking():this._StopTicking()}}}}self.C3.Behaviors.Anchor.Cnds={IsEnabled(){return this._isEnabled}},self.C3.Behaviors.Anchor.Acts={SetEnabled(e){this._isEnabled&&0===e?(this._isEnabled=!1,this._StopTicking()):this._isEnabled||0===e||(e=this._inst.GetWorldInfo().GetBoundingBox(),this._xLeft=e.getLeft(),this._yTop=e.getTop(),this._xRight=this._runtime.GetOriginalViewportWidth()-e.getLeft(),this._yBottom=this._runtime.GetOriginalViewportHeight()-e.getTop(),this._rDiff=this._runtime.GetOriginalViewportWidth()-e.getRight(),this._bDiff=this._runtime.GetOriginalViewportHeight()-e.getBottom(),this._isEnabled=!0,this._StartTicking())}},self.C3.Behaviors.Anchor.Exps={};{const e=self.C3;self.C3_GetObjectRefTable=function(){
return[e.Plugins.Text,e.Plugins.Sprite,e.Behaviors.Tween,e.Plugins.Spritefont2,e.Plugins.Dictionary,e.Plugins.Audio,e.Plugins.Browser,e.Plugins.LocalStorage,e.Plugins.NodeWebkit,e.Behaviors.Bullet,e.Behaviors.solid,e.Behaviors.Sin,e.Behaviors.Orbit,e.Behaviors.Timer,e.Behaviors.Rotate,e.Plugins.Particles,e.Behaviors.Pin,e.Plugins.Tilemap,e.Plugins.gamepad,e.Plugins.Keyboard,e.Plugins.Mouse,e.Plugins.Touch,e.Behaviors.Platform,e.Behaviors.Flash,e.Plugins.TiledBg,e.Behaviors.scrollto,e.Behaviors.MoveTo,e.Behaviors.LOS,e.Plugins.Timeline,e.Behaviors.jumpthru,e.Plugins.PlatformInfo,e.Plugins.AJAX,e.Plugins.Arr,e.Plugins.sliderbar,e.Behaviors.Turret,e.Behaviors.EightDir,e.Behaviors.Physics,e.Behaviors.Anchor,e.Plugins.System.Cnds.IsGroupActive,e.Plugins.Sprite.Cnds.OnCreated,e.Plugins.Sprite.Acts.SetSize,e.Plugins.Sprite.Acts.SetPos,e.Plugins.Sprite.Exps.X,e.Plugins.Sprite.Exps.Y,e.Plugins.Sprite.Acts.AddChild,e.Plugins.Sprite.Cnds.CompareInstanceVar,e.Plugins.Sprite.Exps.ImagePointX,e.Plugins.Sprite.Exps.ImagePointY,e.Plugins.Sprite.Cnds.IsBoolInstanceVarSet,e.Plugins.Sprite.Acts.MoveToLayer,e.Plugins.Sprite.Acts.Destroy,e.Plugins.System.Cnds.CompareVar,e.Behaviors.Platform.Cnds.IsEnabled,e.Plugins.System.Cnds.TriggerOnce,e.Behaviors.Platform.Acts.SetEnabled,e.Plugins.PlatformInfo.Cnds.IsOnMobile,e.Behaviors.MoveTo.Acts.MoveToObject,e.Plugins.Browser.Cnds.IsPortraitLandscape,e.Behaviors.Tween.Acts.TweenValue,e.Plugins.System.Exps.layoutscale,e.Plugins.Keyboard.Cnds.OnKey,e.Plugins.gamepad.Cnds.OnButtonDown,e.Plugins.System.Acts.CreateObject,e.Plugins.Audio.Acts.Play,e.Plugins.Sprite.Acts.SetVisible,e.Plugins.Sprite.Acts.SetInstanceVar,e.Plugins.System.Acts.AddVar,e.Behaviors.Platform.Acts.SetIgnoreInput,e.Behaviors.Platform.Acts.SetGravityAngle,e.Plugins.System.Exps.layoutangle,e.Behaviors.Platform.Acts.SetGravity,e.Behaviors.Platform.Acts.SetMaxFallSpeed,e.Behaviors.Platform.Cnds.IsOnFloor,e.Behaviors.Timer.Acts.StartTimer,e.Behaviors.Platform.Acts.SetDeceleration,e.Behaviors.Platform.Acts.SetMaxSpeed,e.Behaviors.Platform.Cnds.IsByWall,e.Behaviors.Platform.Acts.SimulateControl,e.Behaviors.Platform.Acts.SetVectorX,e.Behaviors.Platform.Exps.VectorX,e.Plugins.Sprite.Cnds.IsOverlappingOffset,e.Behaviors.Platform.Cnds.IsFalling,e.Behaviors.Tween.Acts.TweenTwoProperties,e.Plugins.Sprite.Acts.RotateTowardAngle,e.Behaviors.Platform.Acts.SetVectorY,e.Plugins.Sprite.Acts.RotateCounterclockwise,e.Plugins.Sprite.Acts.RotateClockwise,e.Plugins.Sprite.Acts.SetBoolInstanceVar,e.Plugins.Sprite.Cnds.IsOverlapping,e.Plugins.Audio.Acts.FadeVolume,e.Plugins.TiledBg.Cnds.CompareInstanceVar,e.Plugins.TiledBg.Cnds.IsBoolInstanceVarSet,e.Plugins.Audio.Cnds.IsTagPlaying,e.Plugins.Sprite.Acts.SetOpacity,e.Plugins.Browser.Acts.ConsoleLog,e.Plugins.System.Acts.SubVar,e.Behaviors.scrollto.Acts.Shake,e.Plugins.System.Acts.Wait,e.Plugins.System.Acts.SetTimescale,e.Plugins.System.Exps.timescale,e.Behaviors.Tween.Cnds.IsPlaying,e.Plugins.System.Acts.SetLayerOpacity,e.Behaviors.Tween.Exps.Value,e.Behaviors.Tween.Cnds.OnTweensFinished,e.Plugins.System.Acts.GoToLayout,e.Plugins.Sprite.Cnds.OnCollision,e.Plugins.System.Acts.SetVar,e.Plugins.Sprite.Acts.SetAnim,e.Plugins.TiledBg.Acts.SetBoolInstanceVar,e.Plugins.System.Cnds.PickByComparison,e.Plugins.Audio.Acts.SetPlaybackRate,e.Plugins.Sprite.Acts.SetCollisions,e.Behaviors.Tween.Acts.TweenOneProperty,e.Plugins.Touch.Cnds.OnTouchObject,e.Behaviors.Timer.Cnds.IsTimerRunning,e.Plugins.System.Cnds.Compare,e.Behaviors.Timer.Exps.CurrentTime,e.Plugins.Keyboard.Cnds.IsKeyDown,e.Plugins.gamepad.Cnds.IsButtonDown,e.Plugins.gamepad.Cnds.CompareAxis,e.Plugins.Touch.Cnds.IsTouchingObject,e.Behaviors.Platform.Exps.VectorY,e.Plugins.System.Exps.dt,e.Plugins.Sprite.Acts.SetHeight,e.Plugins.Sprite.Exps.Height,e.Behaviors.Timer.Acts.StopTimer,e.Plugins.Sprite.Acts.SetAngle,e.Behaviors.Platform.Cnds.OnLand,e.Behaviors.Tween.Acts.StopTweens,e.Plugins.Sprite.Cnds.OnAnimFinished,e.Plugins.Sprite.Acts.Spawn,e.Plugins.Sprite.Acts.SubInstanceVar,e.Behaviors.LOS.Acts.SetCone,e.Behaviors.LOS.Acts.SetRange,e.Plugins.Sprite.Acts.SetEffectEnabled,e.Behaviors.Sin.Acts.SetEnabled,e.Plugins.TiledBg.Acts.SetEffectParam,e.Behaviors.Bullet.Acts.SetGravity,e.Behaviors.Bullet.Acts.SetEnabled,e.Plugins.System.Acts.WaitForPreviousActions,e.Behaviors.Bullet.Acts.SetSpeed,e.Behaviors.Bullet.Acts.SetAcceleration,e.Plugins.System.Acts.ToggleBoolVar,e.Plugins.Audio.Acts.SetSilent,e.Plugins.System.Acts.SetBoolVar,e.Plugins.System.Cnds.OnLayoutStart,e.Plugins.Particles.Acts.SetPosToObject,e.Behaviors.Platform.Cnds.CompareSpeed,e.Plugins.Particles.Acts.SetSpraying,e.Plugins.Particles.Acts.SetVisible,e.Plugins.Sprite.Exps.Width,e.Plugins.Particles.Cnds.OnCreated,e.Plugins.Particles.Acts.SetXRandomiser,e.Plugins.Particles.Acts.SetYRandomiser,e.Plugins.Particles.Cnds.IsOnScreen,e.Behaviors.Flash.Acts.Flash,e.Behaviors.Rotate.Acts.SetSpeed,e.Plugins.TiledBg.Acts.SetInstanceVar,e.Plugins.Particles.Acts.SetAngle,e.Plugins.Sprite.Exps.Angle,e.Plugins.Sprite.Acts.SetPosToObject,e.Behaviors.Bullet.Acts.SetAngleOfMotion,e.Plugins.Sprite.Cnds.CompareY,e.Plugins.Sprite.Acts.StartAnim,e.Plugins.Sprite.Cnds.IsOnScreen,e.Behaviors.Orbit.Acts.SetEnabled,e.Plugins.TiledBg.Cnds.OnCreated,e.Plugins.TiledBg.Acts.SetWidth,e.Plugins.TiledBg.Acts.SetPos,e.Plugins.TiledBg.Acts.MoveToLayer,e.Plugins.TiledBg.Cnds.IsOnScreen,e.Plugins.TiledBg.Acts.SetImageOffsetX,e.Plugins.TiledBg.Exps.ImageOffsetX,e.Plugins.System.Exps.int,e.Plugins.System.Exps.random,e.Plugins.Sprite.Cnds.CompareOpacity,e.Behaviors.Physics.Acts.ApplyImpulseAtAngle,e.Behaviors.solid.Acts.SetEnabled,e.Plugins.System.Cnds.CompareBoolVar,e.Plugins.TiledBg.Acts.ToggleBoolInstanceVar,e.Plugins.TiledBg.Exps.Width,e.Plugins.TiledBg.Exps.Height,e.Plugins.TiledBg.Exps.Angle,e.Plugins.TiledBg.Exps.X,e.Plugins.TiledBg.Exps.Y,e.Plugins.System.Cnds.Else,e.Plugins.TiledBg.Acts.Destroy,e.Plugins.System.Exps.choose,e.Behaviors.Rotate.Acts.SetEnabled,e.Plugins.Sprite.Cnds.AngleWithin,e.Plugins.Sprite.Cnds.CompareX,e.Behaviors.Tween.Cnds.IsAnyPlaying,e.Plugins.Sprite.Cnds.PickDistance,e.Plugins.Sprite.Exps.UID,e.Plugins.Sprite.Cnds.IsBetweenAngles,e.Plugins.Particles.Acts.SetPos,e.Plugins.Sprite.Acts.SetX,e.Plugins.System.Exps.layoutwidth,e.Plugins.System.Exps.viewportleft,e.Plugins.System.Exps.viewportright,e.Behaviors.Turret.Acts.SetRange,e.Behaviors.Turret.Acts.SetRotateSpeed,e.Behaviors.LOS.Acts.AddObstacle,e.Behaviors.Orbit.Acts.SetSpeed,e.Behaviors.Orbit.Acts.SetAcceleration,e.Behaviors.Orbit.Exps.PrimaryRadius,e.Behaviors.Orbit.Exps.SecondaryRadius,e.Behaviors.LOS.Cnds.HasLOSToObject,e.Behaviors.Orbit.Acts.SetRadius,e.Behaviors.Orbit.Acts.SetRotation,e.Behaviors.Turret.Acts.AcquireTarget,e.Behaviors.Turret.Acts.UnacquireTarget,e.Behaviors.Orbit.Acts.SetTarget,e.Behaviors.Timer.Cnds.OnTimer,e.Behaviors.Turret.Cnds.OnShoot,e.Behaviors.Bullet.Exps.Speed,e.Plugins.TiledBg.Acts.SetImageOffsetY,e.Plugins.TiledBg.Acts.SetSize,e.Plugins.TiledBg.Acts.SetPosToObject,e.Plugins.TiledBg.Acts.SetAngle,e.Plugins.TiledBg.Acts.SetOpacity,e.Behaviors.Tween.Cnds.IsPaused,e.Behaviors.Tween.Acts.ResumeTweens,e.Behaviors.Tween.Acts.PauseTweens,e.Plugins.Sprite.Acts.SetEffectParam,e.Plugins.System.Cnds.OnLayoutEnd,e.Plugins.System.Exps.layoutname,e.Plugins.Dictionary.Acts.AddKey,e.Plugins.Arr.Exps.AsJSON,e.Plugins.LocalStorage.Acts.SetItem,e.Plugins.Dictionary.Exps.AsJSON,e.Plugins.LocalStorage.Cnds.IsProcessingSets,e.Plugins.LocalStorage.Cnds.OnAllSetsComplete,e.Plugins.Browser.Acts.Close,e.Plugins.Browser.Acts.Reload,e.Plugins.Touch.Cnds.OnHoldGesture,e.Plugins.Arr.Acts.Clear,e.Plugins.Dictionary.Acts.DeleteKey,e.Plugins.System.Cnds.OnLoadFinished,e.Plugins.Audio.Acts.Preload,e.Plugins.Browser.Exps.Domain,e.Plugins.System.Exps.tokenat,e.Plugins.LocalStorage.Acts.GetItem,e.Plugins.AJAX.Acts.RequestFile,e.Plugins.LocalStorage.Cnds.OnItemGet,e.Plugins.Dictionary.Acts.JSONLoad,e.Plugins.LocalStorage.Exps.ItemValue,e.Plugins.Dictionary.Cnds.HasKey,e.Plugins.Dictionary.Exps.Get,e.Plugins.Dictionary.Cnds.CompareValue,e.Plugins.Arr.Acts.JSONLoad,e.Plugins.AJAX.Cnds.OnComplete,e.Plugins.AJAX.Exps.LastData,e.Plugins.System.Acts.SetLayerTransparent,e.Plugins.System.Cnds.CompareTime,e.Plugins.Keyboard.Cnds.OnAnyKey,e.Plugins.gamepad.Cnds.OnAnyButtonDown,e.Plugins.Touch.Cnds.OnTouchStart,e.Plugins.Text.Acts.TypewriterText,e.Plugins.Arr.Exps.At,e.Plugins.System.Exps.layeropacity,e.Plugins.System.Acts.SetLayoutEffectEnabled,e.Plugins.System.Acts.SetLayoutEffectParam,e.Behaviors.Platform.Acts.SetCeilingCollision,e.Behaviors.Pin.Acts.PinByProperties,e.Plugins.Text.Cnds.CompareInstanceVar,e.Plugins.Text.Acts.AppendText,e.Plugins.System.Exps.projectversion,e.Plugins.TiledBg.Acts.SetVisible,e.Plugins.System.Exps.viewporttop,e.Plugins.System.Exps.viewportbottom,e.Plugins.System.Cnds.ForEach,e.Plugins.Sprite.Acts.SetY,e.Plugins.System.Acts.SetLayoutScale,e.Plugins.Particles.Acts.Destroy,e.Plugins.System.Acts.SetObjectTimescale,e.Behaviors.Platform.Cnds.IsMoving,e.Behaviors.Timer.Acts.PauseResumeTimer,e.Plugins.Text.Acts.SetVisible,e.Behaviors.MoveTo.Acts.SetEnabled,e.Behaviors.Timer.Cnds.IsTimerPaused,e.Plugins.System.Exps.min,e.Plugins.System.Exps.max,e.ScriptsInEvents.GlobalSettings_Event227_Act1,e.Plugins.Text.Cnds.IsRunningTypewriterText,e.Plugins.Audio.Acts.SetMuted,e.Plugins.Audio.Acts.SetVolume,e.Plugins.Text.Cnds.OnCreated,e.Plugins.Text.Acts.SetInstanceVar,e.Plugins.Text.Exps.Height,e.Plugins.Text.Exps.Width,e.Plugins.System.Exps.find,e.Plugins.Sprite.Exps.LayerName,e.Plugins.System.Exps.originalwindowwidth,e.Plugins.System.Exps.originalwindowheight,e.Plugins.Text.Acts.SetWrapping,e.Plugins.Text.Acts.AddChild,e.Plugins.Sprite.Cnds.IsAnimPlaying,e.Plugins.Text.Cnds.IsBoolInstanceVarSet,e.Plugins.Text.Acts.SetPos,e.Plugins.Text.Acts.ToggleBoolInstanceVar,e.Plugins.Arr.Acts.SetX,e.Plugins.Arr.Acts.SetXY,e.Plugins.Text.Acts.SetText,e.Plugins.Text.Cnds.OnTypewriterTextFinished,e.Plugins.Audio.Acts.Stop,e.Plugins.System.Cnds.Every,e.Behaviors.Timer.Exps.Duration,e.Behaviors.MoveTo.Acts.Stop,e.Plugins.Sprite.Acts.AddInstanceVar,e.Plugins.System.Exps.zeropad,e.ScriptsInEvents.Achievements_Event1_Act2,e.Plugins.Browser.Acts.GoToURLWindow,e.Plugins.Touch.Cnds.OnHoldGestureObject,e.Plugins.gamepad.Cnds.HasGamepads]},self.C3_JsPropNameTable=[{ClearText:0},{Var:0},{ControlsText:0},{CreditsText:0},{CreditsText2:0},{DeathsTxt:0},{Variable1:0},{debug:0},{Variable:0},{Debug_LB:0},{Active:0},{Tween:0},{Dialogue_Box:0},{FailedtoKillBS:0},{FailedtoRescueP:0},{index:0},{LB_RSC_SCR:0},{LB_RSC_USRNM:0},{LB_RVG_SCR:0},{LB_RVG_USR:0},{LB_USER_RES:0},{LD_USER_RVG:0},{Leaderboard:0},{Leaderboard_text:0},{PlayerStat_RescueTime:0},{StatsText:0},{CurrentBoard:0},{textKey:0},{textSmallSquares:0},{BestRescue:0},{BestRevengeDic:0},{Dictionary:0},{LB_Rescue_G10:0},{Audio:0},{Browser:0},{LocalStorage:0},{NWjs:0},{Bullet:0},{Bullet_0:0},{States:0},{Zone:0},{startHeight:0},{Lava:0},{ActiveZoneObject:0},{Saw_State:0},{Saw_Zones:0},{ZoneNumber:0},{State:0},{SinMove:0},{SinSize:0},{tweenMove:0},{portalState:0},{cutScene:0},{Solid:0},{SawNeon:0},{SinMover:0},{Orbiter:0},{Sine:0},{Orbit:0},{Timer:0},{AtlasSquare:0},{SawNeon2:0},{Distance:0},{angleStart:0},{Rotate:0},{SawPortal:0},{zone_P:0},{Particle_Death_Splat:0},{Particle_Red_1:0},{Particles_Explosion:0},{Particles_Fire:0},{Particles_Laser_Death:0},{Particles_Level_Exit:0},{Particles_Portal_Orange:0},{Particles_Respawn:0},{Particles_Self_Destruct:0},{Pin:0},{Particles_Trail_Player:0},{InstanceRate:0},{Particles_Water_Bubbles:0},{Particles_Water_Splash:0},{Particles_Blue_Portal:0},{Particles_Checkpoint:0},{particles_water:0},{Zones:0},{particles_water_spray:0},{Particle_Death_Fountain:0},{Level_Tilemap:0},{TMStructuralNEON:0},{TMStructuralFLAPPY:0},{StartX:0},{StartY:0},{Align:0},{Touch_Jump:0},{Touch_Left:0},{Touch_Right:0},{Gamepad:0},{Keyboard:0},{Mouse:0},{Touch:0},{CoD:0},{CharacterState_Meta:0},{normalState:0},{swimmingState:0},{Block_Affector:0},{conveyorState:0},{PausedState:0},{Jumped:0},{Floored:0},{WallFall:0},{Jump:0},{Move_Left:0},{Move_Right:0},{Color:0},{LightAffector:0},{zoneTransferState:0},{PowerBoost:0},{SafeZoneState:0},{BoxState:0},{MoveRight:0},{MoveLeft:0},{flappyJumps:0},{flappyRotate:0},{isFlappy:0},{Platform:0},{Flash:0},{Player:0},{PopUpText:0},{CP:0},{Checkpoint:0},{Direction:0},{Respawn:0},{particleRandomX:0},{particleRandomY:0},{Water:0},{Instance:0},{Entered:0},{Force:0},{OrangePortalEntrance:0},{OrangePortalExit:0},{BluePortalExit:0},{BluePortalEntrance:0},{Corpse_Lava:0},{Statess:0},{Zoness:0},{InstanceVar:0},{Dialogue:0},{Spoken:0},{AISmallSquares:0},{Platform_Slider:0},{Power:0},{startY:0},{Bouncer:0},{SwitchNumber:0},{Activate:0},{Type:0},{Inverted:0},{Switch:0},{ver:0},{TextDebug:0},{Water_Top:0},{Spikes:0},{Red:0},{Green:0},{Blue:0},{blood:0},{GameZone:0},{YTrans:0},{ScrollTo:0},{MoveTo:0},{Camera:0},{lightSaw:0},{lightPlayer:0},{lightWater:0},{lightRespawn:0},{StateSecurity:0},{DistanceX:0},{OrbitX:0},{OrbitY:0},{LineOfSight:0},{SecurityBot:0},{Timeline:0},{lightSecurity:0},{Number:0},{Closed:0},{Jumpthru:0},{Dash:0},{dtSpeed:0},{MoveDown:0},{PlayerActive:0},{playerTouching:0},{Conveyor:0},{lightConveyor:0},{DoorNumber:0},{Door:0},{LightDoor:0},{lightAngleMin:0},{lightAngleMax:0},{Spotted:0},{HP:0},{Engagable:0},{SafeBox:0},{Level:0},{lightWarp:0},{distance:0},{OriginalY:0},{Activated:0},{elevator:0},{ElevatorChains:0},{StartWidth:0},{Laser:0},{lightLaser:0},{PlatformInfo:0},{Gridbackground:0},{Logo:0},{NeonLogo:0},{AIExclaimation:0},{DialogueTop1:0},{DialogueTop2:0},{EndingDialogue:0},{BigSquare:0},{StartHeight:0},{UIStart:0},{MenuType:0},{MenuIndex:0},{UIMarker:0},{TouchMenu:0},{BigSquareTextMenu:0},{BigSquareTextBox:0},{AJAX:0},{ArraySquareDiag:0},{NormalHeight:0},{SquishedHeight:0},{PineApple:0},{lightPlayerDeath:0},{StartText:0},{lightSwitch:0},{lightSafeBox:0},{DashBox:0},{SecurityBubble:0},{PineAppleText:0},{CameraClassic:0},{CameraMode:0},{SliderBar:0},{On:0},{SecuritySwitch:0},{startwidth:0},{startheight:0},{SecurityBlock:0},{Turret:0},{SawTurret:0},{SawRound:0},{CheckerTexture:0},{lightPlatform:0},{UIOptions:0},{UIQuit:0},{Bar:0},{WidescreenBars:0},{Character:0},{TextOptions:0},{UIDash:0},{inTouch:0},{UISquare:0},{CamPlayer:0},{Heart:0},{HeartParticles:0},{Index:0},{UICherry:0},{Grabbed:0},{Collected:0},{InitialX:0},{InitialY:0},{Cherry:0},{ArraySmallSquaresDialogueCheck:0},{CameraOff:0},{CameraZoom:0},{MusicOn:0},{SFX:0},{languageUIIndex:0},{Language:0},{PerformanceMode:0},{Credits:0},{Back:0},{Controls:0},{Data:0},{ControlsImages:0},{ArrayBigSquareDiagRandom:0},{ArrayBigSquareTowerTop:0},{ArrayBigSquareTopFall:0},{X:0},{TextDeaths:0},{DeathScrolls:0},{KillScroll:0},{PineappleKills:0},{delay:0},{TextKill:0},{TextRevenge:0},{ArrayDiagend:0},{ArraySmallSquareDown:0},{StatVar:0},{TextStats:0},{TextReset:0},{EOFace80s:0},{LogoText:0},{var:0},{TextIntro:0},{PineAppleIMG:0},{"8Direction":0},{CharacterIMG:0},{ArrayIntroText:0},{Fullscreen:0},{Support:0},{ArrayOptionsLanguage:0},{ArrayCredits:0},{TextCredits:0},{LanguagesIndividual:0},{TextCopyRight:0},{SM_YouTube:0},{SM_Instagram:0},{SM_Facebook:0},{SM_Twitter:0},{SM_TikToc:0},{RotateWarning:0},{EraseData:0},{DataErase:0},{GameOver:0},{TextGameOver:0},{ArrayGameOver:0},{UIPurchase:0},{UIGORestart:0},{GameOverCam:0},{Discord:0},{SM_Discord:0},{UIRestorePurchase:0},{privacyspolicy:0},{SteamLogo:0},{SteamLogo2:0},{AppStoreWhite:0},{googleplaybadge:0},{itchbadge:0},{heightStart:0},{heightEnd:0},{Pipe:0},{pipeRedTube:0},{jumpCountPlayer:0},{RespawnEffect:0},{Mover:0},{moveLeft:0},{StartAngle:0},{Horizontal:0},{BulletX:0},{pipeRedFull:0},{Vertical:0},{pipePurple:0},{blowRight:0},{blowLeft:0},{PurplePipeVolume:0},{PurplePipeParticles:0},{scaleStart:0},{Zoom:0},{PipeRespawn:0},{Wings:0},{RedPipeTubeCurve:0},{RedPipeCorner:0},{RedPipeCurved:0},{flappyJumpVolume:0},{startX:0},{ActiveZone:0},{WingsPlayer:0},{particlesHeat:0},{BluePipeTube:0},{BluePipeTubeCurve2:0},{PlayerWingsFor:0},{PineappleWings:0},{EndZoomTriggeBox:0},{CameraMoveEndTrigger:0},{Anim:0},{Cloud:0},{Feather:0},{ParticleFeather:0},{ParticleFeatherP:0},{BigSquareWings:0},{PineappleExplosion:0},{BigTowerLogo:0},{PreviouslyOn:0},{FLAPPY:0},{Cloud2:0},{Credits2:0},{Controls2:0},{Stats:0},{Sprite:0},{Controls3:0},{EOFace80s2:0},{EODude:0},{EO_Dude_1024x:0},{EO_Dude_512x:0},{textLoading:0},{A:0},{D:0},{W:0},{space:0},{AButton:0},{Dpad:0},{EOTextLogo:0},{CMGLogo:0},{level:0},{triggerboxLevelTransfer:0},{tileCorner:0},{launchBox:0},{shootAngle:0},{turretOuter:0},{statePrevious:0},{turretEye:0},{turretBarrel:0},{bulletParticles:0},{checkpointEmpty:0},{checkpoint:0},{checkpointWrap:0},{dtMulti:0},{zone:0},{lava2:0},{BigTowerRedux:0},{purplePortalEnt:0},{purplePortalExit:0},{active:0},{lavaNoise:0},{pineappleHair:0},{lavaBubbleParticles:0},{lavaBubbleBurst:0},{dtmulti:0},{lava3:0},{backgroundTower:0},{OrangePortalEntrance2:0},{OrangePortalExit2:0},{dashAtlas:0},{lavaDrip:0},{Sine_Movement:0},{Sine_Size:0},{Family_Saws:0},{BulletDestroyers:0},{TimeScalePause:0},{Physics:0},{Particles_Red:0},{Particles_Black:0},{UIText:0},{Leaderboards:0},{Family_Players:0},{Family_NPC:0},{Family_TMs:0},{Family_Particles:0},{Family_Zone_Delete:0},{Family_Particles_Flow:0},{SinMovers:0},{Family_Particle_Sprites:0},{Family_Splash_Stoppers:0},{WaterFam:0},{Family_Statics:0},{Theme_Changers:0},{ActiveTiled:0},{TiledDeath:0},{ActiveSprite:0},{ActiveSaw:0},{DoorsFam:0},{BridgeFam:0},{SecurityFam:0},{UIFam:0},{Anchor:0},{TouchFam:0},{LightFam:0},{UIButtonFam:0},{SocialMediaFam:0},{ResponsiveObjects:0},{EOLogos:0},{LavaFamily:0},{PrimaryAngle:0},{Player_Start_X:0},{Player_Start_Y:0},{RespawnCPGlobal:0},{Current_Checkpoint:0},{playerGravityNormal:0},{playerFallSpeedNormal:0},{playerDecelerationGround:0},{playerMaxSpeedGround:0},{playerDecelerationAir:0},{playerMaxSpeedAir:0},{TouchXBaseline:0},{TouchXMovement:0},{Wall_Fall_Slow:0},{Wall_Fall_Boost_X:0},{WallJumpBuffer:0},{PlayerY:0},{coveyorSpeedHorizontal:0},{conveyorSpeedVertical:0},{NormalJumpBuffer:0},{TouchXBase:0},{TouchDirection:0},{jumpSustainPower:0},{jumpSustainTime:0},{Jump_Strength:0},{Wall_Jump_Boost_Y:0},{Wall_Jump_Boost_X:0},{flappyJumpPower:0},{flappySustainPower:0},{flappySustainTime:0},{textime:0},{SawRotationNormal:0},{SawRotationReverse:0},{bouncerPower:0},{sawPortalDifference:0},{sawPortalDivider:0},{turretRange:0},{Last_Layout:0},{ResetSets:0},{Saved:0},{RevengeTime:0},{RescueTime:0},{FinishedState:0},{GameJumps:0},{GameDeaths:0},{GameTime:0},{BestRevenge:0},{TotalJumps:0},{TotalDeaths:0},{TotalTime:0},{gameName:0},{GameMode:0},{GameState:0},{UIType:0},{UIMenuIndex:0},{UIStartY:0},{UISelection:0},{LanguageIndex:0},{ScaleOutPC:0},{ScaleOutMobileL:0},{ScaleOutMobileP:0},{ScaleInPC:0},{ScaleInMobileL:0},{ScaleInMobileP:0},{VolumeSFX:0},{VolumeMusic:0},{Towerfall:0},{CherriesCollected:0},{LoadState:0},{UION:0},{UIOpacity:0},{UnlimitedLives:0},{GameLives:0},{domain:0},{followCam:0},{adReady:0},{CameraZoomMobileP:0},{CameraZoomMobileL:0},{CameraZoomNormal:0},{volumeStandard:0},{BarWidth:0},{LevelsUp:0},{LevelsDown:0},{LevelTransferCheck:0}]}{const e=self.C3;function b(e,t){return"string"==typeof e||"string"==typeof t?("number"==typeof e?(Math.round(1e10*e)/1e10).toString():e)+("number"==typeof t?(Math.round(1e10*t)/1e10).toString():t):e&&t?1:0}self.C3_ExpressionFuncs=[()=>"Character Initialization",()=>12,e=>{const t=e._GetNode(0);return()=>t.ExpObject()},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()},e=>{const t=e._GetNode(0);return()=>t.ExpObject(2)},e=>{const t=e._GetNode(0);return()=>t.ExpObject(2)-32},()=>"UI",()=>32,()=>16,e=>{const t=e._GetNode(0);return()=>t.ExpObject()-32},()=>"Character is In Play",()=>"InPlay",()=>0,()=>"ScaleDrop",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t()},()=>1,()=>"Self Destruct",()=>"Player",()=>"SelfDestruct",()=>"Death",()=>"Normal State",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar();return()=>t()-s.GetValue()},()=>.1,()=>"Jumptimer",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpBehavior()-s.GetValue()},()=>"WallJumpRight",()=>-2,()=>"WallCling",()=>8,()=>14,()=>.2,()=>15,e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpBehavior()+s.GetValue()},()=>"WallJumpLeft",()=>2,()=>"Paused State",()=>"Box State",e=>{const t=e._GetNode(0);return()=>t.ExpObject(1)},()=>"Conveyor Moveable",()=>"lightride",()=>-100,()=>.5,()=>"Horizontal",e=>{const t=e._GetNode(0).GetVar();return()=>-t.GetValue()},()=>-150,()=>"Vertical",()=>"Swimming State",()=>150,()=>70,()=>-75,()=>75,()=>100,()=>"Death State",()=>10,()=>"",()=>.25,()=>.05,t=>{const s=t._GetNode(0).GetBoundMethod();return()=>e.lerp(s(),1,1)},()=>"Respawn",()=>"GameOverFade",()=>"FadeLayer",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("GameOverFade")},()=>"Respawn State",e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()},()=>"On",e=>{const t=e._GetNode(0).GetVar();return()=>"Checkpoint: "+t.GetValue()},()=>"CheckpointBleep",()=>"Default",()=>"PlayerRespawnPosition",()=>"Respawning...",()=>"Respawned",()=>-285,()=>"Gameover State",()=>"GameOver",()=>"Level Change State",()=>"LevelChange",()=>"Movement Controls",e=>{const t=e._GetNode(0);return()=>b("jump",t.ExpInstVar())},()=>"Flappy Jump",()=>"Normal Jump",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("Jumptimer")},()=>.09,()=>"Move_Left",()=>-60,()=>"MoveLeft",()=>"Move_Right",()=>60,()=>"MoveRight",()=>"Jump Functions (Normal)",()=>"Sustain",()=>"JumpOn",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod();return()=>t.ExpBehavior()-60*s.GetValue()*i()},e=>{const t=e._GetNode(0),s=e._GetNode(1),i=e._GetNode(2).GetBoundMethod();return()=>t.ExpObject()+60*(s.ExpBehavior("Sustain")+.2)*i()},()=>"WallJump",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior()},()=>"RotateValue",()=>-180,()=>"RotateRight",()=>180,e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("RotateValue")},()=>-475,()=>"Extend",()=>.7,()=>"Swimming",()=>-90,()=>"Landing",()=>"HeightReset",()=>"Jump Functions (Flappy)",()=>"flappySustain",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+10},()=>"Animation 1",e=>{const t=e._GetNode(0).GetVar();return()=>1.5*-t.GetValue()},()=>.10000000000000009,()=>360,()=>48,()=>"Scanlines",()=>"GlowHorizontal",()=>"GlowVertical",()=>"Confusion",()=>"SecurityHum",()=>"Sleep",()=>"Chasing",()=>"Spark",()=>3,()=>4,()=>5,()=>200,()=>"flappyWingsTween",()=>"wingsdeathtween",()=>"NewWings",()=>"flappyWingsTweenOn",()=>"adTimer",()=>"Bouncer",()=>"bounceTween",e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()-8},()=>"Player Particles",()=>"Water Particles",e=>{const t=e._GetNode(0);return()=>t.ExpObject()/2},e=>{const t=e._GetNode(0);return()=>t.ExpObject(0)},()=>"Interact",()=>"Environment",()=>"Death Effects",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()-5},()=>.4,()=>"conveyorSpeed",()=>240,()=>"lightrideFast",()=>"RotateSlow",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("RotateSlow")},e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("lightrideFast")},e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("conveyorSpeed")},()=>"Portals",()=>"OrangePortals",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpBehavior()+s.ExpInstVar()},()=>"Spin",()=>"None",()=>"Portaled",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject()-s.GetValue()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject()+s.GetValue()},()=>"BluePortal",e=>{const t=e._GetNode(0);return()=>-t.ExpInstVar()},()=>"purple Portals",()=>"Lava",()=>"Corpse",()=>"Lava Waves",()=>"Fluids",()=>"TowerRise",()=>"LevelTransition",e=>{const t=e._GetNode(0),s=e._GetNode(1),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetBoundMethod(),n=e._GetNode(4).GetBoundMethod();return()=>t.ExpObject()+s.ExpInstVar()*i(r(30,61))*n()},e=>{const t=e._GetNode(0),s=e._GetNode(1),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetBoundMethod(),n=e._GetNode(4).GetBoundMethod();return()=>t.ExpObject()-s.ExpInstVar()*i(r(30,61))*n()},()=>"Particle Physics",()=>"Particles Red",()=>.3,e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(30,330)},()=>"Particles Death",()=>"DeadLights",()=>2e3,e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(300,400)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(0,360)},()=>1.5,()=>"Switch and Door Triggers",()=>"SwitchSpawn",()=>"Normal Switch",()=>-1,()=>"Top",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()+s.ExpObject()/2},()=>"Bottom",()=>"Door",()=>2.5,()=>"dooropen",()=>"Bridge",()=>"BridgeWithdraw",()=>"bridgewithdraw",()=>"Particles General",()=>"Conveyor",()=>"Towerfall",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpObject()-s()*i.ExpInstVar()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpObject()+s()*i.ExpInstVar()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpObject()+s()*-i.ExpInstVar()},()=>"Lights",e=>{const t=e._GetNode(0);return()=>1.2*t.ExpObject()},e=>{const t=e._GetNode(0);return()=>2*t.ExpObject()},()=>"Doors",()=>"Saw Neon",()=>"Active",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetVar();return()=>t(s.GetValue(),i.GetValue())},()=>"SinMover",()=>"Inactive",()=>"SawAngleReset",()=>"Elevator (ZoneTransfer)",()=>"TransferTween",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()-s.ExpInstVar()},e=>{const t=e._GetNode(0);return()=>b("TransferTween",t.ExpObject())},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject()+300*s()},()=>"Actived Background Tiles",()=>"Atlas Square",e=>{const t=e._GetNode(0);return()=>b("lavaDrip",t.ExpObject())},()=>"Pipes",()=>"Red Pipes",()=>"Purple Pipe Volume",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpBehavior()-1500*s()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpBehavior()+1500*s()},()=>300,()=>30,()=>80,()=>270,e=>{const t=e._GetNode(0);return()=>t.ExpObject()-4},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+24},e=>{const t=e._GetNode(0);return()=>t.ExpObject()-24},()=>"Clouds",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod();return()=>t(s()/2-500,i()/2+500)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("Cloud_1","Cloud_2","Cloud_3")},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(-20,-30,-40,-50)},()=>"Paused",()=>1020,e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(0)-s.ExpObject()/2},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(0)+s.ExpObject()/2},()=>"Clouds2",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2).GetBoundMethod();return()=>t(s()/2-1e3,i()/2+1e3)},()=>"Big Square",()=>"Turrets",()=>44,()=>"Idle",()=>"Seek",()=>96,()=>"eyeOrbitPrimary",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(-2,4)},()=>"eyeOrbitSecondary",()=>"Engaged",()=>"turretLOS",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("eyeOrbitPrimary")},e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("eyeOrbitSecondary")},()=>40,()=>"Red",()=>"Green",()=>"Stunned",()=>"hitStun",()=>"bulletShot",()=>"Bullets",()=>"bulletWall",e=>{const t=e._GetNode(0);return()=>-t.ExpBehavior()},()=>"bulletReflect",()=>"CheckpointWrap",()=>50,()=>"Right",()=>"Left",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject()+50*s()},()=>"Pineapple",()=>"hairTween",()=>-5,()=>"bodyTween",e=>{const t=e._GetNode(0);return()=>t.ExpObject()+4},()=>"SimpleSkend",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("hairTween")},()=>"Saw Portal",()=>"GameTimer",()=>"Last_Layout",()=>"Save System",()=>"Autosave",()=>"Language",()=>"GameLives",()=>"UnlimitedLives",()=>"Camera",()=>"Fullscreen",()=>"Music",()=>"SFX",()=>"Performance",()=>"respawnCP",()=>"GameTime",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetVar();return()=>t.GetValue()+s.GetValue()},()=>"TotalDeaths",()=>"SquaresSpoken",()=>"Rescue",()=>"Revenge",()=>"BestRescue",()=>"BestRevenge",e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+"SaveGame"},()=>"Processing Sets...",()=>"All Sets Complete",()=>"Quit",()=>"Quiting",()=>"ResetGame From Options",()=>"Resetting",()=>"Restart Game End",()=>"Reset",()=>"Clear Data",()=>"SawDeaths",()=>"LaserDeaths",()=>"BotDeaths",()=>"PlatformDeaths",()=>"Loader Layout Complete",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar();return()=>t(s.GetValue(),1,".")},()=>"Sitelock Check",()=>"construct",()=>"preview.construct.net",()=>window.location.hostname.split(".")[1],()=>window.location.origin,()=>window.location.hostname,()=>window.location.hostname,()=>window.location.hostname.split(".")[1],()=>window.location.origin,()=>"Load Saved Items3",()=>"AJAX Initial Request",()=>"IntroText",()=>"Load Requests",()=>"LoadingDictionary",()=>"SettingSaves",e=>{const t=e._GetNode(0);return()=>t.ExpObject("Language")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("GameLives")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("Music")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("SFX")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("respawnCP")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("GameTime")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("TotalDeaths")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("SquaresSpoken")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("Rescue")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("Revenge")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("BestRescue")},e=>{const t=e._GetNode(0);return()=>t.ExpObject("BestRevenge")},()=>"AJAX Requests",()=>"SmallDiagLoad",()=>"SmallSquareDown",()=>"BigSquareDiagRandom",()=>"BigSquareTowerTop",()=>"BigSquareTopFall",()=>"Diagend",()=>"OptionsLanguage",()=>"Splash Screen Layout Change",()=>"SplashFade",()=>"SplashFadeIn",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("SplashFadeIn")},e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("SplashFade")},()=>7,()=>"Layout Start Events",()=>"EO Splash",()=>"EvilObjective",()=>"Splash Screen2",()=>"Splash",()=>"Menu",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2),r=e._GetNode(3).GetVar(),n=e._GetNode(4),a=e._GetNode(5).GetVar(),o=e._GetNode(6),h=e._GetNode(7).GetVar();return()=>b(b(b(b(b(b(b(b(b(t.ExpObject(s.GetValue(),0),"\n"),"\n"),i.ExpObject(r.GetValue(),1)),"\n"),"\n"),n.ExpObject(a.GetValue(),2)),"\n"),"\n"),o.ExpObject(h.GetValue(),3))},()=>"Main Tower Layout",()=>"Remastered",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("FadeLayer")},()=>"Layout Initialize",()=>"BlurVertical",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("Widescreenbars")},()=>"Start",()=>"Index Objects",()=>"Camera Starting Events",()=>"CameraZoomEndOut",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject()/2+16+s("Background")},()=>"CameraZoomEnd",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("CameraZoomEnd")},e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("CameraZoomEndOut")},()=>"Towerfall Initialization",()=>"Game Modes",()=>"Normal Mode",()=>"Normal",()=>"SUPERHOT Mode",()=>"Superhot",()=>"Game Is Paused",()=>"Ending",()=>"Scale Adjustment On Load",()=>"Main",()=>"UI Navigation",()=>"MenuChangeInProgress",()=>-30,()=>"Play Button",()=>"GameStart",()=>"StartOn",()=>"UIStartOn",e=>{const t=e._GetNode(0);return()=>1.1*t.ExpObject()},()=>"StartOff",()=>"Options Button",()=>"UIOptionsOn",()=>"Music Button",()=>"SFX Button",()=>"Language Button",()=>"LanguageSwitch",()=>"Quit Button",()=>6,()=>"BSTextboxsize",()=>"Fall",()=>"Dropping",()=>-200,()=>"MainLoop",()=>"OptionsCam",()=>"Options",()=>960,()=>"Game Is In Play",()=>"Transition",()=>"menu",()=>"FadeIn",()=>"QuickFade",()=>160,()=>84,()=>"LogoUp",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t(5,s(2,i.ExpInstVar()/2))},e=>{
const t=e._GetNode(0);return()=>t.ExpBehavior("ScaleDrop")},()=>"Zone Activation",()=>"ZoneTransition",()=>"FinalZoneOut",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("FinalZoneOut")},()=>"FinalZoneIn",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("FinalZoneIn")},()=>.6,()=>"LogoDown",()=>"BossTextReveal",()=>512,e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod();return()=>t.ExpObject(s.GetValue(),i(0,1,2,3,4,5,6,7,8,9,10))},()=>"Sound Controls",()=>"MusicOn",()=>"MusicOff",()=>"SFXOn",()=>"SFXOff",()=>"WidescreenTween",()=>"UI Adjustments",()=>"ResponsiveUI",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpInstVar_Family(),"left")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2);return()=>t.ExpInstVar_Family()+s(i.ExpObject())},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpInstVar_Family(),"right")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod(),i=e._GetNode(2),r=e._GetNode(3).GetBoundMethod();return()=>t.ExpInstVar_Family()+(s(i.ExpObject())-r())},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpInstVar_Family(),"up")},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpInstVar_Family(),"down")},()=>"Language Setup",()=>"english",()=>"English",()=>"spanish",()=>"latam",()=>"Spanish",()=>"japanese",()=>"Japanese",()=>"Dialogue Box",()=>"Checkpoint Save Actions",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject(s.ExpInstVar())},()=>"Spoken",()=>"Animation 3",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject(s.ExpInstVar(),1)},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2);return()=>t.ExpObject(s.GetValue(),i.ExpInstVar())},()=>"SmallText",()=>"TowerTop",e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1);return()=>t.GetValue()+s.ExpBehavior("GameTimer")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue(),0)},()=>20,()=>"Bottom Switch",()=>"BottomSwitch",()=>"FinalCamScale",()=>"FinalCam",()=>1250,()=>1500,()=>1366,()=>1372,e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("FinalCamScale")},()=>"ArmsUp",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue(),10)},()=>"PreEnding",()=>"DashBridge",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetVar(),n=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetVar(),o=e._GetNode(6).GetBoundMethod(),h=e._GetNode(7).GetVar();return()=>b(b(b(b(b(t.ExpObject(s.GetValue(),0),i(Math.floor(r.GetValue()/3600),2)),":"),n(Math.floor(a.GetValue()/60%60),2)),":"),o(Math.floor(h.GetValue()%60),2))},()=>"BigSquare",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetVar(),n=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetVar(),o=e._GetNode(6).GetBoundMethod(),h=e._GetNode(7).GetVar();return()=>b(b(b(b(b(t.ExpObject(s.GetValue(),1),i(Math.floor(r.GetValue()/3600),2)),":"),n(Math.floor(a.GetValue()/60%60),2)),":"),o(Math.floor(h.GetValue()%60),2))},()=>"Deaths",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetVar();return()=>b(t.ExpObject(s.GetValue(),2),i.GetValue())},()=>"Thanks",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue(),3)},e=>{const t=e._GetNode(0);return()=>t.ExpObject()+355},()=>90,()=>1006,()=>1901,()=>"Steam",()=>"GameOverFade2",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("GameOverFade2")},()=>"https://apps.apple.com/us/app/big-neon-tower-vs-tiny-square/id1561217173",()=>"NewWindow",()=>"https://store.steampowered.com/app/758010/Big_NEON_Tower_VS_Tiny_Square/",()=>"https://play.google.com/store/apps/details?id=com.eointeractive.bigneontower.android",()=>"https://evilobjective.itch.io/big-neon-tower-tiny-square",()=>"CreditsLanguage",()=>"SelfPingPong",e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue(),12)},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar();return()=>t.ExpObject(s.GetValue(),11)},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetVar(),n=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetVar(),o=e._GetNode(6).GetBoundMethod(),h=e._GetNode(7).GetVar();return()=>b(b(b(b(b(b(b(b(b(t.ExpObject(s.GetValue(),1),"[outline=#292929]"),"[color=#118ab2]"),i(Math.floor(r.GetValue()/3600),2)),":"),n(Math.floor(a.GetValue()/60%60),2)),":"),o(Math.floor(h.GetValue()%60),2)),"[/color]"),"[/outline]")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetVar(),n=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetVar(),o=e._GetNode(6).GetBoundMethod(),h=e._GetNode(7).GetVar();return()=>b(b(b(b(b(b(b(b(b(t.ExpObject(s.GetValue(),2),"[outline=#292929]"),"[color=#118ab2]"),i(Math.floor(r.GetValue()/3600),2)),":"),n(Math.floor(a.GetValue()/60%60),2)),":"),o(Math.floor(h.GetValue()%60),2)),"[/color]"),"[/outline]")},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetVar();return()=>b(b(b(t.ExpObject(s.GetValue(),3),"[color=#ef2e4e]"),i.GetValue()),"[/color]")},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetVar(),n=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetVar();return()=>t(Math.floor(s.GetValue()/3600),2)+":"+i(Math.floor(r.GetValue()/60%60),2)+":"+n(Math.floor(a.GetValue()%60),2)},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetVar(),i=e._GetNode(2).GetBoundMethod(),r=e._GetNode(3).GetVar(),n=e._GetNode(4).GetBoundMethod(),a=e._GetNode(5).GetVar(),o=e._GetNode(6).GetBoundMethod(),h=e._GetNode(7).GetVar();return()=>b(b(b(b(b(b(b(b(b(t.ExpObject(s.GetValue(),10),"[outline=#292929]"),"[color=#118ab2]"),i(Math.floor(r.GetValue()/3600),2)),":"),n(Math.floor(a.GetValue()/60%60),2)),":"),o(Math.floor(h.GetValue()%60),2)),"[/color]"),"[/outline]")},()=>"FadeOut",()=>"http://evilobjective.com/bntpp-html5/",()=>"http://evilobjective.com/contact/",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("FadeIn")},e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("FadeOut")},()=>"Social Media2"]}var module$str$c3runtime={};const sdkElem$$module$str$main=document.createElement("script");sdkElem$$module$str$main.type="text/javascript",sdkElem$$module$str$main.src="",document.body.appendChild(sdkElem$$module$str$main);var module$str$main={};const scriptsInEvents$$module$str$scriptsInEvents={async GlobalSettings_Event227_Act1(e,t){parent.cmgGameEvent("start")},async Achievements_Event1_Act2(e,t){parent.cmgGameEvent("start",e.globalVars.LevelTransferCheck)}};self.C3.ScriptsInEvents=scriptsInEvents$$module$str$scriptsInEvents;var module$str$scriptsInEvents={},module$str$__c3root__={};