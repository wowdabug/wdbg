/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
(function(){var a="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},e="undefined"!==typeof module&&module.exports,b="undefined"!==typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,f=function(){for(var c,g=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),
"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],b=0,f=g.length,e={};b<f;b++)if((c=g[b])&&c[1]in a){for(b=0;b<c.length;b++)e[g[0][b]]=
c[b];return e}return!1}(),h={change:f.fullscreenchange,error:f.fullscreenerror},c={request:function(c){var g=f.requestFullscreen;c=c||a.documentElement;if(/5\.1[.\d]* Safari/.test(navigator.userAgent))c[g]();else c[g](b&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){a[f.exitFullscreen]()},toggle:function(a){this.isFullscreen?this.exit():this.request(a)},onchange:function(a){this.on("change",a)},onerror:function(a){this.on("error",a)},on:function(c,b){var g=h[c];g&&a.addEventListener(g,b,!1)},off:function(c,
b){var g=h[c];g&&a.removeEventListener(g,b,!1)},raw:f};f?(Object.defineProperties(c,{isFullscreen:{get:function(){return!!a[f.fullscreenElement]}},element:{enumerable:!0,get:function(){return a[f.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!a[f.fullscreenEnabled]}}}),e?module.exports=c:window.screenfull=c):e?module.exports=!1:window.screenfull=!1})();
(function(){function a(a){a=String(a);return a.charAt(0).toUpperCase()+a.slice(1)}function e(a,c){var b=-1,g=a?a.length:0;if("number"==typeof g&&-1<g&&g<=t)for(;++b<g;)c(a[b],b,a);else f(a,c)}function b(c){c=String(c).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(c)?c:a(c)}function f(a,c){for(var b in a)r.call(a,b)&&c(a[b],b,a)}function h(c){return null==c?a(c):x.call(c).slice(8,-1)}function c(a,c){var b=null!=a?typeof a[c]:"number";return!/^(?:boolean|number|string|undefined)$/.test(b)&&
("object"==b?!!a[c]:!0)}function d(a){return String(a).replace(/([ -])(?!$)/g,"$1?")}function g(a,c){var b=null;e(a,function(g,d){b=c(b,g,d,a)});return b}function m(a){function e(c){return g(c,function(c,g){var m=g.pattern||d(g);!c&&(c=RegExp("\\b"+m+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+m+" *\\w+-[\\w]*","i").exec(a)||RegExp("\\b"+m+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((c=String(g.label&&!RegExp(m,"i").test(g.label)?g.label:c).split("/"))[1]&&!/[\d.]+/.test(c[0])&&(c[0]+=
" "+c[1]),g=g.label||g,c=b(c[0].replace(RegExp(m,"i"),g).replace(RegExp("; *(?:"+g+"[_-])?","i")," ").replace(RegExp("("+g+")[-_.]?(\\w)","i"),"$1 $2")));return c})}function n(c){return g(c,function(c,b){return c||(RegExp(b+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})}var l=q,k=a&&"object"==typeof a&&"String"!=h(a);k&&(l=a,a=null);var t=l.navigator||{},r=t.userAgent||"";a||(a=r);var B=k?!!t.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(x.toString()),
T=k?"Object":"ScriptBridgingProxyObject",y=k?"Object":"Environment",L=k&&l.java?"JavaPackage":h(l.java),U=k?"Object":"RuntimeObject";y=(L=/\bJava/.test(L)&&l.java)&&h(l.environment)==y;var V=L?"a":"\u03b1",W=L?"b":"\u03b2",Q=l.document||{},I=l.operamini||l.opera,M=u.test(M=k&&I?I["[[Class]]"]:h(I))?M:I=null,p,N=a;k=[];var O=null,J=a==r;r=J&&I&&"function"==typeof I.version&&I.version();var z=function(c){return g(c,function(c,b){return c||RegExp("\\b"+(b.pattern||d(b))+"\\b","i").exec(a)&&(b.label||
b)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),v=function(c){return g(c,function(c,b){return c||RegExp("\\b"+(b.pattern||d(b))+"\\b","i").exec(a)&&(b.label||b)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),A=e([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(c){return g(c,function(c,b,g){return c||(b[A]||b[/^[a-z]+(?: +[a-z]+\b)*/i.exec(A)]||RegExp("\\b"+d(g)+"(?:\\b|\\w*\\d)","i").exec(a))&&g})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),w=function(c){return g(c,function(c,g){var m=g.pattern||d(g);if(!c&&(c=RegExp("\\b"+m+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))){var f=c,e=g.label||g,k={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};m&&e&&/^Win/i.test(f)&&!/^Windows Phone /i.test(f)&&(k=k[/[\d.]+$/.exec(f)])&&(f="Windows "+k);f=String(f);m&&e&&(f=f.replace(RegExp(m,"i"),e));c=f=b(f.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/,
" $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return c})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac",
"Windows 98;","Windows "]);z&&(z=[z]);D&&!A&&(A=e([D]));if(p=/\bGoogle TV\b/.exec(A))A=p[0];/\bSimulator\b/i.test(a)&&(A=(A?A+" ":"")+"Simulator");"Opera Mini"==v&&/\bOPiOS\b/.test(a)&&k.push("running in Turbo/Uncompressed mode");"IE"==v&&/\blike iPhone OS\b/.test(a)?(p=m(a.replace(/like iPhone OS/,"")),D=p.manufacturer,A=p.product):/^iP/.test(A)?(v||(v="Safari"),w="iOS"+((p=/ OS ([\d_]+)/i.exec(a))?" "+p[1].replace(/_/g,"."):"")):"Konqueror"!=v||/buntu/i.test(w)?D&&"Google"!=D&&(/Chrome/.test(v)&&
!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(A))||/\bAndroid\b/.test(w)&&/^Chrome/.test(v)&&/\bVersion\//i.test(a)?(v="Android Browser",w=/\bAndroid\b/.test(w)?w:"Android"):"Silk"==v?(/\bMobi/i.test(a)||(w="Android",k.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&k.unshift("accelerated")):"PaleMoon"==v&&(p=/\bFirefox\/([\d.]+)\b/.exec(a))?k.push("identifying as Firefox "+p[1]):"Firefox"==v&&(p=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(w||(w="Firefox OS"),A||(A=p[1])):!v||(p=!/\bMinefield\b/i.test(a)&&
/\b(?:Firefox|Safari)\b/.exec(v))?(v&&!A&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(p+"/")+8))&&(v=null),(p=A||D||w)&&(A||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(w))&&(v=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(w)?w:p)+" Browser")):"Electron"==v&&(p=(/\bChrome\/([\d.]+)\b/.exec(a)||0)[1])&&k.push("Chromium "+p):w="Kubuntu";r||(r=n(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",d(v),"(?:Firefox|Minefield|NetFront)"]));
if(p="iCab"==z&&3<parseFloat(r)&&"WebKit"||/\bOpera\b/.test(v)&&(/\bOPR\b/.test(a)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(z)&&"WebKit"||!z&&/\bMSIE\b/i.test(a)&&("Mac OS"==w?"Tasman":"Trident")||"WebKit"==z&&/\bPlayStation\b(?! Vita\b)/i.test(v)&&"NetFront")z=[p];"IE"==v&&(p=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(v+=" Mobile",w="Windows Phone "+(/\+$/.test(p)?p:p+".x"),k.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(v="IE Mobile",w="Windows Phone 8.x",
k.unshift("desktop mode"),r||(r=(/\brv:([\d.]+)/.exec(a)||0)[1])):"IE"!=v&&"Trident"==z&&(p=/\brv:([\d.]+)/.exec(a))&&(v&&k.push("identifying as "+v+(r?" "+r:"")),v="IE",r=p[1]);if(J){if(c(l,"global"))if(L&&(p=L.lang.System,N=p.getProperty("os.arch"),w=w||p.getProperty("os.name")+" "+p.getProperty("os.version")),y){try{r=l.require("ringo/engine").version.join("."),v="RingoJS"}catch(S){(p=l.system)&&p.global.system==l.system&&(v="Narwhal",w||(w=p[0].os||null))}v||(v="Rhino")}else"object"==typeof l.process&&
!l.process.browser&&(p=l.process)&&("object"==typeof p.versions&&("string"==typeof p.versions.electron?(k.push("Node "+p.versions.node),v="Electron",r=p.versions.electron):"string"==typeof p.versions.nw&&(k.push("Chromium "+r,"Node "+p.versions.node),v="NW.js",r=p.versions.nw)),v||(v="Node.js",N=p.arch,w=p.platform,r=(r=/[\d.]+/.exec(p.version))?r[0]:null));else h(p=l.runtime)==T?(v="Adobe AIR",w=p.flash.system.Capabilities.os):h(p=l.phantom)==U?(v="PhantomJS",r=(p=p.version||null)&&p.major+"."+p.minor+
"."+p.patch):"number"==typeof Q.documentMode&&(p=/\bTrident\/(\d+)/i.exec(a))?(r=[r,Q.documentMode],(p=+p[1]+4)!=r[1]&&(k.push("IE "+r[1]+" mode"),z&&(z[1]=""),r[1]=p),r="IE"==v?String(r[1].toFixed(1)):r[0]):"number"==typeof Q.documentMode&&/^(?:Chrome|Firefox)\b/.test(v)&&(k.push("masking as "+v+" "+r),v="IE",r="11.0",z=["Trident"],w="Windows");w=w&&b(w)}r&&(p=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(r)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(J&&t.appMinorVersion))||/\bMinefield\b/i.test(a)&&
"a")&&(O=/b/i.test(p)?"beta":"alpha",r=r.replace(RegExp(p+"\\+?$"),"")+("beta"==O?W:V)+(/\d+\+?/.exec(p)||""));if("Fennec"==v||"Firefox"==v&&/\b(?:Android|Firefox OS)\b/.test(w))v="Firefox Mobile";else if("Maxthon"==v&&r)r=r.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(A))"Xbox 360"==A&&(w=null),"Xbox 360"==A&&/\bIEMobile\b/.test(a)&&k.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(v)&&(!v||A||/Browser|Mobi/.test(v))||"Windows CE"!=w&&!/Mobi/i.test(a))if("IE"==v&&J)try{null===l.external&&
k.unshift("platform preview")}catch(S){k.unshift("embedded")}else(/\bBlackBerry\b/.test(A)||/\bBB10\b/.test(a))&&(p=(RegExp(A.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||r)?(p=[p,/BB10/.test(a)],w=(p[1]?(A=null,D="BlackBerry"):"Device Software")+" "+p[0],r=null):this!=f&&"Wii"!=A&&(J&&I||/Opera/.test(v)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==v&&/\bOS X (?:\d+\.){2,}/.test(w)||"IE"==v&&(w&&!/^Win/.test(w)&&5.5<r||/\bWindows XP\b/.test(w)&&8<r||8==r&&!/\bTrident\b/.test(a)))&&!u.test(p=
m.call(f,a.replace(u,"")+";"))&&p.name&&(p="ing as "+p.name+((p=p.version)?" "+p:""),u.test(v)?(/\bIE\b/.test(p)&&"Mac OS"==w&&(w=null),p="identify"+p):(p="mask"+p,v=M?b(M.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(p)&&(w=null),J||(r=null)),z=["Presto"],k.push(p));else v+=" Mobile";if(p=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1]){p=[parseFloat(p.replace(/\.(\d)$/,".0$1")),p];if("Safari"==v&&"+"==p[1].slice(-1))v="WebKit Nightly",O="alpha",r=p[1].slice(0,-1);else if(r==p[1]||r==(p[2]=
(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1]))r=null;p[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1];537.36==p[0]&&537.36==p[2]&&28<=parseFloat(p[1])&&"WebKit"==z&&(z=["Blink"]);J&&(B||p[1])?(z&&(z[1]="like Chrome"),p=p[1]||(p=p[0],530>p?1:532>p?2:532.05>p?3:533>p?4:534.03>p?5:534.07>p?6:534.1>p?7:534.13>p?8:534.16>p?9:534.24>p?10:534.3>p?11:535.01>p?12:535.02>p?"13+":535.07>p?15:535.11>p?16:535.19>p?17:536.05>p?18:536.1>p?19:537.01>p?20:537.11>p?"21+":537.13>p?23:537.18>p?24:537.24>p?25:537.36>p?26:"Blink"!=
z?"27":"28")):(z&&(z[1]="like Safari"),p=(p=p[0],400>p?1:500>p?2:526>p?3:533>p?4:534>p?"4+":535>p?5:537>p?6:538>p?7:601>p?8:"8"));z&&(z[1]+=" "+(p+="number"==typeof p?".x":/[.+]/.test(p)?"":"+"));"Safari"==v&&(!r||45<parseInt(r))&&(r=p)}"Opera"==v&&(p=/\bzbov|zvav$/.exec(w))?(v+=" ",k.unshift("desktop mode"),"zvav"==p?(v+="Mini",r=null):v+="Mobile",w=w.replace(RegExp(" *"+p+"$"),"")):"Safari"==v&&/\bChrome\b/.exec(z&&z[1])&&(k.unshift("desktop mode"),v="Chrome Mobile",r=null,/\bOS X\b/.test(w)?(D=
"Apple",w="iOS 4.3+"):w=null);r&&0==r.indexOf(p=/[\d.]+$/.exec(w))&&-1<a.indexOf("/"+p+"-")&&(w=String(w.replace(p,"")).replace(/^ +| +$/g,""));z&&!/\b(?:Avant|Nook)\b/.test(v)&&(/Browser|Lunascape|Maxthon/.test(v)||"Safari"!=v&&/^iOS/.test(w)&&/\bSafari\b/.test(z[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(v)&&z[1])&&(p=z[z.length-1])&&k.push(p);k.length&&(k=["("+k.join("; ")+")"]);D&&A&&0>A.indexOf(D)&&k.push("on "+D);A&&k.push((/^on /.test(k[k.length-
1])?"":"on ")+A);if(w){var R=(p=/ ([\d.+]+)$/.exec(w))&&"/"==w.charAt(w.length-p[0].length-1);w={architecture:32,family:p&&!R?w.replace(p[0],""):w,version:p?p[1]:null,toString:function(){var a=this.version;return this.family+(a&&!R?" "+a:"")+(64==this.architecture?" 64-bit":"")}}}(p=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?(w&&(w.architecture=64,w.family=w.family.replace(RegExp(" *"+p),"")),v&&(/\bWOW64\b/i.test(a)||J&&/\w(?:86|32)$/.test(t.cpuClass||t.platform)&&!/\bWin64; x64\b/i.test(a))&&
k.unshift("32-bit")):w&&/^OS X/.test(w.family)&&"Chrome"==v&&39<=parseFloat(r)&&(w.architecture=64);a||(a=null);l={};l.description=a;l.layout=z&&z[0];l.manufacturer=D;l.name=v;l.prerelease=O;l.product=A;l.ua=a;l.version=v&&r;l.os=w||{architecture:null,family:null,version:null,toString:function(){return"null"}};l.parse=m;l.toString=function(){return this.description||""};l.version&&k.unshift(r);l.name&&k.unshift(v);w&&v&&(w!=String(w).split(" ")[0]||w!=v.split(" ")[0]&&!A)&&k.push(A?"("+w+")":"on "+
w);k.length&&(l.description=k.join(" "));return l}var l={"function":!0,object:!0},q=l[typeof window]&&window||this,k=l[typeof exports]&&exports;l=l[typeof module]&&module&&!module.nodeType&&module;var n=k&&l&&"object"==typeof global&&global;!n||n.global!==n&&n.window!==n&&n.self!==n||(q=n);var t=Math.pow(2,53)-1,u=/\bOpera/;n=Object.prototype;var r=n.hasOwnProperty,x=n.toString,B=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(q.platform=B,define(function(){return B})):k&&
l?f(B,function(a,c){k[c]=a}):q.platform=B}).call(this);
function buildIOSMeta(){for(var a=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],e=0;e<a.length;e++){var b=document.createElement("meta");b.name=a[e].name;b.content=a[e].content;var f=window.document.head.querySelector('meta[name="'+b.name+'"]');f&&f.parentNode.removeChild(f);window.document.head.appendChild(b)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;
case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}function iosInIframe(){try{return window.self!==window.top}catch(a){return!0}}$(document).ready(function(){platform&&"iPhone"===platform.product&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&!iosInIframe()&&iosResize()});var s_iScaleFactor=1,s_iOffsetX,s_iOffsetY,s_bIsIphone=!1,s_bIsRetina;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}
function getSize(a){var e=a.toLowerCase(),b=window.document,f=b.documentElement;if(void 0===window["inner"+a])a=f["client"+a];else if(window["inner"+a]!=f["client"+a]){var h=b.createElement("body");h.id="vpw-test-b";h.style.cssText="overflow:scroll";var c=b.createElement("div");c.id="vpw-test-d";c.style.cssText="position:absolute;top:-1000px";c.innerHTML="<style>@media("+e+":"+f["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+e+":7px!important}}</style>";h.appendChild(c);f.insertBefore(h,b.head);
a=7==c["offset"+a]?f["client"+a]:window["inner"+a];f.removeChild(h)}else a=window["inner"+a];return a}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function isIOS(){isRetina();for(var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");a.length;)if(navigator.platform===a.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}function isRetina(){s_bIsRetina=matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches?!0:!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}
function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var e=getSize("Width");_checkOrientation(e,a);var b=Math.min(a/CANVAS_HEIGHT,e/CANVAS_WIDTH),f=CANVAS_WIDTH*b;b*=CANVAS_HEIGHT;if(b<a){var h=a-b;b+=h;f+=CANVAS_WIDTH/CANVAS_HEIGHT*h}else f<e&&(h=e-f,f+=h,b+=CANVAS_HEIGHT/CANVAS_WIDTH*h);h=a/2-b/2;var c=e/2-f/2,d=CANVAS_WIDTH/f;if(c*d<-EDGEBOARD_X||h*d<-EDGEBOARD_Y)b=Math.min(a/(CANVAS_HEIGHT-2*
EDGEBOARD_Y),e/(CANVAS_WIDTH-2*EDGEBOARD_X)),f=CANVAS_WIDTH*b,b*=CANVAS_HEIGHT,h=(a-b)/2,c=(e-f)/2,d=CANVAS_WIDTH/f;s_iOffsetX=-1*c*d;s_iOffsetY=-1*h*d;0<=h&&(s_iOffsetY=0);0<=c&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oModeMenu&&s_oModeMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oSandBoxMenu&&s_oSandBoxMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_bIsRetina?(canvas=
document.getElementById("canvas"),s_oStage.canvas.width=2*f,s_oStage.canvas.height=2*b,canvas.style.width=f+"px",canvas.style.height=b+"px",a=Math.min(f/CANVAS_WIDTH,b/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=2*a,s_iScaleFactor=2*a):s_bMobile?($("#canvas").css("width",f+"px"),$("#canvas").css("height",b+"px")):(s_oStage.canvas.width=f,s_oStage.canvas.height=b,s_iScaleFactor=Math.min(f/CANVAS_WIDTH,b/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor);0>h?$("#canvas").css("top",h+
"px"):$("#canvas").css("top","0px");$("#canvas").css("left",c+"px");fullscreenHandler()}}
function _checkOrientation(a,e){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(a>e?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function playSound(a,e,b){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[a].play(),s_aSounds[a].volume(e),s_aSounds[a].loop(b),s_aSounds[a]):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].stop()}function setVolume(a,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].volume(e)}function setMute(a,e){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].mute(e)}
function createBitmap(a,e,b){var f=new createjs.Bitmap(a),h=new createjs.Shape;e&&b?h.graphics.beginFill("#fff").drawRect(0,0,e,b):h.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);f.hitArea=h;return f}function createSprite(a,e,b,f,h,c){a=null!==e?new createjs.Sprite(a,e):new createjs.Sprite(a);e=new createjs.Shape;e.graphics.beginFill("#000000").drawRect(-b,-f,h,c);a.hitArea=e;return a}function pad(a,e,b){a+="";return a.length>=e?a:Array(e-a.length+1).join(b||"0")+a}
function randomFloatBetween(a,e,b){"undefined"===typeof b&&(b=2);return parseFloat(Math.min(a+Math.random()*(e-a),e).toFixed(b))}function rotateVector2D(a,e){var b=e.getX()*Math.cos(a)+e.getY()*Math.sin(a),f=e.getX()*-Math.sin(a)+e.getY()*Math.cos(a);e.set(b,f)}function tweenVectorsOnX(a,e,b){return a+b*(e-a)}function shuffle(a){for(var e=a.length,b,f;0!==e;)f=Math.floor(Math.random()*e),--e,b=a[e],a[e]=a[f],a[f]=b;return a}
function bubbleSort(a){do{var e=!1;for(var b=0;b<a.length-1;b++)a[b]>a[b+1]&&(e=a[b],a[b]=a[b+1],a[b+1]=e,e=!0)}while(e)}function compare(a,e){return a.index>e.index?-1:a.index<e.index?1:0}function easeLinear(a,e,b,f){return b*a/f+e}function easeInQuad(a,e,b,f){return b*(a/=f)*a+e}function easeInSine(a,e,b,f){return-b*Math.cos(a/f*(Math.PI/2))+b+e}function easeInCubic(a,e,b,f){return b*(a/=f)*a*a+e}function easeInQuart(a,e,b,f){return b*(a/=f)*a*a*a+e}
function easeOutQuart(a,e,b,f){return-b*((a=a/f-1)*a*a*a-1)+e}function getTrajectoryPoint(a,e){var b=new createjs.Point,f=(1-a)*(1-a),h=a*a;b.x=f*e.start.x+2*(1-a)*a*e.traj.x+h*e.end.x;b.y=f*e.start.y+2*(1-a)*a*e.traj.y+h*e.end.y;return b}function formatTime(a){a/=1E3;var e=Math.floor(a/60);a=parseFloat(a-60*e).toFixed(1);var b="";b=10>e?b+("0"+e+":"):b+(e+":");return 10>a?b+("0"+a):b+a}
function angleBetweenVector2D(a,e){var b=Math.acos(dotProductV2(a,e)/(a.length()*e.length()));return 1==isNaN(b)?0:b}function dotProductV2(a,e){return a.getX()*e.getX()+a.getY()*e.getY()}function radiansToDegree(a){return 180/Math.PI*a}function degreesToRadians(a){return a*Math.PI/180}function checkRectCollision(a,e){var b=getBounds(a,.9);var f=getBounds(e,.98);return calculateIntersection(b,f)}
function calculateIntersection(a,e){var b,f,h,c;var d=a.x+(b=a.width/2);var g=a.y+(f=a.height/2);var m=e.x+(h=e.width/2);var l=e.y+(c=e.height/2);d=Math.abs(d-m)-(b+h);g=Math.abs(g-l)-(f+c);return 0>d&&0>g?(d=Math.min(Math.min(a.width,e.width),-d),g=Math.min(Math.min(a.height,e.height),-g),{x:Math.max(a.x,e.x),y:Math.max(a.y,e.y),width:d,height:g,rect1:a,rect2:e}):null}
function getBounds(a,e){var b={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){b.x2=-Infinity;b.y2=-Infinity;var f=a.children,h=f.length,c;for(c=0;c<h;c++){var d=getBounds(f[c],1);d.x<b.x&&(b.x=d.x);d.y<b.y&&(b.y=d.y);d.x+d.width>b.x2&&(b.x2=d.x+d.width);d.y+d.height>b.y2&&(b.y2=d.y+d.height)}Infinity==b.x&&(b.x=0);Infinity==b.y&&(b.y=0);Infinity==b.x2&&(b.x2=0);Infinity==b.y2&&(b.y2=0);b.width=b.x2-b.x;b.height=b.y2-b.y;delete b.x2;delete b.y2}else{if(a instanceof createjs.Bitmap){h=
a.sourceRect||a.image;c=h.width*e;var g=h.height*e}else if(a instanceof createjs.Sprite)if(a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image){h=a.spriteSheet.getFrame(a.currentFrame);c=h.rect.width;g=h.rect.height;f=h.regX;var m=h.regY}else b.x=a.x||0,b.y=a.y||0;else b.x=a.x||0,b.y=a.y||0;f=f||0;c=c||0;m=m||0;g=g||0;b.regX=f;b.regY=m;h=a.localToGlobal(0-f,0-m);d=a.localToGlobal(c-f,g-m);c=a.localToGlobal(c-f,0-m);f=a.localToGlobal(0-f,g-m);b.x=
Math.min(Math.min(Math.min(h.x,d.x),c.x),f.x);b.y=Math.min(Math.min(Math.min(h.y,d.y),c.y),f.y);b.width=Math.max(Math.max(Math.max(h.x,d.x),c.x),f.x)-b.x;b.height=Math.max(Math.max(Math.max(h.y,d.y),c.y),f.y)-b.y}return b}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(a){for(var e=a.length,b,f;0<e;)f=Math.floor(Math.random()*e),e--,b=a[e],a[e]=a[f],a[f]=b;return a}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0);a.dispatchEvent(e)}}};
(function(){function a(a){var b={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;a.type in b?document.body.className=b[a.type]:(document.body.className=this[e]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var e="hidden";e in document?document.addEventListener("visibilitychange",a):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(e="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",a):(e="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(a){for(var e=window.location.search.substring(1).split("&"),b=0;b<e.length;b++){var f=e[b].split("=");if(f[0]==a)return f[1]}}String.prototype.format=function(){for(var a=this,e=arguments.length;e--;)a=a.replace(new RegExp("\\{"+e+"\\}","gm"),arguments[e]);return a};function Timer(a,e){var b,f,h=e;this.pause=function(){window.clearTimeout(b);h-=new Date-f};this.resume=function(){f=new Date;window.clearTimeout(b);b=window.setTimeout(a,h)};this.resume()}
function fullscreenHandler(){ENABLE_FULLSCREEN&&!1!==screenfull.enabled&&(s_bFullscreen=screen.height<window.innerHeight+3&&screen.height>window.innerHeight-3?!0:!1,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut())}if(screenfull.enabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut()});
function CSpriteLibrary(){var a,e,b,f,h,c;this.init=function(d,g,m){b=e=0;f=d;h=g;c=m;a={}};this.addSprite=function(c,b){a.hasOwnProperty(c)||(a[c]={szPath:b,oSprite:new Image},e++)};this.getSprite=function(c){return a.hasOwnProperty(c)?a[c].oSprite:null};this._onSpritesLoaded=function(){h.call(c)};this._onSpriteLoaded=function(){f.call(c);++b==e&&this._onSpritesLoaded()};this.loadSprites=function(){for(var c in a)a[c].oSprite.oSpriteLibrary=this,a[c].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
a[c].oSprite.src=a[c].szPath};this.getNumSprites=function(){return e}}
var SHIP_SMALL={map:[[!0],[!0],[!0]],sandbox_sprite:"ship5",battle_spritesheet:5,index_type:0,reg_points:{x:12,y:24,inverseX:74,inverseY:60},fill_pos:{x:151.5,y:-344.5},enemy_sunk_pos:{x:550,y:-26}},SHIP_SUB={map:[[!0],[!0],[!0],[!0]],sandbox_sprite:"ship4",battle_spritesheet:4,index_type:1,reg_points:{x:10,y:18,inverseX:100,inverseY:74},fill_pos:{x:147.5,y:-413},enemy_sunk_pos:{x:400,y:-26}},SHIP_MEDIUM={map:[[!0],[!0],[!0],[!0]],sandbox_sprite:"ship3",battle_spritesheet:3,index_type:2,reg_points:{x:10,
y:28,inverseX:106,inverseY:86},fill_pos:{x:150,y:-269},enemy_sunk_pos:{x:680,y:-26}},SHIP_LONG={map:[[!0],[!0],[!0],[!0],[!0]],sandbox_sprite:"ship2",battle_spritesheet:2,index_type:3,reg_points:{x:16,y:46,inverseX:134,inverseY:118},fill_pos:{x:151.5,y:-196},enemy_sunk_pos:{x:860,y:-26}},SHIP_BATTLE={map:[[!0],[!0],[!0],[!0],[!0],[!0]],sandbox_sprite:"ship1",battle_spritesheet:1,index_type:4,reg_points:{x:6,y:48,inverseX:166,inverseY:138},fill_pos:{x:149,y:-118.5},enemy_sunk_pos:{x:1060,y:-26}},SHIP_CARRIER=
{map:[[!0,!0],[!0,!0],[!0,!0],[!0,!0],[!0,!0]],sandbox_sprite:"ship0",battle_spritesheet:0,index_type:5,reg_points:{x:14,y:60,inverseX:170,inverseY:112},fill_pos:{x:154,y:-41},enemy_sunk_pos:{x:1280,y:-26}},CANVAS_WIDTH=1920,CANVAS_HEIGHT=1080,EDGEBOARD_X=250,EDGEBOARD_Y=80,PRIMARY_FONT="Arial",SECONDARY_FONT="Army",FPS=30,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=
5,MODE_CLASSIC=0,MODE_ADVANCED=1,PLAYER=0,OPPONENT=1,SHIPS_TYPE=[SHIP_CARRIER,SHIP_BATTLE,SHIP_LONG,SHIP_MEDIUM,SHIP_SUB,SHIP_SMALL],MISSILE_TYPE_NORMAL=0,MISSILE_TYPE_TORPEDO=1,MISSILE_TYPE_AIRSTRIKE=2,SEA_PIECE_DIM=512,NUM_CELL=14,TOT_CELL=196,BOARD_LENGTH=710,BOARD_REG_POINTS={x:237,y:286},CELL_LENGTH=BOARD_LENGTH/NUM_CELL,CONTROL_CELL_DIM=52,CELL_STATE_VOID="void",CELL_STATE_HIT="hit",CELL_STATE_SUNK="sunk",CELL_STATE_WATER="water",AI_STATE_NEW_COORDINATE=0,AI_STATE_FIND_SHIP_NEIGHBOR=1,AI_FIND_DIRECTION=
2,AI_FOLLOW_DIRECTION=3,AI_REVERSE_DIRECTION=4,AI_FOLLOW_REVERSE=5,AI_FOLLOW_CARRIER=6,PREDICT_WATER=0,PREDICT_HIT=1,PREDICT_SUNK=2,COST_AIRSTRIKE=100,COST_RADAR=200,NUM_BOMB_AIRSTRIKE=5,MIN_AI_THINKING=1E3,MAX_AI_THINKING=1500,POINTS_TO_LOSE,POINTS_EARNED,AD_SHOW_COUNTER,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION;TEXT_WIN="YOU WIN";TEXT_LOSE="YOU LOSE";TEXT_SCORE="SCORE";TEXT_ARE_SURE="ARE YOU SURE?";TEXT_YOUR_FLEET="YOUR FLEET";TEXT_ENEMY_FLEET="ENEMY FLEET";TEXT_STRATEGY_PANEL="STRATEGY PANEL";
TEXT_GAME_MODE="GAME MODE";TEXT_CLASSIC="CLASSIC";TEXT_ADVANCED="ADVANCED";TEXT_COST="COST";TEXT_SUNK="SUNK";TEXT_HELP="HELP";TEXT_HELP_CLASSIC="CLICK ON A CELL AND GUESS THE POSITION OF YOUR ENEMY'S SHIP TO DESTROY THEM";TEXT_HELP_ADVANCED="COLLECT POINTS TO BUY THE POWER-UPS";TEXT_HELP_AIRSTRIKE="HITS RANDOM CELLS OT ONCE";TEXT_HELP_RADAR="REVEALS THE POSITION OF AN OPPONENT'S SHIP";TEXT_PRELOADER_CONTINUE="START";TEXT_SHARE_IMAGE="200x200.jpg";TEXT_SHARE_TITLE="Congratulations!";
TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better";
function CPreloader(){var a,e,b,f,h,c,d,g,m,l;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();l=new createjs.Container;s_oStage.addChild(l)};this.unload=function(){l.removeAllChildren();m.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var q=new createjs.Shape;q.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.addChild(q);q=s_oSpriteLibrary.getSprite("200x200");d=createBitmap(q);d.regX=.5*q.width;d.regY=.5*q.height;d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2-180;l.addChild(d);g=new createjs.Shape;g.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(d.x-100,d.y-100,200,200,10);l.addChild(g);d.mask=g;
q=s_oSpriteLibrary.getSprite("progress_bar");f=createBitmap(q);f.x=CANVAS_WIDTH/2-q.width/2;f.y=CANVAS_HEIGHT/2+50;l.addChild(f);a=q.width;e=q.height;h=new createjs.Shape;h.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,1,e);l.addChild(h);f.mask=h;b=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2+100;b.textBaseline="alphabetic";b.textAlign="center";l.addChild(b);q=s_oSpriteLibrary.getSprite("but_start");m=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2,q,TEXT_PRELOADER_CONTINUE,"Arial","#000","bold 40",l);m.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);m.setVisible(!1);c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.addChild(c);createjs.Tween.get(c).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(c);l.removeChild(c)})};this._onButStartRelease=function(){$(s_oMain).trigger("show_preroll_ad");s_oMain._onPreloaderComplete()};this.refreshLoader=function(c){b.text=c+"%";100===
c&&(m.setVisible(!0),b.visible=!1,f.visible=!1);h.graphics.clear();c=Math.floor(c*a/100);h.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,c,e)};this._init()}
function CMain(a){var e,b=0,f=0,h=STATE_LOADING,c,d;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);s_oStage.preventSelection=!0;createjs.Touch.enable(s_oStage);s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(FPS),$("body").on("contextmenu","#canvas",function(a){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=FPS;navigator.userAgent.match(/Windows Phone/i)&&
(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;c=new CPreloader};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();e=!0};this.soundLoaded=function(a){b++;c.refreshLoader(Math.floor(b/f*100))};this._initSounds=function(){var a=[];a.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});a.push({path:"./sounds/",filename:"click",loop:!1,volume:1,ingamename:"click"});a.push({path:"./sounds/",
filename:"game_over",loop:!1,volume:1,ingamename:"game_over"});a.push({path:"./sounds/",filename:"missile_explosion",loop:!1,volume:1,ingamename:"missile_explosion"});a.push({path:"./sounds/",filename:"missile_launch",loop:!1,volume:1,ingamename:"missile_launch"});a.push({path:"./sounds/",filename:"missile_sink",loop:!1,volume:1,ingamename:"missile_sink"});a.push({path:"./sounds/",filename:"missile_torpedo",loop:!1,volume:1,ingamename:"missile_torpedo"});a.push({path:"./sounds/",filename:"missile_water",
loop:!1,volume:1,ingamename:"missile_water"});a.push({path:"./sounds/",filename:"air_strike",loop:!1,volume:1,ingamename:"air_strike"});a.push({path:"./sounds/",filename:"sonar",loop:!1,volume:1,ingamename:"sonar"});f+=a.length;s_aSounds=[];for(var c=0;c<a.length;c++)s_aSounds[a[c].ingamename]=new Howl({src:[a[c].path+a[c].filename+".mp3",a[c].path+a[c].filename+".ogg"],autoplay:!1,preload:!0,loop:a[c].loop,volume:a[c].volume,onload:s_oMain.soundLoaded})};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,
this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_not","./sprites/but_not.png");s_oSpriteLibrary.addSprite("but_shuffle","./sprites/but_shuffle.png");s_oSpriteLibrary.addSprite("but_delete",
"./sprites/but_delete.png");s_oSpriteLibrary.addSprite("but_rotate","./sprites/but_rotate.png");s_oSpriteLibrary.addSprite("but_classic","./sprites/but_classic.png");s_oSpriteLibrary.addSprite("but_advanced","./sprites/but_advanced.png");s_oSpriteLibrary.addSprite("but_help","./sprites/but_help.png");s_oSpriteLibrary.addSprite("bg_sandbox_menu","./sprites/bg_sandbox_menu.jpg");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_mode","./sprites/bg_mode.jpg");
s_oSpriteLibrary.addSprite("score_panel","./sprites/score_panel.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("highlight","./sprites/highlight.png");s_oSpriteLibrary.addSprite("occupied_area","./sprites/occupied_area.png");s_oSpriteLibrary.addSprite("control_panel","./sprites/control_panel.png");s_oSpriteLibrary.addSprite("cell_control",
"./sprites/cell_control.png");s_oSpriteLibrary.addSprite("cell_battle","./sprites/cell_battle.png");for(var a=0;6>a;a++)s_oSpriteLibrary.addSprite("fill_"+a,"./sprites/ships/fill_"+a+".png"),s_oSpriteLibrary.addSprite("shape_"+a,"./sprites/ships/shape_"+a+".png"),s_oSpriteLibrary.addSprite("ship"+a,"./sprites/ships/ship"+a+".png"),s_oSpriteLibrary.addSprite("ship"+a+"_3d","./sprites/ships/ship"+a+"_3d.png");s_oSpriteLibrary.addSprite("final_explosion","./sprites/final_explosion.png");s_oSpriteLibrary.addSprite("torpedo",
"./sprites/torpedo.png");s_oSpriteLibrary.addSprite("missile","./sprites/missile.png");s_oSpriteLibrary.addSprite("missile_reactor","./sprites/missile_reactor.png");s_oSpriteLibrary.addSprite("missile_smoke","./sprites/missile_smoke.png");s_oSpriteLibrary.addSprite("missile_water","./sprites/missile_water.png");s_oSpriteLibrary.addSprite("missile_explosion","./sprites/missile_explosion.png");s_oSpriteLibrary.addSprite("fire","./sprites/fire.png");for(a=0;37>=a;a++)s_oSpriteLibrary.addSprite("surface_"+
a,"./sprites/sea_caustics/surface_"+a+".jpg");s_oSpriteLibrary.addSprite("bg_rocks","./sprites/bg_rocks.png");s_oSpriteLibrary.addSprite("enemy_fleet_panel","./sprites/enemy_fleet_panel.png");s_oSpriteLibrary.addSprite("your_fleet_panel","./sprites/your_fleet_panel.png");s_oSpriteLibrary.addSprite("wait_player","./sprites/wait_player.png");s_oSpriteLibrary.addSprite("but_air_strike","./sprites/but_air_strike.png");s_oSpriteLibrary.addSprite("but_radar","./sprites/but_radar.png");s_oSpriteLibrary.addSprite("air",
"./sprites/air.png");s_oSpriteLibrary.addSprite("air_shadow","./sprites/air_shadow.png");s_oSpriteLibrary.addSprite("sea_mobile","./sprites/sea_mobile.jpg");f+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){b++;c.refreshLoader(Math.floor(b/f*100))};this._onAllImagesLoaded=function(){};this._onPreloaderComplete=function(){c.unload();s_oSoundtrack=playSound("soundtrack",1,!0);this.gotoMenu();new CAnimationSettings};this.gotoMenu=function(){new CMenu;
h=STATE_MENU};this.gotoModeMenu=function(){new CModeMenu;h=STATE_MENU};this.gotoSandBoxMenu=function(){new CSandBoxMenu;h=STATE_MENU};this.gotoGame=function(a){d=new CGame(g,a);h=STATE_GAME};this.gotoHelp=function(){new CHelp;h=STATE_HELP};this.stopUpdate=function(){e=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();e=!0;createjs.Ticker.paused=!1;$("#block_game").css("display",
"none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(a){if(!1!==e){var c=(new Date).getTime();s_iTimeElaps=c-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=c;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);h===STATE_GAME&&d.update();s_oStage.update(a)}};s_oMain=this;var g=a;ENABLE_FULLSCREEN=a.fullscreen;ENABLE_CHECK_ORIENTATION=a.check_orientation;this.initContainer()}
var s_bMobile,s_bAudioActive=!0,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_bFullscreen=!1,s_iMode,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundtrack,s_oCanvas,s_aSounds;
function CTextButton(a,e,b,f,h,c,d,g){var m,l,q,k,n,t,u;this._init=function(a,c,b,g,d,f,e,h){m=[];l=[];var t=createBitmap(b),u=Math.ceil(e/20);n=new createjs.Text(g," "+e+"px "+d,"#000000");n.textAlign="center";n.textBaseline="alphabetic";var r=n.getBounds();n.x=b.width/2+u;n.y=Math.floor(b.height/2)+r.height/3+u;k=new createjs.Text(g," "+e+"px "+d,f);k.textAlign="center";k.textBaseline="alphabetic";r=k.getBounds();k.x=b.width/2;k.y=Math.floor(b.height/2)+r.height/3;q=new createjs.Container;q.x=a;
q.y=c;q.regX=b.width/2;q.regY=b.height/2;q.addChild(t,n,k);h.addChild(q);this._initListener()};this.unload=function(){q.off("mousedown",t);q.off("pressup",u);g.removeChild(q)};this.setVisible=function(a){q.visible=a};this._initListener=function(){oParent=this;t=q.on("mousedown",this.buttonDown);u=q.on("pressup",this.buttonRelease)};this.addEventListener=function(a,c,b){m[a]=c;l[a]=b};this.buttonRelease=function(){q.scaleX=1;q.scaleY=1;m[ON_MOUSE_UP]&&m[ON_MOUSE_UP].call(l[ON_MOUSE_UP])};this.buttonDown=
function(){q.scaleX=.9;q.scaleY=.9;m[ON_MOUSE_DOWN]&&m[ON_MOUSE_DOWN].call(l[ON_MOUSE_DOWN])};this.setTextPosition=function(a){k.y=a;n.y=a+2};this.setPosition=function(a,c){q.x=a;q.y=c};this.setX=function(a){q.x=a};this.setY=function(a){q.y=a};this.getButtonImage=function(){return q};this.getX=function(){return q.x};this.getY=function(){return q.y};this._init(a,e,b,f,h,c,d,g);return this}
function CToggle(a,e,b,f,h){var c,d,g,m,l,q,k,n,t;this._init=function(a,b,g,m,f){d=!1;k=[];n=[];var e=new createjs.SpriteSheet({images:[g],frames:{width:g.width/2,height:g.height,regX:g.width/2/2,regY:g.height/2},animations:{state_true:[0],state_false:[1]}});c=m;t=createSprite(e,"state_"+c,g.width/2/2,g.height/2,g.width/2,g.height);t.x=a;t.y=b;t.stop();f.addChild(t);this._initListener()};this.setVisible=function(a){t.visible=a};this.unload=function(){s_bMobile?t.off("mousedown",g):(t.off("mousedown",
g),t.off("mouseover",l),t.off("mouseout",q));t.off("pressup",m);h.removeChild(t)};this._initListener=function(){s_bMobile?g=t.on("mousedown",this.buttonDown):(g=t.on("mousedown",this.buttonDown),l=t.on("mouseover",this.buttonOver),q=t.on("mouseout",this.buttonOut));m=t.on("pressup",this.buttonRelease)};this.addEventListener=function(a,c,b){k[a]=c;n[a]=b};this.setActive=function(a){c=a;t.gotoAndStop("state_"+c)};this.buttonRelease=function(){d||(t.scaleX=1,t.scaleY=1,playSound("click",1,!1),c=!c,t.gotoAndStop("state_"+
c),k[ON_MOUSE_UP]&&k[ON_MOUSE_UP].call(n[ON_MOUSE_UP],c))};this.buttonDown=function(){d||(t.scaleX=.9,t.scaleY=.9,k[ON_MOUSE_DOWN]&&k[ON_MOUSE_DOWN].call(n[ON_MOUSE_DOWN]))};this.buttonOver=function(a){s_bMobile||d||(a.target.cursor="pointer",k[ON_MOUSE_OVER]&&k[ON_MOUSE_OVER].call(n[ON_MOUSE_OVER]))};this.buttonOut=function(a){s_bMobile||d||(a.target.cursor="pointer",k[ON_MOUSE_OUT]&&k[ON_MOUSE_OUT].call(n[ON_MOUSE_OUT]))};this.setPosition=function(a,c){t.x=a;t.y=c};this.getPos=function(){return{x:t.x,
y:t.y}};this.setClickable=function(a){d=!a};this.enable=function(a){a?(t.gotoAndPlay("state_true"),this.setClickable(!0)):(t.gotoAndPlay("state_false"),this.setClickable(!1))};this._init(a,e,b,f,h)}
function CGfxButton(a,e,b,f){var h,c,d,g,m,l,q,k,n;this._init=function(a,b,g,d){h=!1;c=1;q=[];k=[];n=new createjs.Container;n.x=a;n.y=b;d.addChild(n);a=createBitmap(g);a.scaleX=n.scaleY=c;a.regX=g.width/2;a.regY=g.height/2;n.addChild(a);this._initListener()};this.unload=function(){s_bMobile?n.off("mousedown",d):(n.off("mousedown",d),n.off("mouseover",m),n.off("mouseout",l));n.off("pressup",g);f.removeChild(n)};this.setVisible=function(a){n.visible=a};this.setClickable=function(a){h=!a};this._initListener=
function(){s_bMobile?d=n.on("mousedown",this.buttonDown):(d=n.on("mousedown",this.buttonDown),m=n.on("mouseover",this.buttonOver),l=n.on("mouseout",this.buttonOut));g=n.on("pressup",this.buttonRelease)};this.addEventListener=function(a,c,b){q[a]=c;k[a]=b};this.buttonRelease=function(){h||(n.scaleX=c,n.scaleY=c,q[ON_MOUSE_UP]&&q[ON_MOUSE_UP].call(k[ON_MOUSE_UP]))};this.buttonDown=function(){h||(n.scaleX=.9*c,n.scaleY=.9*c,playSound("click",1,!1),q[ON_MOUSE_DOWN]&&q[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN]))};
this.buttonOver=function(a){s_bMobile||h||(a.target.cursor="pointer")};this.buttonOut=function(a){s_bMobile||h||(a.target.cursor="pointer",q[ON_MOUSE_OUT]&&q[ON_MOUSE_OUT].call(k[ON_MOUSE_OUT]))};this.pulseAnimation=function(){createjs.Tween.get(n).to({scaleX:.9*c,scaleY:.9*c},850,createjs.Ease.quadOut).to({scaleX:c,scaleY:c},650,createjs.Ease.quadIn).call(function(){t.pulseAnimation()})};this.trembleAnimation=function(){createjs.Tween.get(n).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},
140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){t.trebleAnimation()})};this.setPosition=function(a,c){n.x=a;n.y=c};this.setX=function(a){n.x=a};this.setY=function(a){n.y=a};this.getButtonImage=function(){return n};this.getX=function(){return n.x};this.getY=function(){return n.y};this.setText=function(a,c,b){a=new createjs.Text(a," 44px "+SECONDARY_FONT,"#1ef400");a.textAlign="center";a.textBaseline="middle";a.x=c;a.y=b;n.addChild(a)};var t=this;this._init(a,
e,b,f);return this}
function CMenu(){var a,e,b,f,h,c,d,g,m,l,q,k,n=null,t=null;this._init=function(){d=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(d);var u=s_oSpriteLibrary.getSprite("but_play");g=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-300,u,s_oStage);g.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);g.pulseAnimation();u=s_oSpriteLibrary.getSprite("but_info");h=u.height/2+10;c=u.height/2+10;q=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-240,u,s_oStage);q.addEventListener(ON_MOUSE_UP,this._onCreditsBut,
this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)u=s_oSpriteLibrary.getSprite("audio_icon"),b=CANVAS_WIDTH-u.height/2-10,f=u.height/2+10,l=new CToggle(b,f,u,s_bAudioActive,s_oStage),l.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);u=window.document;var r=u.documentElement;n=r.requestFullscreen||r.mozRequestFullScreen||r.webkitRequestFullScreen||r.msRequestFullscreen;t=u.exitFullscreen||u.mozCancelFullScreen||u.webkitExitFullscreen||u.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(n=!1);n&&screenfull.enabled&&
(u=s_oSpriteLibrary.getSprite("but_fullscreen"),a=h+u.width/2+10,e=u.height/2+10,k=new CToggle(a,e,u,s_bFullscreen,s_oStage),k.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(m);createjs.Tween.get(m).to({alpha:0},1E3).call(function(){m.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){g.unload();g=null;m.visible=!1;q.unload();if(!1===DISABLE_SOUND_MOBILE||
!1===s_bMobile)l.unload(),l=null;n&&screenfull.enabled&&k.unload();s_oStage.removeChild(d);s_oMenu=d=null};this.refreshButtonPos=function(g,d){q.setPosition(h+g,d+c);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(b-g,d+f);n&&screenfull.enabled&&k.setPosition(a+g,e+d)};this.resetFullscreenBut=function(){n&&screenfull.enabled&&k.setActive(s_bFullscreen)};this._onFullscreen=function(){s_bFullscreen?t.call(window.document):n.call(window.document.documentElement);sizeHandler()};this._onAudioToggle=
function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onCreditsBut=function(){new CCreditsPanel};this._onButPlayRelease=function(){this.unload();$(s_oMain).trigger("start_session");s_oMain.gotoModeMenu()};s_oMenu=this;this._init()}var s_oMenu=null;
function CModeMenu(){var a,e,b,f,h,c,d,g,m,l,q,k;this._init=function(){var n=createBitmap(s_oSpriteLibrary.getSprite("bg_mode"));s_oStage.addChild(n);n=new createjs.Text(TEXT_GAME_MODE," 160px "+SECONDARY_FONT,"#1ef400");n.textAlign="center";n.textBaseline="middle";n.x=CANVAS_WIDTH/2;n.y=260;s_oStage.addChild(n);n=s_oSpriteLibrary.getSprite("but_classic");g=new CGfxButton(CANVAS_WIDTH/2-220,CANVAS_HEIGHT/2+100,n,s_oStage);g.addEventListener(ON_MOUSE_UP,this._onClassicBut,this);g.setText(TEXT_CLASSIC,
0,76);n=s_oSpriteLibrary.getSprite("but_advanced");m=new CGfxButton(CANVAS_WIDTH/2+220,CANVAS_HEIGHT/2+100,n,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onAdvancedBut,this);m.setText(TEXT_ADVANCED,0,76);n=s_oSpriteLibrary.getSprite("but_help");a=n.height/2+10;e=n.height/2+10;k=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-240,n,s_oStage);k.addEventListener(ON_MOUSE_UP,this._onHelpBut,this);n=s_oSpriteLibrary.getSprite("but_exit");h=CANVAS_WIDTH-n.height/2-10;c=n.height/2+10;l=new CGfxButton(h,c,
n,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onExit,this);b=CANVAS_WIDTH-n.width/2-110;f=n.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)n=s_oSpriteLibrary.getSprite("audio_icon"),q=new CToggle(b,f,n,s_bAudioActive,s_oStage),q.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(d);createjs.Tween.get(d).to({alpha:0},1E3).call(function(){d.visible=!1});this.refreshButtonPos(s_iOffsetX,
s_iOffsetY)};this.unload=function(){s_oStage.removeAllChildren();m.unload();g.unload();l.unload();q.unload();k.unload();s_oModeMenu=null};this.refreshButtonPos=function(g,d){k.setPosition(a+g,d+e);l.setPosition(h-g,d+c);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||q.setPosition(b-g,d+f)};this._onHelpBut=function(){new CHelpPanel};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onClassicBut=function(){n.unload();
s_iMode=MODE_CLASSIC;s_oMain.gotoSandBoxMenu()};this._onAdvancedBut=function(){n.unload();s_iMode=MODE_ADVANCED;s_oMain.gotoSandBoxMenu()};s_oModeMenu=this;var n=this;this._init()}var s_oModeMenu=null;
function CGame(a,e){var b,f,h,c,d=0,g,m,l,q,k=null,n,t,u,r,x,B,y,C,F,K,G,H,E,P;this._init=function(){setVolume("soundtrack",.4);$(s_oMain).trigger("start_level",1);b=!0;f=0;c=PLAYER;g=0;h=1;B=new CBackground(s_oStage);y=new createjs.Container;s_oStage.addChild(y);l=e;this._initEnemyBoard();C=new createjs.Container;s_oStage.addChild(C);F=new createjs.Container;s_oStage.addChild(F);t=new CPlayerBoard(CANVAS_WIDTH/2-150,CANVAS_HEIGHT/2+100,C,l,PLAYER,F);u=new CPlayerBoard(CANVAS_WIDTH/2+150,CANVAS_HEIGHT/
2-200,C,m,OPPONENT,F);r=new CMissile(F,y);H=new CTurnWaiter(s_oStage);x=null;E=new CAirStrike(C);q=new CInterface;q.refreshScore(f);if(!s_bMobile)s_oStage.on("stagemousemove",this.setMouseCoordinate);n=new CControlPanel;n.show();K=new CAI(t);G=new createjs.Shape;G.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(G);createjs.Tween.get(G).to({alpha:0},1E3).call(function(){G.visible=!1})};this._initEnemyBoard=function(){var a=new CSandBoxBoard(0,0,s_oStage,!1);m=
[];m[0]=new CShip(400,200,SHIP_SMALL,s_oStage,a);m[1]=new CShip(400,300,SHIP_SUB,s_oStage,a);m[2]=new CShip(400,400,SHIP_MEDIUM,s_oStage,a);m[3]=new CShip(400,500,SHIP_LONG,s_oStage,a);m[4]=new CShip(400,600,SHIP_BATTLE,s_oStage,a);m[5]=new CShip(400,700,SHIP_CARRIER,s_oStage,a);a.shuffle(m);for(var c=0;c<m.length;c++)m[c].unload();a.unload()};this.tryShowAd=function(){d++;d===AD_SHOW_COUNTER&&(d=0,$(s_oMain).trigger("show_interlevel_ad"))};this.onCellClick=function(a,c){n.hide();g=1;r.launchMissileForPlayer(a,
c)};this.onMissileArrived=function(a,b){var d=[u,t],f=d[c].isShipOn(a,b);if(null!==f){if(f.hitShip(a,b),d[c].setCellState(a,b,CELL_STATE_HIT),c===OPPONENT?(d[c].setFire(a,b),s_oGame.addScore(-POINTS_TO_LOSE)):(s_oGame.addScore(h*POINTS_EARNED),h++),d[c].playExplosion(a,b),f.isSunk()){for(var e=f.getListCellOccupied(),k=0;k<e.length;k++)for(var r=s_oBoardUtility.getAllNeighbor(e[k].row,e[k].col),C=0;C<r.length;C++)d[c].setCellState(r[C].row,r[C].col,CELL_STATE_WATER);for(k=0;k<e.length;k++)d[c].setCellState(e[k].row,
e[k].col,CELL_STATE_SUNK);c===OPPONENT&&K.resetToStartState();d[c].sunkAnimation(f)}}else d[c].setCellState(a,b,CELL_STATE_WATER),d[c].playWater(a,b),c===PLAYER&&(h=1);n.refresh(u.getCells());c===OPPONENT?q.setShipDamage(l):q.setEnemySunk(m);g--;0===g&&(this.tryShowAd(),this.changeTurn())};this.changeTurn=function(){this.checkEndGame()||(c===PLAYER?(c=OPPONENT,this._wakeUpAI()):(c=PLAYER,setTimeout(function(){n.show()},1E3)))};this._wakeUpAI=function(){H.show();g=1;var a=randomFloatBetween(MIN_AI_THINKING,
MAX_AI_THINKING),c;x=new Timer(function(){c=K.getCoordinate(l);r.launchMissileForOpponent(c.row,c.col);H.hide();x=null},a)};this.checkEndGame=function(){for(var a=!0,c=0;c<m.length;c++)if(!m[c].isSunk()){a=!1;break}var b=!0;for(c=0;c<l.length;c++)if(!l[c].isSunk()){b=!1;break}a?this.gameOver(PLAYER):b&&this.gameOver(OPPONENT);return a||b};this.setNumMissileShot=function(a){g=a};this.getRandomAvailableShip=function(a){for(var c=[l,m],b=[],g=0;g<c[a].length;g++)c[a][g].isSunk()||b.push(c[a][g]);return b[Math.floor(Math.random()*
b.length)]};this.getCellPos=function(a,c,b){return b===OPPONENT?u.getCellPos(a,c):t.getCellPos(a,c)};this.getBoardPos=function(a){if(a===PLAYER)return t.getPos();a=u.getBounds();var c=u.getPos();return{x:c.x-a.width/2,y:c.y}};this.getBoard=function(a){return a===PLAYER?t:u};this.launchAirStrike=function(){E.launch()};this.addScore=function(a){f+=a;0>=f&&(f=0);q.refreshScore(f)};this.getScore=function(){return f};this.restartGame=function(){$(s_oMain).trigger("show_interlevel_ad");this.unload();this._init()};
this.pauseGame=function(a){b=!a;null!==x&&(b?x.resume():x.pause())};this.unload=function(){b=!1;q.unload();null!==k&&k.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};this.onExit=function(){$(s_oMain).trigger("end_session");s_oGame.unload();s_oMain.gotoMenu()};this._onExitHelp=function(){b=!0;$(s_oMain).trigger("start_level",1)};this.gameOver=function(a){k=CEndPanel(a);k.show(f)};this.setMouseCoordinate=function(a){P={x:a.stageX,y:a.stageY}};this.getMouseCoordinate=function(){return P};
this.update=function(){b&&(null!==H&&H.update(),r.update(),B.update(),n.update(P))};s_oGame=this;POINTS_TO_LOSE=a.points_to_lose;POINTS_EARNED=a.points_earned;AD_SHOW_COUNTER=a.ad_show_counter;this._init()}var s_oGame;
function CInterface(){var a,e,b,f,h,c,d,g,m,l,q,k=null,n,t=null,u=null;this._init=function(){var k=s_oSpriteLibrary.getSprite("but_exit");d=CANVAS_WIDTH-k.height/2-10;g=k.height/2+10;l=new CGfxButton(d,g,k,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onExit,this);h=CANVAS_WIDTH-k.width/2-110;c=k.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)k=s_oSpriteLibrary.getSprite("audio_icon"),m=new CToggle(h,c,k,s_bAudioActive,s_oStage),m.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);
k=window.document;var x=k.documentElement;t=x.requestFullscreen||x.mozRequestFullScreen||x.webkitRequestFullScreen||x.msRequestFullscreen;u=k.exitFullscreen||k.mozCancelFullScreen||k.webkitExitFullscreen||k.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(t=!1);t&&screenfull.enabled&&(k=s_oSpriteLibrary.getSprite("but_fullscreen"),b=k.width/4+10,f=k.height/2+10,q=new CToggle(b,f,k,s_bFullscreen,s_oStage),q.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));a=0;e=CANVAS_HEIGHT;n=new CSummaryPanel(a,e,
s_oStage);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)m.unload(),m=null;l.unload();t&&screenfull.enabled&&q.unload();s_oInterface=null};this.refreshButtonPos=function(k,u){l.setPosition(d-k,u+g);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||m.setPosition(h-k,u+c);t&&screenfull.enabled&&q.setPosition(b+k,f+u);n.setPos(a+k,e-u)};this.refreshScore=function(a){n.setScore(a)};this.setShipDamage=function(a){n.setDamage(a)};this.setEnemySunk=
function(a){n.setEnemySunk(a)};this._onButHelpRelease=function(){k=new CHelpPanel};this.onExitFromHelp=function(){k.unload()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){new CAreYouSurePanel(s_oGame.onExit)};this.resetFullscreenBut=function(){t&&screenfull.enabled&&q.setActive(s_bFullscreen)};this._onFullscreen=function(){s_bFullscreen?u.call(window.document):t.call(window.document.documentElement);sizeHandler()};s_oInterface=
this;this._init();return this}var s_oInterface=null;
function CHelpPanel(){var a,e,b,f,h,c;this._init=function(){b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=0;e=b.on("mousedown",this.unload);s_oStage.addChild(b);(new createjs.Tween.get(b)).to({alpha:.7},500);f=new createjs.Container;s_oStage.addChild(f);var d=s_oSpriteLibrary.getSprite("control_panel"),g=createBitmap(d);g.regX=d.width/2;g.regY=d.height/2;f.addChild(g);f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT+d.height/2;a=f.y;(new createjs.Tween.get(f)).to({y:CANVAS_HEIGHT/
2},500,createjs.Ease.quartIn);g=new createjs.Text(TEXT_HELP," 120px "+SECONDARY_FONT,"#1ef400");g.y=-d.height/2+100;g.textAlign="center";g.textBaseline="middle";g.lineWidth=300;f.addChild(g);d=new createjs.Text(TEXT_CLASSIC+":"," 40px "+SECONDARY_FONT,"#1ef400");d.x=-550;d.y=-200;d.textAlign="left";d.textBaseline="alphabetic";d.lineWidth=1200;f.addChild(d);g=new createjs.Text(TEXT_HELP_CLASSIC," 34px "+PRIMARY_FONT,"#ffffff");g.x=d.x+d.getBounds().width+10;g.y=d.y;g.textAlign="left";g.textBaseline=
"alphabetic";g.lineWidth=1E3;f.addChild(g);g=new createjs.Text(TEXT_ADVANCED+":"," 40px "+SECONDARY_FONT,"#1ef400");g.x=-550;g.y=0;g.textAlign="left";g.textBaseline="alphabetic";g.lineWidth=1200;f.addChild(g);var m=new createjs.Text(TEXT_HELP_ADVANCED," 34px "+PRIMARY_FONT,"#ffffff");m.x=g.x+g.getBounds().width+10;m.y=g.y;m.textAlign="left";m.textBaseline="alphabetic";m.lineWidth=1E3;f.addChild(m);d=s_oSpriteLibrary.getSprite("but_air_strike");h=new CToggle(m.x+d.width/4,g.y+100,d,!0,f);h.setClickable(!1);
g=new createjs.Text(TEXT_HELP_AIRSTRIKE," 34px "+PRIMARY_FONT,"#ffffff");g.x=h.getPos().x+d.width/4+10;g.y=h.getPos().y;g.textAlign="left";g.textBaseline="middle";g.lineWidth=800;f.addChild(g);c=new CAnimatedButton(h.getPos().x,h.getPos().y+150,s_oRadarSpritesheet,f);c.enable(!0);c.setClickable(!1);g=new createjs.Text(TEXT_HELP_RADAR," 34px "+PRIMARY_FONT,"#ffffff");g.x=h.getPos().x+d.width/4+10;g.y=h.getPos().y+134;g.textAlign="left";g.textBaseline="middle";g.lineWidth=800;f.addChild(g)};this.unload=
function(){(new createjs.Tween.get(b)).to({alpha:0},500);(new createjs.Tween.get(f)).to({y:a},400,createjs.Ease.backIn).call(function(){s_oStage.removeChild(b);s_oStage.removeChild(f);h.unload();c.unload()});b.off("mousedown",e)};this._init()}
function CCreditsPanel(){var a,e,b,f,h,c,d;this._init=function(){e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=0;s_oStage.addChild(e);(new createjs.Tween.get(e)).to({alpha:.7},500);c=new createjs.Shape;c.graphics.beginFill("#0f0f0f").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=.01;d=c.on("click",this._onLogoButRelease);s_oStage.addChild(c);b=new createjs.Container;s_oStage.addChild(b);var g=s_oSpriteLibrary.getSprite("msg_box"),m=createBitmap(g);
m.regX=g.width/2;m.regY=g.height/2;b.addChild(m);b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT+g.height/2;a=b.y;(new createjs.Tween.get(b)).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.quartIn);m=new createjs.Text("DEVELOPED BY"," 30px "+SECONDARY_FONT,"#1ef400");m.y=-g.height/2+100;m.textAlign="center";m.textBaseline="middle";m.lineWidth=300;b.addChild(m);g=new createjs.Text("www.codethislab.com"," 30px "+SECONDARY_FONT,"#1ef400");g.y=80;g.textAlign="center";g.textBaseline="middle";g.lineWidth=300;b.addChild(g);
g=s_oSpriteLibrary.getSprite("ctl_logo");h=createBitmap(g);h.regX=g.width/2;h.regY=g.height/2;b.addChild(h);g=s_oSpriteLibrary.getSprite("but_exit");f=new CGfxButton(210,-122,g,b);f.addEventListener(ON_MOUSE_UP,this.unload,this)};this.unload=function(){s_oStage.removeChild(c);f.setClickable(!1);(new createjs.Tween.get(e)).to({alpha:0},500);(new createjs.Tween.get(b)).to({y:a},400,createjs.Ease.backIn).call(function(){s_oStage.removeChild(e);s_oStage.removeChild(b);f.unload()});c.off("click",d)};this._onLogoButRelease=
function(){window.open("http://www.codethislab.com/index.php?&l=en")};this._onMoreGamesReleased=function(){window.open("http://codecanyon.net/collections/5409142-games")};this._init()}
function CAreYouSurePanel(a){var e,b,f,h,c,d;this._init=function(a){s_oGame.pauseGame(!0);h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.alpha=0;d=h.on("mousedown",function(){});s_oStage.addChild(h);(new createjs.Tween.get(h)).to({alpha:.7},500);c=new createjs.Container;s_oStage.addChild(c);a=s_oSpriteLibrary.getSprite("msg_box");var g=createBitmap(a);g.regX=a.width/2;g.regY=a.height/2;c.addChild(g);c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT+a.height/2;e=c.y;
(new createjs.Tween.get(c)).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartIn);g=new createjs.Text(TEXT_ARE_SURE," 50px "+SECONDARY_FONT,"#000000");g.y=-a.height/2+120;g.textAlign="center";g.textBaseline="middle";g.lineWidth=400;g.outline=5;c.addChild(g);a=new createjs.Text(TEXT_ARE_SURE," 50px "+SECONDARY_FONT,"#1ef400");a.y=g.y;a.textAlign="center";a.textBaseline="middle";a.lineWidth=400;c.addChild(a);b=new CGfxButton(110,80,s_oSpriteLibrary.getSprite("but_yes"),c);b.addEventListener(ON_MOUSE_UP,
this._onButYes,this);f=new CGfxButton(-110,80,s_oSpriteLibrary.getSprite("but_not"),c);f.addEventListener(ON_MOUSE_UP,this._onButNo,this);f.pulseAnimation()};this._onButYes=function(){f.setClickable(!1);b.setClickable(!1);s_oGame.pauseGame(!1);(new createjs.Tween.get(h)).to({alpha:0},500);(new createjs.Tween.get(c)).to({y:e},400,createjs.Ease.backIn).call(function(){g.unload();a()})};this._onButNo=function(){f.setClickable(!1);b.setClickable(!1);s_oGame.pauseGame(!1);(new createjs.Tween.get(h)).to({alpha:0},
500);(new createjs.Tween.get(c)).to({y:e},400,createjs.Ease.backIn).call(function(){g.unload()})};this.unload=function(){f.unload();b.unload();s_oStage.removeChild(h);s_oStage.removeChild(c);h.off("mousedown",d)};var g=this;this._init(a)}
function CEndPanel(a){var e,b,f,h,c,d,g,m,l;this._init=function(a){e=null;setVolume("soundtrack",1);h=new createjs.Shape;h.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);h.alpha=.7;a=s_oSpriteLibrary.getSprite("msg_box");b=createBitmap(a);b.regX=a.width/2;b.regY=a.height/2;b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2;c=new createjs.Text(""," 100px "+SECONDARY_FONT,"#000");c.x=CANVAS_WIDTH/2+1;c.y=CANVAS_HEIGHT/2-50;c.textAlign="center";c.textBaseline="alphabetic";c.lineWidth=500;d=
new createjs.Text(""," 100px "+SECONDARY_FONT,"#1ef400");d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2-52;d.textAlign="center";d.textBaseline="alphabetic";d.lineWidth=500;g=new createjs.Text(""," 40px "+SECONDARY_FONT,"#000");g.x=CANVAS_WIDTH/2+1;g.y=CANVAS_HEIGHT/2+50;g.textAlign="center";g.textBaseline="alphabetic";g.lineWidth=500;m=new createjs.Text(""," 40px  "+SECONDARY_FONT,"#1ef400");m.x=CANVAS_WIDTH/2;m.y=CANVAS_HEIGHT/2+52;m.textAlign="center";m.textBaseline="alphabetic";m.lineWidth=500;f=new createjs.Container;
f.alpha=0;f.visible=!1;f.addChild(h,b,g,m,c,d);s_oStage.addChild(f)};this.unload=function(){null!==e&&clearTimeout(e);f.off("mousedown",l)};this._initListener=function(){l=f.on("mousedown",this._onExit)};this.show=function(b){playSound("game_over",1,!1);a===PLAYER?(c.text=TEXT_WIN,d.text=TEXT_WIN,this._winnerAnim()):(c.text=TEXT_LOSE,d.text=TEXT_LOSE,this._loseAnim());g.text=TEXT_SCORE+": "+b;m.text=TEXT_SCORE+": "+b;f.visible=!0;var e=this;createjs.Tween.get(f).to({alpha:1},500).call(function(){e._initListener()});
$(s_oMain).trigger("save_score",b,s_iMode);$(s_oMain).trigger("end_level",1);var k="You collected <strong>"+b+" points</strong>!<br><br>Share your score with your friends!",h="My score is "+b+" points! Can you do better?";$(s_oMain).trigger("share_event",b,"200x200.jpg","Congratulations!",k,h)};this._winnerAnim=function(){e=setTimeout(function(){(new CAirStrike(f)).endAnim({x:CANVAS_WIDTH+(200+200*Math.random()),y:CANVAS_HEIGHT+(-400-200*Math.random())},{x:-250-250*Math.random(),y:-300-300*Math.random()},
2E3+2E3*Math.random());q._winnerAnim()},1E3+1E3*Math.random())};this._loseAnim=function(){e=setTimeout(function(){var a=new createSprite(s_oMissileExplosionSpritesheet,"idle",0,0,0,0);a.on("animationend",this._endExplosion,this,!1,{missile:a});playSound("missile_explosion",1,!1);a.x=CANVAS_WIDTH*Math.random();a.y=CANVAS_HEIGHT*Math.random();f.addChild(a);q._loseAnim()},400+400*Math.random())};this._endExplosion=function(a,c){a.remove();f.removeChild(c.missile)};this._onExit=function(){$(s_oMain).trigger("show_interlevel_ad");
f.off("mousedown",l);s_oStage.removeChild(f);s_oGame.onExit()};this._init(a);var q=this;return this}
function CSandBoxBoard(a,e,b,f){var h,c,d;this._init=function(a,b,f,e){c=[];d=null;this._initBoard();new CBoardUtility(h)};this.unload=function(){b.removeChild();for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)h[a][c].unload()};this.getSandBoxMode=function(){return f};this._initBoard=function(){var a=NUM_CELL,c=CELL_LENGTH,d=-BOARD_LENGTH/2+c/2;h=[];for(var e=0;e<a;e++){h[e]=[];for(var k=0;k<a;k++)h[e][k]=new CSandBoxCell(d+k*c+-2,d+e*c+54,e,k,b),h[e][k].setVisible(f)}};this.snapFromRelease=
function(a){this.snapShip(d,a)};this.snapShip=function(a,d){var g=d.getShipContainer();if(null!==a){var e=this._checkFreeCells(a.row,a.col,d);if(e.free){var k=h[a.row][a.col];k=b.localToGlobal(k.getPos().x,k.getPos().y);g.x=k.x/s_iScaleFactor;g.y=k.y/s_iScaleFactor;this.setDeniedArea(e.list);d.setListCellOccupied(e.list);c.push(d);this.hideHighlight();this.printDebug()}else this.resetShip(d)}else this.resetShip(d);f&&s_oSandBoxMenu.checkPlayable()};this._checkFreeCells=function(a,c,b){b=b.getMap();
for(var g=[],d=!0,e=0;e<b.length;e++)for(var f=0;f<b[e].length;f++){var m=a+e,l=c+f;if(m>=NUM_CELL||l>=NUM_CELL||h[m][l].isShipOn())return d=!1,{free:d,list:[]};g.push({row:m,col:l})}return{free:d,list:g}};this.setShipOnCell=function(a,c){for(var b=0;b<a.length;b++)h[a[b].row][a[b].col].setShip(c)};this.resetShip=function(a){this.hideHighlight();var c=a.getListCellOccupied();this.setShipOnCell(c,!1);a.returnInStartPos()};this._findShipPos=function(a){a=a.getShipContainer();a=s_oStage.localToLocal(a.x,
a.y,b);for(var c=null,g=0;g<NUM_CELL;g++)for(var d=0;d<NUM_CELL;d++){var e=h[g][d],f=a.x-e.getPos().x,t=a.y-e.getPos().y;e.hitTest(f,t)&&(c={row:g,col:d})}return c};this._findAllPiecesPos=function(a,c,b){var g=[];g.push({row:a,col:c});for(var d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++){var f=a+d,h=c+e;f<NUM_CELL&&h<NUM_CELL&&g.push({row:f,col:h})}return g};this.setDeniedArea=function(a){for(var c=[],b=0;b<a.length;b++){h[a[b].row][a[b].col].highlightDeniedArea(!0);c.push({row:a[b].row,col:a[b].col});
for(var g=s_oBoardUtility.getAllNeighbor(a[b].row,a[b].col),d=0;d<g.length;d++){var e=g[d].row,f=g[d].col;h[e][f].highlightDeniedArea(!0);c.push({row:e,col:f})}}this.setShipOnCell(c,!0)};this.highlightSnap=function(a){this.hideHighlight();var c=this._findShipPos(a);if(null!==c){a=this._findAllPiecesPos(c.row,c.col,a.getMap());for(var b=0;b<a.length;b++)h[a[b].row][a[b].col].highlight(!0)}d=c};this.hideHighlight=function(){for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)h[a][c].highlight(!1)};
this.removeAllDenied=function(){for(var a=0;a<NUM_CELL;a++)for(var c=0;c<NUM_CELL;c++)h[a][c].highlightDeniedArea(!1),h[a][c].setShip(!1)};this.refreshDenied=function(){this.removeAllDenied();for(var a=0;a<c.length;a++)this.setDeniedArea(c[a].getListCellOccupied())};this.removeShip=function(a){for(var b=0;b<c.length;b++)c[b]===a&&(c[b].setListCellOccupied([]),c.splice(b,1));this.refreshDenied();this.highlightSnap(a);this.printDebug()};this.shuffle=function(a){this.clearAll(a);for(var c=0;c<a.length;c++)for(var b=
a[c].getListCellOccupied(),d=100;0===b.length;){b=Math.floor(Math.random()*NUM_CELL);var g=Math.floor(Math.random()*NUM_CELL);.5>Math.random()&&a[c].rotateMap();this.snapShip({row:b,col:g},a[c]);b=a[c].getListCellOccupied();d--;0===d&&this.shuffle(a)}};this.clearAll=function(a){for(var c=0;c<a.length;c++)a[c].isHorizontal()&&a[c].rotateMap(),this.removeShip(a[c]),this.resetShip(a[c])};this.printDebug=function(){for(var a=[],c=0;c<h.length;c++){a[c]=[];for(var b=0;b<h[c].length;b++)void 0!==h[c][b]&&
(h[c][b].isShipOn()?a[c][b]=1:a[c][b]=0)}this.printMat(a)};this.printMat=function(a){for(var c=0;c<a.length;c++)for(var b=0;b<a[c].length;b++);};this._init(a,e,b,f)}
function CSandBoxCell(a,e,b,f,h){var c,d,g,m,l,q;this._init=function(a,b,e,f,h){c=!1;d=new createjs.Container;d.x=a;d.y=b;h.addChild(d);g=null;a=s_oSpriteLibrary.getSprite("highlight");q=createBitmap(a);q.regX=a.width/2;q.regY=a.height/2;q.alpha=.8;q.visible=!1;d.addChild(q);a=s_oSpriteLibrary.getSprite("occupied_area");l=createBitmap(a);l.regX=a.width/2;l.regY=a.height/2;l.visible=!1;d.addChild(l);m=new createjs.Shape;m.graphics.beginFill("rgba(158,0,0,0.01)").drawRect(-CELL_LENGTH/2,-CELL_LENGTH/
2,CELL_LENGTH,CELL_LENGTH);d.addChild(m)};this.unload=function(){h.removeChild(d)};this.setClickableArea=function(a){m.visible=a};this.highlightDeniedArea=function(a){l.visible=a};this.highlight=function(a){q.visible=a};this.isHighlight=function(){return q.visible};this._onCellClick=function(){};this.setActive=function(a){null!==g&&g.setActive(a)};this.setVisible=function(a){d.visible=a};this.setShip=function(a){c=a};this.isShipOn=function(){return c};this.getPos=function(){return{x:a,y:e}};this.getLogicPos=
function(){return{row:b,col:f}};this.hitTest=function(a,c){return d.hitTest(a,c)};this._init(a,e,b,f,h)}
function CSandBoxMenu(a){var e,b,f,h,c,d,g,m,l,q,k,n,t,u,r,x;this._init=function(){n=null;var a=createBitmap(s_oSpriteLibrary.getSprite("bg_sandbox_menu"));s_oStage.addChild(a);d=new createjs.Container;d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2;s_oStage.addChild(d);t=new createjs.Text(TEXT_STRATEGY_PANEL," 80px "+SECONDARY_FONT,"#1ef400");t.textAlign="center";t.textBaseline="middle";t.x=CANVAS_WIDTH/2;t.y=160;s_oStage.addChild(t);a=s_oSpriteLibrary.getSprite("but_shuffle");g=new CGfxButton(1450,220,a,
s_oStage);g.addEventListener(ON_MOUSE_UP,this._onAuto,this);a=s_oSpriteLibrary.getSprite("but_delete");m=new CGfxButton(1450,425,a,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onButClear,this);a=s_oSpriteLibrary.getSprite("but_rotate");q=new CGfxButton(1450,630,a,s_oStage);q.setVisible(!1);q.addEventListener(ON_MOUSE_UP,this._onButRotate,this);a=s_oSpriteLibrary.getSprite("but_play");l=new CGfxButton(1472,CANVAS_HEIGHT-226,a,s_oStage);l.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);
l.setVisible(!1);a=s_oSpriteLibrary.getSprite("but_exit");f=CANVAS_WIDTH-a.height/2-10;h=a.height/2+10;r=new CGfxButton(f,h,a,s_oStage);r.addEventListener(ON_MOUSE_UP,this._onExit,this);e=CANVAS_WIDTH-a.width/2-110;b=a.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)a=s_oSpriteLibrary.getSprite("audio_icon"),x=new CToggle(e,b,a,s_bAudioActive,s_oStage),x.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);k=new CSandBoxBoard(0,0,d,!0);a=new createjs.Container;s_oStage.addChild(a);c=[];
c[0]=new CShip(300,200,SHIP_SMALL,a,k);c[1]=new CShip(400,156,SHIP_SUB,a,k);c[2]=new CShip(300,440,SHIP_MEDIUM,a,k);c[3]=new CShip(400,390,SHIP_LONG,a,k);c[4]=new CShip(300,700,SHIP_BATTLE,a,k);c[5]=new CShip(400,750,SHIP_CARRIER,a,k);u=new createjs.Shape;u.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(u);createjs.Tween.get(u).to({alpha:0},1E3).call(function(){u.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(a,c){r.setPosition(f-
a,c+h);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||x.setPosition(e-a,c+b)};this.unload=function(){s_oSandBoxMenu=null;g.unload();m.unload();l.unload();s_oStage.removeAllChildren();k.unload();for(var a=0;a<c.length;a++)c[a].unload()};this.setActiveShip=function(a){n=a;null===n?q.setVisible(!1):q.setVisible(!0)};this.getShipList=function(){return c};this._onAuto=function(){k.shuffle(c)};this._onButClear=function(){k.clearAll(c);this.checkPlayable()};this._onButRotate=function(){null!==n&&n._onShipRotate()};
this.onExit=function(){$(s_oMain).trigger("end_session");s_oMain.gotoMenu()};this.checkPlayable=function(){for(var a=!0,b,d=0;d<c.length;d++)b=c[d].getListCellOccupied(),0===b.length&&(a=!1);a?l.setVisible(!0):l.setVisible(!1)};this._onButPlayRelease=function(){this.unload();s_oMain.gotoGame(c)};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};s_oSandBoxMenu=this;this._init()}var s_oSandBoxMenu=null;
function CShip(a,e,b,f,h){var c,d,g,m,l,q,k,n,t,u,r,x,B,y,C,F,K,G,H;this._init=function(a,c,b,d,e){l=e.getSandBoxMode();q=!1;k=-4;n=40;g=a;m=c;t=b.map;u=[];r=[];x=new createjs.Container;x.x=a;x.y=c;l&&(F=x.on("mousedown",this._onShipClick),K=x.on("pressmove",this._onShipMove),H=x.on("dblclick",this._onShipRotate),G=x.on("pressup",this._onShipRelease),d.addChild(x));this.drawMap();this.drawShip()};this.drawMap=function(){for(var a=0;a<r.length;a++)for(var c=0;c<r[a].length;c++)x.removeChild(r[a][c]);
var b=0,d=0;r=[];for(a=0;a<t.length;a++){r[a]=[];for(c=0;c<t[a].length;c++)if(t[a][c]){var g=new createjs.Shape;g.graphics.beginFill("rgba(158,158,158,0.01)").drawRect(-CELL_LENGTH/2,-CELL_LENGTH/2,CELL_LENGTH,CELL_LENGTH);g.x=b;g.y=d;x.addChild(g);b+=CELL_LENGTH;r[a][c]=g}b=0;d+=CELL_LENGTH}};this.drawShip=function(){B=s_oSpriteLibrary.getSprite(b.sandbox_sprite);y=createBitmap(B);y.regX=B.width/2+k;y.regY=n;b===SHIP_CARRIER&&(y.regX=B.width/4);x.addChild(y);if(l){var c=s_oSpriteLibrary.getSprite("shape_"+
b.battle_spritesheet);C=createBitmap(c);C.x=a;C.y=e;C.regX=B.width/2+k-8;C.regY=n-10;b===SHIP_CARRIER&&(C.regX=B.width/4-8);f.addChild(C)}};this.unload=function(){l&&(x.off("mousedown",F),x.off("pressmove",K),x.off("dblclick",H),x.off("pressup",G),f.removeChild(x))};this._onShipClick=function(a){h.removeShip(E);l&&s_oSandBoxMenu.setActiveShip(E);c=a.localX;d=a.localY};this._onShipMove=function(a){x.x-=c-a.localX;x.y-=d-a.localY;c=a.localX;d=a.localY;h.highlightSnap(E)};this._onShipRelease=function(){h.snapFromRelease(E)};
this._onShipRotate=function(){E.rotateMap();h.removeShip(E);h.snapFromRelease(E)};this.rotateMap=function(){(q=!q)?(y.rotation=-90,y.scaleY=-1,y.regY=B.height-n,b===SHIP_CARRIER&&(y.regX=3*B.width/4-2)):(y.rotation=0,y.scaleY=1,y.regY=n,b===SHIP_CARRIER&&(y.regX=B.width/4));t=t[0].map(function(a,c){return t.map(function(a){return a[c]})});E.drawMap();u=[]};this.getShipContainer=function(){return x};this.getMap=function(){return t};this.returnInStartPos=function(){x.x=g;x.y=m;u=[];q&&this._onShipRotate();
l&&s_oSandBoxMenu.setActiveShip(null)};this.setListCellOccupied=function(a){u=[];for(var c=0;c<a.length;c++)u.push(a[c])};this.getListCellOccupied=function(){return u};this.getPos=function(){return{x:x.x,y:x.y}};this.getType=function(){return b};this.isHorizontal=function(){return q};this.hitShip=function(a,c){for(var b=0;b<u.length;b++)u[b].row===a&&u[b].col===c&&(u[b].hit=!0)};this.isPartiallyDamaged=function(){for(var a=!1,c=0;c<u.length;c++)u[c].hit&&(a=!0);return a};this.isSunk=function(){for(var a=
!0,c=0;c<u.length;c++)u[c].hit||(a=!1);return a};this.debugShips=function(){f.addChild(x)};this._init(a,e,b,f,h);var E=this}
function CRuler(a){var e,b,f,h,c,d,g;this._init=function(a){e=new createjs.Container;e.x=-CANVAS_WIDTH/2;e.y=-CANVAS_HEIGHT/2;a.addChild(e);b=new createjs.Shape;b.graphics.beginFill("rgba(255,255,255,0.6)").drawRect(0,-1.5,CANVAS_WIDTH,3);e.addChild(b);f=new createjs.Shape;f.graphics.beginFill("rgba(255,255,255,0.6)").drawRect(-1.5,0,3,CANVAS_HEIGHT);e.addChild(f);h=new createjs.Shape;h.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(356,118,1208,844);e.addChild(h);b.mask=h;f.mask=h;c=new createjs.Container;
c.mask=h;e.addChild(c);g=new createjs.Text("0"," 34px "+SECONDARY_FONT,"#000000");g.x=54;g.y=-46;g.textAlign="left";g.textBaseline="middle";c.addChild(g);d=new createjs.Text("0"," 34px "+SECONDARY_FONT,"#ffffff");d.x=50;d.y=-50;d.textAlign="left";d.textBaseline="middle";c.addChild(d)};this.updatePos=function(a,e){f.x=a/s_iScaleFactor;b.y=e/s_iScaleFactor;c.x=a/s_iScaleFactor;c.y=e/s_iScaleFactor;var h=parseInt(a),k=parseInt(e);d.text="("+h+","+k+")";g.text="("+h+","+k+")"};this.show=function(a){e.visible=
a};this._init(a)}
function CAI(a){var e,b,f,h,c,d,g,m,l;this._init=function(a){e=AI_STATE_NEW_COORDINATE;b=AI_FIND_DIRECTION;f=[];h=[DIR_RIGHT,DIR_BOT,DIR_LEFT,DIR_TOP];d=[];g=[];l=null};this.getCoordinate=function(a){switch(e){case AI_STATE_NEW_COORDINATE:return this._getRandomCoordinate(a);case AI_STATE_FIND_SHIP_NEIGHBOR:return this._getLastDirectionCoordinate()}};this._getRandomCoordinate=function(d){f=[];for(d=0;d<NUM_CELL;d++)for(var g=0;g<NUM_CELL;g++)a.getCellState(d,g)===CELL_STATE_VOID&&f.push({row:d,col:g});
d=f[Math.floor(Math.random()*f.length)];this._predictHit(d.row,d.col)===PREDICT_HIT&&(b=AI_FIND_DIRECTION,e=AI_STATE_FIND_SHIP_NEIGHBOR,c=[],c.push(d),this._setViableDirection(c[0]));return d};this._getLastDirectionCoordinate=function(){switch(b){case AI_FIND_DIRECTION:l=h[Math.floor(Math.random()*h.length)];var d=s_oBoardUtility.getNeighborByDir(c[0].row,c[0].col,l);var g=this._predictHit(d.row,d.col);g===PREDICT_HIT?(b=AI_FOLLOW_DIRECTION,c.push(d)):this._removeDirection();break;case AI_FOLLOW_DIRECTION:d=
c[c.length-1];d=s_oBoardUtility.getNeighborByDir(d.row,d.col,l);if(null===d||a.getCellState(d.row,d.col)===CELL_STATE_WATER)return b=AI_REVERSE_DIRECTION,this._getLastDirectionCoordinate();c.push(d);g=this._predictHit(d.row,d.col);g===PREDICT_WATER&&(b=AI_REVERSE_DIRECTION);break;case AI_REVERSE_DIRECTION:d=l;this._removeDirection();l=s_oBoardUtility.getReverseDirection(d);d=s_oBoardUtility.getNeighborByDir(c[0].row,c[0].col,l);if(null===d||a.getCellState(d.row,d.col)===CELL_STATE_WATER)return this._setCarrierFound(),
this._getLastDirectionCoordinate();g=this._predictHit(d.row,d.col);g===PREDICT_WATER?this._setCarrierFound():b=AI_FOLLOW_REVERSE;c.push(d);break;case AI_FOLLOW_REVERSE:d=c[c.length-1];d=s_oBoardUtility.getNeighborByDir(d.row,d.col,l);if(null===d||a.getCellState(d.row,d.col)===CELL_STATE_WATER)return this._setCarrierFound(),this._getLastDirectionCoordinate();c.push(d);g=this._predictHit(d.row,d.col);g===PREDICT_WATER&&this._setCarrierFound();break;case AI_FOLLOW_CARRIER:d=this._findCarrierCell()}return d};
this._findCarrierCell=function(){if(0<d.length){var b=d[0];d.splice(0,1);0===d.length&&(d=s_oBoardUtility.getNeighborByShift(m,g[0]),m=s_oBoardUtility.getNeighborByShift(m,g[0]),null===d[0]||a.getCellState(d[0].row,d[0].col)===CELL_STATE_WATER)&&(0<g.length?(g.splice(0,1),d=s_oBoardUtility.getNeighborByShift(c,g[0]),m=s_oBoardUtility.getNeighborByShift(c,g[0])):(e=AI_STATE_NEW_COORDINATE,l=null,c=[]));var f=this._predictHit(b.row,b.col);f===PREDICT_WATER&&0<g.length&&(c.push(b),d=[],g.splice(0,1))}else{this._removeWaterCell();
d=s_oBoardUtility.getNeighborByShift(c,g[0]);m=s_oBoardUtility.getNeighborByShift(c,g[0]);if(null===d[0]||a.getCellState(d[0].row,d[0].col)===CELL_STATE_WATER)g.splice(0,1),d=s_oBoardUtility.getNeighborByShift(c,g[0]),m=s_oBoardUtility.getNeighborByShift(c,g[0]);b=d[0];d.splice(0,1);f=this._predictHit(b.row,b.col);f===PREDICT_WATER&&(c.push(b),d=[],g.splice(0,1))}return b};this._predictHit=function(c,b){var d=a.isShipOn(c,b);if(null!==d){d=d.getListCellOccupied();for(var g=[],e=0;e<d.length;e++)d[e].row===
c&&d[e].col===b||g.push(d[e]);d=this._checkSunk(g)?PREDICT_SUNK:PREDICT_HIT}else d=PREDICT_WATER;return d};this._checkSunk=function(a){for(var c=!0,b=0;b<a.length;b++)a[b].hit||(c=!1);return c};this._setCarrierFound=function(){b=AI_FOLLOW_CARRIER;g=c[0].row===c[1].row?[DIR_TOP,DIR_BOT]:[DIR_LEFT,DIR_RIGHT];shuffle(g)};this.resetToStartState=function(){b=AI_FIND_DIRECTION;e=AI_STATE_NEW_COORDINATE;l=null;c=[]};this._setViableDirection=function(c){h=[];h=s_oBoardUtility.getCrossDir(c.row,c.col);for(var b=
h.length-1;0<=b;b--){var d=s_oBoardUtility.getNeighborByDir(c.row,c.col,h[b]);a.getCellState(d.row,d.col)===CELL_STATE_WATER&&h.splice(b,1)}};this._removeDirection=function(){var a=h.indexOf(l);h.splice(a,1);l=null};this._removeWaterCell=function(){for(var b=c.length-1;0<=b;b--)a.getCellState(c[b].row,c[b].col)===CELL_STATE_WATER&&c.splice(b,1)};this._init(a)}
function CTurnWaiter(a){var e,b,f,h,c,d;this._init=function(a){e=new createjs.Container;e.x=0;e.y=0;var m=CANVAS_WIDTH,q=CANVAS_HEIGHT;m=(new createjs.Graphics).beginFill("rgba(0,0,0,0.2)").drawRect(0,0,m,q);f=new createjs.Shape(m);d=f.on("click",function(){});b=new createjs.Text("","60px "+PRIMARY_FONT,"#ffffff");b.x=0;b.y=-55;b.textAlign="center";b.textBaseline="alphabetic";b.lineWidth=800;h=new createjs.Text("","180px "+PRIMARY_FONT,"#ffffff");h.x=-85;h.y=10;h.textAlign="left";h.textBaseline="alphabetic";
h.lineWidth=800;c=new createSprite(s_oWaitPlayerSpritesheet,"idle",0,0,0,0);c.x=CANVAS_WIDTH/2-270;c.y=CANVAS_HEIGHT/2-200;e.addChild(f,b,h,c);a.addChild(e);g.hide()};this.show=function(a){null==a&&(a="");b.text=a;e.visible=!0};this.hide=function(){b.text="";e.visible=!1};this.unload=function(){f.off("click",d);a.removeChild(e)};this.update=function(){};var g=this;this._init(a)}
function CAirStrike(a){var e,b=CANVAS_WIDTH+200,f=CANVAS_HEIGHT-400;this._init=function(a){e=new createjs.Container;e.x=b;e.y=f;e.scaleX=e.scaleY=.6;a.addChild(e);a=s_oSpriteLibrary.getSprite("air");var c=createBitmap(a);c.regX=a.width/2;c.regY=a.height/2;e.addChild(c);a=s_oSpriteLibrary.getSprite("air_shadow");c=createBitmap(a);c.x=50;c.y=500;c.scaleX=c.scaleY=.75;c.regX=a.width/2;c.regY=a.height/2;e.addChild(c)};this.unload=function(){a.removeChild(e)};this.endAnim=function(a,b,g){playSound("air_strike",
1,!1);e.x=a.x;e.y=a.y;createjs.Tween.get(e).to({x:b.x,y:b.y},g).call(function(){h.unload()})};this.launch=function(){playSound("air_strike",1,!1);e.x=b;e.y=f;s_oGame.setNumMissileShot(NUM_BOMB_AIRSTRIKE);createjs.Tween.get(e).to({x:-250,y:-300},2E3,createjs.Ease.cubicIn);var c=this._getCellToHit();setTimeout(function(){for(var b=0;b<NUM_BOMB_AIRSTRIKE;b++)(new CMissile(a)).launchAirMissile({x:e.x,y:e.y},{row:c[b].row,col:c[b].col},.8+.4*Math.random())},1100)};this._getCellToHit=function(){for(var a=
s_oGame.getBoard(OPPONENT),b=[],g=0;g<NUM_CELL;g++)for(var e=0;e<NUM_CELL;e++)if(a.getCellState(g,e)===CELL_STATE_VOID){for(var f=s_oBoardUtility.getCrossNeighbor(g,e),h=!0,k=0;k<f.length;k++){var n=f[k];a.getCellState(n.row,n.col)===CELL_STATE_HIT&&(h=!1)}h&&b.push({row:g,col:e})}do for(a=[],g=0;g<NUM_BOMB_AIRSTRIKE;g++)a.push(b[Math.floor(Math.random()*b.length)]);while(this._checkNearCell(a));return a};this._checkNearCell=function(a){for(var c=0;c<a.length-1;c++){var b=a[c];b=s_oBoardUtility.getCrossNeighbor(b.row,
b.col);for(var e=0;e<b.length;e++)for(var f=c+1;f<a.length;f++)if(this._isEqual(a[c],a[f])||this._isEqual(b[e],a[f]))return!0}return!1};this._isEqual=function(a,b){return a.row===b.row&&a.col===b.col?!0:!1};var h=this;this._init(a)}var DIR_TOPRIGHT="DIR_TOPRIGHT",DIR_RIGHT="DIR_RIGHT",DIR_BOTRIGHT="DIR_BOTRIGHT",DIR_TOPLEFT="DIR_TOPLEFT",DIR_LEFT="DIR_LEFT",DIR_BOTLEFT="DIR_BOTLEFT",DIR_TOP="DIR_TOP",DIR_BOT="DIR_BOT";
function CBoardUtility(a){var e,b,f,h;this._init=function(a){e=a.length;b=a[0].length;h=[];f=[];for(a=0;a<e;a++){f[a]=[];for(var c=0;c<b;c++)f[a][c]=[]}this._buildMap()};this._buildMap=function(){for(var a=0;a<e;a++)for(var d=0;d<b;d++)f[a][d][DIR_TOPRIGHT]=this._setNeighbor(a,d,DIR_TOPRIGHT),f[a][d][DIR_RIGHT]=this._setNeighbor(a,d,DIR_RIGHT),f[a][d][DIR_BOTRIGHT]=this._setNeighbor(a,d,DIR_BOTRIGHT),f[a][d][DIR_TOPLEFT]=this._setNeighbor(a,d,DIR_TOPLEFT),f[a][d][DIR_LEFT]=this._setNeighbor(a,d,DIR_LEFT),
f[a][d][DIR_BOTLEFT]=this._setNeighbor(a,d,DIR_BOTLEFT),f[a][d][DIR_TOP]=this._setNeighbor(a,d,DIR_TOP),f[a][d][DIR_BOT]=this._setNeighbor(a,d,DIR_BOT)};this._setNeighbor=function(a,d,g){var c=null;switch(g){case DIR_TOPRIGHT:0<a&&d<b-1&&(c={row:a-1,col:d+1});break;case DIR_RIGHT:d<b-1&&(c={row:a,col:d+1});break;case DIR_BOTRIGHT:a<e-1&&d<b-1&&(c={row:a+1,col:d+1});break;case DIR_TOPLEFT:0<a&&0<d&&(c={row:a-1,col:d-1});break;case DIR_LEFT:0<d&&(c={row:a,col:d-1});break;case DIR_BOTLEFT:a<e-1&&0<d&&
(c={row:a+1,col:d-1});break;case DIR_TOP:0<a&&(c={row:a-1,col:d});break;case DIR_BOT:a<e-1&&(c={row:a+1,col:d})}return c};this.getNeighborByDir=function(a,b,g){return f[a][b][g]};this.getAllNeighbor=function(a,b){var c=[],d;for(d in f[a][b])null!==f[a][b][d]&&c.push(f[a][b][d]);return c};this.getCrossDir=function(a,b){for(var c=[],d=[DIR_TOP,DIR_RIGHT,DIR_BOT,DIR_LEFT],e=0;e<d.length;e++)null!==this.getNeighborByDir(a,b,d[e])&&c.push(d[e]);return c};this.getCrossNeighbor=function(a,b){for(var c=[],
d=[DIR_TOP,DIR_RIGHT,DIR_BOT,DIR_LEFT],e=0;e<d.length;e++){var f=this.getNeighborByDir(a,b,d[e]);null!==f&&c.push(f)}return c};this._getMainDiagonal=function(a,b,g){var c=[],d=g[a][b].getColor();this._findInDirection(a,b,DIR_BOTRIGHT,c,99,d,g);this._findInDirection(a,b,DIR_TOPLEFT,c,99,d,g);return c};this._getSecondDiagonal=function(a,b,g){var c=[],d=g[a][b].getColor();this._findInDirection(a,b,DIR_BOTLEFT,c,99,d,g);this._findInDirection(a,b,DIR_TOPRIGHT,c,99,d,g);return c};this._getRow=function(a,
b,g){var c=[],d=g[a][b].getColor();this._findInDirection(a,b,DIR_LEFT,c,99,d,g);this._findInDirection(a,b,DIR_RIGHT,c,99,d,g);return c};this._getCol=function(a,b,g){var c=[],d=g[a][b].getColor();this._findInDirection(a,b,DIR_TOP,c,99,d,g);this._findInDirection(a,b,DIR_BOT,c,99,d,g);return c};this._getStraightByDirAndRadius=function(a,b,g,e,f){var c=[];h=[];h.push({radius:e,direction:null});var d=f[a][b].getColor();this._findInDirection(a,b,g,c,e,d,f);return c};this._getStraightRowByRadius=function(a,
b,e){var c=[];h=[];h.push({radius:e,direction:null});this._findInDirection(a,b,DIR_LEFT,c,e);this._findInDirection(a,b,DIR_RIGHT,c,e);return c};this._getStraightColByRadius=function(a,b,e){var c=[];h=[];h.push({radius:e,direction:null});this._findInDirection(a,b,DIR_TOP,c,e);this._findInDirection(a,b,DIR_BOT,c,e);return c};this._findInDirection=function(a,b,e,m,l){--l;if(null!==f[a][b][e]&&0<=l){var c=f[a][b][e].row;a=f[a][b][e].col;m.push({row:c,col:a});h.push({radius:l,direction:e});this._findInDirection(c,
a,e,m,l)}};this.getNeighborByShift=function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=this.getNeighborByDir(a[d].row,a[d].col,b);return c};this.getReverseDirection=function(a){switch(a){case DIR_RIGHT:var b=DIR_LEFT;break;case DIR_BOT:b=DIR_TOP;break;case DIR_LEFT:b=DIR_RIGHT;break;case DIR_TOP:b=DIR_BOT}return b};this._init(a);s_oBoardUtility=this}var s_oBoardUtility;
function CBattleCell(a,e,b,f,h,c){var d,g,m,l,q,k,n;this._init=function(a,b,c,e,f,h){d=CELL_STATE_VOID;n=k=null;g=new createjs.Container;g.x=a;g.y=b;c.addChild(g);m=new createSprite(s_oBattleCellSpritesheet,"void",0,0,0,0);g.addChild(m);l=new createSprite(s_oMissileWaterSpritesheet,"stop",0,0,0,0);l.x=a+c.x;l.y=b+c.y;h.addChild(l);q=new createSprite(s_oMissileExplosionSpritesheet,"stop",0,0,0,0);q.x=a+c.x;q.y=b+c.y;h.addChild(q)};this.unload=function(){b.removeChild(g)};this.getPos=function(){return{x:a,
y:e}};this.debug=function(){var a=new createjs.Text(f+","+h," 14px Arial","#ffffff");a.textAlign="center";a.textBaseline="middle";a.lineWidth=200;g.addChild(a)};this.playWater=function(){l.gotoAndPlay("idle");playSound("missile_water",1,!1)};this.playExplosion=function(){q.gotoAndPlay("idle");playSound("missile_explosion",1,!1)};this.getState=function(){return d};this.setState=function(a){d=a;m.gotoAndStop(a);a===CELL_STATE_SUNK&&m.gotoAndStop(CELL_STATE_HIT)};this.setFinalExplosion=function(){playSound("missile_sink",
1,!1);n=new createSprite(s_oFinalExplosionSpritesheet,"idle",0,0,0,0);n.x=a+b.x;n.y=e+b.y;c.addChild(n)};this.setFire=function(){k=new createSprite(s_oFireSpritesheet,"idle",0,0,0,0);k.x=a+b.x;k.y=e+b.y;c.addChild(k)};this.removeFire=function(){null!==k&&k.gotoAndStop("stop")};this._init(a,e,b,f,h,c)}
function CAnimationSettings(){this._init=function(){this._initShips();this._initBattleCell();this._initMissile();this._initEnvironment();this._initGUI()};this._initShips=function(){s_aShipSpritesheet=[];for(var a=0;6>a;a++){var e=s_oSpriteLibrary.getSprite("ship"+a+"_3d");s_aShipSpritesheet[a]=new createjs.SpriteSheet({images:[e],frames:{width:e.width/6,height:e.height/5,regX:0,regY:0},animations:{idle:[0,29],stop:[30,30]}})}};this._initBattleCell=function(){var a=s_oSpriteLibrary.getSprite("cell_battle"),
e=a.width/3,b=a.height;a={images:[a],frames:{width:e,height:b,regX:e/2,regY:b/2},animations:{"void":[0],water:[1],hit:[2]}};s_oBattleCellSpritesheet=new createjs.SpriteSheet(a);a=s_oSpriteLibrary.getSprite("cell_control");e=a.width/5;b=a.height;a={images:[a],frames:{width:e,height:b,regX:e/2,regY:b/2},animations:{"void":[0],hit:[1],sunk:[2],water:[3],selection:[4]}};s_oControlCellSpritesheet=new createjs.SpriteSheet(a)};this._initMissile=function(){var a=s_oSpriteLibrary.getSprite("missile_reactor"),
e=a.width/2,b=a.height;a={images:[a],frames:{width:e,height:b,regX:e/2,regY:b/2},animations:{idle:[0,1]}};s_oMissileReactorSpritesheet=new createjs.SpriteSheet(a);a=s_oSpriteLibrary.getSprite("missile_smoke");e=a.width/5;b=a.height/10;a={images:[a],frames:{width:e,height:b,regX:e/2+20,regY:b/2},animations:{idle:[0,49,"stop"],stop:[50,50]}};s_oMissileSmokeSpritesheet=new createjs.SpriteSheet(a);a=s_oSpriteLibrary.getSprite("missile_water");e=a.width/7;b=a.height/4;a={images:[a],frames:{width:e,height:b,
regX:e/2,regY:b/2+40},animations:{idle:[0,27,"stop"],stop:[28,28]}};s_oMissileWaterSpritesheet=new createjs.SpriteSheet(a);a=s_oSpriteLibrary.getSprite("missile_explosion");e=a.width/6;b=a.height/5;a={framerate:15,images:[a],frames:{width:e,height:b,regX:e/2,regY:b/2},animations:{idle:[0,29,"stop"],stop:[30,30]}};s_oMissileExplosionSpritesheet=new createjs.SpriteSheet(a)};this._initEnvironment=function(){var a=s_oSpriteLibrary.getSprite("fire"),e=a.width/5,b=a.height/6;a={framerate:15,images:[a],
frames:{width:e,height:b,regX:e/2,regY:b-6},animations:{idle:[0,29],stop:[30,30]}};s_oFireSpritesheet=new createjs.SpriteSheet(a);a=s_oSpriteLibrary.getSprite("final_explosion");e=a.width/8;b=a.height/5;a={images:[a],frames:{width:e,height:b,regX:e/2,regY:b/2},animations:{idle:[0,39,"stop"],stop:[40,40]}};s_oFinalExplosionSpritesheet=new createjs.SpriteSheet(a);a=s_oSpriteLibrary.getSprite("wait_player");e=a.width/9;b=a.height/6;a={images:[a],frames:{width:e,height:b,regX:e/2,regY:b/2},animations:{idle:[0,
49],stop:[50,50]}};s_oWaitPlayerSpritesheet=new createjs.SpriteSheet(a)};this._initGUI=function(){var a=s_oSpriteLibrary.getSprite("but_radar"),e=a.width/15,b=a.height/4;s_oRadarSpritesheet=new createjs.SpriteSheet({images:[a],frames:{width:e,height:b,regX:e/2,regY:b/2},animations:{idle:[0,58],disable:[59,59]}})};this._init()}
var s_aShipSpritesheet,s_oBattleCellSpritesheet,s_oControlCellSpritesheet,s_oMissileReactorSpritesheet,s_oMissileSmokeSpritesheet,s_oMissileWaterSpritesheet,s_oMissileExplosionSpritesheet,s_oFireSpritesheet,s_oFinalExplosionSpritesheet,s_oWaitPlayerSpritesheet,s_oRadarSpritesheet;
function CPlayerBoard(a,e,b,f,h,c){var d,g,m,l;this._init=function(a,b,c,d,e,g){l=new createjs.Container;l.x=a;l.y=b;c.addChild(l);this._initBoard();e===PLAYER&&this._setShips()};this._initBoard=function(){g=[];var a=0,b=0;g=[];for(var d=0;d<NUM_CELL;d++){g[d]=[];for(var e=0;e<NUM_CELL;e++){var f=new CBattleCell(a,b,l,d,e,c);h===PLAYER?(a+=32,b-=18):(a-=32,b+=18);g[d][e]=f}h===PLAYER?(a=32*(d+1),b=18*(d+1)):(a=32*-(d+1),b=18*-(d+1))}};this._setShips=function(){m=[];for(var a=0;a<f.length;a++){var b=
f[a].getType(),c=f[a].getListCellOccupied(),d=c[0].row;c=c[0].col;var e=new createSprite(s_aShipSpritesheet[b.battle_spritesheet],"idle",0,0,0,0);e.x=g[d][c].getPos().x;e.y=g[d][c].getPos().y;e.regX=b.reg_points.x;e.regY=b.reg_points.y;h===OPPONENT&&(e.rotation=180);f[a].isHorizontal()&&(e.scaleX=-1,e.regX=b.reg_points.inverseX,e.regY=b.reg_points.inverseY);m.push(e);l.addChild(e)}};this.isShipOn=function(a,b){for(var c=0;c<f.length;c++)for(var d=f[c].getListCellOccupied(),e=0;e<d.length;e++)if(d[e].row===
a&&d[e].col===b)return f[c];return null};this.sunkAnimation=function(a){this.hideShip(a.getType().index_type);a=a.getListCellOccupied();for(var b=[],c=0;c<a.length;c++)b.push(a[c]);shuffle(b);var e=0;d=setInterval(function(){g[b[e].row][b[e].col].removeFire();g[b[e].row][b[e].col].setFinalExplosion();e++;e===b.length&&clearInterval(d)},200)};this.setFire=function(a,b){g[a][b].setFire()};this.setCellState=function(a,b,c){g[a][b].setState(c)};this.getCellState=function(a,b){return g[a][b].getState()};
this.getCells=function(){return g};this.getCellPos=function(b,c){var d=g[b][c].getPos();return{x:d.x+a,y:d.y+e}};this.getBounds=function(){return l.getBounds()};this.getPos=function(){return{x:a,y:e}};this.playExplosion=function(a,b){g[a][b].playExplosion()};this.playWater=function(a,b){g[a][b].playWater()};this.hideShip=function(a){h===PLAYER&&(m[a].visible=!1)};this._init(a,e,b,f,h,c)}
function CControlPanel(){var a,e,b,f,h,c=null,d,g,m,l,q;this._init=function(){e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=0;q=e.on("mousedown",function(){});s_oStage.addChild(e);b=new createjs.Container;s_oStage.addChild(b);h=s_oSpriteLibrary.getSprite("control_panel");var a=createBitmap(h);a.regX=h.width/2;a.regY=h.height/2;b.addChild(a);b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT+h.height/2;f=new createjs.Container;b.addChild(f);this._initControlCells();
this._setAlphabeticCoordinate();this._setNumCoordinate();m=new createjs.Text(TEXT_COST+": "+COST_AIRSTRIKE," 30px "+SECONDARY_FONT,"#1ef400");m.textAlign="left";m.textBaseline="middle";m.x=390;m.y=-352;b.addChild(m);a=s_oSpriteLibrary.getSprite("but_air_strike");d=new CToggle(450,-274,a,!1,b);d.addEventListener(ON_MOUSE_UP,this._onAirStrike,this);d.addEventListener(ON_MOUSE_OVER,this._hideRuler,this);d.addEventListener(ON_MOUSE_OUT,this._showRuler,this);d.enable(!1);s_iMode===MODE_CLASSIC&&(d.setVisible(!1),
m.visible=!1);l=new createjs.Text(TEXT_COST+": "+COST_RADAR," 30px "+SECONDARY_FONT,"#1ef400");l.textAlign="left";l.textBaseline="middle";l.x=390;l.y=-144;b.addChild(l);g=new CAnimatedButton(450,-62,s_oRadarSpritesheet,b);g.addEventListener(ON_MOUSE_UP,this._onRadar,this);g.addEventListener(ON_MOUSE_OVER,this._hideRuler,this);g.addEventListener(ON_MOUSE_OUT,this._showRuler,this);g.enable(!1);s_iMode===MODE_CLASSIC&&(g.setVisible(!1),l.visible=!1);c=new CRuler(b)};this.unload=function(){s_oStage.removeChild(e);
s_oStage.removeChild(b);d.unload();g.unload();e.off("mousedown",q)};this._initControlCells=function(){var b=NUM_CELL,c=CONTROL_CELL_DIM,d=NUM_CELL/2*CONTROL_CELL_DIM-c/2;a=[];for(var e=0;e<b;e++){a[e]=[];for(var g=0;g<b;g++)a[e][g]=new CControlCell(d-g*c,d-e*c,f,e,g)}};this._setAlphabeticCoordinate=function(){for(var b=NUM_CELL-1;0<=b;b--){var c=new createjs.Text(String.fromCharCode(65+NUM_CELL-b-1)," 50px "+SECONDARY_FONT,"#60ff00");c.x=a[b][NUM_CELL-1].getPos().x-60;c.y=a[b][NUM_CELL-1].getPos().y;
c.textAlign="center";c.textBaseline="middle";f.addChild(c)}};this._setNumCoordinate=function(){for(var b=NUM_CELL-1;0<=b;b--){var c=new createjs.Text(NUM_CELL-b," 34px "+SECONDARY_FONT,"#60ff00");c.x=a[0][b].getPos().x;c.y=a[0][b].getPos().y+50;c.textAlign="center";c.textBaseline="middle";f.addChild(c)}};this.show=function(){b.visible=!0;createjs.Tween.get(e).to({alpha:.7},500);createjs.Tween.get(b).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartIn)};this.hide=function(){createjs.Tween.removeTweens(e);
b.visible=!1;b.y=CANVAS_HEIGHT+h.height/2;e.alpha=0};this._showRuler=function(){c.show(!0)};this._hideRuler=function(){c.show(!1)};this.refresh=function(b){for(var c=0;c<a.length;c++)for(var e=0;e<a[c].length;e++){var f=b[c][e].getState();a[c][e].setState(f);a[c][e].disableHighlight()}b=s_oGame.getScore();b>COST_AIRSTRIKE&&d.enable(!0);b>COST_RADAR&&g.enable(!0)};this._onAirStrike=function(){this._showRuler();d.enable(!1);s_oGame.addScore(-COST_AIRSTRIKE);k.hide();s_oGame.launchAirStrike()};this._onRadar=
function(){playSound("sonar",1,!1);this._showRuler();g.enable(!1);s_oGame.addScore(-COST_RADAR);for(var b=s_oGame.getRandomAvailableShip(OPPONENT).getListCellOccupied(),c=[],d=0;d<b.length;d++)b[d].hit||c.push(b[d]);b=c[Math.floor(Math.random()*c.length)];a[b.row][b.col].highlight()};this.update=function(a){a&&c.updatePos(a.x,a.y)};var k=this;this._init()}
function CControlCell(a,e,b,f,h){var c,d,g,m,l,q,k;this._init=function(a,b,e,f,h){c=CELL_STATE_VOID;d=new createjs.Container;d.x=a;d.y=b;e.addChild(d);m=new createSprite(s_oControlCellSpritesheet,"void",0,0,0,0);d.addChild(m);g=new createSprite(s_oControlCellSpritesheet,"hit",0,0,0,0);g.alpha=0;d.addChild(g);a=new createjs.Shape;a.graphics.beginFill("rgba(158,0,0,0.01)").drawRect(-CONTROL_CELL_DIM/2,-CONTROL_CELL_DIM/2,CONTROL_CELL_DIM,CONTROL_CELL_DIM);d.addChild(a);l=d.on("mousedown",this._onCellClick,
this);q=d.on("mouseover",this._onCellOver,this);k=d.on("mouseout",this._onCellOut,this)};this.unload=function(){d.off("mousedown",l);d.off("mouseover",q);d.off("mouseout",k);b.removeChild(d)};this._onCellClick=function(){if(c===CELL_STATE_VOID)s_oGame.onCellClick(f,h)};this._onCellOver=function(){c===CELL_STATE_VOID&&m.gotoAndStop("selection")};this._onCellOut=function(){c===CELL_STATE_VOID&&m.gotoAndStop("void")};this.setState=function(a){c=a;m.gotoAndStop(a)};this.getState=function(){return c};
this.highlight=function(){createjs.Tween.get(g,{loop:!0}).to({alpha:1},500,createjs.Ease.cubicOut).to({alpha:0},500,createjs.Ease.cubicOut)};this.disableHighlight=function(){createjs.Tween.removeTweens(g);g.alpha=0};this.getPos=function(){return{x:d.x,y:d.y}};this._init(a,e,b,f,h)}
function CMissile(a,e){var b,f,h,c,d,g,m,l,q,k,n,t,u,r,x,B,y;this._init=function(a,e){b=!0;c=MISSILE_TYPE_NORMAL;d=0;g=50;m=new CVector2(0,0);q=new CVector2(0,-1);l=new CVector2(0,0);n=0;r=new createjs.Container;a.addChild(r);B=new createSprite(s_oMissileReactorSpritesheet,"idle",0,0,0,0);B.x=-1;B.y=28;B.visible=!1;r.addChild(B);var f=s_oSpriteLibrary.getSprite("missile");x=createBitmap(f);x.regX=f.width/2;x.regY=f.height/2;r.addChild(x);y=new createSprite(s_oMissileSmokeSpritesheet,"stop",0,0,0,
0);a.addChild(y)};this.reset=function(a,b,c){l.x=a;l.y=b;t=c;m=new CVector2(a,b);q=new CVector2(0,-1);l=new CVector2(a,b);n=0};this._findMiddlePoint=function(a,b,c){return c===PLAYER?a.y>b.y?a.x>b.x?new createjs.Point(a.x-.2*(a.x-b.x),b.y-200):new createjs.Point(b.x+.2*(b.x-a.x),b.y-200):a.x>b.x?new createjs.Point(a.x-.2*(a.x-b.x),a.y-200):new createjs.Point(b.x+.2*(b.x-a.x),a.y-200):a.y>b.y?a.x>b.x?new createjs.Point(a.x+.2*(a.x-b.x),b.y-200):new createjs.Point(b.x-.2*(b.x-a.x),b.y-200):a.x>b.x?
new createjs.Point(b.x+.2*(b.x-a.x),a.y-200):new createjs.Point(a.x-.2*(a.x-b.x),a.y-200)};this.launchMissileForPlayer=function(d,g){r.visible=!0;var f=this.getLaunchCoordinate(d,g,PLAYER),h=f.start;h.y-=17;var k=f.end,n=new createjs.Point(h.x,h.y);k=new createjs.Point(k.x,k.y);null!==f.ship&&4===f.ship.getType().battle_spritesheet?(c=MISSILE_TYPE_TORPEDO,f=s_oSpriteLibrary.getSprite("torpedo"),x.image=f,e.addChild(r),playSound("missile_torpedo",1,!1),b=!1,u=[new createjs.Point(n.x,n.y+17),k],r.rotation=
180/Math.PI*Math.atan2(k.y-n.y,k.x-n.x)+90,r.x=n.x,r.y=n.y+17):(c=MISSILE_TYPE_NORMAL,f=s_oSpriteLibrary.getSprite("missile"),x.image=f,a.addChild(r),playSound("missile_launch",1,!1),b=!1,f=this._findMiddlePoint(n,k,PLAYER),u=[n,f,k],y.gotoAndPlay("idle"),y.x=h.x,y.y=h.y,B.visible=!0,this.reset(n.x,n.y,1));return!0};this.launchMissileForOpponent=function(d,e){c=MISSILE_TYPE_NORMAL;var f=s_oSpriteLibrary.getSprite("missile");x.image=f;a.addChild(r);playSound("missile_launch",1,!1);b=!1;r.visible=!0;
var g=this.getLaunchCoordinate(d,e,OPPONENT);f=g.start;f.y-=17;var h=g.end;g=new createjs.Point(f.x,f.y);h=new createjs.Point(h.x,h.y);var k=this._findMiddlePoint(g,h,OPPONENT);u=[g,k,h];y.gotoAndPlay("idle");y.x=f.x;y.y=f.y;this.reset(g.x,g.y,1)};this.getLaunchCoordinate=function(a,b,c){f=a;h=b;var d=null;if(c===PLAYER){d=s_oGame.getRandomAvailableShip(PLAYER);c=d.getListCellOccupied();for(var e=[],g=0;g<c.length;g++)e.push(c[g]);for(g=e.length-1;0<=g;g--)e[g].hit&&e.splice(g,1);c=e[Math.floor(Math.random()*
e.length)];c=s_oGame.getCellPos(c.row,c.col,PLAYER);a=s_oGame.getCellPos(a,b,OPPONENT)}else c=s_oGame.getBoardPos(OPPONENT),a=s_oGame.getCellPos(a,b,PLAYER);return{start:c,end:a,ship:d}};this.setPos=function(a,b){m=new CVector2(l.x,l.y);l.x=a;l.y=b;k=new CVector2(a,b);k.subV(m);k.normalize();n=angleBetweenVector2D(q,k);n=m.getX()<a?radiansToDegree(n):-radiansToDegree(n)};this.launchAirMissile=function(a,b,c){var d=s_oGame.getCellPos(b.row,b.col,OPPONENT);r.x=a.x;r.y=a.y;r.alpha=0;r.rotation=-70;y.gotoAndPlay("idle");
y.x=a.x;y.y=a.y;createjs.Tween.get(r).to({alpha:1},300*c).call(function(){B.visible=!0;new CTremble(x,300,10,1);playSound("missile_launch",1,!1)});createjs.Tween.get(r).to({x:d.x},1400*c,createjs.Ease.quartIn);var e=50+50*Math.random();createjs.Tween.get(r).to({y:a.y+e},700*c,createjs.Ease.cubicOut).to({y:d.y},700*c,createjs.Ease.cubicIn).call(function(){s_oGame.onMissileArrived(b.row,b.col);r.visible=!1})};this.updateTorpedo=function(){if(!b){d++;d>g&&(d=0);var a=easeInQuart(d,0,1,g),c=new createjs.Point(u[0].x+
a*(u[1].x-u[0].x),u[0].y+a*(u[1].y-u[0].y));r.x=c.x;r.y=c.y;1===a&&(d=0,b=!0,r.visible=!1,s_oGame.onMissileArrived(f,h))}};this.updateMissile=function(){if(!b){d++;d>g&&(d=0);var a=easeInQuart(d,0,1,g),c=this.quad(a,u);this.setPos(c.x,c.y);this.updateGfx();1===a&&(d=0,b=!0,r.visible=!1,s_oGame.onMissileArrived(f,h))}};this.quad=function(a,b){var c=new createjs.Point,d=(1-a)*(1-a),e=a*a;c.x=d*b[0].x+2*(1-a)*a*b[1].x+e*b[2].x;c.y=d*b[0].y+2*(1-a)*a*b[1].y+e*b[2].y;return c};this.updateGfx=function(){r.x=
l.x;r.y=l.y;r.rotation=n*t};this.update=function(){switch(c){case MISSILE_TYPE_NORMAL:this.updateMissile();break;case MISSILE_TYPE_TORPEDO:this.updateTorpedo()}};this._init(a,e)}
function CTremble(a,e,b,f){var h,c,d,g,m,l,q;this._init=function(a,b,e,f){g=d=!1;l=0;this._calculateDuration();h=a.x;c=a.y;d||(d=!0,m=setInterval(function(){k._tremble()},e))};this._tremble=function(){if(g=!g){var n=.5>Math.random()?-f:f;var t=.5>Math.random()?-f:f;a.x+=n;a.y+=t}else a.x=h,a.y=c;l++;l>q&&(l=0,d=!1,0===e?m=setInterval(function(){k._tremble()},b):clearInterval(m))};this._calculateDuration=function(){q=e/b};this.stopTremble=function(){clearInterval(m)};var k=this;this._init(a,e,b,f)}
function CVector2(a,e){var b,f;this._init=function(a,c){b=a;f=c};this.add=function(a,c){b+=a;f+=c};this.addV=function(a){b+=a.getX();f+=a.getY()};this.scalarDivision=function(a){b/=a;f/=a};this.subV=function(a){b-=a.getX();f-=a.getY()};this.scalarProduct=function(a){b*=a;f*=a};this.invert=function(){b*=-1;f*=-1};this.dotProduct=function(a){return b*a.getX()+f*a.getY()};this.set=function(a,c){b=a;f=c};this.setV=function(a){b=a.getX();f=a.getY()};this.length=function(){return Math.sqrt(b*b+f*f)};this.length2=
function(){return b*b+f*f};this.normalize=function(){var a=this.length();0<a&&(b/=a,f/=a)};this.getNormalize=function(a){this.length();a.set(b,f);a.normalize()};this.rot90CCW=function(){var a=b;b=-f;f=a};this.rot90CW=function(){var a=b;b=f;f=-a};this.getRotCCW=function(a){a.set(b,f);a.rot90CCW()};this.getRotCW=function(a){a.set(b,f);a.rot90CW()};this.ceil=function(){b=Math.ceil(b);f=Math.ceil(f)};this.round=function(){b=Math.round(b);f=Math.round(f)};this.toString=function(){return"Vector2: "+b+", "+
f};this.print=function(){trace("Vector2: "+b+", "+f)};this.getX=function(){return b};this.getY=function(){return f};this._init(a,e)}
function CBackground(a){var e,b,f;this._init=function(a){f=new createjs.Container;a.addChild(f);if(s_bMobile)a=s_oSpriteLibrary.getSprite("sea_mobile"),a=createBitmap(a),f.addChild(a);else{var c=a=e=0;b=[];for(var d=0;32>=d;d++)b.push(new CSeaAnimation(a,c,f)),a+=SEA_PIECE_DIM/2,0===d%8&&0<d&&(c+=SEA_PIECE_DIM/2,a=0)}a=s_oSpriteLibrary.getSprite("bg_rocks");a=createBitmap(a);f.addChild(a)};this.update=function(){e++;if(1<e)for(var a=e=0;a<b.length;a++)b[a].update()};this._init(a)}
function CSeaAnimation(a,e,b){var f,h,c,d;this._init=function(a,b,e){d=new createjs.Container;d.x=a;d.y=b;d.scaleX=d.scaleY=.5;e.addChild(d);h=37;f=Math.floor(Math.random()*h);c=[];for(a=0;a<=h;a++)b=s_oSpriteLibrary.getSprite("surface_"+a),c[a]=createBitmap(b),c[a].visible=!1,d.addChild(c[a]);c[0].visible=!0};this._idle=function(){0===f?(c[h].visible=!1,c[0].visible=!0):(c[f-1].visible=!1,c[f].visible=!0);f++;f>h&&(f=0)};this.update=function(){this._idle()};this._init(a,e,b)}
function CSummaryPanel(a,e,b){var f,h,c,d,g,m,l,q,k;this._init=function(a,b,c){d=new createjs.Container;this.setPos(a,b);c.addChild(d);a=s_oSpriteLibrary.getSprite("your_fleet_panel");g=createBitmap(a);g.regY=a.height;d.addChild(g);l=new createjs.Text(TEXT_YOUR_FLEET," 30px "+SECONDARY_FONT,"#04b700");l.x=a.width/2;l.y=-a.height+28;l.textAlign="center";l.textBaseline="alphabetic";l.lineWidth=600;l.lineHeight=40;d.addChild(l);b=s_oSpriteLibrary.getSprite("enemy_fleet_panel");m=createBitmap(b);m.x=
a.width;m.regY=b.height;d.addChild(m);m=new createjs.Text(TEXT_ENEMY_FLEET," 30px "+SECONDARY_FONT,"#b81e00");m.x=a.width+130;m.y=-b.height+28;m.textAlign="center";m.textBaseline="alphabetic";m.lineWidth=600;m.lineHeight=40;d.addChild(m);c=s_oSpriteLibrary.getSprite("score_panel");q=createBitmap(c);q.x=2*a.width-50;q.y=-b.height;d.addChild(q);k=new createjs.Text(TEXT_SCORE+": 0"," 30px "+SECONDARY_FONT,"#04b700");k.x=q.x+20;k.y=q.y+18;k.textAlign="left";k.textBaseline="middle";k.lineWidth=600;d.addChild(k);
this.setYourFill();this.setText()};this.setYourFill=function(){f=[];for(var a=0;6>a;a++){var b=s_oSpriteLibrary.getSprite("fill_"+a),c=createBitmap(b);c.regX=b.width/2;c.regY=b.height/2;c.x=SHIPS_TYPE[a].fill_pos.x;c.y=SHIPS_TYPE[a].fill_pos.y;d.addChild(c);f[a]=new createjs.Shape;f[a].graphics.beginFill("rgba(255,255,255,0.01)").drawRect(0,0,b.width,b.height);f[a].x=SHIPS_TYPE[a].fill_pos.x-b.width/2;f[a].y=SHIPS_TYPE[a].fill_pos.y-b.height/2;d.addChild(f[a]);c.mask=f[a];f[a].scaleX=0}};this.setText=
function(){h=[];for(var a=0;6>a;a++)h[a]=new createjs.Text(TEXT_SUNK," 30px "+SECONDARY_FONT,"#ff7200"),h[a].x=SHIPS_TYPE[a].fill_pos.x,h[a].y=SHIPS_TYPE[a].fill_pos.y+10,h[a].textAlign="center",h[a].textBaseline="middle",h[a].lineWidth=200,h[a].visible=!1,h[a].rotation=15,d.addChild(h[a]);c=[];for(a=0;6>a;a++)c[a]=new createjs.Text(TEXT_SUNK," 30px "+SECONDARY_FONT,"#ff7200"),c[a].x=SHIPS_TYPE[a].enemy_sunk_pos.x,c[a].y=SHIPS_TYPE[a].enemy_sunk_pos.y,c[a].textAlign="center",c[a].textBaseline="middle",
c[a].lineWidth=200,c[a].rotation=15,c[a].visible=!1,d.addChild(c[a])};this.setDamage=function(a){for(var b=0;b<a.length;b++){for(var c=a[b].getType(),d=a[b].getListCellOccupied(),e=d.length,g=0,k=0;k<e;k++)d[k].hit&&g++;f[c.battle_spritesheet].scaleX=g/e;g===e&&(h[c.battle_spritesheet].visible=!0)}};this.setEnemySunk=function(a){for(var b=0;b<a.length;b++){for(var d=a[b].getType(),e=a[b].getListCellOccupied(),f=e.length,g=0,h=0;h<f;h++)e[h].hit&&g++;g===f&&(c[d.battle_spritesheet].visible=!0)}};this.setScore=
function(a){k.text=TEXT_SCORE+": "+a};this.setPos=function(a,b){d.x=a;d.y=b};this._init(a,e,b)}
function CAnimatedButton(a,e,b,f){var h,c,d,g,m,l,q,k;this._init=function(a,b,d,e){h=!1;c=1;l=[];q=[];k=createSprite(d,"disable",60,60,120,120);k.x=a;k.y=b;k.scaleX=k.scaleY=c;e.addChild(k);this._initListener()};this.unload=function(){s_bMobile?k.off("mousedown",d):(k.off("mousedown",d),k.off("mouseover",m),k.off("mouseout",_iListenerIDMouseOut));k.off("pressup",g);f.removeChild(k)};this.setVisible=function(a){k.visible=a};this.setClickable=function(a){h=!a};this._initListener=function(){s_bMobile?
d=k.on("mousedown",this.buttonDown):(d=k.on("mousedown",this.buttonDown),m=k.on("mouseover",this.buttonOver),_iListenerIDMouseOut=k.on("mouseout",this.buttonOut));g=k.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){l[a]=b;q[a]=c};this.buttonRelease=function(){h||(k.scaleX=c,k.scaleY=c,l[ON_MOUSE_UP]&&l[ON_MOUSE_UP].call(q[ON_MOUSE_UP]))};this.buttonDown=function(){h||(k.scaleX=.9*c,k.scaleY=.9*c,playSound("click",1,!1),l[ON_MOUSE_DOWN]&&l[ON_MOUSE_DOWN].call(q[ON_MOUSE_DOWN]))};
this.buttonOver=function(a){s_bMobile||h||(a.target.cursor="pointer",l[ON_MOUSE_OVER]&&l[ON_MOUSE_OVER].call(q[ON_MOUSE_OVER]))};this.buttonOut=function(a){s_bMobile||h||(a.target.cursor="pointer",l[ON_MOUSE_OUT]&&l[ON_MOUSE_OUT].call(q[ON_MOUSE_OUT]))};this.pulseAnimation=function(){createjs.Tween.get(k).to({scaleX:.9*c,scaleY:.9*c},850,createjs.Ease.quadOut).to({scaleX:c,scaleY:c},650,createjs.Ease.quadIn).call(function(){n.pulseAnimation()})};this.trembleAnimation=function(){createjs.Tween.get(k).to({rotation:5},
75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){n.trebleAnimation()})};this.setPosition=function(a,b){k.x=a;k.y=b};this.setX=function(a){k.x=a};this.setY=function(a){k.y=a};this.getButtonImage=function(){return k};this.getX=function(){return k.x};this.getY=function(){return k.y};this.enable=function(a){a?(k.gotoAndPlay("idle"),this.setClickable(!0)):(k.gotoAndPlay("disable"),this.setClickable(!1))};var n=this;
this._init(a,e,b,f);return this};