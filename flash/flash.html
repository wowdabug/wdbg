<!DOCTYPE html>
<html>
  <head>
    <title>Flash</title>
    <script src="../scripts/title_favicon.js"></script>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        height: 100%;
        background-color: #333;
        color: white;
      }

      #gameSelector {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 1000;
      }

      #game {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #000;
      }

      ruffle-player {
        width: 100%;
        height: 100%;
      }
    </style>
    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  </head>
  <body>
    <select id="gameSelector" onchange="loadFlashGame()">
      <option value="" disabled selected>Select a game</option>
      <option value="swfs/breaking_the_bank.swf">Breaking the Bank</option>
      <option value="swfs/escaping_the_prison.swf">Escaping the Prison</option>
    </select>

    <div id="game"></div>

    <script>
      function loadFlashGame() {
        const gameContainer = document.getElementById("game");
        const selector = document.getElementById("gameSelector");
        const swfUrl = selector.value;

        if (!swfUrl) return;

        gameContainer.innerHTML = "";

        const player = document.createElement("ruffle-player");
        player.setAttribute("autoplay", "true");
        player.setAttribute("allowfullscreen", "true");
        player.style.border = "none";
        player.setAttribute("src", swfUrl);

        gameContainer.appendChild(player);
      }

      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      function loadGameFromURL() {
        const gameParam = getQueryParam("g");
        const hideSelector = getQueryParam("hs");
        const select = document.getElementById("gameSelector");

        if (hideSelector === "true") {
          select.style.display = "none";
        }

        if (gameParam) {
          for (let i = 0; i < select.options.length; i++) {
            if (
              select.options[i].text.trim().toLowerCase() ===
              decodeURIComponent(gameParam).trim().toLowerCase()
            ) {
              select.value = select.options[i].value;
              loadFlashGame();
              return;
            }
          }
        }

        select.selectedIndex = 0;
      }

      window.onload = loadGameFromURL;
    </script>
  </body>
</html>
